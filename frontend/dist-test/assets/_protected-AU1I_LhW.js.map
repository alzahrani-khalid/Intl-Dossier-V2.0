{"version":3,"file":"_protected-AU1I_LhW.js","sources":["../../src/hooks/useWorkQueueCounts.ts","../../src/hooks/use-mobile.tsx","../../src/components/LanguageToggle.tsx","../../src/components/Layout/navigation-config.ts","../../src/components/Layout/ProCollapsibleSidebar.tsx","../../src/components/Layout/MainLayout.tsx","../../src/components/ai/ToolResultCard.tsx","../../src/components/ai/ChatMessage.tsx","../../src/components/ai/ChatInput.tsx","../../src/hooks/useAIChat.ts","../../src/components/ai/ChatDock.tsx","../../src/contexts/ChatContext.tsx","../../src/routes/_protected.tsx?tsr-split=component"],"sourcesContent":["// Placeholder hook for work queue counts\n// TODO: Implement actual API call to fetch work queue counts\nexport function useWorkQueueCounts() {\n  return {\n    data: {\n      assignments: 0,\n      intake: 0,\n      waiting: 0,\n    },\n    isLoading: false,\n  };\n}\n","import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n React.useEffect(() => {\n const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n const onChange = () => {\n setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n }\n mql.addEventListener(\"change\", onChange)\n setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n return () => mql.removeEventListener(\"change\", onChange)\n }, [])\n\n return !!isMobile\n}\n","import { useCallback } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { switchLanguage, type SupportedLanguage } from '../i18n'\nimport { useUIStore } from '../store/uiStore'\nimport { cn } from '../lib/utils'\n\ninterface LanguageToggleProps {\n compact?: boolean\n}\n\nexport function LanguageToggle({ compact = false }: LanguageToggleProps) {\n const { i18n } = useTranslation()\n const { language, setLanguage } = useUIStore()\n\n const handleToggle = useCallback(async () => {\n const nextLang: SupportedLanguage = language === 'en' ? 'ar' : 'en'\n await switchLanguage(nextLang)\n setLanguage(nextLang)\n }, [language, setLanguage])\n\n const isRTL = language === 'ar'\n\n return (\n <button\n onClick={handleToggle}\n className={cn(\n 'relative flex items-center rounded-full transition-all duration-300',\n 'bg-background border border-border',\n 'hover:bg-accent',\n 'focus:outline-none',\n compact ? 'w-16 h-[30px] p-[3px]' : 'w-28 sm:w-32 h-9 p-1'\n )}\n aria-label={i18n.t('languages.switch', 'Switch language')}\n >\n {/* Sliding Toggle Background */}\n <div\n className={cn(\n 'absolute rounded-full transition-all duration-300 ease-in-out',\n 'bg-primary shadow-md',\n 'flex items-center justify-center',\n compact ? 'h-[22px] w-7 top-[3px]' : 'h-7 w-12 top-1',\n isRTL ? (compact ? 'end-[3px]' : 'end-1') : (compact ? 'start-[3px]' : 'start-1')\n )}\n />\n\n {/* EN Label */}\n <span\n className={cn(\n 'relative z-10 flex-1 text-center transition-all duration-300',\n compact ? 'text-[10px] font-semibold' : 'text-xs font-semibold',\n !isRTL ? 'text-primary-foreground' : 'text-muted-foreground'\n )}\n >\n EN\n </span>\n\n {/* AR Label */}\n <span\n className={cn(\n 'relative z-10 flex-1 text-center transition-all duration-300',\n compact ? 'text-[10px] font-semibold' : 'text-xs font-semibold',\n isRTL ? 'text-primary-foreground' : 'text-muted-foreground'\n )}\n >\n ع\n </span>\n </button>\n )\n}\n\n","import type { LucideIcon } from 'lucide-react'\nimport {\n  LayoutDashboard,\n  LayoutGrid,\n  CalendarDays,\n  Brain,\n  Database,\n  Users,\n  CheckSquare,\n  Inbox,\n  Clock,\n  Settings,\n  HelpCircle,\n  Folder,\n  MessageSquare,\n  ClipboardList,\n  ScrollText,\n  TrendingUp,\n  BarChart3,\n  Activity,\n  Download,\n  UserCog,\n  PenTool,\n  Shield,\n  Wrench,\n  Briefcase,\n  FileCheck,\n  Sparkles,\n  Sliders,\n} from 'lucide-react'\n\nexport interface NavigationItem {\n  id: string\n  label: string\n  path: string\n  icon: LucideIcon\n  badgeCount?: number\n  adminOnly?: boolean\n}\n\nexport interface NavigationSection {\n  id: string\n  label: string\n  items: NavigationItem[]\n}\n\nexport const createNavigationSections = (\n  counts: { assignments: number; intake: number; waiting: number },\n  isAdmin: boolean,\n): NavigationSection[] => {\n  const sections: NavigationSection[] = [\n    {\n      id: 'my-work',\n      label: 'navigation.myWork',\n      items: [\n        {\n          id: 'unified-work',\n          label: 'navigation.unifiedWork',\n          path: '/my-work',\n          icon: Briefcase,\n          badgeCount: counts.assignments + counts.intake + counts.waiting,\n        },\n        {\n          id: 'my-assignments',\n          label: 'navigation.myAssignments',\n          path: '/tasks',\n          icon: CheckSquare,\n          badgeCount: counts.assignments,\n        },\n        {\n          id: 'commitments',\n          label: 'navigation.commitments',\n          path: '/commitments',\n          icon: FileCheck,\n        },\n        {\n          id: 'intake-queue',\n          label: 'navigation.intakeQueue',\n          path: '/my-work/intake',\n          icon: Inbox,\n          badgeCount: counts.intake,\n        },\n        {\n          id: 'waiting-queue',\n          label: 'navigation.waitingQueue',\n          path: '/my-work/waiting',\n          icon: Clock,\n          badgeCount: counts.waiting,\n        },\n      ],\n    },\n    {\n      id: 'main',\n      label: 'Main',\n      items: [\n        {\n          id: 'dashboard',\n          label: 'navigation.dashboard',\n          path: '/dashboard',\n          icon: LayoutDashboard,\n        },\n        {\n          id: 'custom-dashboard',\n          label: 'navigation.customDashboard',\n          path: '/custom-dashboard',\n          icon: LayoutGrid,\n        },\n        {\n          id: 'approvals',\n          label: 'navigation.approvals',\n          path: '/approvals',\n          icon: CheckSquare,\n        },\n        {\n          id: 'dossiers',\n          label: 'navigation.dossiers',\n          path: '/dossiers',\n          icon: Folder,\n        },\n        {\n          id: 'positions',\n          label: 'navigation.positions',\n          path: '/positions',\n          icon: MessageSquare,\n        },\n        {\n          id: 'after-actions',\n          label: 'navigation.afterActions',\n          path: '/after-actions',\n          icon: ClipboardList,\n        },\n      ],\n    },\n    {\n      id: 'tools',\n      label: 'Tools',\n      items: [\n        {\n          id: 'calendar',\n          label: 'navigation.calendar',\n          path: '/calendar',\n          icon: CalendarDays,\n        },\n        {\n          id: 'briefs',\n          label: 'navigation.briefs',\n          path: '/briefs',\n          icon: ScrollText,\n        },\n        {\n          id: 'intelligence',\n          label: 'navigation.intelligence',\n          path: '/intelligence',\n          icon: Brain,\n        },\n        {\n          id: 'analytics',\n          label: 'navigation.analytics',\n          path: '/analytics',\n          icon: TrendingUp,\n        },\n        {\n          id: 'reports',\n          label: 'navigation.reports',\n          path: '/reports',\n          icon: BarChart3,\n        },\n      ],\n    },\n    {\n      id: 'documents',\n      label: 'Documents',\n      items: [\n        {\n          id: 'data-library',\n          label: 'navigation.dataLibrary',\n          path: '/data-library',\n          icon: Database,\n        },\n        {\n          id: 'word-assistant',\n          label: 'navigation.wordAssistant',\n          path: '/word-assistant',\n          icon: PenTool,\n        },\n      ],\n    },\n  ]\n\n  // Add admin section if user is admin\n  if (isAdmin) {\n    sections.push({\n      id: 'admin',\n      label: 'navigation.admin',\n      items: [\n        {\n          id: 'admin-system',\n          label: 'navigation.adminSystem',\n          path: '/admin/system',\n          icon: Wrench,\n          adminOnly: true,\n        },\n        {\n          id: 'admin-approvals',\n          label: 'navigation.adminApprovals',\n          path: '/admin/approvals',\n          icon: Shield,\n          adminOnly: true,\n        },\n        {\n          id: 'ai-usage',\n          label: 'navigation.aiUsage',\n          path: '/admin/ai-usage',\n          icon: Sparkles,\n          adminOnly: true,\n        },\n        {\n          id: 'ai-settings',\n          label: 'navigation.aiSettings',\n          path: '/admin/ai-settings',\n          icon: Sliders,\n          adminOnly: true,\n        },\n        {\n          id: 'users',\n          label: 'navigation.users',\n          path: '/users',\n          icon: UserCog,\n          adminOnly: true,\n        },\n        {\n          id: 'monitoring',\n          label: 'navigation.monitoring',\n          path: '/monitoring',\n          icon: Activity,\n          adminOnly: true,\n        },\n        {\n          id: 'export',\n          label: 'navigation.export',\n          path: '/export',\n          icon: Download,\n          adminOnly: true,\n        },\n      ],\n    })\n  }\n\n  return sections\n}\n\nexport const bottomNavigationItems: NavigationItem[] = [\n  {\n    id: 'settings',\n    label: 'navigation.settings',\n    path: '/settings',\n    icon: Settings,\n  },\n  {\n    id: 'help',\n    label: 'navigation.getHelp',\n    path: '/help',\n    icon: HelpCircle,\n  },\n]\n","import { useMemo, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Link, useLocation, useNavigate } from '@tanstack/react-router';\nimport { LogOut, User, Menu } from 'lucide-react';\nimport { motion, AnimatePresence } from 'motion/react';\nimport { IconArrowNarrowLeft } from '@tabler/icons-react';\nimport { cn } from '@/lib/utils';\nimport { useAuth } from '@/contexts/auth.context';\nimport { useWorkQueueCounts } from '@/hooks/useWorkQueueCounts';\nimport { useIsMobile } from '@/hooks/use-mobile';\nimport { LanguageToggle } from '@/components/LanguageToggle';\nimport { ThemeSelector } from '@/components/theme-selector/theme-selector';\nimport {\n  Sheet,\n  SheetContent,\n  SheetHeader,\n  SheetTitle,\n  SheetDescription,\n  SheetTrigger,\n} from '@/components/ui/sheet';\nimport { Button } from '@/components/ui/button';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from '@/components/ui/tooltip';\nimport {\n  createNavigationSections,\n  bottomNavigationItems,\n  type NavigationItem,\n  type NavigationSection,\n} from './navigation-config';\n\ninterface ProCollapsibleSidebarProps {\n  className?: string;\n  onLinkClick?: () => void; // Callback for mobile to close Sheet after navigation\n  isInSheet?: boolean; // Whether sidebar is rendered inside a mobile Sheet\n}\n\nexport function ProCollapsibleSidebar({ className, onLinkClick, isInSheet = false }: ProCollapsibleSidebarProps) {\n  const { t, i18n } = useTranslation();\n  const location = useLocation();\n  const navigate = useNavigate();\n  const { user, logout } = useAuth();\n  const isMobile = useIsMobile();\n  const isRTL = i18n.language === 'ar';\n\n  // Collapsible state (start expanded on desktop, always expanded in Sheet)\n  const [isOpen, setIsOpen] = useState(true);\n\n  // When in Sheet, always show as expanded\n  const effectiveIsOpen = isInSheet ? true : isOpen;\n\n  // Fetch work queue counts\n  const { data: workQueueCounts, isLoading: isLoadingCounts } = useWorkQueueCounts();\n  const counts = workQueueCounts || { assignments: 0, intake: 0, waiting: 0 };\n\n  // Check if user is admin\n  const isAdmin = user?.role === 'admin' || user?.role === 'super_admin';\n\n  // Generate navigation sections\n  const navigationSections = useMemo(\n    () => createNavigationSections(counts, isAdmin),\n    [counts, isAdmin]\n  );\n\n  const handleLogout = async () => {\n    await logout();\n    navigate({ to: '/login' });\n  };\n\n  const userInitials = useMemo(() => {\n    if (!user?.name && !user?.email) return 'GA';\n    const source = user.name ?? user.email ?? 'User';\n    return source\n      .split(' ')\n      .map((part) => part.charAt(0).toUpperCase())\n      .join('')\n      .slice(0, 2);\n  }, [user]);\n\n  // SidebarLink with animations\n  interface SidebarLinkProps {\n    item: NavigationItem;\n    isActive: boolean;\n    isRTL: boolean;\n  }\n\n  function SidebarLink({ item, isActive, isRTL }: SidebarLinkProps) {\n    const Icon = item.icon;\n    const labelText = t(item.label, item.label);\n\n    const linkContent = (\n      <Link\n        to={item.path}\n        onClick={onLinkClick} // Close mobile sheet after navigation\n        className=\"group/link relative block\"\n      >\n        {/* Hover background animation */}\n        <AnimatePresence>\n          {isActive && (\n            <motion.div\n              layoutId=\"active-sidebar-link\"\n              className=\"absolute inset-0 bg-sidebar-accent rounded-lg z-10\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n              transition={{ duration: 0.15 }}\n            />\n          )}\n        </AnimatePresence>\n\n        {/* Link content - Mobile-first with proper touch targets */}\n        <div\n          className={cn(\n            'relative z-20 flex items-center',\n            // Mobile-first: proper touch targets and spacing\n            'gap-2 px-3 py-3 sm:gap-3 sm:py-2.5 md:py-2',\n            'min-h-11 sm:min-h-10', // WCAG AA touch target minimum\n            'rounded-lg',\n            'text-sidebar-foreground transition-all duration-150',\n            'group-hover/link:bg-sidebar-accent/50',\n            isActive && 'font-medium text-sidebar-accent-foreground'\n          )}\n        >\n          <Icon\n            className={cn(\n              // Mobile-first icon sizing\n              'h-5 w-5 sm:h-4 sm:w-4 shrink-0 transition-transform duration-150',\n              'group-hover/link:translate-x-1',\n              isRTL && 'group-hover/link:-translate-x-1'\n            )}\n          />\n          <motion.span\n            className=\"text-sm whitespace-pre\"\n            animate={{\n              display: effectiveIsOpen ? 'inline-block' : 'none',\n              opacity: effectiveIsOpen ? 1 : 0,\n            }}\n            transition={{ duration: 0.15 }}\n          >\n            {labelText}\n          </motion.span>\n\n          {/* Badge for work queue counts */}\n          {item.badgeCount !== undefined && item.badgeCount > 0 && effectiveIsOpen && (\n            <motion.div\n              className={cn(\n                'ms-auto flex h-5 min-w-5 items-center justify-center',\n                'rounded-md px-1 bg-primary text-primary-foreground',\n                'text-xs font-medium tabular-nums'\n              )}\n              animate={{\n                display: effectiveIsOpen ? 'flex' : 'none',\n                opacity: effectiveIsOpen ? 1 : 0,\n              }}\n              transition={{ duration: 0.15 }}\n            >\n              {item.badgeCount > 99 ? '99+' : item.badgeCount}\n            </motion.div>\n          )}\n        </div>\n      </Link>\n    );\n\n    // Show tooltip when sidebar is collapsed\n    if (!effectiveIsOpen) {\n      return (\n        <Tooltip delayDuration={0}>\n          <TooltipTrigger asChild>{linkContent}</TooltipTrigger>\n          <TooltipContent side={isRTL ? 'left' : 'right'} className=\"flex items-center gap-2\">\n            {labelText}\n            {item.badgeCount !== undefined && item.badgeCount > 0 && (\n              <span className=\"flex h-5 min-w-5 items-center justify-center rounded-md px-1 bg-primary text-primary-foreground text-xs font-medium\">\n                {item.badgeCount > 99 ? '99+' : item.badgeCount}\n              </span>\n            )}\n          </TooltipContent>\n        </Tooltip>\n      );\n    }\n\n    return linkContent;\n  }\n\n  return (\n    <TooltipProvider delayDuration={0}>\n      <motion.div\n        className={cn(\n          // Mobile-first: sidebar is always full-width in Sheet, collapsible on desktop\n          'group/sidebar-btn relative flex flex-col h-screen flex-shrink-0',\n          'bg-sidebar text-sidebar-foreground',\n          // Only show border on desktop (not in mobile Sheet)\n          !isInSheet && 'border-r border-sidebar-border',\n          className\n        )}\n        // Only animate width on desktop (md:768px+), on mobile it's always full width in Sheet\n        animate={{ width: isMobile || isInSheet ? '100%' : (effectiveIsOpen ? '300px' : '70px') }}\n        transition={{ duration: 0.2, ease: 'easeInOut' }}\n        dir={isRTL ? 'rtl' : 'ltr'}\n      >\n      {/* Collapse/Expand Toggle Button - Desktop only with proper touch target */}\n      {!isInSheet && (\n        <button\n          onClick={() => setIsOpen(!isOpen)}\n          className={cn(\n            // RTL-compatible positioning\n            'absolute top-[20px] z-40',\n            isRTL ? '-start-3' : '-end-3',\n            // Touch-friendly size (44x44px minimum)\n            'min-h-11 min-w-11 flex items-center justify-center',\n            'rounded-md border-2 border-sidebar-border bg-sidebar shadow-md',\n            'transition duration-200',\n            'hover:bg-sidebar-accent hover:border-sidebar-accent-foreground/20',\n            'focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2',\n            // Only show on desktop, hide on mobile\n            'hidden md:flex',\n            // Show on hover for desktop\n            'md:opacity-0 md:group-hover/sidebar-btn:opacity-100',\n            // Rotation based on state and RTL\n            isOpen\n              ? (isRTL ? 'rotate-180' : 'rotate-0')\n              : (isRTL ? 'rotate-0' : 'rotate-180')\n          )}\n          aria-label={isOpen ? t('sidebar.collapse', 'Collapse sidebar') : t('sidebar.expand', 'Expand sidebar')}\n        >\n          <IconArrowNarrowLeft className=\"h-5 w-5 sm:h-4 sm:w-4 text-sidebar-foreground/80 hover:text-sidebar-foreground\" />\n        </button>\n      )}\n\n      {/* Header */}\n      <div className=\"px-4 py-4\">\n        <Link\n          to=\"/dashboard\"\n          className=\"flex items-center gap-3 transition-transform hover:scale-[1.02] active:scale-[0.98]\"\n        >\n          <div className=\"flex aspect-square size-8 items-center justify-center rounded-lg bg-primary text-primary-foreground\">\n            <span className=\"text-sm font-bold\">G</span>\n          </div>\n          <motion.div\n            className=\"grid flex-1 text-start text-sm leading-tight\"\n            animate={{\n              display: effectiveIsOpen ? 'grid' : 'none',\n              opacity: effectiveIsOpen ? 1 : 0,\n            }}\n            transition={{ duration: 0.2 }}\n          >\n            <span className=\"truncate font-semibold\">GASTAT Dossier</span>\n            <span className=\"truncate text-xs text-muted-foreground\">\n              {t('common.internationalRelations', 'International Relations')}\n            </span>\n          </motion.div>\n        </Link>\n      </div>\n\n      {/* Navigation Content - Mobile-first spacing */}\n      <div className=\"flex-1 overflow-y-auto px-3 sm:px-4\">\n        {navigationSections.map((section) => (\n          <div key={section.id} className=\"mb-4 sm:mb-6\">\n            {effectiveIsOpen && (\n              <h3 className=\"px-2 mb-2 sm:mb-2 text-xs font-semibold text-muted-foreground uppercase tracking-wider\">\n                {t(section.label, section.label)}\n              </h3>\n            )}\n            <div className=\"space-y-1 sm:space-y-1\">\n              {section.items.map((item) => (\n                <SidebarLink\n                  key={item.id}\n                  item={item}\n                  isActive={\n                    location.pathname === item.path ||\n                    location.pathname.startsWith(`${item.path}/`)\n                  }\n                  isRTL={isRTL}\n                />\n              ))}\n            </div>\n          </div>\n        ))}\n      </div>\n\n      {/* Footer */}\n      <div className=\"px-4 py-4 border-t border-sidebar-border\">\n        {/* Settings & Help */}\n        <div className=\"space-y-1 mb-4\">\n          {bottomNavigationItems.map((item) => (\n            <SidebarLink\n              key={item.id}\n              item={item}\n              isActive={location.pathname === item.path}\n              isRTL={isRTL}\n            />\n          ))}\n        </div>\n\n        {/* Theme & Language Controls */}\n        {effectiveIsOpen && (\n          <div className=\"flex items-center justify-center gap-2 mb-4\">\n            <LanguageToggle compact />\n            <ThemeSelector />\n          </div>\n        )}\n\n        {/* User Profile */}\n        <div className=\"flex items-center gap-3 px-2 py-2 rounded-lg hover:bg-sidebar-accent/50 transition-colors\">\n          <div className=\"flex aspect-square size-8 items-center justify-center rounded-full bg-primary text-primary-foreground shadow-sm\">\n            <span className=\"text-sm font-bold\">{userInitials}</span>\n          </div>\n          {effectiveIsOpen && (\n            <>\n              <div className=\"grid flex-1 text-start text-sm leading-tight min-w-0\">\n                <span className=\"truncate font-semibold text-sidebar-foreground\">\n                  {user?.name ?? user?.email}\n                </span>\n                <span className=\"truncate text-xs text-muted-foreground\">\n                  {user?.role ?? t('common.administrator', 'Administrator')}\n                </span>\n              </div>\n              <button\n                onClick={handleLogout}\n                className={cn(\n                  'rounded-md p-1.5 hover:bg-sidebar-accent text-muted-foreground hover:text-sidebar-foreground transition-all',\n                  'hover:scale-105 active:scale-95',\n                  isRTL && 'me-auto ms-0'\n                )}\n                aria-label={t('common.logout', 'Sign out')}\n              >\n                <LogOut className=\"h-4 w-4\" />\n              </button>\n            </>\n          )}\n        </div>\n      </div>\n    </motion.div>\n    </TooltipProvider>\n  );\n}\n\n// Mobile wrapper component with Sheet\nexport function ProCollapsibleSidebarWrapper({ children }: { children: React.ReactNode }) {\n  const [mobileOpen, setMobileOpen] = useState(false);\n  const { t, i18n } = useTranslation();\n  const isMobile = useIsMobile();\n  const isRTL = i18n.language === 'ar';\n\n  // Close mobile menu after navigation\n  const handleLinkClick = () => {\n    if (isMobile) {\n      setMobileOpen(false);\n    }\n  };\n\n  return (\n    <>\n      {/* Mobile Menu Trigger & Sheet (< 768px) */}\n      <Sheet open={mobileOpen} onOpenChange={setMobileOpen}>\n        {/* Mobile Menu Button - Fixed position on mobile only */}\n        <SheetTrigger asChild>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className={cn(\n              // Show only on mobile\n              'fixed top-4 z-50',\n              isRTL ? 'right-4' : 'left-4',\n              'md:hidden', // Hide on desktop (sidebar is always visible)\n              // Touch-friendly size\n              'min-h-11 min-w-11',\n              'bg-sidebar border border-sidebar-border shadow-lg',\n              'hover:bg-sidebar-accent'\n            )}\n            aria-label={t('sidebar.openMenu', 'Open menu')}\n          >\n            <Menu className=\"h-5 w-5\" />\n          </Button>\n        </SheetTrigger>\n\n        {/* Mobile Sheet Content */}\n        <SheetContent\n          side={isRTL ? 'right' : 'left'}\n          className=\"w-[300px] p-0 bg-sidebar border-sidebar-border\"\n        >\n          {/* Accessibility: Required for screen readers, visually hidden */}\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>{t('sidebar.title', 'Navigation Menu')}</SheetTitle>\n            <SheetDescription>\n              {t('sidebar.description', 'Main navigation menu for the application')}\n            </SheetDescription>\n          </SheetHeader>\n          <ProCollapsibleSidebar onLinkClick={handleLinkClick} isInSheet={true} />\n        </SheetContent>\n      </Sheet>\n\n      {/* Desktop Sidebar (≥ 768px) */}\n      <ProCollapsibleSidebar className=\"hidden md:flex\" />\n\n      {/* Main Content */}\n      {children}\n    </>\n  );\n}\n\nexport default ProCollapsibleSidebarWrapper;\n","import type { ReactNode } from 'react';\nimport { Toaster } from 'react-hot-toast';\nimport { ProCollapsibleSidebarWrapper } from './ProCollapsibleSidebar';\n\ninterface MainLayoutProps {\n children: ReactNode;\n}\n\nexport function MainLayout({ children }: MainLayoutProps) {\n return (\n <>\n <div className=\"flex h-screen overflow-hidden bg-background\">\n <ProCollapsibleSidebarWrapper>\n {/* Mobile-first padding with space for fixed menu button on mobile */}\n <main className=\"flex-1 overflow-y-auto pt-16 px-4 pb-4 md:pt-6 md:px-6 md:pb-6 lg:p-8\">\n {children}\n </main>\n </ProCollapsibleSidebarWrapper>\n </div>\n <Toaster\n position=\"top-center\"\n toastOptions={{\n duration: 4000,\n style: {\n background: 'var(--toast-bg)',\n color: 'var(--toast-color)',\n },\n }}\n />\n </>\n );\n}\n","/**\n * ToolResultCard Component\n * Feature: 033-ai-brief-generation\n * Task: T037\n *\n * Component for displaying tool execution results:\n * - Shows tool name and input\n * - Displays formatted results\n * - Collapsible for long results\n */\n\nimport { useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { Card, CardContent, CardHeader } from '@/components/ui/card'\nimport { Badge } from '@/components/ui/badge'\nimport { Button } from '@/components/ui/button'\nimport { cn } from '@/lib/utils'\nimport {\n  Search,\n  FileText,\n  ListChecks,\n  Calendar,\n  ChevronDown,\n  ChevronUp,\n  Loader2,\n  CheckCircle,\n} from 'lucide-react'\n\nexport interface ToolResultCardProps {\n  toolName: string\n  input: Record<string, unknown>\n  result?: unknown\n  isLoading?: boolean\n  className?: string\n}\n\nconst TOOL_ICONS: Record<string, typeof Search> = {\n  search_entities: Search,\n  get_dossier: FileText,\n  query_commitments: ListChecks,\n  get_engagement_history: Calendar,\n}\n\nconst TOOL_LABELS: Record<string, { en: string; ar: string }> = {\n  search_entities: { en: 'Searching...', ar: 'جاري البحث...' },\n  get_dossier: { en: 'Loading dossier...', ar: 'جاري تحميل الملف...' },\n  query_commitments: { en: 'Finding commitments...', ar: 'جاري البحث عن الالتزامات...' },\n  get_engagement_history: { en: 'Loading engagements...', ar: 'جاري تحميل الاجتماعات...' },\n}\n\nexport function ToolResultCard({\n  toolName,\n  input,\n  result,\n  isLoading = false,\n  className,\n}: ToolResultCardProps) {\n  const { i18n } = useTranslation('ai-chat')\n  const isRTL = i18n.language === 'ar'\n  const [isExpanded, setIsExpanded] = useState(false)\n\n  const Icon = TOOL_ICONS[toolName] || Search\n  const label = TOOL_LABELS[toolName]?.[isRTL ? 'ar' : 'en'] || toolName\n\n  // Format result for display\n  const formatResult = (data: unknown): string => {\n    if (!data) return ''\n\n    if (typeof data === 'object') {\n      const obj = data as Record<string, unknown>\n\n      // Handle search results\n      if (Array.isArray(obj.results)) {\n        return `Found ${obj.results.length} result(s)`\n      }\n\n      // Handle dossier\n      if (obj.dossier && typeof obj.dossier === 'object') {\n        const dossier = obj.dossier as Record<string, unknown>\n        return `${dossier.name_en || dossier.name_ar || 'Dossier'}`\n      }\n\n      // Handle commitments\n      if (Array.isArray(obj.commitments)) {\n        return `Found ${obj.commitments.length} commitment(s)`\n      }\n\n      // Handle engagements\n      if (Array.isArray(obj.engagements)) {\n        return `Found ${obj.engagements.length} engagement(s)`\n      }\n    }\n\n    return JSON.stringify(data).substring(0, 100)\n  }\n\n  // Get detailed results\n  const getDetailedResults = (\n    data: unknown,\n  ): Array<{ id: string; title: string; type?: string }> => {\n    if (!data || typeof data !== 'object') return []\n\n    const obj = data as Record<string, unknown>\n\n    if (Array.isArray(obj.results)) {\n      return obj.results.map((r: Record<string, unknown>) => ({\n        id: r.id as string,\n        title: (r.title || r.name_en || r.name_ar) as string,\n        type: r.type as string,\n      }))\n    }\n\n    if (Array.isArray(obj.commitments)) {\n      return obj.commitments.map((c: Record<string, unknown>) => ({\n        id: c.id as string,\n        title: (c.description_en || c.description_ar || 'Commitment') as string,\n        type: 'commitment',\n      }))\n    }\n\n    if (Array.isArray(obj.engagements)) {\n      return obj.engagements.map((e: Record<string, unknown>) => ({\n        id: e.id as string,\n        title: (e.name_en || e.name_ar || 'Engagement') as string,\n        type: 'engagement',\n      }))\n    }\n\n    return []\n  }\n\n  const detailedResults = getDetailedResults(result)\n  const hasDetails = detailedResults.length > 0\n\n  return (\n    <Card\n      className={cn('bg-muted/30 border-muted', 'transition-all duration-200', className)}\n      dir={isRTL ? 'rtl' : 'ltr'}\n    >\n      <CardHeader className=\"py-2 px-3\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            {isLoading ? (\n              <Loader2 className=\"h-4 w-4 animate-spin text-muted-foreground\" />\n            ) : (\n              <CheckCircle className=\"h-4 w-4 text-green-500\" />\n            )}\n            <Icon className=\"h-4 w-4 text-muted-foreground\" />\n            <span className=\"text-xs text-muted-foreground\">\n              {isLoading ? label : formatResult(result)}\n            </span>\n          </div>\n          {!isLoading && hasDetails && (\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"h-6 px-2\"\n              onClick={() => setIsExpanded(!isExpanded)}\n            >\n              {isExpanded ? <ChevronUp className=\"h-3 w-3\" /> : <ChevronDown className=\"h-3 w-3\" />}\n            </Button>\n          )}\n        </div>\n      </CardHeader>\n\n      {/* Expanded results */}\n      {isExpanded && hasDetails && (\n        <CardContent className=\"py-2 px-3 pt-0\">\n          <div className=\"space-y-1.5 max-h-32 overflow-y-auto\">\n            {detailedResults.slice(0, 5).map((item, idx) => (\n              <div key={item.id || idx} className=\"flex items-center gap-2 text-xs\">\n                {item.type && (\n                  <Badge variant=\"outline\" className=\"text-[10px] px-1.5 py-0\">\n                    {item.type}\n                  </Badge>\n                )}\n                <span className=\"truncate text-muted-foreground\">{item.title}</span>\n              </div>\n            ))}\n            {detailedResults.length > 5 && (\n              <span className=\"text-xs text-muted-foreground\">\n                +{detailedResults.length - 5} more\n              </span>\n            )}\n          </div>\n        </CardContent>\n      )}\n    </Card>\n  )\n}\n\nexport default ToolResultCard\n","/**\n * ChatMessage Component\n * Feature: 033-ai-brief-generation\n * Task: T035\n *\n * Component for displaying individual chat messages with:\n * - User/assistant styling\n * - Tool call cards\n * - Citations with deep links\n */\n\nimport { useTranslation } from 'react-i18next'\nimport { Avatar, AvatarFallback } from '@/components/ui/avatar'\nimport { Badge } from '@/components/ui/badge'\nimport { cn } from '@/lib/utils'\nimport { User, Bot, ExternalLink } from 'lucide-react'\nimport { ToolResultCard } from './ToolResultCard'\n\nexport interface Citation {\n  type: string\n  id: string\n  title: string\n  snippet?: string\n}\n\nexport interface ToolCall {\n  name: string\n  input: Record<string, unknown>\n  result?: unknown\n}\n\nexport interface ChatMessageProps {\n  role: 'user' | 'assistant' | 'system'\n  content: string\n  toolCalls?: ToolCall[]\n  citations?: Citation[]\n  isStreaming?: boolean\n  onCitationClick?: (type: string, id: string) => void\n  className?: string\n}\n\nexport function ChatMessage({\n  role,\n  content,\n  toolCalls = [],\n  citations = [],\n  isStreaming = false,\n  onCitationClick,\n  className,\n}: ChatMessageProps) {\n  const { i18n } = useTranslation('ai-chat')\n  const isRTL = i18n.language === 'ar'\n  const isUser = role === 'user'\n\n  return (\n    <div\n      className={cn('flex gap-3 p-4', isUser ? 'flex-row-reverse' : 'flex-row', className)}\n      dir={isRTL ? 'rtl' : 'ltr'}\n    >\n      {/* Avatar */}\n      <Avatar className={cn('h-8 w-8 shrink-0', isUser ? 'bg-primary' : 'bg-muted')}>\n        <AvatarFallback className={isUser ? 'text-primary-foreground' : ''}>\n          {isUser ? <User className=\"h-4 w-4\" /> : <Bot className=\"h-4 w-4\" />}\n        </AvatarFallback>\n      </Avatar>\n\n      {/* Message content */}\n      <div className={cn('flex-1 space-y-2 max-w-[80%]', isUser ? 'items-end' : 'items-start')}>\n        {/* Tool calls (before main response) */}\n        {!isUser && toolCalls.length > 0 && (\n          <div className=\"space-y-2\">\n            {toolCalls.map((toolCall, index) => (\n              <ToolResultCard\n                key={index}\n                toolName={toolCall.name}\n                input={toolCall.input}\n                result={toolCall.result}\n              />\n            ))}\n          </div>\n        )}\n\n        {/* Main message bubble */}\n        <div\n          className={cn(\n            'rounded-2xl px-4 py-3',\n            isUser ? 'bg-primary text-primary-foreground rounded-br-md' : 'bg-muted rounded-bl-md',\n            isRTL && isUser && 'rounded-br-2xl rounded-bl-md',\n            isRTL && !isUser && 'rounded-bl-2xl rounded-br-md',\n          )}\n        >\n          <p className={cn('text-sm whitespace-pre-wrap', isStreaming && 'animate-pulse')}>\n            {content}\n            {isStreaming && (\n              <span className=\"inline-block w-1.5 h-4 ms-1 bg-current animate-pulse\" />\n            )}\n          </p>\n        </div>\n\n        {/* Citations */}\n        {!isUser && citations.length > 0 && (\n          <div className=\"flex flex-wrap gap-1.5 mt-2\">\n            {citations.map((citation, index) => (\n              <Badge\n                key={index}\n                variant=\"outline\"\n                className={cn(\n                  'text-xs cursor-pointer hover:bg-muted transition-colors',\n                  'flex items-center gap-1 px-2 py-0.5',\n                )}\n                onClick={() => onCitationClick?.(citation.type, citation.id)}\n              >\n                <span className=\"capitalize\">{citation.type}</span>\n                <ExternalLink className=\"h-3 w-3\" />\n              </Badge>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n\nexport default ChatMessage\n","/**\n * ChatInput Component\n * Feature: 033-ai-brief-generation\n * Task: T036\n *\n * Chat input component with:\n * - Text input with auto-resize\n * - Send button\n * - Keyboard handling (Enter to send, Shift+Enter for newline)\n * - RTL support\n */\n\nimport { useState, useRef, useEffect, KeyboardEvent } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { Button } from '@/components/ui/button'\nimport { Textarea } from '@/components/ui/textarea'\nimport { cn } from '@/lib/utils'\nimport { Send, Loader2 } from 'lucide-react'\n\nexport interface ChatInputProps {\n  onSend: (message: string) => void\n  disabled?: boolean\n  isLoading?: boolean\n  placeholder?: string\n  className?: string\n}\n\nexport function ChatInput({\n  onSend,\n  disabled = false,\n  isLoading = false,\n  placeholder,\n  className,\n}: ChatInputProps) {\n  const { t, i18n } = useTranslation('ai-chat')\n  const isRTL = i18n.language === 'ar'\n  const [message, setMessage] = useState('')\n  const textareaRef = useRef<HTMLTextAreaElement>(null)\n\n  // Auto-resize textarea\n  useEffect(() => {\n    if (textareaRef.current) {\n      textareaRef.current.style.height = 'auto'\n      textareaRef.current.style.height = `${Math.min(textareaRef.current.scrollHeight, 150)}px`\n    }\n  }, [message])\n\n  const handleSend = () => {\n    const trimmedMessage = message.trim()\n    if (trimmedMessage && !disabled && !isLoading) {\n      onSend(trimmedMessage)\n      setMessage('')\n      // Reset textarea height\n      if (textareaRef.current) {\n        textareaRef.current.style.height = 'auto'\n      }\n    }\n  }\n\n  const handleKeyDown = (e: KeyboardEvent<HTMLTextAreaElement>) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault()\n      handleSend()\n    }\n  }\n\n  return (\n    <div\n      className={cn('flex items-end gap-2 p-3 border-t bg-background', className)}\n      dir={isRTL ? 'rtl' : 'ltr'}\n    >\n      <Textarea\n        ref={textareaRef}\n        value={message}\n        onChange={(e) => setMessage(e.target.value)}\n        onKeyDown={handleKeyDown}\n        placeholder={placeholder || t('inputPlaceholder', 'Ask a question...')}\n        disabled={disabled || isLoading}\n        className={cn(\n          'min-h-[44px] max-h-[150px] resize-none py-3',\n          'rounded-2xl border-muted-foreground/20',\n          'focus-visible:ring-1 focus-visible:ring-primary',\n          isRTL && 'text-right',\n        )}\n        rows={1}\n      />\n      <Button\n        onClick={handleSend}\n        disabled={disabled || isLoading || !message.trim()}\n        size=\"icon\"\n        className={cn(\n          'h-11 w-11 shrink-0 rounded-full',\n          'transition-all duration-200',\n          message.trim() ? 'bg-primary' : 'bg-muted',\n        )}\n      >\n        {isLoading ? (\n          <Loader2 className=\"h-5 w-5 animate-spin\" />\n        ) : (\n          <Send className={cn('h-5 w-5', isRTL && 'rotate-180')} />\n        )}\n      </Button>\n    </div>\n  )\n}\n\nexport default ChatInput\n","/**\n * useAIChat Hook\n * Feature: 033-ai-brief-generation\n * Task: T038\n *\n * Hook for AI chat functionality with:\n * - SSE streaming support\n * - Message state management\n * - Tool call handling\n * - Error handling and retry\n */\n\nimport { useState, useCallback, useRef, useEffect } from 'react'\nimport { supabase } from '@/store/authStore'\n\nexport interface ChatMessage {\n  role: 'user' | 'assistant' | 'system'\n  content: string\n  toolCalls?: Array<{\n    name: string\n    input: Record<string, unknown>\n    result?: unknown\n  }>\n  citations?: Array<{\n    type: string\n    id: string\n    title: string\n    snippet?: string\n  }>\n  runId?: string\n  timestamp: Date\n}\n\nexport interface UseAIChatReturn {\n  messages: ChatMessage[]\n  isLoading: boolean\n  error: string | null\n  currentStreamContent: string\n  currentToolCalls: Array<{\n    name: string\n    input: Record<string, unknown>\n    result?: unknown\n  }>\n  sendMessage: (content: string) => Promise<void>\n  clearMessages: () => void\n  retryLastMessage: () => Promise<void>\n}\n\nconst API_BASE = import.meta.env.VITE_API_URL || '/api'\n\nexport function useAIChat(): UseAIChatReturn {\n  const [token, setToken] = useState<string | null>(null)\n  const [messages, setMessages] = useState<ChatMessage[]>([])\n\n  // Get auth token from Supabase session\n  useEffect(() => {\n    const getToken = async () => {\n      const {\n        data: { session },\n      } = await supabase.auth.getSession()\n      setToken(session?.access_token || null)\n    }\n    getToken()\n\n    // Listen for auth state changes\n    const {\n      data: { subscription },\n    } = supabase.auth.onAuthStateChange((_event, session) => {\n      setToken(session?.access_token || null)\n    })\n\n    return () => subscription.unsubscribe()\n  }, [])\n  const [isLoading, setIsLoading] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  const [currentStreamContent, setCurrentStreamContent] = useState('')\n  const [currentToolCalls, setCurrentToolCalls] = useState<\n    Array<{\n      name: string\n      input: Record<string, unknown>\n      result?: unknown\n    }>\n  >([])\n  const abortControllerRef = useRef<AbortController | null>(null)\n  const lastUserMessageRef = useRef<string>('')\n\n  const sendMessage = useCallback(\n    async (content: string) => {\n      if (isLoading || !content.trim()) return\n\n      lastUserMessageRef.current = content\n      setIsLoading(true)\n      setError(null)\n      setCurrentStreamContent('')\n      setCurrentToolCalls([])\n\n      // Add user message to history\n      const userMessage: ChatMessage = {\n        role: 'user',\n        content,\n        timestamp: new Date(),\n      }\n      setMessages((prev) => [...prev, userMessage])\n\n      // Prepare conversation history for API\n      const conversationHistory = messages.map((m) => ({\n        role: m.role,\n        content: m.content,\n      }))\n\n      abortControllerRef.current = new AbortController()\n\n      try {\n        const response = await fetch(`${API_BASE}/ai/chat`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            Accept: 'text/event-stream',\n            Authorization: `Bearer ${token}`,\n          },\n          body: JSON.stringify({\n            message: content,\n            conversation_history: conversationHistory,\n            language: document.documentElement.lang || 'en',\n          }),\n          signal: abortControllerRef.current.signal,\n        })\n\n        if (!response.ok) {\n          const errorData = await response.json().catch(() => ({}))\n          throw new Error(errorData.error || 'Chat request failed')\n        }\n\n        const reader = response.body?.getReader()\n        if (!reader) throw new Error('No response body')\n\n        const decoder = new TextDecoder()\n        let fullContent = ''\n        let runId = ''\n        const toolCalls: ChatMessage['toolCalls'] = []\n\n        while (true) {\n          const { done, value } = await reader.read()\n          if (done) break\n\n          const chunk = decoder.decode(value)\n          const lines = chunk.split('\\n')\n\n          for (const line of lines) {\n            if (!line.startsWith('data: ')) continue\n\n            try {\n              const data = JSON.parse(line.slice(6))\n\n              if (data.type === 'init' && data.runId) {\n                runId = data.runId\n              } else if (data.type === 'tool_call' && data.name) {\n                const toolCall = {\n                  name: data.name,\n                  input: data.input || {},\n                  result: data.result,\n                }\n\n                if (data.result) {\n                  // Update existing tool call with result\n                  setCurrentToolCalls((prev) => {\n                    const idx = prev.findIndex((t) => t.name === data.name)\n                    if (idx >= 0) {\n                      const updated = [...prev]\n                      updated[idx] = toolCall\n                      return updated\n                    }\n                    return [...prev, toolCall]\n                  })\n                  toolCalls.push(toolCall)\n                } else {\n                  // New tool call starting\n                  setCurrentToolCalls((prev) => [...prev, toolCall])\n                }\n              } else if (data.type === 'content' && data.content) {\n                fullContent += data.content\n                setCurrentStreamContent(fullContent)\n              } else if (data.type === 'done') {\n                // Stream complete\n                break\n              } else if (data.type === 'error') {\n                throw new Error(data.error || 'Stream error')\n              } else if (data.type === 'timeout') {\n                setError('Response timed out. Please try again.')\n              }\n            } catch (parseError) {\n              // Ignore parse errors for partial chunks\n            }\n          }\n        }\n\n        // Add assistant message to history\n        const assistantMessage: ChatMessage = {\n          role: 'assistant',\n          content: fullContent,\n          toolCalls,\n          runId,\n          timestamp: new Date(),\n        }\n        setMessages((prev) => [...prev, assistantMessage])\n        setCurrentStreamContent('')\n        setCurrentToolCalls([])\n      } catch (err) {\n        if (err instanceof Error && err.name === 'AbortError') {\n          setError('Request cancelled')\n        } else {\n          setError(err instanceof Error ? err.message : 'Unknown error')\n        }\n      } finally {\n        setIsLoading(false)\n        abortControllerRef.current = null\n      }\n    },\n    [token, messages, isLoading],\n  )\n\n  const clearMessages = useCallback(() => {\n    setMessages([])\n    setError(null)\n    setCurrentStreamContent('')\n    setCurrentToolCalls([])\n    if (abortControllerRef.current) {\n      abortControllerRef.current.abort()\n    }\n  }, [])\n\n  const retryLastMessage = useCallback(async () => {\n    if (lastUserMessageRef.current) {\n      // Remove last assistant message if it exists\n      setMessages((prev) => {\n        if (prev.length > 0 && prev[prev.length - 1]?.role === 'assistant') {\n          return prev.slice(0, -1)\n        }\n        // Also remove the last user message since sendMessage will add it again\n        if (prev.length > 0 && prev[prev.length - 1]?.role === 'user') {\n          return prev.slice(0, -1)\n        }\n        return prev\n      })\n      await sendMessage(lastUserMessageRef.current)\n    }\n  }, [sendMessage])\n\n  return {\n    messages,\n    isLoading,\n    error,\n    currentStreamContent,\n    currentToolCalls,\n    sendMessage,\n    clearMessages,\n    retryLastMessage,\n  }\n}\n\nexport default useAIChat\n","/**\n * ChatDock Component\n * Feature: 033-ai-brief-generation\n * Task: T034\n *\n * Persistent chat dock component with:\n * - FAB (Floating Action Button) to open/close\n * - Expandable panel\n * - Message history\n * - Tool result display\n * - RTL support\n */\n\nimport { useState, useRef, useEffect } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardHeader, CardTitle } from '@/components/ui/card'\nimport { ScrollArea } from '@/components/ui/scroll-area'\nimport { cn } from '@/lib/utils'\nimport { MessageCircle, X, Minimize2, Maximize2, Trash2, Sparkles } from 'lucide-react'\nimport { ChatMessage, type Citation, type ToolCall } from './ChatMessage'\nimport { ChatInput } from './ChatInput'\nimport { useAIChat } from '@/hooks/useAIChat'\n\nexport interface ChatDockProps {\n  onCitationClick?: (type: string, id: string) => void\n  className?: string\n}\n\nexport function ChatDock({ onCitationClick, className }: ChatDockProps) {\n  const { t, i18n } = useTranslation('ai-chat')\n  const isRTL = i18n.language === 'ar'\n  const [isOpen, setIsOpen] = useState(false)\n  const [isExpanded, setIsExpanded] = useState(false)\n  const scrollRef = useRef<HTMLDivElement>(null)\n\n  const {\n    messages,\n    isLoading,\n    currentStreamContent,\n    currentToolCalls,\n    sendMessage,\n    clearMessages,\n  } = useAIChat()\n\n  // Auto-scroll to bottom when new messages arrive\n  useEffect(() => {\n    if (scrollRef.current) {\n      scrollRef.current.scrollTop = scrollRef.current.scrollHeight\n    }\n  }, [messages, currentStreamContent])\n\n  const handleSend = async (content: string) => {\n    await sendMessage(content)\n  }\n\n  const toggleOpen = () => {\n    setIsOpen(!isOpen)\n    if (!isOpen) {\n      setIsExpanded(false)\n    }\n  }\n\n  const toggleExpanded = () => {\n    setIsExpanded(!isExpanded)\n  }\n\n  return (\n    <div className={cn('fixed z-50', isRTL ? 'left-4' : 'right-4', 'bottom-4', className)}>\n      {/* Chat Panel */}\n      {isOpen && (\n        <Card\n          className={cn(\n            'mb-4 flex flex-col shadow-xl border',\n            'transition-all duration-300 ease-in-out',\n            isExpanded ? 'w-[480px] h-[600px]' : 'w-[360px] h-[480px]',\n            'max-w-[calc(100vw-2rem)] max-h-[calc(100vh-6rem)]',\n          )}\n          dir={isRTL ? 'rtl' : 'ltr'}\n        >\n          {/* Header */}\n          <CardHeader className=\"py-3 px-4 border-b shrink-0\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-2\">\n                <Sparkles className=\"h-5 w-5 text-primary\" />\n                <CardTitle className=\"text-base font-semibold\">\n                  {t('title', 'AI Assistant')}\n                </CardTitle>\n              </div>\n              <div className=\"flex items-center gap-1\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  className=\"h-8 w-8\"\n                  onClick={clearMessages}\n                  title={t('clearChat', 'Clear chat')}\n                >\n                  <Trash2 className=\"h-4 w-4\" />\n                </Button>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  className=\"h-8 w-8\"\n                  onClick={toggleExpanded}\n                  title={isExpanded ? t('minimize', 'Minimize') : t('expand', 'Expand')}\n                >\n                  {isExpanded ? (\n                    <Minimize2 className=\"h-4 w-4\" />\n                  ) : (\n                    <Maximize2 className=\"h-4 w-4\" />\n                  )}\n                </Button>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  className=\"h-8 w-8\"\n                  onClick={toggleOpen}\n                  title={t('close', 'Close')}\n                >\n                  <X className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </div>\n          </CardHeader>\n\n          {/* Messages Area */}\n          <ScrollArea className=\"flex-1\" ref={scrollRef}>\n            <div className=\"min-h-full\">\n              {messages.length === 0 && !isLoading ? (\n                <div className=\"flex flex-col items-center justify-center h-full py-12 px-4 text-center\">\n                  <Sparkles className=\"h-12 w-12 text-muted-foreground/50 mb-4\" />\n                  <h3 className=\"text-lg font-medium text-muted-foreground mb-2\">\n                    {t('welcomeTitle', 'How can I help you?')}\n                  </h3>\n                  <p className=\"text-sm text-muted-foreground max-w-[250px]\">\n                    {t(\n                      'welcomeMessage',\n                      'Ask me about dossiers, commitments, engagements, or any other information in the system.',\n                    )}\n                  </p>\n                  <div className=\"mt-6 space-y-2 w-full max-w-[280px]\">\n                    <SuggestionButton\n                      onClick={() => handleSend('What are our active commitments?')}\n                      isRTL={isRTL}\n                    >\n                      {t('suggestion1', 'What are our active commitments?')}\n                    </SuggestionButton>\n                    <SuggestionButton\n                      onClick={() => handleSend('Find dossiers about trade agreements')}\n                      isRTL={isRTL}\n                    >\n                      {t('suggestion2', 'Find dossiers about trade agreements')}\n                    </SuggestionButton>\n                    <SuggestionButton\n                      onClick={() => handleSend('Show recent engagements')}\n                      isRTL={isRTL}\n                    >\n                      {t('suggestion3', 'Show recent engagements')}\n                    </SuggestionButton>\n                  </div>\n                </div>\n              ) : (\n                <div className=\"pb-4\">\n                  {messages.map((message, index) => (\n                    <ChatMessage\n                      key={index}\n                      role={message.role as 'user' | 'assistant'}\n                      content={message.content}\n                      toolCalls={message.toolCalls as ToolCall[]}\n                      citations={message.citations as Citation[]}\n                      onCitationClick={onCitationClick}\n                    />\n                  ))}\n\n                  {/* Streaming message */}\n                  {isLoading && (\n                    <ChatMessage\n                      role=\"assistant\"\n                      content={currentStreamContent || ''}\n                      toolCalls={currentToolCalls as ToolCall[]}\n                      isStreaming={true}\n                    />\n                  )}\n                </div>\n              )}\n            </div>\n          </ScrollArea>\n\n          {/* Input */}\n          <ChatInput\n            onSend={handleSend}\n            isLoading={isLoading}\n            placeholder={t('inputPlaceholder', 'Ask a question...')}\n          />\n        </Card>\n      )}\n\n      {/* FAB Button */}\n      <Button\n        onClick={toggleOpen}\n        size=\"lg\"\n        className={cn(\n          'h-14 w-14 rounded-full shadow-lg',\n          'transition-all duration-300',\n          'hover:scale-105 active:scale-95',\n          isOpen && 'bg-muted text-muted-foreground hover:bg-muted',\n        )}\n      >\n        {isOpen ? <X className=\"h-6 w-6\" /> : <MessageCircle className=\"h-6 w-6\" />}\n      </Button>\n    </div>\n  )\n}\n\ninterface SuggestionButtonProps {\n  children: React.ReactNode\n  onClick: () => void\n  isRTL: boolean\n}\n\nfunction SuggestionButton({ children, onClick, isRTL }: SuggestionButtonProps) {\n  return (\n    <button\n      onClick={onClick}\n      className={cn(\n        'w-full text-start text-sm px-3 py-2 rounded-lg',\n        'bg-muted/50 hover:bg-muted transition-colors',\n        'text-muted-foreground hover:text-foreground',\n        isRTL && 'text-end',\n      )}\n    >\n      {children}\n    </button>\n  )\n}\n\nexport default ChatDock\n","/**\n * ChatContext Provider\n * Feature: 033-ai-brief-generation\n * Task: T039\n *\n * Global chat context for:\n * - Chat state persistence across navigation\n * - Open/close state management\n * - Session persistence\n */\n\nimport { createContext, useContext, useState, useCallback, ReactNode } from 'react'\n\nexport interface ChatContextState {\n  isOpen: boolean\n  isExpanded: boolean\n  sessionId: string | null\n  lastActivity: Date | null\n}\n\nexport interface ChatContextValue extends ChatContextState {\n  openChat: () => void\n  closeChat: () => void\n  toggleChat: () => void\n  setExpanded: (expanded: boolean) => void\n  setSessionId: (id: string | null) => void\n  updateLastActivity: () => void\n}\n\nconst ChatContext = createContext<ChatContextValue | undefined>(undefined)\n\nexport interface ChatProviderProps {\n  children: ReactNode\n}\n\nexport function ChatProvider({ children }: ChatProviderProps) {\n  const [isOpen, setIsOpen] = useState(false)\n  const [isExpanded, setIsExpanded] = useState(false)\n  const [sessionId, setSessionId] = useState<string | null>(null)\n  const [lastActivity, setLastActivity] = useState<Date | null>(null)\n\n  const openChat = useCallback(() => {\n    setIsOpen(true)\n    setLastActivity(new Date())\n  }, [])\n\n  const closeChat = useCallback(() => {\n    setIsOpen(false)\n  }, [])\n\n  const toggleChat = useCallback(() => {\n    setIsOpen((prev) => {\n      if (!prev) {\n        setLastActivity(new Date())\n      }\n      return !prev\n    })\n  }, [])\n\n  const setExpanded = useCallback((expanded: boolean) => {\n    setIsExpanded(expanded)\n  }, [])\n\n  const handleSetSessionId = useCallback((id: string | null) => {\n    setSessionId(id)\n  }, [])\n\n  const updateLastActivity = useCallback(() => {\n    setLastActivity(new Date())\n  }, [])\n\n  const value: ChatContextValue = {\n    isOpen,\n    isExpanded,\n    sessionId,\n    lastActivity,\n    openChat,\n    closeChat,\n    toggleChat,\n    setExpanded,\n    setSessionId: handleSetSessionId,\n    updateLastActivity,\n  }\n\n  return <ChatContext.Provider value={value}>{children}</ChatContext.Provider>\n}\n\nexport function useChatContext(): ChatContextValue {\n  const context = useContext(ChatContext)\n  if (context === undefined) {\n    throw new Error('useChatContext must be used within a ChatProvider')\n  }\n  return context\n}\n\nexport default ChatContext\n","import { createFileRoute, Outlet, redirect, useNavigate } from '@tanstack/react-router'\nimport { MainLayout } from '../components/Layout/MainLayout'\nimport { useAuthStore, supabase } from '../store/authStore'\nimport { ChatDock } from '@/components/ai/ChatDock'\nimport { ChatProvider } from '@/contexts/ChatContext'\n\nexport const Route = createFileRoute('/_protected')({\n  beforeLoad: async () => {\n    // Check actual Supabase session, not just localStorage\n    const {\n      data: { session },\n    } = await supabase.auth.getSession()\n\n    if (!session) {\n      // Clear stale auth state and redirect to login\n      useAuthStore.setState({ user: null, isAuthenticated: false })\n      throw redirect({\n        to: '/login',\n      })\n    }\n  },\n  component: ProtectedLayout,\n})\n\nfunction ProtectedLayout() {\n  const navigate = useNavigate()\n\n  // Handle citation clicks from chat to navigate to entities\n  const handleCitationClick = (type: string, id: string) => {\n    switch (type) {\n      case 'dossier':\n        navigate({ to: '/dossiers/$id', params: { id } })\n        break\n      case 'commitment':\n        navigate({ to: '/commitments', search: { id } })\n        break\n      case 'engagement':\n        navigate({ to: '/engagements/$engagementId', params: { engagementId: id } })\n        break\n      default:\n        // For other types, try a general search\n        navigate({ to: '/search', search: { q: id, type: undefined, includeArchived: undefined } })\n    }\n  }\n\n  return (\n    <ChatProvider>\n      <MainLayout>\n        <Outlet />\n      </MainLayout>\n      {/* AI Chat Dock - available on all protected pages */}\n      <ChatDock onCitationClick={handleCitationClick} />\n    </ChatProvider>\n  )\n}\n"],"names":["useWorkQueueCounts","MOBILE_BREAKPOINT","useIsMobile","isMobile","setIsMobile","React.useState","React.useEffect","mql","onChange","LanguageToggle","compact","i18n","useTranslation","language","setLanguage","useUIStore","handleToggle","useCallback","nextLang","switchLanguage","isRTL","jsxs","cn","jsx","createNavigationSections","counts","isAdmin","sections","Briefcase","CheckSquare","FileCheck","Inbox","Clock","LayoutDashboard","LayoutGrid","Folder","MessageSquare","ClipboardList","CalendarDays","ScrollText","Brain","TrendingUp","BarChart3","Database","PenTool","Wrench","Shield","Sparkles","Sliders","UserCog","Activity","Download","bottomNavigationItems","Settings","HelpCircle","ProCollapsibleSidebar","className","onLinkClick","isInSheet","t","location","useLocation","navigate","useNavigate","user","logout","useAuth","isOpen","setIsOpen","useState","effectiveIsOpen","workQueueCounts","navigationSections","useMemo","handleLogout","userInitials","part","SidebarLink","item","isActive","Icon","labelText","linkContent","Link","AnimatePresence","motion","Tooltip","TooltipTrigger","TooltipContent","TooltipProvider","IconArrowNarrowLeft","section","ThemeSelector","Fragment","LogOut","ProCollapsibleSidebarWrapper","children","mobileOpen","setMobileOpen","handleLinkClick","Sheet","SheetTrigger","Button","Menu","SheetContent","SheetHeader","SheetTitle","SheetDescription","MainLayout","Toaster","TOOL_ICONS","Search","FileText","ListChecks","Calendar","TOOL_LABELS","ToolResultCard","toolName","input","result","isLoading","isExpanded","setIsExpanded","label","formatResult","data","obj","dossier","detailedResults","r","c","e","hasDetails","Card","CardHeader","Loader2","CheckCircle","ChevronUp","ChevronDown","CardContent","idx","Badge","ChatMessage","role","content","toolCalls","citations","isStreaming","onCitationClick","isUser","Avatar","AvatarFallback","User","Bot","toolCall","index","citation","ExternalLink","ChatInput","onSend","disabled","placeholder","message","setMessage","textareaRef","useRef","useEffect","handleSend","trimmedMessage","handleKeyDown","Textarea","Send","API_BASE","useAIChat","token","setToken","messages","setMessages","session","supabase","subscription","_event","setIsLoading","error","setError","currentStreamContent","setCurrentStreamContent","currentToolCalls","setCurrentToolCalls","abortControllerRef","lastUserMessageRef","sendMessage","userMessage","prev","conversationHistory","m","response","errorData","reader","decoder","fullContent","runId","done","value","lines","line","updated","assistantMessage","err","clearMessages","retryLastMessage","ChatDock","scrollRef","toggleOpen","toggleExpanded","CardTitle","Trash2","Minimize2","Maximize2","X","ScrollArea","SuggestionButton","MessageCircle","onClick","ChatContext","createContext","ChatProvider","sessionId","setSessionId","lastActivity","setLastActivity","openChat","closeChat","toggleChat","setExpanded","expanded","handleSetSessionId","id","updateLastActivity","ProtectedLayout","handleCitationClick","type","to","params","search","engagementId","q","undefined","includeArchived","Outlet"],"mappings":"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"}