{"version":3,"file":"_contactId-xSFVaBA4.js","sources":["../../src/components/relationships/RelationshipGraph.tsx","../../src/components/relationships/RelationshipForm.tsx","../../src/components/contacts/InteractionTimeline.tsx","../../src/components/contacts/InteractionNoteForm.tsx","../../src/pages/contacts/ContactDetails.tsx","../../src/routes/_protected/contacts/$contactId.tsx?tsr-split=component"],"sourcesContent":["/**\n * RelationshipGraph Component\n * Part of: 027-contact-directory Phase 6\n *\n * Network visualization of contact relationships using React Flow.\n * Mobile-first, RTL-aware with zoom/pan controls.\n */\n\nimport { useCallback, useEffect, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport {\n ReactFlow,\n Node,\n Edge,\n Controls,\n Background,\n useNodesState,\n useEdgesState,\n MarkerType,\n Position,\n type OnConnect,\n addEdge,\n Connection,\n} from '@xyflow/react';\nimport '@xyflow/react/dist/style.css';\nimport { Card } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Building2, User, Loader2 } from 'lucide-react';\nimport type { RelationshipResponse } from '@/services/contact-relationship-api';\nimport type { Database } from '@/types/contact-directory.types';\n\ntype Contact = Database['public']['Tables']['cd_contacts']['Row'];\n\n/**\n * RelationshipGraph Props\n */\ninterface RelationshipGraphProps {\n /** Center contact ID */\n contactId: string;\n /** All relationships to display */\n relationships: RelationshipResponse[];\n /** All contacts in the network */\n contacts: Contact[];\n /** Handle contact node click */\n onContactClick?: (contactId: string) => void;\n /** Handle relationship edge click */\n onRelationshipClick?: (relationshipId: string) => void;\n /** Loading state */\n isLoading?: boolean;\n /** Height of the graph container */\n height?: string | number;\n /** RTL direction */\n className?: string;\n}\n\n/**\n * Relationship type colors\n */\nconst RELATIONSHIP_COLORS = {\n reports_to: '#ef4444', // red\n collaborates_with: '#3b82f6', // blue\n partner: '#10b981', // green\n colleague: '#f59e0b', // amber\n other: '#6b7280', // gray\n} as const;\n\n/**\n * Custom node component for contacts\n */\nfunction ContactNode({ data }: { data: any }) {\n const { t } = useTranslation('contacts');\n const isCenter = data.isCenter;\n\n return (\n <Card\n className={`p-3 min-w-[180px] sm:min-w-[200px] cursor-pointer transition-shadow hover:shadow-md ${\n isCenter ? 'ring-2 ring-primary' : ''\n }`}\n >\n <div className=\"flex flex-col gap-2\">\n <div className=\"flex items-center gap-2\">\n <User className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" />\n <span className=\"font-semibold text-sm truncate\">{data.label}</span>\n </div>\n {data.position && (\n <p className=\"text-xs text-muted-foreground truncate\">{data.position}</p>\n )}\n {data.organization && (\n <Badge variant=\"secondary\" className=\"text-xs px-2 py-0.5 w-fit\">\n <Building2 className=\"h-3 w-3 mr-1\" />\n {data.organization}\n </Badge>\n )}\n </div>\n </Card>\n );\n}\n\nconst nodeTypes = {\n contact: ContactNode,\n};\n\n/**\n * RelationshipGraph Component\n */\nexport function RelationshipGraph({\n contactId,\n relationships,\n contacts,\n onContactClick,\n onRelationshipClick,\n isLoading = false,\n height = 500,\n className = '',\n}: RelationshipGraphProps) {\n const { t, i18n } = useTranslation('contacts');\n const isRTL = i18n.language === 'ar';\n\n const [nodes, setNodes, onNodesChange] = useNodesState([]);\n const [edges, setEdges, onEdgesChange] = useEdgesState([]);\n\n /**\n * Build nodes and edges from relationships\n */\n useEffect(() => {\n if (!contacts.length || !contactId) return;\n\n // Create a map of contacts for quick lookup\n const contactMap = new Map(contacts.map((c) => [c.id, c]));\n const centerContact = contactMap.get(contactId);\n if (!centerContact) return;\n\n // Collect all unique contacts involved in relationships\n const involvedContactIds = new Set<string>([contactId]);\n relationships.forEach((rel) => {\n involvedContactIds.add(rel.from_contact_id);\n involvedContactIds.add(rel.to_contact_id);\n });\n\n // Create nodes for each contact\n const newNodes: Node[] = [];\n const contactsArray = Array.from(involvedContactIds)\n .map((id) => contactMap.get(id))\n .filter(Boolean) as Contact[];\n\n // Calculate node positions in a circular layout\n const radius = 250;\n const angleStep = (2 * Math.PI) / (contactsArray.length - 1 || 1);\n\n contactsArray.forEach((contact, index) => {\n const isCenter = contact.id === contactId;\n\n // Center contact in the middle\n let x = isCenter ? 0 : radius * Math.cos(index * angleStep);\n let y = isCenter ? 0 : radius * Math.sin(index * angleStep);\n\n // For RTL, flip x coordinates\n if (isRTL) {\n x = -x;\n }\n\n newNodes.push({\n id: contact.id,\n type: 'contact',\n position: { x, y },\n data: {\n label: contact.full_name,\n position: contact.position,\n organization: contact.organization?.name,\n isCenter,\n },\n sourcePosition: isRTL ? Position.Left : Position.Right,\n targetPosition: isRTL ? Position.Right : Position.Left,\n });\n });\n\n // Create edges for each relationship\n const newEdges: Edge[] = relationships.map((rel) => ({\n id: rel.id,\n source: rel.from_contact_id,\n target: rel.to_contact_id,\n type: 'smoothstep',\n animated: true,\n label: t(`contactDirectory.relationshipTypes.${rel.relationship_type}`),\n labelStyle: {\n fontSize: 11,\n fontWeight: 500,\n },\n labelBgPadding: [8, 4],\n labelBgBorderRadius: 4,\n labelBgStyle: {\n fill: '#ffffff',\n opacity: 0.9,\n },\n style: {\n stroke: RELATIONSHIP_COLORS[rel.relationship_type as keyof typeof RELATIONSHIP_COLORS] || RELATIONSHIP_COLORS.other,\n strokeWidth: 2,\n },\n markerEnd: {\n type: MarkerType.ArrowClosed,\n width: 15,\n height: 15,\n color: RELATIONSHIP_COLORS[rel.relationship_type as keyof typeof RELATIONSHIP_COLORS] || RELATIONSHIP_COLORS.other,\n },\n }));\n\n setNodes(newNodes);\n setEdges(newEdges);\n }, [contactId, relationships, contacts, isRTL, t, setNodes, setEdges]);\n\n /**\n * Handle node click\n */\n const handleNodeClick = useCallback(\n (_event: React.MouseEvent, node: Node) => {\n if (onContactClick) {\n onContactClick(node.id);\n }\n },\n [onContactClick]\n );\n\n /**\n * Handle edge click\n */\n const handleEdgeClick = useCallback(\n (_event: React.MouseEvent, edge: Edge) => {\n if (onRelationshipClick) {\n onRelationshipClick(edge.id);\n }\n },\n [onRelationshipClick]\n );\n\n /**\n * Handle connection\n */\n const onConnect: OnConnect = useCallback(\n (params: Connection) => setEdges((eds) => addEdge(params, eds)),\n [setEdges]\n );\n\n // Loading state\n if (isLoading) {\n return (\n <div\n className=\"flex items-center justify-center bg-muted/10\"\n style={{ height: typeof height === 'number' ? `${height}px` : height }}\n >\n <div className=\"flex flex-col items-center gap-3\">\n <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n <p className=\"text-sm text-muted-foreground\">\n {t('contactDirectory.relationships.loading_network')}\n </p>\n </div>\n </div>\n );\n }\n\n // Empty state\n if (!relationships.length) {\n return (\n <div\n className=\"flex items-center justify-center bg-muted/10 rounded-lg border border-dashed\"\n style={{ height: typeof height === 'number' ? `${height}px` : height }}\n >\n <div className=\"text-center px-4\">\n <p className=\"font-medium mb-1\">\n {t('contactDirectory.relationships.no_relationships')}\n </p>\n <p className=\"text-sm text-muted-foreground\">\n {t('contactDirectory.relationships.add_relationships_hint')}\n </p>\n </div>\n </div>\n );\n }\n\n return (\n <div\n className={`rounded-lg border overflow-hidden ${className}`}\n style={{ height: typeof height === 'number' ? `${height}px` : height }}\n dir={isRTL ? 'rtl' : 'ltr'}\n >\n <ReactFlow\n nodes={nodes}\n edges={edges}\n onNodesChange={onNodesChange}\n onEdgesChange={onEdgesChange}\n onNodeClick={handleNodeClick}\n onEdgeClick={handleEdgeClick}\n onConnect={onConnect}\n nodeTypes={nodeTypes}\n fitView\n attributionPosition={isRTL ? 'bottom-left' : 'bottom-right'}\n proOptions={{ hideAttribution: true }}\n >\n <Background />\n <Controls position={isRTL ? 'top-left' : 'top-right'} />\n </ReactFlow>\n </div>\n );\n}\n","/**\n * RelationshipForm Component\n * Part of: 027-contact-directory Phase 6\n *\n * Form for creating/editing relationships between contacts.\n * Mobile-first, RTL-aware.\n */\n\nimport { useForm } from 'react-hook-form';\nimport { useTranslation } from 'react-i18next';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport {\n Select,\n SelectContent,\n SelectItem,\n SelectTrigger,\n SelectValue,\n} from '@/components/ui/select';\nimport { Loader2 } from 'lucide-react';\nimport { useCreateRelationship } from '@/hooks/useContactRelationships';\nimport type { CreateRelationshipInput, RelationshipType } from '@/services/contact-relationship-api';\n\n/**\n * RelationshipForm Props\n */\ninterface RelationshipFormProps {\n /** Source contact ID (from) */\n fromContactId: string;\n /** Target contact ID (to) - optional for new relationships */\n toContactId?: string;\n /** Available contacts for selection */\n availableContacts?: Array<{ id: string; full_name: string }>;\n /** Callback on successful creation */\n onSuccess?: () => void;\n /** Callback on cancel */\n onCancel?: () => void;\n}\n\n/**\n * Form values\n */\ninterface RelationshipFormValues {\n to_contact_id: string;\n relationship_type: RelationshipType;\n notes?: string;\n start_date?: string;\n end_date?: string;\n}\n\n/**\n * RelationshipForm Component\n */\nexport function RelationshipForm({\n fromContactId,\n toContactId,\n availableContacts = [],\n onSuccess,\n onCancel,\n}: RelationshipFormProps) {\n const { t, i18n } = useTranslation('contacts');\n const isRTL = i18n.language === 'ar';\n\n const {\n register,\n handleSubmit,\n setValue,\n watch,\n formState: { errors },\n } = useForm<RelationshipFormValues>({\n defaultValues: {\n to_contact_id: toContactId || '',\n relationship_type: 'colleague',\n },\n });\n\n const createMutation = useCreateRelationship();\n\n const selectedRelationType = watch('relationship_type');\n\n /**\n * Handle form submission\n */\n const onSubmit = (data: RelationshipFormValues) => {\n const input: CreateRelationshipInput = {\n from_contact_id: fromContactId,\n to_contact_id: data.to_contact_id,\n relationship_type: data.relationship_type,\n notes: data.notes || undefined,\n start_date: data.start_date || undefined,\n end_date: data.end_date || undefined,\n };\n\n createMutation.mutate(input, {\n onSuccess: () => {\n onSuccess?.();\n },\n });\n };\n\n return (\n <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-4\" dir={isRTL ? 'rtl' : 'ltr'}>\n {/* Contact Selection (if not pre-selected) */}\n {!toContactId && (\n <div className=\"space-y-2\">\n <Label htmlFor=\"to_contact_id\">\n {t('contactDirectory.relationships.form.select_contact')}\n <span className=\"text-destructive ms-1\">*</span>\n </Label>\n <Select\n value={watch('to_contact_id')}\n onValueChange={(value) => setValue('to_contact_id', value)}\n >\n <SelectTrigger id=\"to_contact_id\" className=\"h-11 sm:h-10\">\n <SelectValue placeholder={t('contactDirectory.relationships.form.select_contact_placeholder')} />\n </SelectTrigger>\n <SelectContent>\n {availableContacts.map((contact) => (\n <SelectItem key={contact.id} value={contact.id}>\n {contact.full_name}\n </SelectItem>\n ))}\n </SelectContent>\n </Select>\n {errors.to_contact_id && (\n <p className=\"text-sm text-destructive text-start\">\n {t('contactDirectory.relationships.form.contact_required')}\n </p>\n )}\n </div>\n )}\n\n {/* Relationship Type */}\n <div className=\"space-y-2\">\n <Label htmlFor=\"relationship_type\">\n {t('contactDirectory.relationships.form.relationship_type')}\n <span className=\"text-destructive ms-1\">*</span>\n </Label>\n <Select\n value={selectedRelationType}\n onValueChange={(value) => setValue('relationship_type', value as RelationshipType)}\n >\n <SelectTrigger id=\"relationship_type\" className=\"h-11 sm:h-10\">\n <SelectValue />\n </SelectTrigger>\n <SelectContent>\n <SelectItem value=\"reports_to\">\n {t('contactDirectory.relationshipTypes.reports_to')}\n </SelectItem>\n <SelectItem value=\"collaborates_with\">\n {t('contactDirectory.relationshipTypes.collaborates_with')}\n </SelectItem>\n <SelectItem value=\"partner\">\n {t('contactDirectory.relationshipTypes.partner')}\n </SelectItem>\n <SelectItem value=\"colleague\">\n {t('contactDirectory.relationshipTypes.colleague')}\n </SelectItem>\n <SelectItem value=\"other\">\n {t('contactDirectory.relationshipTypes.other')}\n </SelectItem>\n </SelectContent>\n </Select>\n </div>\n\n {/* Start Date */}\n <div className=\"space-y-2\">\n <Label htmlFor=\"start_date\">\n {t('contactDirectory.relationships.form.start_date')}\n </Label>\n <Input\n id=\"start_date\"\n type=\"date\"\n {...register('start_date')}\n className=\"h-11 sm:h-10\"\n />\n </div>\n\n {/* End Date */}\n <div className=\"space-y-2\">\n <Label htmlFor=\"end_date\">\n {t('contactDirectory.relationships.form.end_date')}\n </Label>\n <Input\n id=\"end_date\"\n type=\"date\"\n {...register('end_date')}\n className=\"h-11 sm:h-10\"\n />\n </div>\n\n {/* Notes */}\n <div className=\"space-y-2\">\n <Label htmlFor=\"notes\">\n {t('contactDirectory.relationships.form.notes')}\n </Label>\n <Textarea\n id=\"notes\"\n {...register('notes')}\n placeholder={t('contactDirectory.relationships.form.notes_placeholder')}\n rows={3}\n className=\"resize-none\"\n />\n </div>\n\n {/* Actions */}\n <div className=\"flex flex-col-reverse sm:flex-row gap-2 pt-4\">\n {onCancel && (\n <Button\n type=\"button\"\n variant=\"outline\"\n onClick={onCancel}\n disabled={createMutation.isPending}\n className=\"flex-1 sm:flex-initial h-11 sm:h-10\"\n >\n {t('contactDirectory.form.cancel')}\n </Button>\n )}\n <Button\n type=\"submit\"\n disabled={createMutation.isPending}\n className=\"flex-1 sm:flex-initial h-11 sm:h-10\"\n >\n {createMutation.isPending && (\n <Loader2 className={`h-4 w-4 animate-spin ${isRTL ? 'ml-2' : 'mr-2'}`} />\n )}\n {t('contactDirectory.relationships.form.create_relationship')}\n </Button>\n </div>\n </form>\n );\n}\n","/**\n * Interaction Timeline Component\n * Part of: 027-contact-directory Phase 7 implementation\n *\n * Mobile-first, RTL-aware component displaying chronological list of interaction notes.\n * Shows date, type icon, details preview, and attachments with expand/collapse functionality.\n */\n\nimport React, { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { format } from 'date-fns';\nimport { ar, enUS } from 'date-fns/locale';\nimport {\n Calendar,\n Mail,\n Phone,\n Users,\n FileText,\n ChevronDown,\n ChevronUp,\n Download,\n ExternalLink,\n Paperclip,\n MoreVertical,\n Trash2,\n Edit,\n} from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Card } from '@/components/ui/card';\nimport { Separator } from '@/components/ui/separator';\nimport {\n DropdownMenu,\n DropdownMenuContent,\n DropdownMenuItem,\n DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { useInteractionNotes, useDeleteNote, useDownloadAttachment } from '@/hooks/useInteractions';\nimport type { InteractionNoteResponse } from '@/services/interaction-api';\nimport { cn } from '@/lib/utils';\n\ninterface InteractionTimelineProps {\n contactId: string;\n onEditNote?: (note: InteractionNoteResponse) => void;\n className?: string;\n}\n\n/**\n * Get icon component for interaction type\n */\nfunction getTypeIcon(type: string) {\n switch (type) {\n case 'meeting':\n return Calendar;\n case 'email':\n return Mail;\n case 'call':\n return Phone;\n case 'conference':\n return Users;\n default:\n return FileText;\n }\n}\n\n/**\n * Get color for interaction type badge\n */\nfunction getTypeColor(type: string): string {\n switch (type) {\n case 'meeting':\n return 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200';\n case 'email':\n return 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200';\n case 'call':\n return 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200';\n case 'conference':\n return 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200';\n default:\n return 'bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200';\n }\n}\n\n/**\n * Individual Interaction Note Item\n */\ninterface InteractionNoteItemProps {\n note: InteractionNoteResponse;\n isRTL: boolean;\n locale: typeof ar | typeof enUS;\n onEdit?: (note: InteractionNoteResponse) => void;\n onDelete: (id: string, contactId: string) => void;\n onDownload: (path: string, filename: string) => void;\n}\n\nfunction InteractionNoteItem({\n note,\n isRTL,\n locale,\n onEdit,\n onDelete,\n onDownload,\n}: InteractionNoteItemProps) {\n const { t } = useTranslation('contacts');\n const [isExpanded, setIsExpanded] = useState(false);\n\n const TypeIcon = getTypeIcon(note.type);\n const formattedDate = format(new Date(note.date), 'PPP', { locale });\n\n // Extract filename from attachment path\n const getFilename = (path: string) => {\n const parts = path.split('/');\n const filename = parts[parts.length - 1];\n // Remove timestamp prefix if present (e.g., \"1234567890_document.pdf\" -> \"document.pdf\")\n return filename.replace(/^\\d+_/, '');\n };\n\n const hasAttachments = note.attachments && note.attachments.length > 0;\n const hasAttendees = note.attendees && note.attendees.length > 0;\n const detailsPreview =\n note.details.length > 150 ? `${note.details.substring(0, 150)}...` : note.details;\n\n return (\n <Card\n className={cn(\n 'p-4 hover:shadow-md transition-shadow',\n 'border border-border',\n isRTL && 'text-end'\n )}\n >\n <div className=\"flex flex-col gap-3 sm:gap-4\">\n {/* Header: Icon, Type, Date, Actions */}\n <div className=\"flex items-start justify-between gap-3\">\n <div className=\"flex items-start gap-3 flex-1 min-w-0\">\n {/* Icon */}\n <div\n className={cn(\n 'flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center',\n 'bg-primary/10 text-primary'\n )}\n >\n <TypeIcon className=\"w-5 h-5\" />\n </div>\n\n {/* Type, Date */}\n <div className=\"flex-1 min-w-0\">\n <div className=\"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-2\">\n <Badge variant=\"secondary\" className={cn('w-fit text-xs', getTypeColor(note.type))}>\n {t(`contactDirectory.interactions.types.${note.type}`)}\n </Badge>\n <span className=\"text-xs sm:text-sm text-muted-foreground\">{formattedDate}</span>\n </div>\n\n {/* Attendees */}\n {hasAttendees && (\n <div className=\"flex items-center gap-1 mt-1\">\n <Users className=\"w-3 h-3 text-muted-foreground\" />\n <span className=\"text-xs text-muted-foreground\">\n {t('contactDirectory.interactions.attendees_count', {\n count: note.attendees!.length,\n })}\n </span>\n </div>\n )}\n </div>\n </div>\n\n {/* Actions Menu */}\n <DropdownMenu>\n <DropdownMenuTrigger asChild>\n <Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0\">\n <MoreVertical className=\"h-4 w-4\" />\n <span className=\"sr-only\">{t('contactDirectory.interactions.actions')}</span>\n </Button>\n </DropdownMenuTrigger>\n <DropdownMenuContent align={isRTL ? 'start' : 'end'}>\n {onEdit && (\n <DropdownMenuItem onClick={() => onEdit(note)}>\n <Edit className=\"w-4 h-4 me-2\" />\n {t('contactDirectory.interactions.edit')}\n </DropdownMenuItem>\n )}\n <DropdownMenuItem\n onClick={() => onDelete(note.id, note.contact_id)}\n className=\"text-destructive\"\n >\n <Trash2 className=\"w-4 h-4 me-2\" />\n {t('contactDirectory.interactions.delete')}\n </DropdownMenuItem>\n </DropdownMenuContent>\n </DropdownMenu>\n </div>\n\n {/* Details Preview/Full */}\n <div className=\"text-sm text-foreground\">\n {isExpanded ? note.details : detailsPreview}\n </div>\n\n {/* Attachments */}\n {hasAttachments && (\n <div className=\"flex flex-col gap-2\">\n <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\n <Paperclip className=\"w-3 h-3\" />\n <span>\n {t('contactDirectory.interactions.attachments_count', {\n count: note.attachments!.length,\n })}\n </span>\n </div>\n <div className=\"flex flex-wrap gap-2\">\n {note.attachments!.map((path, index) => {\n const filename = getFilename(path);\n return (\n <Button\n key={index}\n variant=\"outline\"\n size=\"sm\"\n className=\"h-8 text-xs gap-2\"\n onClick={() => onDownload(path, filename)}\n >\n <Download className=\"w-3 h-3\" />\n <span className=\"truncate max-w-[150px] sm:max-w-[200px]\">{filename}</span>\n </Button>\n );\n })}\n </div>\n </div>\n )}\n\n {/* Expand/Collapse Button (only if details are long) */}\n {note.details.length > 150 && (\n <Button\n variant=\"ghost\"\n size=\"sm\"\n className=\"h-8 w-full sm:w-auto text-xs gap-1\"\n onClick={() => setIsExpanded(!isExpanded)}\n >\n {isExpanded ? (\n <>\n <ChevronUp className=\"w-4 h-4\" />\n {t('contactDirectory.interactions.show_less')}\n </>\n ) : (\n <>\n <ChevronDown className=\"w-4 h-4\" />\n {t('contactDirectory.interactions.show_more')}\n </>\n )}\n </Button>\n )}\n </div>\n </Card>\n );\n}\n\n/**\n * Interaction Timeline Component\n */\nexport function InteractionTimeline({\n contactId,\n onEditNote,\n className,\n}: InteractionTimelineProps) {\n const { t, i18n } = useTranslation('contacts');\n const isRTL = i18n.language === 'ar';\n const locale = isRTL ? ar : enUS;\n\n const { data: notes, isLoading, error } = useInteractionNotes(contactId);\n const deleteNoteMutation = useDeleteNote();\n const downloadAttachmentMutation = useDownloadAttachment();\n\n const handleDelete = (noteId: string, contactId: string) => {\n if (window.confirm(t('contactDirectory.interactions.delete_confirm'))) {\n deleteNoteMutation.mutate({ id: noteId, contactId });\n }\n };\n\n const handleDownload = (path: string, filename: string) => {\n downloadAttachmentMutation.mutate({ path, filename });\n };\n\n if (isLoading) {\n return (\n <div className={cn('flex items-center justify-center py-8', className)} dir={isRTL ? 'rtl' : 'ltr'}>\n <div className=\"flex flex-col items-center gap-2\">\n <div className=\"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent\" />\n <p className=\"text-sm text-muted-foreground\">\n {t('contactDirectory.interactions.loading')}\n </p>\n </div>\n </div>\n );\n }\n\n if (error) {\n return (\n <div className={cn('p-4 text-center', className)} dir={isRTL ? 'rtl' : 'ltr'}>\n <p className=\"text-sm text-destructive\">\n {t('contactDirectory.interactions.error')}: {error.message}\n </p>\n </div>\n );\n }\n\n if (!notes || notes.length === 0) {\n return (\n <div\n className={cn('flex flex-col items-center justify-center py-12 text-center', className)}\n dir={isRTL ? 'rtl' : 'ltr'}\n >\n <FileText className=\"w-12 h-12 text-muted-foreground/50 mb-4\" />\n <h3 className=\"text-base font-medium mb-2\">\n {t('contactDirectory.interactions.no_notes_title')}\n </h3>\n <p className=\"text-sm text-muted-foreground max-w-sm\">\n {t('contactDirectory.interactions.no_notes_description')}\n </p>\n </div>\n );\n }\n\n return (\n <div className={cn('space-y-4', className)} dir={isRTL ? 'rtl' : 'ltr'}>\n {/* Timeline Header */}\n <div className=\"flex items-center justify-between\">\n <h3 className=\"text-base sm:text-lg font-semibold\">\n {t('contactDirectory.interactions.timeline_title')}\n </h3>\n <Badge variant=\"secondary\" className=\"text-xs\">\n {t('contactDirectory.interactions.notes_count', { count: notes.length })}\n </Badge>\n </div>\n\n <Separator />\n\n {/* Timeline Items */}\n <div className=\"space-y-3 sm:space-y-4\">\n {notes.map((note) => (\n <InteractionNoteItem\n key={note.id}\n note={note}\n isRTL={isRTL}\n locale={locale}\n onEdit={onEditNote}\n onDelete={handleDelete}\n onDownload={handleDownload}\n />\n ))}\n </div>\n </div>\n );\n}\n","/**\n * Interaction Note Form Component\n * Part of: 027-contact-directory Phase 7 implementation\n *\n * Mobile-first, RTL-aware dialog form for creating/editing interaction notes.\n * Includes date picker, type selector, details textarea, attendee multi-select, and file upload.\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { format } from 'date-fns';\nimport { Calendar as CalendarIcon, Upload, X, Loader2, Users } from 'lucide-react';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport * as z from 'zod';\n\nimport { Button } from '@/components/ui/button';\nimport {\n Dialog,\n DialogContent,\n DialogDescription,\n DialogFooter,\n DialogHeader,\n DialogTitle,\n} from '@/components/ui/dialog';\nimport {\n Form,\n FormControl,\n FormDescription,\n FormField,\n FormItem,\n FormLabel,\n FormMessage,\n} from '@/components/ui/form';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport {\n Select,\n SelectContent,\n SelectItem,\n SelectTrigger,\n SelectValue,\n} from '@/components/ui/select';\nimport { Calendar } from '@/components/ui/calendar';\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';\nimport { Badge } from '@/components/ui/badge';\nimport { useCreateNote, useUploadAttachment } from '@/hooks/useInteractions';\nimport { useSearchPersonDossiers } from '@/hooks/usePersonDossiers';\nimport type { InteractionNoteResponse } from '@/services/interaction-api';\nimport { cn } from '@/lib/utils';\n\ninterface InteractionNoteFormProps {\n contactId: string;\n note?: InteractionNoteResponse; // For editing existing notes\n open: boolean;\n onOpenChange: (open: boolean) => void;\n}\n\n/**\n * Form Schema\n */\nconst formSchema = z.object({\n date: z.date({\n required_error: 'Date is required',\n }),\n type: z.enum(['meeting', 'email', 'call', 'conference', 'other'], {\n required_error: 'Type is required',\n }),\n details: z\n .string()\n .min(10, 'Details must be at least 10 characters')\n .max(5000, 'Details cannot exceed 5000 characters'),\n attendees: z.array(z.string()).optional(),\n});\n\ntype FormValues = z.infer<typeof formSchema>;\n\n/**\n * Interaction Note Form Dialog\n */\nexport function InteractionNoteForm({\n contactId,\n note,\n open,\n onOpenChange,\n}: InteractionNoteFormProps) {\n const { t, i18n } = useTranslation('contacts');\n const isRTL = i18n.language === 'ar';\n\n const createNoteMutation = useCreateNote();\n const uploadAttachmentMutation = useUploadAttachment();\n\n const [selectedFiles, setSelectedFiles] = useState<File[]>([]);\n const [uploadingFiles, setUploadingFiles] = useState(false);\n const [attendeeSearch, setAttendeeSearch] = useState('');\n const [selectedAttendees, setSelectedAttendees] = useState<string[]>([]);\n\n // Search contacts for attendees\n const { data: contactsData } = useSearchContacts({\n search: attendeeSearch,\n limit: 10,\n });\n\n const form = useForm<FormValues>({\n resolver: zodResolver(formSchema),\n defaultValues: {\n date: note ? new Date(note.date) : new Date(),\n type: note?.type || 'meeting',\n details: note?.details || '',\n attendees: note?.attendees || [],\n },\n });\n\n // Update selected attendees when note changes\n useEffect(() => {\n if (note?.attendees) {\n setSelectedAttendees(note.attendees);\n }\n }, [note]);\n\n const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n const files = Array.from(e.target.files || []);\n\n // Validate files\n const validFiles = files.filter((file) => {\n // Check file size (max 10MB)\n if (file.size > 10 * 1024 * 1024) {\n return false;\n }\n return true;\n });\n\n setSelectedFiles((prev) => [...prev, ...validFiles]);\n };\n\n const removeFile = (index: number) => {\n setSelectedFiles((prev) => prev.filter((_, i) => i !== index));\n };\n\n const addAttendee = (contactId: string) => {\n if (!selectedAttendees.includes(contactId)) {\n setSelectedAttendees([...selectedAttendees, contactId]);\n }\n setAttendeeSearch('');\n };\n\n const removeAttendee = (contactId: string) => {\n setSelectedAttendees(selectedAttendees.filter((id) => id !== contactId));\n };\n\n const onSubmit = async (values: FormValues) => {\n try {\n // Create the note first\n const noteData = await createNoteMutation.mutateAsync({\n contact_id: contactId,\n date: format(values.date, 'yyyy-MM-dd'),\n type: values.type,\n details: values.details,\n attendees: selectedAttendees.length > 0 ? selectedAttendees : undefined,\n });\n\n // Upload attachments if any\n if (selectedFiles.length > 0) {\n setUploadingFiles(true);\n const uploadPromises = selectedFiles.map((file) =>\n uploadAttachmentMutation.mutateAsync({\n contactId,\n noteId: noteData.id,\n file,\n })\n );\n\n await Promise.all(uploadPromises);\n setUploadingFiles(false);\n }\n\n // Reset form and close dialog\n form.reset();\n setSelectedFiles([]);\n setSelectedAttendees([]);\n onOpenChange(false);\n } catch (error) {\n console.error('Failed to create note:', error);\n setUploadingFiles(false);\n }\n };\n\n const isSubmitting = createNoteMutation.isPending || uploadingFiles;\n const maxDate = new Date(); // Cannot select future dates\n\n return (\n <Dialog open={open} onOpenChange={onOpenChange}>\n <DialogContent\n className=\"max-w-2xl max-h-[90vh] overflow-y-auto px-4 sm:px-6\"\n dir={isRTL ? 'rtl' : 'ltr'}\n >\n <DialogHeader>\n <DialogTitle className=\"text-lg sm:text-xl\">\n {note\n ? t('contactDirectory.interactions.form.edit_title')\n : t('contactDirectory.interactions.form.create_title')}\n </DialogTitle>\n <DialogDescription className=\"text-sm\">\n {t('contactDirectory.interactions.form.description')}\n </DialogDescription>\n </DialogHeader>\n\n <Form {...form}>\n <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4 sm:space-y-6\">\n {/* Date Field */}\n <FormField\n control={form.control}\n name=\"date\"\n render={({ field }) => (\n <FormItem className=\"flex flex-col\">\n <FormLabel>{t('contactDirectory.interactions.form.date')}</FormLabel>\n <Popover>\n <PopoverTrigger asChild>\n <FormControl>\n <Button\n variant=\"outline\"\n className={cn(\n 'w-full justify-start text-start font-normal',\n !field.value && 'text-muted-foreground'\n )}\n >\n <CalendarIcon className={cn('h-4 w-4', isRTL ? 'ms-2' : 'me-2')} />\n {field.value ? (\n format(field.value, 'PPP')\n ) : (\n <span>{t('contactDirectory.interactions.form.select_date')}</span>\n )}\n </Button>\n </FormControl>\n </PopoverTrigger>\n <PopoverContent className=\"w-auto p-0\" align={isRTL ? 'end' : 'start'}>\n <Calendar\n mode=\"single\"\n selected={field.value}\n onSelect={field.onChange}\n disabled={(date) => date > maxDate}\n initialFocus\n />\n </PopoverContent>\n </Popover>\n <FormDescription className=\"text-xs\">\n {t('contactDirectory.interactions.form.date_description')}\n </FormDescription>\n <FormMessage />\n </FormItem>\n )}\n />\n\n {/* Type Field */}\n <FormField\n control={form.control}\n name=\"type\"\n render={({ field }) => (\n <FormItem>\n <FormLabel>{t('contactDirectory.interactions.form.type')}</FormLabel>\n <Select onValueChange={field.onChange} defaultValue={field.value}>\n <FormControl>\n <SelectTrigger>\n <SelectValue\n placeholder={t('contactDirectory.interactions.form.select_type')}\n />\n </SelectTrigger>\n </FormControl>\n <SelectContent>\n <SelectItem value=\"meeting\">\n {t('contactDirectory.interactions.types.meeting')}\n </SelectItem>\n <SelectItem value=\"email\">\n {t('contactDirectory.interactions.types.email')}\n </SelectItem>\n <SelectItem value=\"call\">\n {t('contactDirectory.interactions.types.call')}\n </SelectItem>\n <SelectItem value=\"conference\">\n {t('contactDirectory.interactions.types.conference')}\n </SelectItem>\n <SelectItem value=\"other\">\n {t('contactDirectory.interactions.types.other')}\n </SelectItem>\n </SelectContent>\n </Select>\n <FormMessage />\n </FormItem>\n )}\n />\n\n {/* Details Field */}\n <FormField\n control={form.control}\n name=\"details\"\n render={({ field }) => (\n <FormItem>\n <FormLabel>{t('contactDirectory.interactions.form.details')}</FormLabel>\n <FormControl>\n <Textarea\n placeholder={t('contactDirectory.interactions.form.details_placeholder')}\n className=\"min-h-[120px] resize-none\"\n {...field}\n />\n </FormControl>\n <FormDescription className=\"text-xs\">\n {field.value.length}/5000{' '}\n {t('contactDirectory.interactions.form.characters')}\n </FormDescription>\n <FormMessage />\n </FormItem>\n )}\n />\n\n {/* Attendees Field */}\n <div className=\"space-y-2\">\n <FormLabel className=\"flex items-center gap-2\">\n <Users className=\"w-4 h-4\" />\n {t('contactDirectory.interactions.form.attendees')}\n </FormLabel>\n <Input\n type=\"text\"\n placeholder={t('contactDirectory.interactions.form.search_attendees')}\n value={attendeeSearch}\n onChange={(e) => setAttendeeSearch(e.target.value)}\n className=\"text-sm\"\n />\n {attendeeSearch && contactsData && contactsData.contacts.length > 0 && (\n <div className=\"border rounded-md max-h-40 overflow-y-auto\">\n {contactsData.contacts.map((contact) => (\n <button\n key={contact.id}\n type=\"button\"\n onClick={() => addAttendee(contact.id)}\n className=\"w-full px-3 py-2 text-sm text-start hover:bg-accent transition-colors\"\n >\n {contact.full_name}\n {contact.organization && (\n <span className=\"text-xs text-muted-foreground ms-2\">\n ({contact.organization.name})\n </span>\n )}\n </button>\n ))}\n </div>\n )}\n {selectedAttendees.length > 0 && (\n <div className=\"flex flex-wrap gap-2\">\n {selectedAttendees.map((attendeeId) => {\n const attendee = contactsData?.contacts.find((c) => c.id === attendeeId);\n return (\n <Badge key={attendeeId} variant=\"secondary\" className=\"gap-1\">\n {attendee?.full_name || attendeeId}\n <button\n type=\"button\"\n onClick={() => removeAttendee(attendeeId)}\n className=\"ms-1 hover:text-destructive\"\n >\n <X className=\"w-3 h-3\" />\n </button>\n </Badge>\n );\n })}\n </div>\n )}\n <FormDescription className=\"text-xs\">\n {t('contactDirectory.interactions.form.attendees_description')}\n </FormDescription>\n </div>\n\n {/* File Upload */}\n <div className=\"space-y-2\">\n <FormLabel>{t('contactDirectory.interactions.form.attachments')}</FormLabel>\n <div className=\"flex flex-col sm:flex-row gap-2\">\n <Input\n type=\"file\"\n id=\"file-upload\"\n multiple\n onChange={handleFileChange}\n className=\"hidden\"\n />\n <Button\n type=\"button\"\n variant=\"outline\"\n size=\"sm\"\n onClick={() => document.getElementById('file-upload')?.click()}\n className=\"w-full sm:w-auto\"\n >\n <Upload className={cn('w-4 h-4', isRTL ? 'ms-2' : 'me-2')} />\n {t('contactDirectory.interactions.form.upload_files')}\n </Button>\n </div>\n {selectedFiles.length > 0 && (\n <div className=\"space-y-2\">\n {selectedFiles.map((file, index) => (\n <div\n key={index}\n className=\"flex items-center justify-between p-2 border rounded-md text-sm\"\n >\n <span className=\"truncate flex-1\">{file.name}</span>\n <button\n type=\"button\"\n onClick={() => removeFile(index)}\n className=\"ms-2 text-muted-foreground hover:text-destructive\"\n >\n <X className=\"w-4 h-4\" />\n </button>\n </div>\n ))}\n </div>\n )}\n <FormDescription className=\"text-xs\">\n {t('contactDirectory.interactions.form.attachments_description')}\n </FormDescription>\n </div>\n\n <DialogFooter className=\"flex-col sm:flex-row gap-2\">\n <Button\n type=\"button\"\n variant=\"outline\"\n onClick={() => onOpenChange(false)}\n disabled={isSubmitting}\n className=\"w-full sm:w-auto\"\n >\n {t('contactDirectory.interactions.form.cancel')}\n </Button>\n <Button type=\"submit\" disabled={isSubmitting} className=\"w-full sm:w-auto gap-2\">\n {isSubmitting && <Loader2 className=\"w-4 h-4 animate-spin\" />}\n {note\n ? t('contactDirectory.interactions.form.save_changes')\n : t('contactDirectory.interactions.form.create_note')}\n </Button>\n </DialogFooter>\n </form>\n </Form>\n </DialogContent>\n </Dialog>\n );\n}\n","/**\n * ContactDetails Page\n * Part of: 027-contact-directory implementation\n *\n * Contact detail view with full information and edit/archive actions.\n * Mobile-first, RTL-ready.\n */\n\nimport { useState } from 'react';\nimport { useNavigate, useParams } from '@tanstack/react-router';\nimport { useTranslation } from 'react-i18next';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport {\n Dialog,\n DialogContent,\n DialogDescription,\n DialogFooter,\n DialogHeader,\n DialogTitle,\n} from '@/components/ui/dialog';\nimport {\n ArrowLeft,\n Edit,\n Archive,\n Mail,\n Phone,\n Building2,\n Briefcase,\n Tag,\n Calendar,\n Loader2,\n Network,\n Plus,\n} from 'lucide-react';\nimport { usePersonDossier, useArchivePersonDossier } from '@/hooks/usePersonDossiers';\nimport { useRelationships } from '@/hooks/useContactRelationships';\nimport { ContactForm } from '@/components/contacts/ContactForm';\nimport { RelationshipGraph } from '@/components/relationships/RelationshipGraph';\nimport { RelationshipForm } from '@/components/relationships/RelationshipForm';\nimport { InteractionTimeline } from '@/components/contacts/InteractionTimeline';\nimport { InteractionNoteForm } from '@/components/contacts/InteractionNoteForm';\nimport { format } from 'date-fns';\nimport type { InteractionNoteResponse } from '@/services/interaction-api';\n\nexport function ContactDetails() {\n const { t, i18n } = useTranslation('contacts');\n const isRTL = i18n.language === 'ar';\n const navigate = useNavigate();\n const { contactId } = useParams({ from: '/contacts/$contactId' });\n\n const [isEditing, setIsEditing] = useState(false);\n const [showArchiveDialog, setShowArchiveDialog] = useState(false);\n const [showNetworkDialog, setShowNetworkDialog] = useState(false);\n const [showAddRelationDialog, setShowAddRelationDialog] = useState(false);\n const [showAddNoteDialog, setShowAddNoteDialog] = useState(false);\n const [editingNote, setEditingNote] = useState<InteractionNoteResponse | undefined>(undefined);\n\n // Fetch contact\n const { data: contact, isLoading } = useContact(contactId);\n\n // Fetch relationships\n const { data: relationships = [], isLoading: isLoadingRelationships } = useRelationships(contactId);\n\n // Archive mutation\n const archiveMutation = useArchiveContact();\n\n const handleBack = () => {\n navigate({ to: '/contacts' });\n };\n\n const handleArchive = () => {\n archiveMutation.mutate(contactId, {\n onSuccess: () => {\n setShowArchiveDialog(false);\n navigate({ to: '/contacts' });\n },\n });\n };\n\n // Loading state\n if (isLoading) {\n return (\n <div className=\"min-h-screen flex items-center justify-center\">\n <div className=\"flex flex-col items-center gap-4\">\n <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n <p className=\"text-sm text-muted-foreground\">\n {t('contactDirectory.list.loading_contacts')}\n </p>\n </div>\n </div>\n );\n }\n\n // Not found\n if (!contact) {\n return (\n <div className=\"min-h-screen flex items-center justify-center\">\n <div className=\"text-center\">\n <h2 className=\"text-xl font-semibold mb-2\">\n {t('contactDirectory.messages.noContacts')}\n </h2>\n <Button onClick={handleBack} variant=\"outline\">\n <ArrowLeft className={`h-4 w-4 ${isRTL ? 'ml-2' : 'mr-2'}`} />\n {t('contactDirectory.buttons.back')}\n </Button>\n </div>\n </div>\n );\n }\n\n return (\n <div className=\"min-h-screen\" dir={isRTL ? 'rtl' : 'ltr'}>\n <div className=\"container mx-auto px-4 sm:px-6 lg:px-8 py-6\">\n {/* Header */}\n <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between mb-6\">\n <Button\n variant=\"ghost\"\n onClick={handleBack}\n className=\"self-start\"\n >\n <ArrowLeft className={`h-4 w-4 ${isRTL ? 'ml-2' : 'mr-2'}`} />\n {t('contactDirectory.buttons.back')}\n </Button>\n\n {!isEditing && (\n <div className=\"flex flex-wrap gap-2\">\n <Button\n variant=\"outline\"\n onClick={() => setShowNetworkDialog(true)}\n className=\"h-11 sm:h-10\"\n >\n <Network className={`h-4 w-4 ${isRTL ? 'ml-2' : 'mr-2'}`} />\n {t('contactDirectory.relationships.view_network')}\n </Button>\n\n <Button\n variant=\"outline\"\n onClick={() => setIsEditing(true)}\n className=\"h-11 sm:h-10\"\n >\n <Edit className={`h-4 w-4 ${isRTL ? 'ml-2' : 'mr-2'}`} />\n {t('contactDirectory.buttons.edit')}\n </Button>\n\n <Button\n variant=\"outline\"\n onClick={() => setShowArchiveDialog(true)}\n className=\"h-11 sm:h-10\"\n >\n <Archive className={`h-4 w-4 ${isRTL ? 'ml-2' : 'mr-2'}`} />\n {t('contactDirectory.buttons.archive')}\n </Button>\n </div>\n )}\n </div>\n\n {/* Edit Form or Details */}\n {isEditing ? (\n <Card>\n <CardHeader>\n <CardTitle>{t('contactDirectory.buttons.edit')}</CardTitle>\n </CardHeader>\n <CardContent>\n <ContactForm\n defaultValues={contact}\n onSubmit={() => setIsEditing(false)}\n onCancel={() => setIsEditing(false)}\n mode=\"edit\"\n />\n </CardContent>\n </Card>\n ) : (\n <div className=\"space-y-6\">\n {/* Basic Information Card */}\n <Card>\n <CardHeader>\n <div className=\"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between\">\n <div>\n <CardTitle className=\"text-2xl text-start\">\n {contact.full_name}\n </CardTitle>\n {contact.position && (\n <div className=\"flex items-center gap-2 mt-2 text-muted-foreground\">\n <Briefcase className=\"h-4 w-4\" />\n <span className=\"text-start\">{contact.position}</span>\n </div>\n )}\n </div>\n\n {contact.organization && (\n <Badge variant=\"secondary\" className=\"flex items-center gap-2 px-3 py-1.5\">\n <Building2 className=\"h-4 w-4\" />\n {contact.organization.name}\n </Badge>\n )}\n </div>\n </CardHeader>\n\n <CardContent className=\"space-y-4\">\n {/* Email Addresses */}\n {contact.email_addresses && contact.email_addresses.length > 0 && (\n <div>\n <h3 className=\"text-sm font-medium mb-2 text-start\">\n {t('contactDirectory.labels.email')}\n </h3>\n <div className=\"space-y-2\">\n {contact.email_addresses.map((email, index) => (\n <div key={index} className=\"flex items-center gap-2 text-sm\">\n <Mail className=\"h-4 w-4 text-muted-foreground\" />\n <a href={`mailto:${email}`} className=\"text-primary hover:underline text-start\">\n {email}\n </a>\n </div>\n ))}\n </div>\n </div>\n )}\n\n {/* Phone Numbers */}\n {contact.phone_numbers && contact.phone_numbers.length > 0 && (\n <div>\n <h3 className=\"text-sm font-medium mb-2 text-start\">\n {t('contactDirectory.labels.phone')}\n </h3>\n <div className=\"space-y-2\">\n {contact.phone_numbers.map((phone, index) => (\n <div key={index} className=\"flex items-center gap-2 text-sm\">\n <Phone className=\"h-4 w-4 text-muted-foreground\" />\n <a href={`tel:${phone}`} className=\"text-primary hover:underline\" dir=\"ltr\">\n {phone}\n </a>\n </div>\n ))}\n </div>\n </div>\n )}\n\n {/* Tags */}\n {contact.tags && contact.tags.length > 0 && (\n <div>\n <h3 className=\"text-sm font-medium mb-2 text-start\">\n {t('contactDirectory.labels.tags')}\n </h3>\n <div className=\"flex flex-wrap gap-2\">\n {contact.tags.map((tag) => (\n <Badge key={tag.id} variant=\"outline\">\n <Tag className=\"h-3 w-3 mr-1\" />\n {tag.name}\n </Badge>\n ))}\n </div>\n </div>\n )}\n\n {/* Notes */}\n {contact.notes && (\n <div>\n <h3 className=\"text-sm font-medium mb-2 text-start\">\n {t('contactDirectory.labels.notes')}\n </h3>\n <p className=\"text-sm text-muted-foreground whitespace-pre-wrap text-start\">\n {contact.notes}\n </p>\n </div>\n )}\n\n {/* Metadata */}\n <div className=\"pt-4 border-t space-y-2 text-xs text-muted-foreground\">\n <div className=\"flex items-center gap-2\">\n <Calendar className=\"h-3 w-3\" />\n <span>\n {t('contactDirectory.labels.createdAt')}:{' '}\n {format(new Date(contact.created_at), 'PPP')}\n </span>\n </div>\n {contact.updated_at !== contact.created_at && (\n <div className=\"flex items-center gap-2\">\n <Calendar className=\"h-3 w-3\" />\n <span>\n {t('contactDirectory.labels.updatedAt')}:{' '}\n {format(new Date(contact.updated_at), 'PPP')}\n </span>\n </div>\n )}\n <div className=\"flex items-center gap-2\">\n <span>\n {t('contactDirectory.labels.sourceType')}:{' '}\n {t(`contactDirectory.sourceTypes.${contact.source_type}`)}\n </span>\n </div>\n </div>\n </CardContent>\n </Card>\n\n {/* Interaction History Section */}\n <Card>\n <CardHeader>\n <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\n <CardTitle className=\"text-start\">\n {t('contactDirectory.interactions.title')}\n </CardTitle>\n <Button\n variant=\"default\"\n size=\"sm\"\n onClick={() => setShowAddNoteDialog(true)}\n className=\"h-11 sm:h-10 w-full sm:w-auto\"\n >\n <Plus className={`h-4 w-4 ${isRTL ? 'ml-2' : 'mr-2'}`} />\n {t('contactDirectory.interactions.add_note')}\n </Button>\n </div>\n </CardHeader>\n <CardContent>\n <InteractionTimeline\n contactId={contactId}\n onEditNote={(note) => {\n setEditingNote(note);\n setShowAddNoteDialog(true);\n }}\n />\n </CardContent>\n </Card>\n </div>\n )}\n\n {/* Network Dialog */}\n <Dialog open={showNetworkDialog} onOpenChange={setShowNetworkDialog}>\n <DialogContent className=\"max-w-5xl max-h-[90vh]\">\n <DialogHeader>\n <div className=\"flex items-center justify-between\">\n <DialogTitle>{t('contactDirectory.relationships.title')}</DialogTitle>\n <Button\n variant=\"outline\"\n size=\"sm\"\n onClick={() => {\n setShowNetworkDialog(false);\n setShowAddRelationDialog(true);\n }}\n className=\"h-9\"\n >\n <Plus className={`h-4 w-4 ${isRTL ? 'ml-2' : 'mr-2'}`} />\n {t('contactDirectory.relationships.add_relationship')}\n </Button>\n </div>\n <DialogDescription>\n {t('contactDirectory.relationships.relationship_count', { count: relationships.length })}\n </DialogDescription>\n </DialogHeader>\n <div className=\"mt-4\">\n <RelationshipGraph\n contactId={contactId}\n relationships={relationships}\n contacts={[contact, ...relationships.map(r => r.from_contact || r.to_contact).filter(Boolean)]}\n isLoading={isLoadingRelationships}\n height={500}\n />\n </div>\n </DialogContent>\n </Dialog>\n\n {/* Add Relationship Dialog */}\n <Dialog open={showAddRelationDialog} onOpenChange={setShowAddRelationDialog}>\n <DialogContent>\n <DialogHeader>\n <DialogTitle>{t('contactDirectory.relationships.add_relationship')}</DialogTitle>\n <DialogDescription>\n Create a new relationship for {contact.full_name}\n </DialogDescription>\n </DialogHeader>\n <RelationshipForm\n fromContactId={contactId}\n onSuccess={() => setShowAddRelationDialog(false)}\n onCancel={() => setShowAddRelationDialog(false)}\n />\n </DialogContent>\n </Dialog>\n\n {/* Add/Edit Note Dialog */}\n <InteractionNoteForm\n contactId={contactId}\n note={editingNote}\n open={showAddNoteDialog}\n onOpenChange={(open) => {\n setShowAddNoteDialog(open);\n if (!open) {\n setEditingNote(undefined);\n }\n }}\n />\n\n {/* Archive Confirmation Dialog */}\n <Dialog open={showArchiveDialog} onOpenChange={setShowArchiveDialog}>\n <DialogContent>\n <DialogHeader>\n <DialogTitle>{t('contactDirectory.buttons.archive')}</DialogTitle>\n <DialogDescription>\n {t('contactDirectory.messages.archiveConfirm', { name: contact.full_name })}\n </DialogDescription>\n </DialogHeader>\n <DialogFooter>\n <Button\n variant=\"outline\"\n onClick={() => setShowArchiveDialog(false)}\n disabled={archiveMutation.isPending}\n >\n {t('contactDirectory.form.cancel')}\n </Button>\n <Button\n variant=\"destructive\"\n onClick={handleArchive}\n disabled={archiveMutation.isPending}\n >\n {archiveMutation.isPending && (\n <Loader2 className={`h-4 w-4 animate-spin ${isRTL ? 'ml-2' : 'mr-2'}`} />\n )}\n {t('contactDirectory.buttons.archive')}\n </Button>\n </DialogFooter>\n </DialogContent>\n </Dialog>\n </div>\n </div>\n );\n}\n","/**\n * Contact Details Route\n * Part of: 027-contact-directory implementation\n *\n * Route: /contacts/:contactId\n * Displays full contact details with edit/archive actions\n */\n\nimport { createFileRoute } from '@tanstack/react-router';\nimport { ContactDetails } from '@/pages/contacts/ContactDetails';\n\nexport const Route = createFileRoute('/_protected/contacts/$contactId')({\n component: ContactDetails,\n meta: ({ params }) => [\n {\n title: `Contact Details - ${params.contactId} - GASTAT`,\n },\n ],\n});\n"],"names":["RELATIONSHIP_COLORS","ContactNode","data","t","useTranslation","isCenter","jsx","Card","jsxs","User","Badge","Building2","nodeTypes","RelationshipGraph","contactId","relationships","contacts","onContactClick","onRelationshipClick","isLoading","height","className","i18n","isRTL","nodes","setNodes","onNodesChange","useNodesState","edges","setEdges","onEdgesChange","useEdgesState","useEffect","contactMap","c","involvedContactIds","rel","newNodes","contactsArray","id","radius","angleStep","contact","index","x","y","Position","newEdges","MarkerType","handleNodeClick","useCallback","_event","node","handleEdgeClick","edge","onConnect","params","eds","addEdge","Loader2","ReactFlow","Background","Controls","RelationshipForm","fromContactId","toContactId","availableContacts","onSuccess","onCancel","register","handleSubmit","setValue","watch","errors","useForm","createMutation","useCreateRelationship","selectedRelationType","onSubmit","input","Label","Select","value","SelectTrigger","SelectValue","SelectContent","SelectItem","Input","Textarea","Button","getTypeIcon","type","Calendar","Mail","Phone","Users","FileText","getTypeColor","InteractionNoteItem","note","locale","onEdit","onDelete","onDownload","isExpanded","setIsExpanded","useState","TypeIcon","formattedDate","format","getFilename","path","parts","hasAttachments","hasAttendees","detailsPreview","cn","DropdownMenu","DropdownMenuTrigger","MoreVertical","DropdownMenuContent","DropdownMenuItem","Edit","Trash2","Paperclip","filename","Download","Fragment","ChevronUp","ChevronDown","InteractionTimeline","onEditNote","ar","enUS","notes","error","useInteractionNotes","deleteNoteMutation","useDeleteNote","downloadAttachmentMutation","useDownloadAttachment","handleDelete","noteId","handleDownload","Separator","formSchema","z.object","z.date","z.enum","z.string","z.array","InteractionNoteForm","open","onOpenChange","createNoteMutation","useCreateNote","uploadAttachmentMutation","useUploadAttachment","selectedFiles","setSelectedFiles","uploadingFiles","setUploadingFiles","attendeeSearch","setAttendeeSearch","selectedAttendees","setSelectedAttendees","contactsData","form","zodResolver","handleFileChange","e","validFiles","file","prev","removeFile","_","i","addAttendee","removeAttendee","values","noteData","uploadPromises","isSubmitting","maxDate","Dialog","DialogContent","DialogHeader","DialogTitle","DialogDescription","Form","FormField","field","FormItem","FormLabel","Popover","PopoverTrigger","FormControl","CalendarIcon","PopoverContent","date","FormDescription","FormMessage","attendeeId","attendee","X","Upload","DialogFooter","ContactDetails","navigate","useNavigate","useParams","isEditing","setIsEditing","showArchiveDialog","setShowArchiveDialog","showNetworkDialog","setShowNetworkDialog","showAddRelationDialog","setShowAddRelationDialog","showAddNoteDialog","setShowAddNoteDialog","editingNote","setEditingNote","isLoadingRelationships","useRelationships","archiveMutation","handleBack","handleArchive","ArrowLeft","Network","Archive","CardHeader","CardTitle","CardContent","ContactForm","Briefcase","email","phone","tag","Tag","Plus","r","SplitComponent"],"mappings":"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"}