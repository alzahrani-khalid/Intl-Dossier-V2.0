{"version":3,"file":"CollapsibleSection-Bj_Tk5Ee.js","sources":["../../src/hooks/useSessionStorage.ts","../../src/components/Dossier/CollapsibleSection.tsx"],"sourcesContent":["/**\n * Custom hook for session storage persistence\n * Automatically syncs state with sessionStorage\n * Session-scoped persistence (clears on tab close)\n * Feature: 028-type-specific-dossier-pages\n */\n\nimport { useState, useCallback, useEffect } from 'react';\n\n/**\n * Custom hook to persist state in sessionStorage\n *\n * @param key - Storage key (must be unique per component/context)\n * @param initialValue - Default value if no stored value exists\n * @returns [storedValue, setValue] - Current value and setter function\n *\n * @example\n * const [isOpen, setIsOpen] = useSessionStorage('sidebar-open', false);\n *\n * @example\n * const [sections, setSections] = useSessionStorage<Record<string, boolean>>(\n *   'dossier-sections-country-123',\n *   { overview: true, positions: true }\n * );\n */\nexport function useSessionStorage<T>(\n  key: string,\n  initialValue: T\n): [T, (value: T | ((val: T) => T)) => void] {\n  // Initialize state from sessionStorage or use initial value\n  const [storedValue, setStoredValue] = useState<T>(() => {\n    if (typeof window === 'undefined') {\n      return initialValue;\n    }\n\n    try {\n      const item = window.sessionStorage.getItem(key);\n      return item ? (JSON.parse(item) as T) : initialValue;\n    } catch (error) {\n      console.warn(`Error reading sessionStorage key \"${key}\":`, error);\n      return initialValue;\n    }\n  });\n\n  // Update sessionStorage when value changes\n  const setValue = useCallback(\n    (value: T | ((val: T) => T)) => {\n      try {\n        // Allow value to be a function (same API as useState)\n        const valueToStore =\n          value instanceof Function ? value(storedValue) : value;\n\n        // Update React state\n        setStoredValue(valueToStore);\n\n        // Persist to sessionStorage\n        if (typeof window !== 'undefined') {\n          window.sessionStorage.setItem(key, JSON.stringify(valueToStore));\n        }\n      } catch (error) {\n        console.warn(`Error setting sessionStorage key \"${key}\":`, error);\n      }\n    },\n    [key, storedValue]\n  );\n\n  // Sync with sessionStorage changes from other tabs/windows\n  useEffect(() => {\n    if (typeof window === 'undefined') {\n      return;\n    }\n\n    const handleStorageChange = (e: StorageEvent) => {\n      if (e.key === key && e.newValue !== null) {\n        try {\n          setStoredValue(JSON.parse(e.newValue) as T);\n        } catch (error) {\n          console.warn(\n            `Error syncing sessionStorage key \"${key}\":`,\n            error\n          );\n        }\n      }\n    };\n\n    // Listen for storage events (cross-tab synchronization)\n    window.addEventListener('storage', handleStorageChange);\n\n    return () => {\n      window.removeEventListener('storage', handleStorageChange);\n    };\n  }, [key]);\n\n  return [storedValue, setValue];\n}\n\n/**\n * Hook for managing collapsible section state\n * Persists expand/collapse state per dossier and section\n *\n * @param dossierId - Unique dossier identifier\n * @param dossierType - Dossier type (for namespacing)\n * @param defaultSections - Default expanded state for each section\n * @returns [sections, toggleSection, setSections]\n *\n * @example\n * const [sections, toggleSection] = useCollapsibleSections(\n *   dossier.id,\n *   dossier.type,\n *   { overview: true, positions: true, intelligence: false }\n * );\n */\nexport function useCollapsibleSections(\n  dossierId: string,\n  dossierType: string,\n  defaultSections: Record<string, boolean>\n): [\n  Record<string, boolean>,\n  (sectionId: string) => void,\n  (sections: Record<string, boolean>) => void\n] {\n  const storageKey = `dossier-sections-${dossierType}-${dossierId}`;\n  const [sections, setSections] = useSessionStorage<Record<string, boolean>>(\n    storageKey,\n    defaultSections\n  );\n\n  const toggleSection = useCallback(\n    (sectionId: string) => {\n      setSections((prev) => ({\n        ...prev,\n        [sectionId]: !prev[sectionId],\n      }));\n    },\n    [setSections]\n  );\n\n  return [sections, toggleSection, setSections];\n}\n","/**\n * CollapsibleSection - WCAG AA compliant accordion component\n * Features: ARIA attributes, keyboard navigation, Framer Motion animations,\n * session storage persistence, 44px touch targets, RTL support\n * Feature: 028-type-specific-dossier-pages\n */\n\nimport { useState, useId, ReactNode } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { motion, AnimatePresence } from 'framer-motion'\nimport { ChevronDown, Loader2 } from 'lucide-react'\nimport { cn } from '@/lib/utils'\n\ninterface CollapsibleSectionProps {\n  /**\n   * Unique section identifier (for session storage)\n   */\n  id: string\n\n  /**\n   * Section title (supports i18n keys or plain text)\n   */\n  title: string\n\n  /**\n   * Optional description shown below title\n   */\n  description?: string\n\n  /**\n   * Section content\n   */\n  children: ReactNode\n\n  /**\n   * Default expanded state (overridden by session storage)\n   */\n  defaultExpanded?: boolean\n\n  /**\n   * Controlled expanded state (optional)\n   */\n  isExpanded?: boolean\n\n  /**\n   * Controlled toggle handler (optional)\n   */\n  onToggle?: (expanded: boolean) => void\n\n  /**\n   * Loading state\n   */\n  isLoading?: boolean\n\n  /**\n   * Error state\n   */\n  error?: string\n\n  /**\n   * Empty state message\n   */\n  emptyMessage?: string\n\n  /**\n   * Show empty state when no children provided\n   */\n  showEmptyState?: boolean\n\n  /**\n   * Custom header class name\n   */\n  headerClassName?: string\n\n  /**\n   * Custom content class name\n   */\n  contentClassName?: string\n}\n\n/**\n * CollapsibleSection component\n * WCAG AA compliant with ARIA accordion pattern\n */\nexport function CollapsibleSection({\n  id,\n  title,\n  description,\n  children,\n  defaultExpanded = true,\n  isExpanded: controlledExpanded,\n  onToggle,\n  isLoading = false,\n  error,\n  emptyMessage,\n  showEmptyState = false,\n  headerClassName,\n  contentClassName,\n}: CollapsibleSectionProps) {\n  const { t, i18n } = useTranslation('dossier')\n  const isRTL = i18n.language === 'ar'\n  const uniqueId = useId()\n\n  // Use controlled state if provided, otherwise use internal state\n  const [internalExpanded, setInternalExpanded] = useState(defaultExpanded)\n  const isExpanded = controlledExpanded ?? internalExpanded\n\n  // Generate unique IDs for ARIA attributes\n  const headerId = `collapsible-header-${uniqueId}-${id}`\n  const panelId = `collapsible-panel-${uniqueId}-${id}`\n\n  // Handle toggle\n  const handleToggle = () => {\n    const newValue = !isExpanded\n    if (onToggle) {\n      onToggle(newValue)\n    } else {\n      setInternalExpanded(newValue)\n    }\n  }\n\n  // Handle keyboard navigation\n  const handleKeyDown = (event: React.KeyboardEvent) => {\n    if (event.key === 'Enter' || event.key === ' ') {\n      event.preventDefault()\n      handleToggle()\n    }\n  }\n\n  return (\n    <div className=\"border rounded-lg overflow-hidden\" dir={isRTL ? 'rtl' : 'ltr'}>\n      {/* Header - WCAG AA touch target: min 44x44px */}\n      <button\n        type=\"button\"\n        id={headerId}\n        aria-expanded={isExpanded}\n        aria-controls={panelId}\n        onClick={handleToggle}\n        onKeyDown={handleKeyDown}\n        className={cn(\n          'w-full min-h-11 px-4 py-3 sm:px-6 sm:py-4',\n          'flex items-center justify-between gap-3',\n          'bg-card text-card-foreground',\n          'hover:bg-accent hover:text-accent-foreground',\n          'focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2',\n          'transition-colors duration-200',\n          'text-start', // Logical property for RTL support\n          headerClassName,\n        )}\n      >\n        <div className=\"flex-1\">\n          <h2 className=\"text-base sm:text-lg font-semibold\">{title}</h2>\n          {description && <p className=\"text-sm text-muted-foreground mt-1\">{description}</p>}\n        </div>\n\n        {/* Chevron icon */}\n        <ChevronDown\n          className={cn(\n            'h-5 w-5 text-muted-foreground',\n            'transition-transform duration-300',\n            isExpanded && 'rotate-180',\n          )}\n          aria-hidden=\"true\"\n        />\n      </button>\n\n      {/* Content Panel - AnimatePresence for smooth transitions */}\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{\n              duration: 0.3,\n              ease: [0.04, 0.62, 0.23, 0.98], // Custom easing for smooth motion\n            }}\n            role=\"region\"\n            id={panelId}\n            aria-labelledby={headerId}\n          >\n            <div\n              className={cn(\n                'px-4 py-3 sm:px-6 sm:py-4 bg-background',\n                'border-t',\n                contentClassName,\n              )}\n            >\n              {/* Loading State - with aria-live for screen readers */}\n              {isLoading && (\n                <div\n                  className=\"flex items-center justify-center py-8 sm:py-12\"\n                  aria-live=\"polite\"\n                  aria-busy=\"true\"\n                >\n                  <Loader2 className=\"h-6 w-6 sm:h-8 sm:w-8 animate-spin text-muted-foreground\" />\n                  <span className=\"ms-3 text-muted-foreground\">\n                    {t('sections.collapsible.loading')}\n                  </span>\n                </div>\n              )}\n\n              {/* Error State - with aria-live for screen readers */}\n              {error && !isLoading && (\n                <div\n                  className=\"flex items-center justify-center py-8 sm:py-12\"\n                  role=\"alert\"\n                  aria-live=\"assertive\"\n                >\n                  <p className=\"text-destructive text-sm sm:text-base\">{error}</p>\n                </div>\n              )}\n\n              {/* Empty State */}\n              {showEmptyState && !isLoading && !error && !children && (\n                <div className=\"flex items-center justify-center py-8 sm:py-12\">\n                  <p className=\"text-muted-foreground text-sm sm:text-base\">\n                    {emptyMessage || t('sections.collapsible.empty')}\n                  </p>\n                </div>\n              )}\n\n              {/* Content */}\n              {!isLoading && !error && children && (\n                <div className=\"prose prose-sm sm:prose max-w-none dark:prose-invert\">\n                  {children}\n                </div>\n              )}\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  )\n}\n"],"names":["useSessionStorage","key","initialValue","storedValue","setStoredValue","useState","item","error","setValue","useCallback","value","valueToStore","useEffect","handleStorageChange","e","useCollapsibleSections","dossierId","dossierType","defaultSections","storageKey","sections","setSections","toggleSection","sectionId","prev","CollapsibleSection","id","title","description","children","defaultExpanded","controlledExpanded","onToggle","isLoading","emptyMessage","showEmptyState","headerClassName","contentClassName","t","i18n","useTranslation","isRTL","uniqueId","useId","internalExpanded","setInternalExpanded","isExpanded","headerId","panelId","handleToggle","newValue","handleKeyDown","event","jsxs","cn","jsx","ChevronDown","AnimatePresence","motion","Loader2"],"mappings":"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"}