{"version":3,"file":"_id-8dwuRbIO.js","sources":["../../src/components/Dossier/sections/EngagementInformation.tsx","../../src/components/Dossier/sections/ParticipantsList.tsx","../../src/components/Dossier/sections/OutcomesSummary.tsx","../../src/components/Dossier/sections/FollowUpActions.tsx","../../src/hooks/useEngagementPositions.ts","../../src/hooks/usePositionSuggestions.ts","../../src/hooks/useUpdateSuggestionAction.ts","../../src/components/positions/PositionSuggestionsPanel.tsx","../../src/hooks/useGenerateBriefingPack.ts","../../src/hooks/useBriefingPackStatus.ts","../../src/components/positions/BriefingPackGenerator.tsx","../../src/components/positions/EngagementPositionsSection.tsx","../../src/components/Dossier/EngagementDossierDetail.tsx","../../src/components/kibo-ui/kanban/index.tsx","../../src/components/assignments/KanbanTaskCard.tsx","../../src/components/assignments/EngagementKanbanDialog.tsx","../../src/hooks/useEngagementKanban.ts","../../src/pages/dossiers/EngagementDossierPage.tsx","../../src/routes/_protected/dossiers/engagements/$id.tsx?tsr-split=component"],"sourcesContent":["/**\n * Engagement Information Section\n * Displays key engagement metadata: dates, location, description, created by\n * Mobile-first design with RTL support\n */\n\nimport { useTranslation } from 'react-i18next';\nimport { Calendar, MapPin, FileText, Users } from 'lucide-react';\nimport { format } from 'date-fns';\nimport { ar, enUS } from 'date-fns/locale';\nimport type { EngagementDossier } from '@/lib/dossier-type-guards';\n\ninterface EngagementInformationProps {\n  dossier: EngagementDossier;\n}\n\nexport function EngagementInformation({ dossier }: EngagementInformationProps) {\n  const { t, i18n } = useTranslation('dossier');\n  const isRTL = i18n.language === 'ar';\n  const locale = isRTL ? ar : enUS;\n\n  // Safe access to extension data\n  const extension = dossier.extension as any;\n  const location = isRTL\n    ? extension?.location_ar || extension?.location\n    : extension?.location_en || extension?.location;\n\n  return (\n    <div\n      className=\"space-y-4 sm:space-y-6\"\n      dir={isRTL ? 'rtl' : 'ltr'}\n    >\n      {/* Engagement Date */}\n      <div className=\"flex items-start gap-3 sm:gap-4\">\n        <Calendar className=\"h-5 w-5 sm:h-6 sm:w-6 text-muted-foreground mt-0.5 flex-shrink-0\" />\n        <div className=\"flex-1 min-w-0\">\n          <p className=\"text-sm sm:text-base font-medium mb-1\">\n            {t('sections.engagement.date')}\n          </p>\n          <p className=\"text-sm sm:text-base text-muted-foreground\">\n            {format(new Date(dossier.created_at), 'PPP', { locale })}\n          </p>\n        </div>\n      </div>\n\n      {/* Location */}\n      {location && (\n        <div className=\"flex items-start gap-3 sm:gap-4\">\n          <MapPin className=\"h-5 w-5 sm:h-6 sm:w-6 text-muted-foreground mt-0.5 flex-shrink-0\" />\n          <div className=\"flex-1 min-w-0\">\n            <p className=\"text-sm sm:text-base font-medium mb-1\">\n              {t('sections.engagement.location')}\n            </p>\n            <p className=\"text-sm sm:text-base text-muted-foreground\">\n              {location}\n            </p>\n          </div>\n        </div>\n      )}\n\n      {/* Description */}\n      {(isRTL ? dossier.description_ar : dossier.description_en) && (\n        <div className=\"flex items-start gap-3 sm:gap-4\">\n          <FileText className=\"h-5 w-5 sm:h-6 sm:w-6 text-muted-foreground mt-0.5 flex-shrink-0\" />\n          <div className=\"flex-1 min-w-0\">\n            <p className=\"text-sm sm:text-base font-medium mb-1\">\n              {t('sections.engagement.description')}\n            </p>\n            <p className=\"text-sm sm:text-base text-muted-foreground whitespace-pre-wrap\">\n              {isRTL ? dossier.description_ar : dossier.description_en}\n            </p>\n          </div>\n        </div>\n      )}\n\n      {/* Created By */}\n      <div className=\"flex items-start gap-3 sm:gap-4\">\n        <Users className=\"h-5 w-5 sm:h-6 sm:w-6 text-muted-foreground mt-0.5 flex-shrink-0\" />\n        <div className=\"flex-1 min-w-0\">\n          <p className=\"text-sm sm:text-base font-medium mb-1\">\n            {t('sections.engagement.createdBy')}\n          </p>\n          <p className=\"text-sm sm:text-base text-muted-foreground\">\n            {format(new Date(dossier.created_at), 'PPp', { locale })}\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n","/**\n * Participants List Section (Feature 028 - User Story 3 - T030)\n *\n * Displays attendees and their roles for engagement.\n * Future: Integration with person dossiers via dossier_relationships.\n * Mobile-first layout with RTL support.\n */\n\nimport { useTranslation } from 'react-i18next';\nimport { Users, User } from 'lucide-react';\n\ninterface ParticipantsListProps {\n  dossierId: string;\n}\n\nexport function ParticipantsList({ dossierId }: ParticipantsListProps) {\n  const { t, i18n } = useTranslation('dossier');\n  const isRTL = i18n.language === 'ar';\n\n  // TODO: Fetch person dossiers linked to this engagement\n  // FROM dossier_relationships WHERE relationship_type = 'engagement_participant'\n  // For now, show empty state placeholder\n\n  return (\n    <div\n      className=\"flex flex-col items-center justify-center py-8 sm:py-12 text-center\"\n      dir={isRTL ? 'rtl' : 'ltr'}\n    >\n      <div className=\"mb-4 sm:mb-6\">\n        <div className=\"h-16 w-16 sm:h-20 sm:w-20 rounded-full bg-primary/10 flex items-center justify-center\">\n          <Users className=\"h-8 w-8 sm:h-10 sm:w-10 text-primary\" />\n        </div>\n      </div>\n\n      <h3 className=\"text-base sm:text-lg font-semibold text-foreground mb-2\">\n        {t('sections.engagement.participantsListEmpty')}\n      </h3>\n\n      <p className=\"text-sm sm:text-base text-muted-foreground max-w-md mb-6 px-4\">\n        {t('sections.engagement.participantsListEmptyDescription')}\n      </p>\n\n      <div className=\"text-xs sm:text-sm text-muted-foreground px-4\">\n        <p>{t('sections.engagement.participantsListPlaceholder')}</p>\n      </div>\n    </div>\n  );\n}\n","/**\n * Outcomes Summary Section (Feature 028 - User Story 3 - T031)\n *\n * Displays key decisions and results from engagement.\n * Future: Integration with decisions tracking system.\n * Mobile-first layout with RTL support.\n */\n\nimport { useTranslation } from 'react-i18next';\nimport { CheckCircle2, FileCheck } from 'lucide-react';\n\ninterface OutcomesSummaryProps {\n  dossierId: string;\n}\n\nexport function OutcomesSummary({ dossierId }: OutcomesSummaryProps) {\n  const { t, i18n } = useTranslation('dossier');\n  const isRTL = i18n.language === 'ar';\n\n  // TODO: Fetch outcomes/decisions from related tables\n  // Future integration with decisions tracking\n  // For now, show empty state placeholder\n\n  return (\n    <div\n      className=\"flex flex-col items-center justify-center py-8 sm:py-12 text-center\"\n      dir={isRTL ? 'rtl' : 'ltr'}\n    >\n      <div className=\"mb-4 sm:mb-6\">\n        <div className=\"h-16 w-16 sm:h-20 sm:w-20 rounded-full bg-primary/10 flex items-center justify-center\">\n          <CheckCircle2 className=\"h-8 w-8 sm:h-10 sm:w-10 text-primary\" />\n        </div>\n      </div>\n\n      <h3 className=\"text-base sm:text-lg font-semibold text-foreground mb-2\">\n        {t('sections.engagement.outcomesSummaryEmpty')}\n      </h3>\n\n      <p className=\"text-sm sm:text-base text-muted-foreground max-w-md mb-6 px-4\">\n        {t('sections.engagement.outcomesSummaryEmptyDescription')}\n      </p>\n\n      <div className=\"text-xs sm:text-sm text-muted-foreground px-4\">\n        <p>{t('sections.engagement.outcomesSummaryPlaceholder')}</p>\n      </div>\n    </div>\n  );\n}\n","/**\n * Follow-Up Actions Section (Feature 028 - User Story 3 - T032)\n *\n * Displays tasks and next steps from engagement.\n * Future: Integration with tasks/assignments system.\n * Mobile-first layout with RTL support.\n */\n\nimport { useTranslation } from 'react-i18next';\nimport { ListTodo, CheckSquare } from 'lucide-react';\n\ninterface FollowUpActionsProps {\n  dossierId: string;\n}\n\nexport function FollowUpActions({ dossierId }: FollowUpActionsProps) {\n  const { t, i18n } = useTranslation('dossier');\n  const isRTL = i18n.language === 'ar';\n\n  // TODO: Fetch follow-up tasks/actions from assignments table\n  // WHERE entity_type = 'engagement' AND entity_id = dossierId\n  // For now, show empty state placeholder\n\n  return (\n    <div\n      className=\"flex flex-col items-center justify-center py-8 sm:py-12 text-center\"\n      dir={isRTL ? 'rtl' : 'ltr'}\n    >\n      <div className=\"mb-4 sm:mb-6\">\n        <div className=\"h-16 w-16 sm:h-20 sm:w-20 rounded-full bg-primary/10 flex items-center justify-center\">\n          <ListTodo className=\"h-8 w-8 sm:h-10 sm:w-10 text-primary\" />\n        </div>\n      </div>\n\n      <h3 className=\"text-base sm:text-lg font-semibold text-foreground mb-2\">\n        {t('sections.engagement.followUpActionsEmpty')}\n      </h3>\n\n      <p className=\"text-sm sm:text-base text-muted-foreground max-w-md mb-6 px-4\">\n        {t('sections.engagement.followUpActionsEmptyDescription')}\n      </p>\n\n      <div className=\"text-xs sm:text-sm text-muted-foreground px-4\">\n        <p>{t('sections.engagement.followUpActionsPlaceholder')}</p>\n      </div>\n    </div>\n  );\n}\n","/**\n * TanStack Query Hook: useEngagementPositions (T035)\n * Fetches positions attached to an engagement with sorting and pagination\n */\n\nimport { useQuery } from '@tanstack/react-query';\nimport { supabase } from '@/lib/supabase';\n\nexport interface EngagementPosition {\n  id: string;\n  engagement_id: string;\n  position_id: string;\n  attached_by: string;\n  attached_at: string;\n  attachment_reason?: string;\n  display_order?: number;\n  relevance_score?: number;\n  positions: {\n    id: string;\n    title: string;\n    content: string;\n    type: string;\n    status: string;\n    primary_language: 'en' | 'ar';\n    created_at: string;\n    updated_at: string;\n  };\n}\n\nexport interface UseEngagementPositionsOptions {\n  engagementId: string;\n  sort?: 'display_order' | 'relevance_score' | 'attached_at';\n  order?: 'asc' | 'desc';\n  page?: number;\n  pageSize?: number;\n  enabled?: boolean;\n}\n\nexport interface UseEngagementPositionsResult {\n  positions: EngagementPosition[];\n  total: number;\n  page: number;\n  pageSize: number;\n  totalPages: number;\n  isLoading: boolean;\n  isError: boolean;\n  error: Error | null;\n  refetch: () => void;\n}\n\nasync function fetchEngagementPositions(\n  options: UseEngagementPositionsOptions\n): Promise<{ positions: EngagementPosition[]; total: number }> {\n  const {\n    engagementId,\n    sort = 'attached_at',\n    order = 'desc',\n    page = 1,\n    pageSize = 20,\n  } = options;\n\n  // Build query\n  let query = supabase\n    .from('engagement_positions')\n    .select('*, positions(*)', { count: 'exact' })\n    .eq('engagement_id', engagementId);\n\n  // Apply sorting\n  const ascending = order === 'asc';\n  query = query.order(sort, { ascending });\n\n  // Apply pagination\n  const from = (page - 1) * pageSize;\n  const to = from + pageSize - 1;\n  query = query.range(from, to);\n\n  const { data, error, count } = await query;\n\n  if (error) {\n    throw new Error(`Failed to fetch engagement positions: ${error.message}`);\n  }\n\n  return {\n    positions: (data || []) as EngagementPosition[],\n    total: count || 0,\n  };\n}\n\nexport function useEngagementPositions(\n  options: UseEngagementPositionsOptions\n): UseEngagementPositionsResult {\n  const {\n    engagementId,\n    sort = 'attached_at',\n    order = 'desc',\n    page = 1,\n    pageSize = 20,\n    enabled = true,\n  } = options;\n\n  const {\n    data,\n    isLoading,\n    isError,\n    error,\n    refetch,\n  } = useQuery({\n    queryKey: ['engagement-positions', engagementId, sort, order, page, pageSize],\n    queryFn: () => fetchEngagementPositions(options),\n    enabled: enabled && !!engagementId,\n    staleTime: 5 * 60 * 1000, // 5 minutes\n    gcTime: 10 * 60 * 1000, // 10 minutes (formerly cacheTime)\n  });\n\n  const positions = data?.positions || [];\n  const total = data?.total || 0;\n  const totalPages = Math.ceil(total / pageSize);\n\n  return {\n    positions,\n    total,\n    page,\n    pageSize,\n    totalPages,\n    isLoading,\n    isError,\n    error: error as Error | null,\n    refetch,\n  };\n}\n","/**\n * TanStack Query Hook: usePositionSuggestions (T038)\n * Fetches AI-suggested positions for an engagement with fallback mode handling\n */\n\nimport { useQuery } from '@tanstack/react-query';\nimport { supabase } from '@/lib/supabase';\n\nexport interface PositionSuggestion {\n  id: string;\n  engagement_id: string;\n  position_id: string;\n  relevance_score: number;\n  suggestion_reasoning?: {\n    keywords?: string[];\n    context_factors?: string[];\n  };\n  created_at: string;\n  user_action?: 'accepted' | 'rejected' | 'ignored';\n  actioned_at?: string;\n  position: {\n    id: string;\n    title: string;\n    content: string;\n    type: string;\n    status: string;\n    primary_language: 'en' | 'ar';\n  };\n}\n\nexport interface SuggestionsMeta {\n  ai_service_status: 'available' | 'degraded' | 'unavailable';\n  fallback_mode: boolean;\n  generated_at: string;\n}\n\nexport interface UsePositionSuggestionsOptions {\n  engagementId: string;\n  minRelevance?: number;\n  limit?: number;\n  enabled?: boolean;\n}\n\nexport interface UsePositionSuggestionsResult {\n  suggestions: PositionSuggestion[];\n  meta: SuggestionsMeta | null;\n  isLoading: boolean;\n  isError: boolean;\n  error: Error | null;\n  refetch: () => void;\n}\n\nasync function fetchPositionSuggestions(\n  options: UsePositionSuggestionsOptions\n): Promise<{ suggestions: PositionSuggestion[]; meta: SuggestionsMeta }> {\n  const {\n    engagementId,\n    minRelevance = 0.7,\n    limit = 10,\n  } = options;\n\n  // Call edge function for AI suggestions\n  const { data: authData } = await supabase.auth.getSession();\n  const token = authData.session?.access_token;\n\n  if (!token) {\n    throw new Error('Authentication required');\n  }\n\n  const response = await fetch(\n    `${process.env.VITE_SUPABASE_URL}/functions/v1/engagements/${engagementId}/positions/suggestions?min_relevance=${minRelevance}&limit=${limit}`,\n    {\n      headers: {\n        'Authorization': `Bearer ${token}`,\n      },\n    }\n  );\n\n  if (!response.ok && response.status !== 503) {\n    throw new Error(`Failed to fetch suggestions: ${response.statusText}`);\n  }\n\n  const result = await response.json();\n\n  return {\n    suggestions: result.data || [],\n    meta: result.meta || {\n      ai_service_status: response.status === 503 ? 'unavailable' : 'available',\n      fallback_mode: response.status === 503,\n      generated_at: new Date().toISOString(),\n    },\n  };\n}\n\nexport function usePositionSuggestions(\n  options: UsePositionSuggestionsOptions\n): UsePositionSuggestionsResult {\n  const {\n    engagementId,\n    minRelevance = 0.7,\n    limit = 10,\n    enabled = true,\n  } = options;\n\n  const {\n    data,\n    isLoading,\n    isError,\n    error,\n    refetch,\n  } = useQuery({\n    queryKey: ['position-suggestions', engagementId, minRelevance, limit],\n    queryFn: () => fetchPositionSuggestions(options),\n    enabled: enabled && !!engagementId,\n    staleTime: 15 * 60 * 1000, // 15 minutes (suggestions don't change often)\n    gcTime: 30 * 60 * 1000, // 30 minutes\n    retry: 2, // Retry twice on failure\n    retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 5000), // Exponential backoff\n  });\n\n  return {\n    suggestions: data?.suggestions || [],\n    meta: data?.meta || null,\n    isLoading,\n    isError,\n    error: error as Error | null,\n    refetch,\n  };\n}\n","/**\n * TanStack Query Hook: useUpdateSuggestionAction (T039)\n * Updates user action on position suggestions (accepted/rejected/ignored)\n */\n\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\nimport { supabase } from '@/lib/supabase';\n\nexport interface UpdateSuggestionActionParams {\n  engagementId: string;\n  suggestionId: string;\n  action: 'accepted' | 'rejected' | 'ignored';\n}\n\nexport interface UpdateSuggestionActionResult {\n  suggestion: {\n    id: string;\n    user_action: string;\n    actioned_at: string;\n  };\n}\n\nasync function updateSuggestionAction(\n  params: UpdateSuggestionActionParams\n): Promise<UpdateSuggestionActionResult> {\n  const { engagementId, suggestionId, action } = params;\n\n  // Call edge function to update suggestion action\n  const { data: authData } = await supabase.auth.getSession();\n  const token = authData.session?.access_token;\n\n  if (!token) {\n    throw new Error('Authentication required');\n  }\n\n  const response = await fetch(\n    `${process.env.VITE_SUPABASE_URL}/functions/v1/engagements/${engagementId}/positions/suggestions`,\n    {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${token}`,\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        suggestion_id: suggestionId,\n        action,\n      }),\n    }\n  );\n\n  if (!response.ok) {\n    const error = await response.json();\n    throw new Error(error.message || 'Failed to update suggestion action');\n  }\n\n  return await response.json();\n}\n\nexport function useUpdateSuggestionAction() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: updateSuggestionAction,\n    onSuccess: (_data, variables) => {\n      // Invalidate suggestions query to refetch\n      queryClient.invalidateQueries({\n        queryKey: ['position-suggestions', variables.engagementId],\n      });\n\n      // If action is 'accepted', invalidate engagement positions list\n      if (variables.action === 'accepted') {\n        queryClient.invalidateQueries({\n          queryKey: ['engagement-positions', variables.engagementId],\n        });\n      }\n    },\n    onError: (error) => {\n      console.error('Failed to update suggestion action:', error);\n    },\n  });\n}\n","/**\n * PositionSuggestionsPanel Component (T045)\n * Displays AI-suggested positions with relevance scores\n */\n\nimport React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Sparkles, AlertCircle, TrendingUp, TrendingDown, Minus } from 'lucide-react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { usePositionSuggestions } from '@/hooks/usePositionSuggestions';\nimport { useUpdateSuggestionAction } from '@/hooks/useUpdateSuggestionAction';\nimport type { Position } from '@/types/position';\n\nexport interface PositionSuggestionsPanelProps {\n engagementId: string;\n onAttach?: (positionId: string) => void;\n className?: string;\n}\n\ninterface PositionSuggestion {\n id: string;\n position_id: string;\n position: Position;\n relevance_score: number;\n suggestion_reasoning?: {\n keywords?: string[];\n context_factors?: string[];\n };\n user_action?: 'accepted' | 'rejected' | 'ignored';\n}\n\nexport const PositionSuggestionsPanel: React.FC<PositionSuggestionsPanelProps> = ({\n engagementId,\n onAttach,\n className = '',\n}) => {\n const { t, i18n } = useTranslation();\n const isRTL = i18n.language === 'ar';\n\n // Fetch AI suggestions\n const { data, isLoading, error, refetch } = usePositionSuggestions(engagementId);\n const suggestions = data?.suggestions as PositionSuggestion[] || [];\n const isFallbackMode = data?.fallback_mode || false;\n\n // Mutation for updating suggestion actions\n const updateActionMutation = useUpdateSuggestionAction(engagementId);\n\n // Get relevance indicator\n const getRelevanceIndicator = (score: number) => {\n if (score >= 0.85) {\n return {\n label: t('positions.suggestions.relevance.high'),\n icon: TrendingUp,\n variant: 'default' as const,\n color: 'text-green-600 dark:text-green-400',\n };\n } else if (score >= 0.75) {\n return {\n label: t('positions.suggestions.relevance.medium'),\n icon: Minus,\n variant: 'secondary' as const,\n color: 'text-yellow-600 dark:text-yellow-400',\n };\n } else {\n return {\n label: t('positions.suggestions.relevance.low'),\n icon: TrendingDown,\n variant: 'outline' as const,\n color: 'text-blue-600 dark:text-blue-400',\n };\n }\n };\n\n // Handle one-click attach\n const handleAttach = async (suggestion: PositionSuggestion) => {\n if (onAttach) {\n onAttach(suggestion.position_id);\n // Update suggestion action to 'accepted'\n await updateActionMutation.mutateAsync({\n suggestionId: suggestion.id,\n action: 'accepted',\n });\n }\n };\n\n // Handle reject suggestion\n const handleReject = async (suggestionId: string) => {\n await updateActionMutation.mutateAsync({\n suggestionId,\n action: 'rejected',\n });\n };\n\n // Get localized position title\n const getPositionTitle = (position: Position) => {\n return i18n.language === 'ar' ? position.title_ar : position.title_en;\n };\n\n // Get localized position content preview\n const getPositionPreview = (position: Position) => {\n const content = i18n.language === 'ar' ? position.content_ar : position.content_en;\n return content ? (content.length > 150 ? `${content.substring(0, 150)}...` : content) : '';\n };\n\n if (isLoading) {\n return (\n <Card className={className}>\n <CardHeader>\n <CardTitle className=\"flex items-center gap-2\">\n <Sparkles className=\"h-5 w-5\" />\n {t('positions.suggestions.title')}\n </CardTitle>\n </CardHeader>\n <CardContent>\n <div className=\"flex items-center justify-center py-8\">\n <div className=\"flex flex-col items-center gap-2\">\n <div className=\"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent\" />\n <p className=\"text-sm text-muted-foreground\">{t('positions.suggestions.loading')}</p>\n </div>\n </div>\n </CardContent>\n </Card>\n );\n }\n\n if (error) {\n return (\n <Card className={className}>\n <CardHeader>\n <CardTitle className=\"flex items-center gap-2\">\n <Sparkles className=\"h-5 w-5\" />\n {t('positions.suggestions.title')}\n </CardTitle>\n </CardHeader>\n <CardContent>\n <Alert variant=\"destructive\">\n <AlertCircle className=\"h-4 w-4\" />\n <AlertDescription>{t('positions.suggestions.error')}</AlertDescription>\n </Alert>\n <Button variant=\"outline\" onClick={() => refetch()} className=\"mt-4\">\n {t('positions.suggestions.retry')}\n </Button>\n </CardContent>\n </Card>\n );\n }\n\n return (\n <Card className={className}>\n <CardHeader>\n <CardTitle className=\"flex items-center gap-2\">\n <Sparkles className=\"h-5 w-5\" />\n {t('positions.suggestions.title')}\n </CardTitle>\n <CardDescription>\n {t('positions.suggestions.description')}\n </CardDescription>\n </CardHeader>\n\n <CardContent>\n {/* Fallback Mode Indicator */}\n {isFallbackMode && (\n <Alert className=\"mb-4\">\n <AlertCircle className=\"h-4 w-4\" />\n <AlertDescription>\n {t('positions.suggestions.fallbackMode')}\n </AlertDescription>\n </Alert>\n )}\n\n {/* Suggestions List */}\n {suggestions.length === 0 ? (\n <div className=\"flex flex-col items-center justify-center rounded-lg border border-dashed py-8\">\n <Sparkles className=\"mb-2 h-8 w-8 text-muted-foreground\" />\n <p className=\"text-center text-muted-foreground\">\n {t('positions.suggestions.empty')}\n </p>\n <p className=\"mt-1 text-center text-xs text-muted-foreground\">\n {t('positions.suggestions.emptyHint')}\n </p>\n </div>\n ) : (\n <div className=\"space-y-3\" role=\"list\" aria-label={t('positions.suggestions.listLabel')}>\n {suggestions.map((suggestion) => {\n const relevanceIndicator = getRelevanceIndicator(suggestion.relevance_score);\n const Icon = relevanceIndicator.icon;\n const isActioned = suggestion.user_action === 'accepted' || suggestion.user_action === 'rejected';\n\n return (\n <Card\n key={suggestion.id}\n className={`transition-opacity ${isActioned ? 'opacity-50' : ''}`}\n role=\"listitem\"\n >\n <CardContent className=\"p-4\">\n <div className=\"flex items-start justify-between gap-3\">\n {/* Position Info */}\n <div className=\"flex-1 space-y-2\">\n <div className=\"flex items-start gap-2\">\n <h4 className=\"font-medium leading-tight\" dir={isRTL ? 'rtl' : 'ltr'}>\n {getPositionTitle(suggestion.position)}\n </h4>\n <Badge variant={relevanceIndicator.variant} className=\"shrink-0\">\n <Icon className={`me-1 h-3 w-3 ${relevanceIndicator.color}`} />\n {relevanceIndicator.label}\n </Badge>\n </div>\n\n {/* Content Preview */}\n <p className=\"text-sm text-muted-foreground line-clamp-2\" dir={isRTL ? 'rtl' : 'ltr'}>\n {getPositionPreview(suggestion.position)}\n </p>\n\n {/* Relevance Score */}\n <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n <span>{t('positions.suggestions.score')}:</span>\n <span className=\"font-mono font-medium\">\n {(suggestion.relevance_score * 100).toFixed(0)}%\n </span>\n </div>\n\n {/* Reasoning Keywords */}\n {suggestion.suggestion_reasoning?.keywords && suggestion.suggestion_reasoning.keywords.length > 0 && (\n <div className=\"flex flex-wrap gap-1\">\n {suggestion.suggestion_reasoning.keywords.slice(0, 3).map((keyword, i) => (\n <Badge key={i} variant=\"outline\" className=\"text-xs\">\n {keyword}\n </Badge>\n ))}\n </div>\n )}\n </div>\n\n {/* Action Buttons */}\n {!isActioned && (\n <div className=\"flex shrink-0 flex-col gap-2\">\n <Button\n size=\"sm\"\n onClick={() => handleAttach(suggestion)}\n disabled={!onAttach || updateActionMutation.isPending}\n aria-label={t('positions.suggestions.attachLabel', {\n title: getPositionTitle(suggestion.position),\n })}\n >\n {t('positions.suggestions.attach')}\n </Button>\n <Button\n variant=\"ghost\"\n size=\"sm\"\n onClick={() => handleReject(suggestion.id)}\n disabled={updateActionMutation.isPending}\n aria-label={t('positions.suggestions.rejectLabel', {\n title: getPositionTitle(suggestion.position),\n })}\n >\n {t('positions.suggestions.reject')}\n </Button>\n </div>\n )}\n\n {/* Action Status */}\n {isActioned && (\n <Badge variant={suggestion.user_action === 'accepted' ? 'default' : 'secondary'}>\n {t(`positions.suggestions.action.${suggestion.user_action}`)}\n </Badge>\n )}\n </div>\n </CardContent>\n </Card>\n );\n })}\n </div>\n )}\n\n {/* Refresh Button */}\n {suggestions.length > 0 && (\n <Button\n variant=\"outline\"\n size=\"sm\"\n onClick={() => refetch()}\n className=\"mt-4 w-full\"\n disabled={isLoading}\n >\n <Sparkles className=\"me-2 h-4 w-4\" />\n {t('positions.suggestions.refresh')}\n </Button>\n )}\n </CardContent>\n </Card>\n );\n};\n","/**\n * TanStack Query Hook: useGenerateBriefingPack (T040)\n * Initiates briefing pack generation and returns job ID for status polling\n */\n\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\nimport { supabase } from '@/lib/supabase';\n\nexport interface GenerateBriefingPackParams {\n  engagementId: string;\n  language: 'en' | 'ar';\n  positionIds?: string[]; // Optional: specific positions, otherwise all attached\n}\n\nexport interface GenerateBriefingPackResult {\n  job_id: string;\n  status: 'pending' | 'generating';\n  estimated_completion_seconds: number;\n}\n\nasync function generateBriefingPack(\n  params: GenerateBriefingPackParams\n): Promise<GenerateBriefingPackResult> {\n  const { engagementId, language, positionIds } = params;\n\n  // Call edge function to initiate generation\n  const { data: authData } = await supabase.auth.getSession();\n  const token = authData.session?.access_token;\n\n  if (!token) {\n    throw new Error('Authentication required');\n  }\n\n  const response = await fetch(\n    `${process.env.VITE_SUPABASE_URL}/functions/v1/engagements/${engagementId}/briefing-packs`,\n    {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${token}`,\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        language,\n        ...(positionIds && { position_ids: positionIds }),\n      }),\n    }\n  );\n\n  if (!response.ok) {\n    const error = await response.json();\n\n    // Handle specific error codes\n    if (error.error === 'NO_POSITIONS_ATTACHED') {\n      throw new Error('No positions are attached to this engagement. Please attach positions first.');\n    } else if (error.error === 'TOO_MANY_POSITIONS') {\n      throw new Error('Too many positions attached (max 100). Please reduce the number of positions.');\n    }\n\n    throw new Error(error.message || 'Failed to generate briefing pack');\n  }\n\n  return await response.json();\n}\n\nexport function useGenerateBriefingPack() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: generateBriefingPack,\n    onSuccess: (_data, variables) => {\n      // Invalidate briefing packs list to show new generation\n      queryClient.invalidateQueries({\n        queryKey: ['briefing-packs', variables.engagementId],\n      });\n\n      // Increment analytics for all positions in the pack\n      if (variables.positionIds) {\n        variables.positionIds.forEach((positionId) => {\n          queryClient.invalidateQueries({\n            queryKey: ['position-analytics', positionId],\n          });\n        });\n      }\n    },\n    onError: (error) => {\n      console.error('Failed to generate briefing pack:', error);\n    },\n  });\n}\n","/**\n * TanStack Query Hook: useBriefingPackStatus (T041)\n * Polls briefing pack job status with automatic refetch until completion\n */\n\nimport { useQuery } from '@tanstack/react-query';\nimport { supabase } from '@/lib/supabase';\n\nexport interface BriefingPack {\n  id: string;\n  engagement_id: string;\n  position_ids: string[];\n  language: 'en' | 'ar';\n  generated_by: string;\n  generated_at: string;\n  file_url: string;\n  file_size_bytes: number;\n  expires_at?: string;\n  metadata?: {\n    page_count?: number;\n    template_version?: string;\n    translations_performed?: number;\n  };\n}\n\nexport interface BriefingPackJobStatus {\n  status: 'pending' | 'generating' | 'completed' | 'failed';\n  progress?: number; // 0-100\n  error?: string;\n  briefing_pack?: BriefingPack;\n  estimated_completion_seconds?: number;\n  metadata?: {\n    retry_count?: number;\n  };\n}\n\nexport interface UseBriefingPackStatusOptions {\n  jobId: string;\n  enabled?: boolean;\n  onCompleted?: (briefingPack: BriefingPack) => void;\n  onFailed?: (error: string) => void;\n}\n\nasync function fetchBriefingPackStatus(\n  jobId: string\n): Promise<BriefingPackJobStatus> {\n  // Call edge function to check status\n  const { data: authData } = await supabase.auth.getSession();\n  const token = authData.session?.access_token;\n\n  if (!token) {\n    throw new Error('Authentication required');\n  }\n\n  const response = await fetch(\n    `${process.env.VITE_SUPABASE_URL}/functions/v1/briefing-packs/jobs/${jobId}/status`,\n    {\n      headers: {\n        'Authorization': `Bearer ${token}`,\n      },\n    }\n  );\n\n  if (!response.ok) {\n    if (response.status === 404) {\n      throw new Error('Briefing pack job not found');\n    }\n    throw new Error('Failed to fetch briefing pack status');\n  }\n\n  return await response.json();\n}\n\nexport function useBriefingPackStatus(\n  options: UseBriefingPackStatusOptions\n) {\n  const {\n    jobId,\n    enabled = true,\n    onCompleted,\n    onFailed,\n  } = options;\n\n  const {\n    data,\n    isLoading,\n    isError,\n    error,\n    refetch,\n  } = useQuery({\n    queryKey: ['briefing-pack-job', jobId],\n    queryFn: () => fetchBriefingPackStatus(jobId),\n    enabled: enabled && !!jobId,\n    refetchInterval: (query) => {\n      const status = query.state.data?.status;\n\n      // Stop polling when completed or failed\n      if (status === 'completed' || status === 'failed') {\n        // Trigger callbacks\n        if (status === 'completed' && query.state.data?.briefing_pack && onCompleted) {\n          onCompleted(query.state.data.briefing_pack);\n        } else if (status === 'failed' && query.state.data?.error && onFailed) {\n          onFailed(query.state.data.error);\n        }\n\n        return false; // Stop polling\n      }\n\n      // Poll every 2 seconds while generating\n      return 2000;\n    },\n    staleTime: 0, // Always consider stale to enable polling\n    gcTime: 5 * 60 * 1000, // Keep in cache for 5 minutes\n  });\n\n  const status = data?.status || 'pending';\n  const isPolling = status === 'pending' || status === 'generating';\n  const isCompleted = status === 'completed';\n  const isFailed = status === 'failed';\n\n  return {\n    status: data?.status || 'pending',\n    progress: data?.progress,\n    error: data?.error,\n    briefingPack: data?.briefing_pack,\n    estimatedCompletionSeconds: data?.estimated_completion_seconds,\n    metadata: data?.metadata,\n    isLoading,\n    isError,\n    queryError: error as Error | null,\n    isPolling,\n    isCompleted,\n    isFailed,\n    refetch,\n  };\n}\n","/**\n * BriefingPackGenerator Component (T047)\n * Generate bilingual briefing packs with language selection\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { FileText, Download, Loader2, CheckCircle, XCircle } from 'lucide-react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group';\nimport { Label } from '@/components/ui/label';\nimport { Progress } from '@/components/ui/progress';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { useGenerateBriefingPack } from '@/hooks/useGenerateBriefingPack';\nimport { useBriefingPackStatus } from '@/hooks/useBriefingPackStatus';\n\nexport interface BriefingPackGeneratorProps {\n engagementId: string;\n attachedPositionCount: number;\n className?: string;\n}\n\ntype GenerationStatus = 'idle' | 'generating' | 'completed' | 'failed';\n\nexport const BriefingPackGenerator: React.FC<BriefingPackGeneratorProps> = ({\n engagementId,\n attachedPositionCount,\n className = '',\n}) => {\n const { t } = useTranslation();\n\n // State\n const [language, setLanguage] = useState<'en' | 'ar'>('en');\n const [jobId, setJobId] = useState<string | null>(null);\n const [status, setStatus] = useState<GenerationStatus>('idle');\n const [fileUrl, setFileUrl] = useState<string | null>(null);\n const [errorMessage, setErrorMessage] = useState<string | null>(null);\n\n // Mutations and queries\n const generateMutation = useGenerateBriefingPack(engagementId);\n const { data: jobStatus, isLoading: isPolling } = useBriefingPackStatus(jobId || '', {\n enabled: !!jobId && status === 'generating',\n refetchInterval: 2000, // Poll every 2 seconds\n });\n\n // Handle job status updates\n useEffect(() => {\n if (!jobStatus) return;\n\n if (jobStatus.status === 'completed') {\n setStatus('completed');\n setFileUrl(jobStatus.file_url);\n setJobId(null);\n } else if (jobStatus.status === 'failed') {\n setStatus('failed');\n setErrorMessage(jobStatus.error_message || t('positions.briefing.error'));\n setJobId(null);\n }\n }, [jobStatus, t]);\n\n // Handle generation\n const handleGenerate = async () => {\n if (attachedPositionCount === 0) {\n setErrorMessage(t('positions.briefing.noPositions'));\n return;\n }\n\n setStatus('generating');\n setErrorMessage(null);\n setFileUrl(null);\n\n try {\n const result = await generateMutation.mutateAsync({ language });\n setJobId(result.job_id);\n } catch (error: any) {\n setStatus('failed');\n setErrorMessage(error.message || t('positions.briefing.error'));\n }\n };\n\n // Handle download\n const handleDownload = () => {\n if (fileUrl) {\n window.open(fileUrl, '_blank');\n }\n };\n\n // Reset\n const handleReset = () => {\n setStatus('idle');\n setFileUrl(null);\n setErrorMessage(null);\n setJobId(null);\n };\n\n // Calculate estimated time (10s per 100 positions)\n const estimatedTime = Math.ceil((attachedPositionCount / 100) * 10);\n\n return (\n <Card className={className}>\n <CardHeader>\n <CardTitle className=\"flex items-center gap-2\">\n <FileText className=\"h-5 w-5\" />\n {t('positions.briefing.title')}\n </CardTitle>\n <CardDescription>\n {t('positions.briefing.description', { count: attachedPositionCount })}\n </CardDescription>\n </CardHeader>\n\n <CardContent className=\"space-y-4\">\n {/* Language Selection */}\n {status === 'idle' && (\n <>\n <div className=\"space-y-3\">\n <Label>{t('positions.briefing.selectLanguage')}</Label>\n <RadioGroup value={language} onValueChange={(val) => setLanguage(val as 'en' | 'ar')}>\n <div className=\"flex items-center space-x-2\">\n <RadioGroupItem value=\"en\" id=\"lang-en\" />\n <Label htmlFor=\"lang-en\" className=\"cursor-pointer\">\n {t('positions.briefing.language.english')}\n </Label>\n </div>\n <div className=\"flex items-center space-x-2\">\n <RadioGroupItem value=\"ar\" id=\"lang-ar\" />\n <Label htmlFor=\"lang-ar\" className=\"cursor-pointer\">\n {t('positions.briefing.language.arabic')}\n </Label>\n </div>\n </RadioGroup>\n </div>\n\n {/* Info */}\n <Alert>\n <AlertDescription>\n {t('positions.briefing.estimatedTime', { seconds: estimatedTime })}\n </AlertDescription>\n </Alert>\n\n {/* Generate Button */}\n <Button\n onClick={handleGenerate}\n disabled={attachedPositionCount === 0 || generateMutation.isPending}\n className=\"w-full\"\n >\n {generateMutation.isPending ? (\n <>\n <Loader2 className=\"me-2 h-4 w-4 animate-spin\" />\n {t('positions.briefing.initiating')}\n </>\n ) : (\n <>\n <FileText className=\"me-2 h-4 w-4\" />\n {t('positions.briefing.generate')}\n </>\n )}\n </Button>\n </>\n )}\n\n {/* Generating */}\n {status === 'generating' && (\n <div className=\"space-y-4\">\n <div className=\"flex items-center justify-center py-6\">\n <Loader2 className=\"h-12 w-12 animate-spin text-primary\" />\n </div>\n <div className=\"space-y-2\">\n <p className=\"text-center text-sm font-medium\">{t('positions.briefing.generating')}</p>\n <Progress value={undefined} className=\"h-2\" />\n <p className=\"text-center text-xs text-muted-foreground\">\n {t('positions.briefing.pleaseWait')}\n </p>\n </div>\n </div>\n )}\n\n {/* Completed */}\n {status === 'completed' && fileUrl && (\n <div className=\"space-y-4\">\n <div className=\"flex flex-col items-center gap-2 rounded-lg border border-green-500 bg-green-50 p-6 dark:bg-green-950\">\n <CheckCircle className=\"h-12 w-12 text-green-600 dark:text-green-400\" />\n <p className=\"font-medium text-green-900 dark:text-green-100\">\n {t('positions.briefing.completed')}\n </p>\n </div>\n\n <Button onClick={handleDownload} className=\"w-full\" >\n <Download className=\"me-2 h-5 w-5\" />\n {t('positions.briefing.download')}\n </Button>\n\n <Button onClick={handleReset} variant=\"outline\" className=\"w-full\">\n {t('positions.briefing.generateAnother')}\n </Button>\n </div>\n )}\n\n {/* Failed */}\n {status === 'failed' && (\n <div className=\"space-y-4\">\n <Alert variant=\"destructive\">\n <XCircle className=\"h-4 w-4\" />\n <AlertDescription>{errorMessage}</AlertDescription>\n </Alert>\n\n <Button onClick={handleReset} variant=\"outline\" className=\"w-full\">\n {t('positions.briefing.tryAgain')}\n </Button>\n </div>\n )}\n\n {/* Validation Error */}\n {attachedPositionCount === 0 && status === 'idle' && (\n <Alert>\n <AlertDescription>{t('positions.briefing.noPositions')}</AlertDescription>\n </Alert>\n )}\n </CardContent>\n </Card>\n );\n};\n","/**\n * Engagement Positions Section (T054)\n *\n * Displays AI suggestions, attached positions, and briefing pack generator\n * Features: Smart suggestions, one-click attach, PDF generation\n * Integration: Part of engagement detail page\n */\n\nimport { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { useEngagementPositions } from '../../hooks/useEngagementPositions';\nimport { usePositionSuggestions } from '../../hooks/usePositionSuggestions';\nimport { PositionList } from './PositionList';\nimport { PositionSuggestionsPanel } from './PositionSuggestionsPanel';\nimport { BriefingPackGenerator } from './BriefingPackGenerator';\nimport { AttachPositionDialog } from './AttachPositionDialog';\nimport { Button } from '../ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '../ui/card';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '../ui/tabs';\nimport { Plus, Sparkles, FileText } from 'lucide-react';\n\ninterface EngagementPositionsSectionProps {\n engagementId: string;\n}\n\nexport function EngagementPositionsSection({\n engagementId,\n}: EngagementPositionsSectionProps) {\n const { t } = useTranslation(['positions', 'common']);\n const [showAttachDialog, setShowAttachDialog] = useState(false);\n const [activeTab, setActiveTab] = useState<'attached' | 'suggestions' | 'briefing'>(\n 'attached'\n );\n\n // Fetch attached positions\n const {\n data: attachedData,\n isLoading: isLoadingAttached,\n error: attachedError,\n } = useEngagementPositions(engagementId, {\n sort: 'relevance_score',\n order: 'desc',\n });\n\n // Fetch AI suggestions\n const {\n data: suggestionsData,\n isLoading: isLoadingSuggestions,\n error: suggestionsError,\n } = usePositionSuggestions(engagementId);\n\n const attachedPositions = attachedData?.items || [];\n const suggestions = suggestionsData?.suggestions || [];\n const isFallbackMode = suggestionsData?.fallback_mode || false;\n const attachedCount = attachedData?.total || 0;\n const suggestionsCount = suggestions.length;\n\n return (\n <Card>\n <CardHeader>\n <div className=\"flex items-center justify-between\">\n <div>\n <CardTitle className=\"flex items-center gap-2\">\n <FileText className=\"h-5 w-5\" />\n {t('positions:engagement_section.title')}\n </CardTitle>\n <CardDescription>\n {t('positions:engagement_section.subtitle')}\n </CardDescription>\n </div>\n <Button\n onClick={() => setShowAttachDialog(true)}\n size=\"sm\"\n className=\"gap-2\"\n >\n <Plus className=\"h-4 w-4\" />\n {t('positions:engagement_section.attach_position')}\n </Button>\n </div>\n </CardHeader>\n\n <CardContent>\n <Tabs value={activeTab} onValueChange={(v) => setActiveTab(v as any)}>\n <TabsList className=\"grid w-full grid-cols-3\">\n <TabsTrigger value=\"attached\" className=\"gap-2\">\n {t('positions:engagement_section.attached_tab')}\n {attachedCount > 0 && (\n <span className=\"ms-1 rounded-full bg-primary/20 px-2 py-0.5 text-xs font-medium\">\n {attachedCount}\n </span>\n )}\n </TabsTrigger>\n <TabsTrigger value=\"suggestions\" className=\"gap-2\">\n <Sparkles className=\"h-4 w-4\" />\n {t('positions:engagement_section.suggestions_tab')}\n {suggestionsCount > 0 && (\n <span className=\"ms-1 rounded-full bg-primary/20 px-2 py-0.5 text-xs font-medium\">\n {suggestionsCount}\n </span>\n )}\n </TabsTrigger>\n <TabsTrigger\n value=\"briefing\"\n disabled={attachedCount === 0}\n className=\"gap-2\"\n >\n {t('positions:engagement_section.briefing_tab')}\n </TabsTrigger>\n </TabsList>\n\n {/* Attached Positions Tab */}\n <TabsContent value=\"attached\" className=\"mt-6\">\n {attachedError ? (\n <div\n className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 text-center\"\n role=\"alert\"\n >\n <p className=\"text-sm text-red-700 dark:text-red-300\">\n {attachedError instanceof Error\n ? attachedError.message\n : t('positions:engagement_section.error_loading_attached')}\n </p>\n </div>\n ) : (\n <PositionList\n positions={attachedPositions}\n isLoading={isLoadingAttached}\n context=\"engagement\"\n engagementId={engagementId}\n emptyMessage={t('positions:engagement_section.no_attached')}\n showAttachButton={false}\n />\n )}\n </TabsContent>\n\n {/* Suggestions Tab */}\n <TabsContent value=\"suggestions\" className=\"mt-6\">\n {suggestionsError ? (\n <div\n className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 text-center\"\n role=\"alert\"\n >\n <p className=\"text-sm text-red-700 dark:text-red-300\">\n {suggestionsError instanceof Error\n ? suggestionsError.message\n : t('positions:engagement_section.error_loading_suggestions')}\n </p>\n </div>\n ) : (\n <PositionSuggestionsPanel\n engagementId={engagementId}\n suggestions={suggestions}\n isLoading={isLoadingSuggestions}\n isFallbackMode={isFallbackMode}\n />\n )}\n </TabsContent>\n\n {/* Briefing Pack Tab */}\n <TabsContent value=\"briefing\" className=\"mt-6\">\n {attachedCount === 0 ? (\n <div className=\"text-center py-12\">\n <FileText className=\"h-12 w-12 mx-auto text-gray-400 mb-4\" />\n <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n {t('positions:engagement_section.no_positions_for_briefing')}\n </p>\n <Button\n onClick={() => setActiveTab('attached')}\n variant=\"outline\"\n size=\"sm\"\n className=\"mt-4\"\n >\n {t('positions:engagement_section.attach_positions_first')}\n </Button>\n </div>\n ) : (\n <BriefingPackGenerator\n engagementId={engagementId}\n positionCount={attachedCount}\n />\n )}\n </TabsContent>\n </Tabs>\n </CardContent>\n\n {/* Attach Position Dialog */}\n {showAttachDialog && (\n <AttachPositionDialog\n open={showAttachDialog}\n onClose={() => setShowAttachDialog(false)}\n context=\"engagement\"\n contextId={engagementId}\n />\n )}\n </Card>\n );\n}\n","/**\n * Engagement Dossier Detail Component (Feature 028 - User Story 3 - T028)\n *\n * Main detail view for engagement dossiers.\n * Single-column layout with Information, Positions, and 4 collapsible sections.\n * Uses session storage for section collapse state.\n * Mobile-first design with RTL support.\n */\n\nimport { useTranslation } from 'react-i18next';\nimport { useSessionStorage } from '@/hooks/useSessionStorage';\nimport { CollapsibleSection } from '@/components/Dossier/CollapsibleSection';\nimport { EngagementInformation } from '@/components/Dossier/sections/EngagementInformation';\nimport { EngagementTimeline } from '@/components/timeline/EngagementTimeline';\nimport { ParticipantsList } from '@/components/Dossier/sections/ParticipantsList';\nimport { OutcomesSummary } from '@/components/Dossier/sections/OutcomesSummary';\nimport { FollowUpActions } from '@/components/Dossier/sections/FollowUpActions';\nimport { EngagementPositionsSection } from '@/components/positions/EngagementPositionsSection';\nimport type { EngagementDossier } from '@/lib/dossier-type-guards';\n\ninterface EngagementDossierDetailProps {\n  dossier: EngagementDossier;\n}\n\nexport function EngagementDossierDetail({ dossier }: EngagementDossierDetailProps) {\n  const { t, i18n } = useTranslation('dossier');\n  const isRTL = i18n.language === 'ar';\n\n  // Session storage for section collapse state\n  const [informationOpen, setInformationOpen] = useSessionStorage(\n    `engagement-${dossier.id}-information-open`,\n    true\n  );\n\n  const [positionsOpen, setPositionsOpen] = useSessionStorage(\n    `engagement-${dossier.id}-positions-open`,\n    true\n  );\n\n  const [timelineOpen, setTimelineOpen] = useSessionStorage(\n    `engagement-${dossier.id}-timeline-open`,\n    true\n  );\n\n  const [participantsOpen, setParticipantsOpen] = useSessionStorage(\n    `engagement-${dossier.id}-participants-open`,\n    true\n  );\n\n  const [outcomesOpen, setOutcomesOpen] = useSessionStorage(\n    `engagement-${dossier.id}-outcomes-open`,\n    true\n  );\n\n  const [followUpOpen, setFollowUpOpen] = useSessionStorage(\n    `engagement-${dossier.id}-followup-open`,\n    true\n  );\n\n  return (\n    <div\n      className=\"space-y-4 sm:space-y-6\"\n      dir={isRTL ? 'rtl' : 'ltr'}\n    >\n      {/* Information Section */}\n      <CollapsibleSection\n        id=\"information\"\n        title={t('sections.engagement.information')}\n        description={t('sections.engagement.informationDescription')}\n        isExpanded={informationOpen}\n        onToggle={setInformationOpen}\n      >\n        <EngagementInformation dossier={dossier} />\n      </CollapsibleSection>\n\n      {/* Positions Section */}\n      <CollapsibleSection\n        id=\"positions\"\n        title={t('sections.engagement.positions')}\n        description={t('sections.engagement.positionsDescription')}\n        isExpanded={positionsOpen}\n        onToggle={setPositionsOpen}\n      >\n        <EngagementPositionsSection engagementId={dossier.id} />\n      </CollapsibleSection>\n\n      {/* Event Timeline Section - Unified Timeline with Multi-Source Events */}\n      <CollapsibleSection\n        id=\"timeline\"\n        title={t('sections.engagement.eventTimeline')}\n        description={t('sections.engagement.eventTimelineDescription')}\n        isExpanded={timelineOpen}\n        onToggle={setTimelineOpen}\n      >\n        <EngagementTimeline dossierId={dossier.id} />\n      </CollapsibleSection>\n\n      {/* Participants List Section */}\n      <CollapsibleSection\n        id=\"participants\"\n        title={t('sections.engagement.participantsList')}\n        description={t('sections.engagement.participantsListDescription')}\n        isExpanded={participantsOpen}\n        onToggle={setParticipantsOpen}\n      >\n        <ParticipantsList dossierId={dossier.id} />\n      </CollapsibleSection>\n\n      {/* Outcomes Summary Section */}\n      <CollapsibleSection\n        id=\"outcomes\"\n        title={t('sections.engagement.outcomesSummary')}\n        description={t('sections.engagement.outcomesSummaryDescription')}\n        isExpanded={outcomesOpen}\n        onToggle={setOutcomesOpen}\n      >\n        <OutcomesSummary dossierId={dossier.id} />\n      </CollapsibleSection>\n\n      {/* Follow-Up Actions Section */}\n      <CollapsibleSection\n        id=\"followup\"\n        title={t('sections.engagement.followUpActions')}\n        description={t('sections.engagement.followUpActionsDescription')}\n        isExpanded={followUpOpen}\n        onToggle={setFollowUpOpen}\n      >\n        <FollowUpActions dossierId={dossier.id} />\n      </CollapsibleSection>\n    </div>\n  );\n}\n","\"use client\";\n\nimport type {\n Announcements,\n DndContextProps,\n DragEndEvent,\n DragOverEvent,\n DragStartEvent,\n} from \"@dnd-kit/core\";\nimport {\n closestCenter,\n DndContext,\n DragOverlay,\n KeyboardSensor,\n MouseSensor,\n TouchSensor,\n useDroppable,\n useSensor,\n useSensors,\n} from \"@dnd-kit/core\";\nimport { arrayMove, SortableContext, useSortable } from \"@dnd-kit/sortable\";\nimport { CSS } from \"@dnd-kit/utilities\";\nimport {\n createContext,\n type HTMLAttributes,\n type ReactNode,\n useContext,\n useState,\n} from \"react\";\nimport { createPortal } from \"react-dom\";\nimport tunnel from \"tunnel-rat\";\nimport { Card } from \"@/components/ui/card\";\nimport { ScrollArea, ScrollBar } from \"@/components/ui/scroll-area\";\nimport { cn } from \"@/lib/utils\";\n\nconst t = tunnel();\n\nexport type { DragEndEvent } from \"@dnd-kit/core\";\n\ntype KanbanItemProps = {\n id: string;\n name: string;\n column: string;\n} & Record<string, unknown>;\n\ntype KanbanColumnProps = {\n id: string;\n name: string;\n} & Record<string, unknown>;\n\ntype KanbanContextProps<\n T extends KanbanItemProps = KanbanItemProps,\n C extends KanbanColumnProps = KanbanColumnProps,\n> = {\n columns: C[];\n data: T[];\n activeCardId: string | null;\n};\n\nconst KanbanContext = createContext<KanbanContextProps>({\n columns: [],\n data: [],\n activeCardId: null,\n});\n\nexport type KanbanBoardProps = {\n id: string;\n children: ReactNode;\n className?: string;\n};\n\nexport const KanbanBoard = ({ id, children, className }: KanbanBoardProps) => {\n const { isOver, setNodeRef } = useDroppable({\n id,\n });\n\n return (\n <div\n className={cn(\n \"flex size-full min-h-40 flex-col divide-y overflow-hidden rounded-md border bg-secondary text-xs shadow-sm ring-2 transition-all\",\n isOver ? \"ring-primary\" : \"ring-transparent\",\n className\n )}\n ref={setNodeRef}\n >\n {children}\n </div>\n );\n};\n\nexport type KanbanCardProps<T extends KanbanItemProps = KanbanItemProps> = T & {\n children?: ReactNode;\n className?: string;\n};\n\nexport const KanbanCard = <T extends KanbanItemProps = KanbanItemProps>({\n id,\n name,\n children,\n className,\n}: KanbanCardProps<T>) => {\n const {\n attributes,\n listeners,\n setNodeRef,\n transition,\n transform,\n isDragging,\n } = useSortable({\n id,\n });\n const { activeCardId } = useContext(KanbanContext) as KanbanContextProps;\n\n const style = {\n transition,\n transform: CSS.Transform.toString(transform),\n };\n\n return (\n <>\n <div style={style} {...listeners} {...attributes} ref={setNodeRef}>\n <Card\n className={cn(\n \"cursor-grab gap-4 rounded-md p-3 shadow-sm\",\n isDragging && \"pointer-events-none cursor-grabbing opacity-30\",\n className\n )}\n >\n {children ?? <p className=\"m-0 font-medium text-sm\">{name}</p>}\n </Card>\n </div>\n {activeCardId === id && (\n <t.In>\n <Card\n className={cn(\n \"cursor-grab gap-4 rounded-md p-3 shadow-sm ring-2 ring-primary\",\n isDragging && \"cursor-grabbing\",\n className\n )}\n >\n {children ?? <p className=\"m-0 font-medium text-sm\">{name}</p>}\n </Card>\n </t.In>\n )}\n </>\n );\n};\n\nexport type KanbanCardsProps<T extends KanbanItemProps = KanbanItemProps> =\n Omit<HTMLAttributes<HTMLDivElement>, \"children\" | \"id\"> & {\n children: (item: T) => ReactNode;\n id: string;\n };\n\nexport const KanbanCards = <T extends KanbanItemProps = KanbanItemProps>({\n children,\n className,\n ...props\n}: KanbanCardsProps<T>) => {\n const { data } = useContext(KanbanContext) as KanbanContextProps<T>;\n const filteredData = data.filter((item) => item.column === props.id);\n const items = filteredData.map((item) => item.id);\n\n return (\n <ScrollArea className=\"overflow-hidden\">\n <SortableContext items={items}>\n <div\n className={cn(\"flex flex-grow flex-col gap-2 p-2\", className)}\n {...props}\n >\n {filteredData.map(children)}\n </div>\n </SortableContext>\n <ScrollBar orientation=\"vertical\" />\n </ScrollArea>\n );\n};\n\nexport type KanbanHeaderProps = HTMLAttributes<HTMLDivElement>;\n\nexport const KanbanHeader = ({ className, ...props }: KanbanHeaderProps) => (\n <div className={cn(\"m-0 p-2 font-semibold text-sm\", className)} {...props} />\n);\n\nexport type KanbanProviderProps<\n T extends KanbanItemProps = KanbanItemProps,\n C extends KanbanColumnProps = KanbanColumnProps,\n> = Omit<DndContextProps, \"children\"> & {\n children: (column: C) => ReactNode;\n className?: string;\n columns: C[];\n data: T[];\n onDataChange?: (data: T[]) => void;\n onDragStart?: (event: DragStartEvent) => void;\n onDragEnd?: (event: DragEndEvent) => void;\n onDragOver?: (event: DragOverEvent) => void;\n};\n\nexport const KanbanProvider = <\n T extends KanbanItemProps = KanbanItemProps,\n C extends KanbanColumnProps = KanbanColumnProps,\n>({\n children,\n onDragStart,\n onDragEnd,\n onDragOver,\n className,\n columns,\n data,\n onDataChange,\n ...props\n}: KanbanProviderProps<T, C>) => {\n const [activeCardId, setActiveCardId] = useState<string | null>(null);\n\n const sensors = useSensors(\n useSensor(MouseSensor),\n useSensor(TouchSensor),\n useSensor(KeyboardSensor)\n );\n\n const handleDragStart = (event: DragStartEvent) => {\n const card = data.find((item) => item.id === event.active.id);\n if (card) {\n setActiveCardId(event.active.id as string);\n }\n onDragStart?.(event);\n };\n\n const handleDragOver = (event: DragOverEvent) => {\n const { active, over } = event;\n\n if (!over) {\n return;\n }\n\n const activeItem = data.find((item) => item.id === active.id);\n const overItem = data.find((item) => item.id === over.id);\n\n if (!activeItem) {\n return;\n }\n\n const activeColumn = activeItem.column;\n const overColumn =\n overItem?.column ||\n columns.find((col) => col.id === over.id)?.id ||\n columns[0]?.id;\n\n if (activeColumn !== overColumn) {\n let newData = [...data];\n const activeIndex = newData.findIndex((item) => item.id === active.id);\n const overIndex = newData.findIndex((item) => item.id === over.id);\n\n newData[activeIndex].column = overColumn;\n newData = arrayMove(newData, activeIndex, overIndex);\n\n onDataChange?.(newData);\n }\n\n onDragOver?.(event);\n };\n\n const handleDragEnd = (event: DragEndEvent) => {\n setActiveCardId(null);\n\n onDragEnd?.(event);\n\n const { active, over } = event;\n\n if (!over || active.id === over.id) {\n return;\n }\n\n let newData = [...data];\n\n const oldIndex = newData.findIndex((item) => item.id === active.id);\n const newIndex = newData.findIndex((item) => item.id === over.id);\n\n newData = arrayMove(newData, oldIndex, newIndex);\n\n onDataChange?.(newData);\n };\n\n const announcements: Announcements = {\n onDragStart({ active }) {\n const { name, column } = data.find((item) => item.id === active.id) ?? {};\n\n return `Picked up the card \"${name}\" from the \"${column}\" column`;\n },\n onDragOver({ active, over }) {\n const { name } = data.find((item) => item.id === active.id) ?? {};\n const newColumn = columns.find((column) => column.id === over?.id)?.name;\n\n return `Dragged the card \"${name}\" over the \"${newColumn}\" column`;\n },\n onDragEnd({ active, over }) {\n const { name } = data.find((item) => item.id === active.id) ?? {};\n const newColumn = columns.find((column) => column.id === over?.id)?.name;\n\n return `Dropped the card \"${name}\" into the \"${newColumn}\" column`;\n },\n onDragCancel({ active }) {\n const { name } = data.find((item) => item.id === active.id) ?? {};\n\n return `Cancelled dragging the card \"${name}\"`;\n },\n };\n\n return (\n <KanbanContext.Provider value={{ columns, data, activeCardId }}>\n <DndContext\n accessibility={{ announcements }}\n collisionDetection={closestCenter}\n onDragEnd={handleDragEnd}\n onDragOver={handleDragOver}\n onDragStart={handleDragStart}\n sensors={sensors}\n {...props}\n >\n <div\n className={cn(\n \"grid size-full auto-cols-fr grid-flow-col gap-4\",\n className\n )}\n >\n {columns.map((column) => children(column))}\n </div>\n {typeof window !== \"undefined\" &&\n createPortal(\n <DragOverlay>\n <t.Out />\n </DragOverlay>,\n document.body\n )}\n </DndContext>\n </KanbanContext.Provider>\n );\n};\n","import { KanbanAssignment } from '@/hooks/useEngagementKanban';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { Badge } from '@/components/ui/badge';\nimport { Clock, FileText } from 'lucide-react';\nimport { useTranslation } from 'react-i18next';\n\ninterface KanbanTaskCardProps {\n assignment: KanbanAssignment;\n}\n\nexport function KanbanTaskCard({ assignment }: KanbanTaskCardProps) {\n const { t } = useTranslation('assignments');\n\n const getSLAStatus = () => {\n if (!assignment.current_stage_sla_deadline) return null;\n\n const deadline = new Date(assignment.current_stage_sla_deadline);\n const now = new Date();\n const hoursRemaining = (deadline.getTime() - now.getTime()) / (1000 * 60 * 60);\n\n if (hoursRemaining < 0) return 'overdue';\n if (hoursRemaining < 4) return 'urgent';\n if (hoursRemaining < 24) return 'warning';\n return 'normal';\n };\n\n const slaStatus = getSLAStatus();\n const slaColors: Record<string, string> = {\n overdue: 'text-red-600 bg-red-50 dark:text-red-400 dark:bg-red-950',\n urgent: 'text-orange-600 bg-orange-50 dark:text-orange-400 dark:bg-orange-950',\n warning: 'text-yellow-600 bg-yellow-50 dark:text-yellow-400 dark:bg-yellow-950',\n normal: 'text-emerald-600 bg-emerald-50 dark:text-emerald-400 dark:bg-emerald-950',\n };\n\n const priorityVariants: Record<string, 'destructive' | 'default' | 'secondary'> = {\n high: 'destructive',\n medium: 'default',\n low: 'secondary',\n };\n\n // Generate a short title from work_item_type and truncated ID\n const shortId = assignment.work_item_id.split('-')[0];\n const workItemTitle = `${assignment.work_item_type.toUpperCase()} ${shortId}`;\n\n return (\n <div className=\"space-y-3\">\n {/* Title */}\n <div className=\"flex items-start gap-2\">\n <FileText className=\"h-4 w-4 mt-0.5 text-muted-foreground shrink-0\" />\n <p className=\"text-sm font-medium line-clamp-2 text-start\">\n {workItemTitle}\n </p>\n </div>\n\n {/* Priority Badge */}\n <div className=\"flex items-center gap-2\">\n <Badge\n variant={priorityVariants[assignment.priority] || 'default'}\n className=\"text-xs capitalize\"\n >\n {assignment.priority}\n </Badge>\n <span className=\"text-xs text-muted-foreground capitalize\">\n {assignment.work_item_type}\n </span>\n </div>\n\n {/* Footer: Assignee and SLA */}\n <div className=\"flex items-center justify-between gap-2 pt-2 border-t\">\n {assignment.assignee && (\n <div className=\"flex items-center gap-2\">\n <Avatar className=\"h-6 w-6\">\n <AvatarImage src={assignment.assignee.avatar_url} />\n <AvatarFallback className=\"text-xs\">\n {assignment.assignee.full_name?.charAt(0) || 'S'}\n </AvatarFallback>\n </Avatar>\n <span className=\"text-xs truncate max-w-[120px]\">\n {assignment.assignee.full_name || 'Staff Member'}\n </span>\n </div>\n )}\n\n {slaStatus && (\n <div className={`flex items-center gap-1 px-2 py-1 rounded-md text-xs font-medium ${slaColors[slaStatus]}`}>\n <Clock className=\"h-3 w-3\" />\n <span className=\"capitalize\">{slaStatus}</span>\n </div>\n )}\n </div>\n </div>\n );\n}\n","import { useMemo } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { DragEndEvent } from '@dnd-kit/core'\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from '@/components/ui/dialog'\nimport { Progress } from '@/components/ui/progress'\nimport { Button } from '@/components/ui/button'\nimport { X, LayoutGrid } from 'lucide-react'\nimport { KanbanColumns, KanbanAssignment, WorkflowStage } from '@/hooks/useEngagementKanban'\nimport {\n  KanbanProvider,\n  KanbanBoard,\n  KanbanHeader,\n  KanbanCards,\n  KanbanCard,\n} from '@/components/kibo-ui/kanban'\nimport { KanbanTaskCard } from './KanbanTaskCard'\n\ninterface KanbanStats {\n  total: number\n  todo: number\n  in_progress: number\n  review: number\n  done: number\n  progressPercentage: number\n}\n\ninterface EngagementKanbanDialogProps {\n  open: boolean\n  onClose: () => void\n  engagementTitle: string\n  columns?: KanbanColumns\n  stats: KanbanStats\n  onDragEnd?: (assignmentId: string, newStage: WorkflowStage) => void\n}\n\nexport function EngagementKanbanDialog({\n  open,\n  onClose,\n  engagementTitle,\n  columns,\n  stats,\n  onDragEnd,\n}: EngagementKanbanDialogProps): React.JSX.Element {\n  const { t, i18n } = useTranslation('assignments')\n  const isRTL = i18n.language === 'ar'\n\n  // Transform columns to kibo-ui format\n  const kanbanColumns = useMemo(\n    () => [\n      { id: 'todo', name: t('kanban.todo', 'To Do') },\n      { id: 'in_progress', name: t('kanban.in_progress', 'In Progress') },\n      { id: 'review', name: t('kanban.review', 'Review') },\n      { id: 'done', name: t('kanban.done', 'Done') },\n      { id: 'cancelled', name: t('kanban.cancelled', 'Cancelled') },\n    ],\n    [t],\n  )\n\n  // Transform assignments to kibo-ui format\n  const kanbanData = useMemo(() => {\n    if (!columns) return []\n\n    const allAssignments: Array<KanbanAssignment & { column: string }> = []\n\n    ;(columns.todo || []).forEach((a) => allAssignments.push({ ...a, column: 'todo' }))\n    ;(columns.in_progress || []).forEach((a) =>\n      allAssignments.push({ ...a, column: 'in_progress' }),\n    )\n    ;(columns.review || []).forEach((a) => allAssignments.push({ ...a, column: 'review' }))\n    ;(columns.done || []).forEach((a) => allAssignments.push({ ...a, column: 'done' }))\n    ;(columns.cancelled || []).forEach((a) => allAssignments.push({ ...a, column: 'cancelled' }))\n\n    return allAssignments\n  }, [columns])\n\n  const handleDragEnd = (event: DragEndEvent) => {\n    const { active, over } = event\n\n    if (!over || !onDragEnd) return\n\n    const assignmentId = active.id as string\n    const assignment = kanbanData.find((a) => a.id === assignmentId)\n\n    if (!assignment) return\n\n    // Check if dropped on a column\n    const newStage = over.id as WorkflowStage\n    const validStages: WorkflowStage[] = ['todo', 'in_progress', 'review', 'done', 'cancelled']\n\n    if (validStages.includes(newStage) && assignment.column !== newStage) {\n      onDragEnd(assignmentId, newStage)\n    }\n  }\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent dir={isRTL ? 'rtl' : 'ltr'} className=\"max-w-[95vw] max-h-[90vh] p-0\">\n        <DialogHeader className=\"px-4 sm:px-6 pt-4 sm:pt-6 pb-4\">\n          <div className=\"flex items-start justify-between gap-4\">\n            <div className=\"flex-1 space-y-2\">\n              <DialogTitle className=\"flex items-center gap-2 text-lg sm:text-xl\">\n                <LayoutGrid className=\"h-4 w-4 sm:h-5 sm:w-5\" />\n                {engagementTitle}\n              </DialogTitle>\n              <DialogDescription className=\"sr-only\">\n                {t(\n                  'kanban.description',\n                  'Drag and drop tasks between columns to update their workflow stage',\n                )}\n              </DialogDescription>\n\n              {/* Progress Bar */}\n              <div className=\"space-y-1\">\n                <div className=\"flex items-center justify-between text-xs sm:text-sm\">\n                  <span className=\"text-muted-foreground\">\n                    {t('kanban.overallProgress', 'Overall Progress')}:\n                  </span>\n                  <span className=\"font-medium\">\n                    {Math.round(stats.progressPercentage)}% ({stats.done}/{stats.total}{' '}\n                    {t('kanban.completed', 'completed')})\n                  </span>\n                </div>\n                <Progress value={stats.progressPercentage} className=\"h-2\" />\n              </div>\n            </div>\n\n            <Button variant=\"ghost\" size=\"icon\" onClick={onClose} className=\"shrink-0\">\n              <X className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </DialogHeader>\n\n        {/* Kanban Board */}\n        <div className=\"px-4 sm:px-6 pb-4 sm:pb-6 overflow-x-auto\">\n          <KanbanProvider\n            columns={kanbanColumns}\n            data={kanbanData}\n            onDragEnd={handleDragEnd}\n            className=\"min-w-[1200px] pb-2 gap-3\"\n          >\n            {(column) => (\n              <KanbanBoard key={column.id} id={column.id} className=\"bg-muted/30 border-muted\">\n                <KanbanHeader className=\"bg-muted/50 font-semibold text-sm px-4 py-3 border-b\">\n                  <div className=\"flex items-center justify-between\">\n                    <span>{column.name}</span>\n                    <span className=\"ms-2 px-2 py-0.5 bg-background rounded-full text-xs font-normal\">\n                      {kanbanData.filter((a) => a.column === column.id).length}\n                    </span>\n                  </div>\n                </KanbanHeader>\n                <KanbanCards id={column.id} className=\"p-3 gap-3 min-h-[400px]\">\n                  {(assignment) => (\n                    <KanbanCard\n                      key={assignment.id}\n                      id={assignment.id}\n                      name={assignment.work_item_id}\n                      column={assignment.column}\n                      className=\"bg-background hover:shadow-md transition-shadow border-border\"\n                    >\n                      <KanbanTaskCard assignment={assignment} />\n                    </KanbanCard>\n                  )}\n                </KanbanCards>\n              </KanbanBoard>\n            )}\n          </KanbanProvider>\n        </div>\n\n        {/* Keyboard Hint */}\n        <div className=\"px-4 sm:px-6 pb-3 sm:pb-4 text-xs text-muted-foreground\">\n          {t('kanban.keyboardHint', 'Drag tasks between columns to update their status')}\n        </div>\n      </DialogContent>\n    </Dialog>\n  )\n}\n","import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { supabase } from '@/lib/supabase';\nimport { useMemo, useCallback } from 'react';\n\nexport interface KanbanAssignment {\n  id: string;\n  work_item_id: string;\n  work_item_type: string;\n  assignee_id: string;\n  workflow_stage: 'todo' | 'in_progress' | 'review' | 'done' | 'cancelled';\n  priority: string;\n  status: string;\n  sla_deadline: string | null;\n  overall_sla_deadline: string | null;\n  current_stage_sla_deadline: string | null;\n  engagement_id: string;\n  created_at: string;\n  updated_at: string;\n  assignee?: {\n    id: string;\n    full_name: string;\n    avatar_url?: string;\n  };\n}\n\nexport interface KanbanColumns {\n  todo: KanbanAssignment[];\n  in_progress: KanbanAssignment[];\n  review: KanbanAssignment[];\n  done: KanbanAssignment[];\n  cancelled: KanbanAssignment[];\n}\n\nexport type SortOption = 'created_at' | 'sla_deadline' | 'priority';\nexport type WorkflowStage = 'todo' | 'in_progress' | 'review' | 'done' | 'cancelled';\n\nexport function useEngagementKanban(engagementId: string, sortBy: SortOption = 'created_at') {\n  const queryClient = useQueryClient();\n\n  const { data: columns, isLoading, error } = useQuery({\n    queryKey: ['engagement-kanban', engagementId, sortBy],\n    queryFn: async () => {\n      const { data: { session } } = await supabase.auth.getSession();\n\n      if (!session) {\n        throw new Error('No active session');\n      }\n\n      const response = await fetch(\n        `${import.meta.env.VITE_SUPABASE_URL}/functions/v1/engagements-kanban-get?engagement_id=${engagementId}&sort=${sortBy}`,\n        {\n          headers: {\n            Authorization: `Bearer ${session.access_token}`,\n          },\n        }\n      );\n\n      if (!response.ok) {\n        throw new Error('Failed to fetch Kanban board');\n      }\n\n      const data = await response.json();\n      return data.columns as KanbanColumns;\n    },\n    enabled: !!engagementId,\n  });\n\n  // Flatten all assignments from columns\n  const assignments = useMemo(() => {\n    if (!columns) return [];\n    return [\n      ...(columns.todo || []),\n      ...(columns.in_progress || []),\n      ...(columns.review || []),\n      ...(columns.done || []),\n      ...(columns.cancelled || []),\n    ];\n  }, [columns]);\n\n  // Calculate stats\n  const stats = useMemo(() => {\n    if (!columns) {\n      return {\n        total: 0,\n        todo: 0,\n        in_progress: 0,\n        review: 0,\n        done: 0,\n        progressPercentage: 0,\n      };\n    }\n\n    const total = assignments.length;\n    const done = columns.done?.length || 0;\n    const progressPercentage = total > 0 ? Math.round((done / total) * 100) : 0;\n\n    return {\n      total,\n      todo: columns.todo?.length || 0,\n      in_progress: columns.in_progress?.length || 0,\n      review: columns.review?.length || 0,\n      done,\n      progressPercentage,\n    };\n  }, [columns, assignments]);\n\n  // Mutation for updating workflow stage\n  const updateStageMutation = useMutation({\n    mutationFn: async ({ assignmentId, newStage }: { assignmentId: string; newStage: WorkflowStage }) => {\n      const { data: { session }, error: sessionError } = await supabase.auth.getSession();\n\n      if (sessionError || !session) {\n        throw new Error('No active session');\n      }\n\n      // Get current user ID\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) {\n        throw new Error('User not authenticated');\n      }\n\n      const response = await fetch(\n        `${import.meta.env.VITE_SUPABASE_URL}/functions/v1/assignments-workflow-stage-update`,\n        {\n          method: 'POST',\n          headers: {\n            'Authorization': `Bearer ${session.access_token}`,\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({\n            assignment_id: assignmentId,\n            workflow_stage: newStage,\n            triggered_by_user_id: user.id,\n          }),\n        }\n      );\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.validation_error || error.error || 'Failed to update assignment stage');\n      }\n\n      return response.json();\n    },\n    onSuccess: () => {\n      // Invalidate and refetch\n      queryClient.invalidateQueries({ queryKey: ['engagement-kanban', engagementId] });\n    },\n  });\n\n  const handleDragEnd = useCallback((assignmentId: string, newStage: WorkflowStage) => {\n    updateStageMutation.mutate({ assignmentId, newStage });\n  }, [updateStageMutation]);\n\n  return {\n    assignments,\n    columns,\n    stats,\n    handleDragEnd,\n    isLoading,\n    error,\n  };\n}\n","/**\n * Engagement Dossier Page (Feature 028 - User Story 3 - T027)\n *\n * Wrapper page component for engagement dossiers.\n * Uses DossierDetailLayout with single-column grid.\n * Renders EngagementDossierDetail component.\n * Includes header actions: View Kanban Board and Log After Action.\n */\n\nimport { useState } from 'react';\nimport { Link } from '@tanstack/react-router';\nimport { useTranslation } from 'react-i18next';\nimport { LayoutGrid, FileText } from 'lucide-react';\nimport type { EngagementDossier } from '@/lib/dossier-type-guards';\nimport { DossierDetailLayout } from '@/components/Dossier/DossierDetailLayout';\nimport { EngagementDossierDetail } from '@/components/Dossier/EngagementDossierDetail';\nimport { Button } from '@/components/ui/button';\nimport { EngagementKanbanDialog } from '@/components/assignments/EngagementKanbanDialog';\nimport { useEngagementKanban } from '@/hooks/useEngagementKanban';\n\ninterface EngagementDossierPageProps {\n  dossier: EngagementDossier;\n}\n\nexport function EngagementDossierPage({ dossier }: EngagementDossierPageProps) {\n  const { t, i18n } = useTranslation('dossier');\n  const isRTL = i18n.language === 'ar';\n  const [kanbanOpen, setKanbanOpen] = useState(false);\n\n  const { columns, stats, handleDragEnd } = useEngagementKanban(dossier.id);\n\n  const headerActions = (\n    <>\n      <Button\n        variant=\"outline\"\n        onClick={() => setKanbanOpen(true)}\n        className=\"gap-2 min-h-11 min-w-11\"\n      >\n        <LayoutGrid className=\"h-4 w-4\" />\n        <span className=\"hidden sm:inline\">\n          {t('engagement.viewKanban')}\n        </span>\n      </Button>\n      <Button asChild className=\"gap-2 min-h-11 min-w-11\">\n        <Link\n          to=\"/engagements/$engagementId/after-action\"\n          params={{ engagementId: dossier.id }}\n        >\n          <FileText className=\"h-4 w-4\" />\n          <span className=\"hidden sm:inline\">\n            {t('engagement.logAfterAction')}\n          </span>\n        </Link>\n      </Button>\n    </>\n  );\n\n  return (\n    <>\n      <DossierDetailLayout\n        dossier={dossier}\n        gridClassName=\"grid-cols-1\"\n        headerActions={headerActions}\n      >\n        <EngagementDossierDetail dossier={dossier} />\n      </DossierDetailLayout>\n\n      {/* Kanban Dialog */}\n      <EngagementKanbanDialog\n        open={kanbanOpen}\n        onClose={() => setKanbanOpen(false)}\n        engagementTitle={isRTL ? (dossier?.name_ar || '') : (dossier?.name_en || '')}\n        columns={columns}\n        stats={stats || { total: 0, todo: 0, in_progress: 0, review: 0, done: 0, progressPercentage: 0 }}\n        onDragEnd={handleDragEnd}\n      />\n    </>\n  );\n}\n","/**\n * Engagement Detail Route (Feature 028 - User Story 3 - T026)\n *\n * Route: /dossiers/engagements/$id\n * Validates engagement type and renders detail page.\n * Error handling for loading, errors, not found, and wrong types.\n */\n\nimport { createFileRoute, Link } from '@tanstack/react-router';\nimport { useTranslation } from 'react-i18next';\nimport { AlertCircle, ArrowLeft } from 'lucide-react';\nimport { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';\nimport { Button } from '@/components/ui/button';\nimport { useDossier } from '@/hooks/useDossier';\nimport { isEngagementDossier } from '@/lib/dossier-type-guards';\nimport { EngagementDossierPage } from '@/pages/dossiers/EngagementDossierPage';\n\nexport const Route = createFileRoute('/_protected/dossiers/engagements/$id')({\n  component: EngagementDossierDetailRoute,\n});\n\nfunction EngagementDossierDetailRoute() {\n  const { t, i18n } = useTranslation('dossier');\n  const isRTL = i18n.language === 'ar';\n  const { id } = Route.useParams();\n\n  const { data: dossier, isLoading, error } = useDossier(id, ['stats', 'owners', 'contacts']);\n\n  // Loading state\n  if (isLoading) {\n    return (\n      <div\n        className=\"flex flex-col items-center justify-center min-h-[50vh] space-y-4\"\n        dir={isRTL ? 'rtl' : 'ltr'}\n      >\n        <div className=\"h-12 w-12 animate-spin rounded-full border-4 border-primary border-t-transparent\" />\n        <p className=\"text-sm sm:text-base text-muted-foreground\">\n          {t('detail.loading')}\n        </p>\n      </div>\n    );\n  }\n\n  // Error state\n  if (error) {\n    return (\n      <div\n        className=\"container mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\"\n        dir={isRTL ? 'rtl' : 'ltr'}\n      >\n        <Alert variant=\"destructive\">\n          <AlertCircle className=\"h-4 w-4\" />\n          <AlertTitle>{t('detail.error')}</AlertTitle>\n          <AlertDescription>\n            {error instanceof Error ? error.message : t('detail.errorGeneric')}\n          </AlertDescription>\n        </Alert>\n        <div className=\"mt-4 sm:mt-6\">\n          <Link to=\"/dossiers\">\n            <Button variant=\"outline\" className=\"gap-2\">\n              <ArrowLeft className={`h-4 w-4 ${isRTL ? 'rotate-180' : ''}`} />\n              {t('action.backToHub')}\n            </Button>\n          </Link>\n        </div>\n      </div>\n    );\n  }\n\n  // Not found state\n  if (!dossier) {\n    return (\n      <div\n        className=\"container mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\"\n        dir={isRTL ? 'rtl' : 'ltr'}\n      >\n        <Alert>\n          <AlertCircle className=\"h-4 w-4\" />\n          <AlertTitle>{t('detail.notFound')}</AlertTitle>\n          <AlertDescription>\n            {t('detail.errorGeneric')}\n          </AlertDescription>\n        </Alert>\n        <div className=\"mt-4 sm:mt-6\">\n          <Link to=\"/dossiers\">\n            <Button variant=\"outline\" className=\"gap-2\">\n              <ArrowLeft className={`h-4 w-4 ${isRTL ? 'rotate-180' : ''}`} />\n              {t('action.backToHub')}\n            </Button>\n          </Link>\n        </div>\n      </div>\n    );\n  }\n\n  // Wrong type validation\n  if (!isEngagementDossier(dossier)) {\n    const actualType = t(`type.${dossier.type}`);\n    const expectedType = t('type.engagement');\n\n    return (\n      <div\n        className=\"container mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\"\n        dir={isRTL ? 'rtl' : 'ltr'}\n      >\n        <Alert>\n          <AlertCircle className=\"h-4 w-4\" />\n          <AlertTitle>{t('detail.wrongType')}</AlertTitle>\n          <AlertDescription>\n            {t('detail.wrongTypeDescription', { actualType, expectedType })}\n          </AlertDescription>\n        </Alert>\n        <div className=\"mt-4 sm:mt-6 flex flex-col sm:flex-row gap-3\">\n          <Link to={`/dossiers/${dossier.type}s/$id`} params={{ id: dossier.id }}>\n            <Button className=\"gap-2 w-full sm:w-auto\">\n              {t('action.viewCorrectType', { type: actualType })}\n            </Button>\n          </Link>\n          <Link to=\"/dossiers/engagements\">\n            <Button variant=\"outline\" className=\"gap-2 w-full sm:w-auto\">\n              <ArrowLeft className={`h-4 w-4 ${isRTL ? 'rotate-180' : ''}`} />\n              {t('action.backToList')}\n            </Button>\n          </Link>\n        </div>\n      </div>\n    );\n  }\n\n  return <EngagementDossierPage dossier={dossier} />;\n}\n"],"names":["EngagementInformation","dossier","t","i18n","useTranslation","isRTL","locale","ar","enUS","extension","location","jsxs","jsx","Calendar","MapPin","FileText","Users","ParticipantsList","dossierId","OutcomesSummary","CheckCircle2","FollowUpActions","ListTodo","fetchEngagementPositions","options","engagementId","sort","order","page","pageSize","query","supabase","ascending","from","to","data","error","count","useEngagementPositions","enabled","isLoading","isError","refetch","useQuery","positions","total","totalPages","fetchPositionSuggestions","minRelevance","limit","authData","token","response","define_process_env_default","result","usePositionSuggestions","attemptIndex","updateSuggestionAction","params","suggestionId","action","useUpdateSuggestionAction","queryClient","useQueryClient","useMutation","_data","variables","PositionSuggestionsPanel","onAttach","className","suggestions","isFallbackMode","updateActionMutation","getRelevanceIndicator","score","TrendingUp","Minus","TrendingDown","handleAttach","suggestion","handleReject","getPositionTitle","position","getPositionPreview","content","Card","CardHeader","CardTitle","Sparkles","CardContent","Alert","AlertCircle","AlertDescription","Button","CardDescription","relevanceIndicator","Icon","isActioned","Badge","keyword","i","generateBriefingPack","language","positionIds","useGenerateBriefingPack","positionId","fetchBriefingPackStatus","jobId","useBriefingPackStatus","onCompleted","onFailed","status","isPolling","isCompleted","isFailed","BriefingPackGenerator","attachedPositionCount","setLanguage","useState","setJobId","setStatus","fileUrl","setFileUrl","errorMessage","setErrorMessage","generateMutation","jobStatus","useEffect","handleGenerate","handleDownload","handleReset","estimatedTime","Fragment","Label","RadioGroup","val","RadioGroupItem","Loader2","Progress","CheckCircle","Download","XCircle","EngagementPositionsSection","showAttachDialog","setShowAttachDialog","activeTab","setActiveTab","attachedData","isLoadingAttached","attachedError","suggestionsData","isLoadingSuggestions","suggestionsError","attachedPositions","attachedCount","suggestionsCount","Plus","Tabs","v","TabsList","TabsTrigger","TabsContent","PositionList","AttachPositionDialog","EngagementDossierDetail","informationOpen","setInformationOpen","useSessionStorage","positionsOpen","setPositionsOpen","timelineOpen","setTimelineOpen","participantsOpen","setParticipantsOpen","outcomesOpen","setOutcomesOpen","followUpOpen","setFollowUpOpen","CollapsibleSection","EngagementTimeline","tunnel","KanbanContext","createContext","KanbanBoard","id","children","isOver","setNodeRef","useDroppable","cn","KanbanCard","name","attributes","listeners","transition","transform","isDragging","useSortable","activeCardId","useContext","style","CSS","KanbanCards","props","filteredData","item","items","ScrollArea","SortableContext","ScrollBar","KanbanHeader","KanbanProvider","onDragStart","onDragEnd","onDragOver","columns","onDataChange","setActiveCardId","sensors","useSensors","useSensor","MouseSensor","TouchSensor","KeyboardSensor","handleDragStart","event","handleDragOver","active","over","activeItem","overItem","activeColumn","overColumn","col","newData","activeIndex","overIndex","arrayMove","handleDragEnd","oldIndex","newIndex","announcements","column","newColumn","DndContext","closestCenter","createPortal","DragOverlay","KanbanTaskCard","assignment","slaStatus","deadline","now","hoursRemaining","slaColors","priorityVariants","shortId","workItemTitle","Avatar","AvatarImage","AvatarFallback","Clock","EngagementKanbanDialog","open","onClose","engagementTitle","stats","kanbanColumns","useMemo","kanbanData","allAssignments","a","assignmentId","newStage","Dialog","DialogContent","DialogHeader","DialogTitle","LayoutGrid","DialogDescription","X","useEngagementKanban","sortBy","session","assignments","done","progressPercentage","updateStageMutation","sessionError","user","useCallback","EngagementDossierPage","kanbanOpen","setKanbanOpen","headerActions","Link","DossierDetailLayout","EngagementDossierDetailRoute","Route","useParams","useDossier","AlertTitle","Error","message","ArrowLeft","isEngagementDossier","actualType","type","expectedType"],"mappings":"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"}