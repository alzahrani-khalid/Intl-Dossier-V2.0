{"version":3,"file":"briefs-DhDpPDx8.js","sources":["../../src/hooks/useGenerateBrief.ts","../../src/utils/ai-errors.ts","../../src/components/ai/BriefGenerationPanel.tsx","../../src/components/ai/BriefViewer.tsx","../../src/pages/Briefs/BriefsPage.tsx","../../src/routes/_protected/briefs.tsx?tsr-split=component"],"sourcesContent":["/**\n * useGenerateBrief Hook\n * Feature: 033-ai-brief-generation\n * Task: T026\n *\n * Hook for generating AI briefs with SSE streaming support\n */\n\nimport { useState, useCallback, useRef, useEffect } from 'react'\nimport { supabase } from '@/lib/supabase'\n\nexport interface BriefGenerationParams {\n  engagementId?: string\n  dossierId?: string\n  customPrompt?: string\n  language?: 'en' | 'ar'\n}\n\nexport interface BriefContent {\n  id: string\n  title: string\n  executiveSummary: string\n  background: string\n  keyParticipants: Array<{\n    name: string\n    role: string\n    relevance: string\n  }>\n  relevantPositions: Array<{\n    title: string\n    stance: string\n    source: string\n    sourceId: string\n  }>\n  activeCommitments: Array<{\n    description: string\n    status: string\n    deadline?: string\n    sourceId: string\n  }>\n  historicalContext: string\n  talkingPoints: string[]\n  recommendations: string\n  citations: Array<{\n    type: 'dossier' | 'position' | 'commitment' | 'engagement'\n    id: string\n    title: string\n    snippet?: string\n  }>\n  status: 'generating' | 'completed' | 'partial' | 'failed'\n}\n\nexport interface UseGenerateBriefReturn {\n  generate: (params: BriefGenerationParams) => Promise<void>\n  brief: BriefContent | null\n  streamingContent: string\n  isGenerating: boolean\n  progress: number\n  error: string | null\n  cancel: () => void\n  retry: () => void\n  reset: () => void\n}\n\nconst API_BASE = import.meta.env.VITE_API_URL || '/api'\n\nexport function useGenerateBrief(): UseGenerateBriefReturn {\n  const [token, setToken] = useState<string | null>(null)\n  const [brief, setBrief] = useState<BriefContent | null>(null)\n\n  // Get the auth token from Supabase session\n  useEffect(() => {\n    const getToken = async () => {\n      const {\n        data: { session },\n      } = await supabase.auth.getSession()\n      setToken(session?.access_token || null)\n    }\n    getToken()\n\n    const {\n      data: { subscription },\n    } = supabase.auth.onAuthStateChange((_event, session) => {\n      setToken(session?.access_token || null)\n    })\n\n    return () => subscription.unsubscribe()\n  }, [])\n  const [streamingContent, setStreamingContent] = useState('')\n  const [isGenerating, setIsGenerating] = useState(false)\n  const [progress, setProgress] = useState(0)\n  const [error, setError] = useState<string | null>(null)\n  const abortControllerRef = useRef<AbortController | null>(null)\n  const lastParamsRef = useRef<BriefGenerationParams | null>(null)\n\n  const generate = useCallback(\n    async (params: BriefGenerationParams) => {\n      if (isGenerating) return\n\n      // Get fresh token from Supabase\n      const {\n        data: { session },\n      } = await supabase.auth.getSession()\n      const currentToken = session?.access_token\n\n      if (!currentToken) {\n        setError('UNAUTHORIZED')\n        return\n      }\n\n      lastParamsRef.current = params\n      setIsGenerating(true)\n      setError(null)\n      setStreamingContent('')\n      setProgress(0)\n      setBrief(null)\n\n      abortControllerRef.current = new AbortController()\n\n      try {\n        const response = await fetch(`${API_BASE}/ai/briefs/generate`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            Accept: 'text/event-stream',\n            Authorization: `Bearer ${currentToken}`,\n          },\n          body: JSON.stringify({\n            engagement_id: params.engagementId,\n            dossier_id: params.dossierId,\n            custom_prompt: params.customPrompt,\n            language: params.language || 'en',\n          }),\n          signal: abortControllerRef.current.signal,\n        })\n\n        if (!response.ok) {\n          const errorData = await response.json().catch(() => ({}))\n          throw new Error(errorData.error || 'Failed to generate brief')\n        }\n\n        const reader = response.body?.getReader()\n        if (!reader) throw new Error('No response body')\n\n        const decoder = new TextDecoder()\n        let content = ''\n        let briefId: string | undefined\n\n        while (true) {\n          const { done, value } = await reader.read()\n          if (done) break\n\n          const chunk = decoder.decode(value)\n          const lines = chunk.split('\\n')\n\n          for (const line of lines) {\n            if (!line.startsWith('data: ')) continue\n\n            try {\n              const data = JSON.parse(line.slice(6))\n\n              if (data.type === 'init' && data.briefId) {\n                briefId = data.briefId\n                setProgress(10)\n              } else if (data.type === 'content' && data.content) {\n                content += data.content\n                setStreamingContent(content)\n                setProgress((p) => Math.min(90, p + 1))\n              } else if (data.type === 'done') {\n                setProgress(100)\n                // Fetch the final brief\n                if (briefId) {\n                  try {\n                    const briefResponse = await fetch(`${API_BASE}/ai/briefs/${briefId}`, {\n                      headers: { Authorization: `Bearer ${currentToken}` },\n                    })\n                    if (briefResponse.ok) {\n                      const briefData = await briefResponse.json()\n                      setBrief(briefData.data)\n                    } else {\n                      throw new Error('BRIEF_FETCH_FAILED')\n                    }\n                  } catch (fetchError) {\n                    // Surface the error to the user instead of failing silently\n                    setError('BRIEF_FETCH_FAILED')\n                  }\n                }\n              } else if (data.type === 'error') {\n                throw new Error(data.code || 'GENERATION_FAILED')\n              } else if (data.type === 'timeout') {\n                setError('TIMEOUT')\n                setProgress(100)\n              }\n            } catch (parseError) {\n              // Ignore parse errors for partial chunks\n            }\n          }\n        }\n      } catch (err) {\n        if (err instanceof Error && err.name === 'AbortError') {\n          setError('CANCELLED')\n        } else {\n          // Use error code if available, otherwise parse from message\n          const errorMessage = err instanceof Error ? err.message : 'UNKNOWN_ERROR'\n          setError(errorMessage)\n        }\n      } finally {\n        setIsGenerating(false)\n        abortControllerRef.current = null\n      }\n    },\n    [isGenerating],\n  )\n\n  const cancel = useCallback(() => {\n    if (abortControllerRef.current) {\n      abortControllerRef.current.abort()\n      abortControllerRef.current = null\n    }\n    setIsGenerating(false)\n  }, [])\n\n  const retry = useCallback(() => {\n    if (lastParamsRef.current) {\n      generate(lastParamsRef.current)\n    }\n  }, [generate])\n\n  const reset = useCallback(() => {\n    setBrief(null)\n    setStreamingContent('')\n    setProgress(0)\n    setError(null)\n    lastParamsRef.current = null\n    if (abortControllerRef.current) {\n      abortControllerRef.current.abort()\n      abortControllerRef.current = null\n    }\n    setIsGenerating(false)\n  }, [])\n\n  return {\n    generate,\n    brief,\n    streamingContent,\n    isGenerating,\n    progress,\n    error,\n    cancel,\n    retry,\n    reset,\n  }\n}\n\nexport default useGenerateBrief\n","/**\n * AI Error Handling Utilities\n * Feature: 033-ai-brief-generation\n * Task: T063\n *\n * User-friendly error messages with i18n support\n */\n\nimport { TFunction } from 'i18next'\n\nexport interface AIError {\n  code: string\n  message: string\n  details?: string\n  retryable: boolean\n  retryAfter?: number // seconds\n}\n\nexport type AIErrorCode =\n  | 'RATE_LIMIT_EXCEEDED'\n  | 'SPEND_CAP_REACHED'\n  | 'PROVIDER_UNAVAILABLE'\n  | 'MODEL_UNAVAILABLE'\n  | 'GENERATION_FAILED'\n  | 'CONTEXT_TOO_LONG'\n  | 'CONTENT_FILTERED'\n  | 'TIMEOUT'\n  | 'UNAUTHORIZED'\n  | 'FEATURE_DISABLED'\n  | 'NETWORK_ERROR'\n  | 'CANCELLED'\n  | 'BRIEF_FETCH_FAILED'\n  | 'UNKNOWN_ERROR'\n\n/**\n * Parse API error response into AIError\n */\nexport function parseAIError(error: unknown): AIError {\n  // Handle API response errors\n  if (typeof error === 'object' && error !== null) {\n    const err = error as Record<string, unknown>\n\n    if (err.code && typeof err.code === 'string') {\n      return {\n        code: err.code,\n        message: (err.message as string) || 'An error occurred',\n        details: err.details as string | undefined,\n        retryable: isRetryableError(err.code),\n        retryAfter: err.retryAfter as number | undefined,\n      }\n    }\n\n    // Handle fetch errors\n    if (err.name === 'TypeError' || err.message?.toString().includes('fetch')) {\n      return {\n        code: 'NETWORK_ERROR',\n        message: 'Network error',\n        retryable: true,\n      }\n    }\n  }\n\n  // Handle Error instances\n  if (error instanceof Error) {\n    const code = detectErrorCode(error.message)\n    return {\n      code,\n      message: error.message,\n      retryable: isRetryableError(code),\n    }\n  }\n\n  return {\n    code: 'UNKNOWN_ERROR',\n    message: 'An unexpected error occurred',\n    retryable: false,\n  }\n}\n\n/**\n * Detect error code from error message\n */\nfunction detectErrorCode(message: string): AIErrorCode {\n  const lowerMessage = message.toLowerCase()\n\n  if (lowerMessage.includes('rate limit') || lowerMessage.includes('429')) {\n    return 'RATE_LIMIT_EXCEEDED'\n  }\n  if (lowerMessage.includes('spend') || lowerMessage.includes('cap')) {\n    return 'SPEND_CAP_REACHED'\n  }\n  if (lowerMessage.includes('provider') || lowerMessage.includes('unavailable')) {\n    return 'PROVIDER_UNAVAILABLE'\n  }\n  if (lowerMessage.includes('model')) {\n    return 'MODEL_UNAVAILABLE'\n  }\n  if (lowerMessage.includes('context') || lowerMessage.includes('too long')) {\n    return 'CONTEXT_TOO_LONG'\n  }\n  if (lowerMessage.includes('filter') || lowerMessage.includes('content policy')) {\n    return 'CONTENT_FILTERED'\n  }\n  if (lowerMessage.includes('timeout') || lowerMessage.includes('timed out')) {\n    return 'TIMEOUT'\n  }\n  if (lowerMessage.includes('unauthorized') || lowerMessage.includes('401')) {\n    return 'UNAUTHORIZED'\n  }\n  if (lowerMessage.includes('disabled') || lowerMessage.includes('not enabled')) {\n    return 'FEATURE_DISABLED'\n  }\n  if (lowerMessage.includes('network') || lowerMessage.includes('fetch failed')) {\n    return 'NETWORK_ERROR'\n  }\n  if (\n    lowerMessage.includes('cancelled') ||\n    lowerMessage.includes('canceled') ||\n    lowerMessage.includes('abort')\n  ) {\n    return 'CANCELLED'\n  }\n  if (lowerMessage.includes('brief_fetch') || lowerMessage.includes('fetch brief')) {\n    return 'BRIEF_FETCH_FAILED'\n  }\n\n  return 'UNKNOWN_ERROR'\n}\n\n/**\n * Check if error is retryable\n */\nfunction isRetryableError(code: string): boolean {\n  const retryableCodes: AIErrorCode[] = [\n    'RATE_LIMIT_EXCEEDED',\n    'PROVIDER_UNAVAILABLE',\n    'TIMEOUT',\n    'NETWORK_ERROR',\n    'BRIEF_FETCH_FAILED',\n  ]\n  return retryableCodes.includes(code as AIErrorCode)\n}\n\n/**\n * Get user-friendly error message with i18n\n */\nexport function getErrorMessage(error: AIError, t: TFunction): string {\n  const messages: Record<AIErrorCode, string> = {\n    RATE_LIMIT_EXCEEDED: t(\n      'ai.errors.rateLimitExceeded',\n      'Too many requests. Please wait a moment and try again.',\n    ),\n    SPEND_CAP_REACHED: t(\n      'ai.errors.spendCapReached',\n      'AI usage limit reached. Please contact your administrator.',\n    ),\n    PROVIDER_UNAVAILABLE: t(\n      'ai.errors.providerUnavailable',\n      'AI service is temporarily unavailable. Please try again later.',\n    ),\n    MODEL_UNAVAILABLE: t(\n      'ai.errors.modelUnavailable',\n      'The AI model is not available. Please try a different request.',\n    ),\n    GENERATION_FAILED: t(\n      'ai.errors.generationFailed',\n      'Failed to generate content. Please try again.',\n    ),\n    CONTEXT_TOO_LONG: t(\n      'ai.errors.contextTooLong',\n      'The input is too long. Please shorten your request.',\n    ),\n    CONTENT_FILTERED: t(\n      'ai.errors.contentFiltered',\n      'The request was filtered due to content policy. Please revise your input.',\n    ),\n    TIMEOUT: t('ai.errors.timeout', 'The request timed out. Please try again.'),\n    UNAUTHORIZED: t(\n      'ai.errors.unauthorized',\n      'You are not authorized to use this feature. Please log in again.',\n    ),\n    FEATURE_DISABLED: t(\n      'ai.errors.featureDisabled',\n      'This AI feature is currently disabled for your organization.',\n    ),\n    NETWORK_ERROR: t(\n      'ai.errors.networkError',\n      'Network error. Please check your connection and try again.',\n    ),\n    CANCELLED: t('ai.errors.cancelled', 'Generation was cancelled.'),\n    BRIEF_FETCH_FAILED: t(\n      'ai.errors.briefFetchFailed',\n      'Brief was generated but could not be retrieved. Please try again.',\n    ),\n    UNKNOWN_ERROR: t('ai.errors.unknown', 'An unexpected error occurred. Please try again.'),\n  }\n\n  return messages[error.code as AIErrorCode] || messages.UNKNOWN_ERROR\n}\n\n/**\n * Get error action suggestion\n */\nexport function getErrorAction(error: AIError, t: TFunction): string | null {\n  if (error.retryable) {\n    if (error.retryAfter) {\n      return t('ai.errors.retryAfter', 'Try again in {{seconds}} seconds', {\n        seconds: error.retryAfter,\n      })\n    }\n    return t('ai.errors.retryNow', 'Click to retry')\n  }\n\n  if (error.code === 'SPEND_CAP_REACHED') {\n    return t('ai.errors.contactAdmin', 'Contact your administrator to increase the limit')\n  }\n\n  if (error.code === 'UNAUTHORIZED') {\n    return t('ai.errors.loginAgain', 'Please log in again')\n  }\n\n  if (error.code === 'CONTEXT_TOO_LONG') {\n    return t('ai.errors.shortenInput', 'Try with a shorter input')\n  }\n\n  return null\n}\n\n/**\n * Format error for display\n */\nexport function formatAIError(\n  error: unknown,\n  t: TFunction,\n): {\n  title: string\n  message: string\n  action: string | null\n  retryable: boolean\n} {\n  const parsedError = parseAIError(error)\n\n  return {\n    title: t('ai.errors.title', 'AI Error'),\n    message: getErrorMessage(parsedError, t),\n    action: getErrorAction(parsedError, t),\n    retryable: parsedError.retryable,\n  }\n}\n\nexport default {\n  parseAIError,\n  getErrorMessage,\n  getErrorAction,\n  formatAIError,\n}\n","/**\n * BriefGenerationPanel Component\n * Feature: 033-ai-brief-generation\n * Task: T024\n *\n * Panel for generating AI briefs with progress indicator, streaming, and retry\n */\n\nimport { useState, useEffect } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { Button } from '@/components/ui/button'\nimport { Textarea } from '@/components/ui/textarea'\nimport { Progress } from '@/components/ui/progress'\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card'\nimport { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert'\nimport { Skeleton } from '@/components/ui/skeleton'\nimport { Label } from '@/components/ui/label'\nimport { useGenerateBrief, BriefGenerationParams } from '@/hooks/useGenerateBrief'\nimport { formatAIError } from '@/utils/ai-errors'\nimport {\n  Loader2,\n  Sparkles,\n  X,\n  RefreshCw,\n  CheckCircle,\n  AlertCircle,\n  Eye,\n  RotateCcw,\n  PenLine,\n} from 'lucide-react'\nimport { cn } from '@/lib/utils'\n\nexport interface BriefGenerationPanelProps {\n  engagementId?: string\n  dossierId?: string\n  onBriefGenerated?: (briefId: string) => void\n  onClose?: () => void\n  className?: string\n}\n\ntype GenerationPhase = 'idle' | 'context' | 'generating' | 'success' | 'error' | 'manual'\n\nexport function BriefGenerationPanel({\n  engagementId,\n  dossierId,\n  onBriefGenerated,\n  onClose,\n  className,\n}: BriefGenerationPanelProps) {\n  const { t, i18n } = useTranslation('ai-brief')\n  const isRTL = i18n.language === 'ar'\n  const [customPrompt, setCustomPrompt] = useState('')\n  const [showAdvanced, setShowAdvanced] = useState(false)\n  const [phase, setPhase] = useState<GenerationPhase>('idle')\n\n  // Manual fallback state\n  const [manualContent, setManualContent] = useState({\n    summary: '',\n    background: '',\n    recommendations: '',\n  })\n\n  const { generate, brief, streamingContent, isGenerating, progress, error, cancel, retry, reset } =\n    useGenerateBrief()\n\n  // Track phase based on state changes\n  useEffect(() => {\n    if (error) {\n      setPhase('error')\n    } else if (brief && brief.status !== 'generating') {\n      setPhase('success')\n    } else if (isGenerating) {\n      // Determine sub-phase based on progress\n      if (progress < 10) {\n        setPhase('context')\n      } else {\n        setPhase('generating')\n      }\n    } else if (!isGenerating && !brief && !error) {\n      setPhase('idle')\n    }\n  }, [isGenerating, progress, brief, error])\n\n  // Format error using ai-errors utility\n  const formattedError = error ? formatAIError(error, t) : null\n\n  const handleGenerate = async () => {\n    const params: BriefGenerationParams = {\n      engagementId,\n      dossierId,\n      customPrompt: customPrompt || undefined,\n      language: i18n.language as 'en' | 'ar',\n    }\n\n    await generate(params)\n  }\n\n  const handleViewBrief = () => {\n    if (brief?.id && onBriefGenerated) {\n      onBriefGenerated(brief.id)\n    }\n  }\n\n  const handleGenerateAnother = () => {\n    reset() // Clear all hook state including brief\n    setPhase('idle')\n    setCustomPrompt('')\n    setShowAdvanced(false)\n    setManualContent({ summary: '', background: '', recommendations: '' })\n  }\n\n  const handleSwitchToManual = () => {\n    reset() // Clear error state\n    setPhase('manual')\n  }\n\n  const handleManualSubmit = () => {\n    // TODO: Implement manual brief submission\n    // For now, just show success message\n    console.log('Manual brief submitted:', manualContent)\n    // In a real implementation, this would call an API to save the manual brief\n  }\n\n  const getPhaseLabel = () => {\n    switch (phase) {\n      case 'context':\n        return t('phases.context', 'Gathering context...')\n      case 'generating':\n        return t('phases.generating', 'Generating brief...')\n      case 'success':\n        return t('phases.success', 'Complete')\n      case 'error':\n        return t('phases.error', 'Error')\n      default:\n        return ''\n    }\n  }\n\n  return (\n    <Card className={cn('w-full', className)} dir={isRTL ? 'rtl' : 'ltr'}>\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Sparkles className={cn('h-5 w-5 text-primary', isRTL && 'rotate-180')} />\n            <CardTitle className=\"text-lg\">{t('title', 'Generate AI Brief')}</CardTitle>\n          </div>\n          {isGenerating && (\n            <Button variant=\"ghost\" size=\"sm\" onClick={cancel} className=\"h-8\">\n              <X className=\"h-4 w-4 me-1\" />\n              {t('cancel', 'Cancel')}\n            </Button>\n          )}\n        </div>\n        <CardDescription>\n          {t('description', 'Generate a comprehensive brief using AI analysis')}\n        </CardDescription>\n      </CardHeader>\n\n      <CardContent className=\"space-y-4\">\n        {/* Three-step progress indicator */}\n        {(phase === 'context' || phase === 'generating' || phase === 'success') && (\n          <div className=\"space-y-3\">\n            <div className=\"flex items-center justify-between\">\n              {/* Step indicators */}\n              <div className=\"flex items-center gap-2 flex-1\">\n                <StepIndicator\n                  step={1}\n                  label={t('steps.context', 'Context')}\n                  active={phase === 'context'}\n                  complete={phase === 'generating' || phase === 'success'}\n                />\n                <div\n                  className={cn(\n                    'flex-1 h-0.5 mx-1',\n                    phase === 'generating' || phase === 'success' ? 'bg-primary' : 'bg-muted',\n                  )}\n                />\n                <StepIndicator\n                  step={2}\n                  label={t('steps.generating', 'Generate')}\n                  active={phase === 'generating'}\n                  complete={phase === 'success'}\n                />\n                <div\n                  className={cn(\n                    'flex-1 h-0.5 mx-1',\n                    phase === 'success' ? 'bg-primary' : 'bg-muted',\n                  )}\n                />\n                <StepIndicator\n                  step={3}\n                  label={t('steps.review', 'Review')}\n                  active={phase === 'success'}\n                  complete={false}\n                />\n              </div>\n            </div>\n\n            {/* Progress bar with percentage */}\n            {isGenerating && (\n              <div className=\"space-y-1\">\n                <div className=\"flex items-center justify-between text-sm\">\n                  <span className=\"text-muted-foreground flex items-center gap-2\">\n                    <Loader2 className=\"h-3 w-3 animate-spin\" />\n                    {getPhaseLabel()}\n                  </span>\n                  <span className=\"text-muted-foreground font-mono\">{Math.round(progress)}%</span>\n                </div>\n                <Progress value={progress} className=\"h-2\" />\n              </div>\n            )}\n          </div>\n        )}\n\n        {/* Streaming Content Preview with shimmer effect */}\n        {isGenerating && (\n          <div className=\"bg-muted/50 rounded-lg p-4 max-h-64 overflow-y-auto border\">\n            {streamingContent ? (\n              <pre className=\"text-sm whitespace-pre-wrap font-sans leading-relaxed\">\n                {streamingContent}\n                <span className=\"inline-block w-2 h-4 bg-primary/60 animate-pulse ms-1\" />\n              </pre>\n            ) : (\n              <div className=\"space-y-2\">\n                <Skeleton className=\"h-4 w-full\" />\n                <Skeleton className=\"h-4 w-3/4\" />\n                <Skeleton className=\"h-4 w-5/6\" />\n                <Skeleton className=\"h-4 w-2/3\" />\n              </div>\n            )}\n          </div>\n        )}\n\n        {/* Error Display with formatted message and manual fallback option */}\n        {phase === 'error' && formattedError && (\n          <Alert variant=\"destructive\">\n            <AlertCircle className=\"h-4 w-4\" />\n            <AlertTitle>{formattedError.title}</AlertTitle>\n            <AlertDescription className=\"mt-2 space-y-3\">\n              <p>{formattedError.message}</p>\n              {formattedError.action && (\n                <p className=\"text-sm opacity-80\">{formattedError.action}</p>\n              )}\n              <div className=\"flex flex-wrap items-center gap-2 mt-3\">\n                {formattedError.retryable && (\n                  <Button variant=\"outline\" size=\"sm\" onClick={retry} className=\"gap-1\">\n                    <RefreshCw className=\"h-3 w-3\" />\n                    {t('retry', 'Retry')}\n                  </Button>\n                )}\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={handleSwitchToManual}\n                  className=\"gap-1\"\n                >\n                  <PenLine className=\"h-3 w-3\" />\n                  {t('fallback.switchToManual', 'Enter Manually')}\n                </Button>\n                <Button variant=\"ghost\" size=\"sm\" onClick={handleGenerateAnother} className=\"gap-1\">\n                  <RotateCcw className=\"h-3 w-3\" />\n                  {t('startOver', 'Start over')}\n                </Button>\n              </div>\n            </AlertDescription>\n          </Alert>\n        )}\n\n        {/* Success Display */}\n        {phase === 'success' && brief && (\n          <Alert className=\"bg-green-50 border-green-200 dark:bg-green-950 dark:border-green-800\">\n            <CheckCircle className=\"h-4 w-4 text-green-600\" />\n            <AlertTitle className=\"text-green-800 dark:text-green-200\">\n              {t('success', 'Brief generated successfully!')}\n            </AlertTitle>\n            <AlertDescription className=\"mt-3\">\n              <p className=\"text-sm text-green-700 dark:text-green-300 mb-3\">{brief.title}</p>\n              <div className=\"flex items-center gap-2\">\n                <Button variant=\"default\" size=\"sm\" onClick={handleViewBrief} className=\"gap-1\">\n                  <Eye className=\"h-3 w-3\" />\n                  {t('viewBrief', 'Open Brief')}\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={handleGenerateAnother}\n                  className=\"gap-1\"\n                >\n                  <Sparkles className={cn('h-3 w-3', isRTL && 'rotate-180')} />\n                  {t('generateAnother', 'Generate Another')}\n                </Button>\n                {onClose && (\n                  <Button variant=\"ghost\" size=\"sm\" onClick={onClose}>\n                    {t('close', 'Close')}\n                  </Button>\n                )}\n              </div>\n            </AlertDescription>\n          </Alert>\n        )}\n\n        {/* Idle state - show options and generate button */}\n        {phase === 'idle' && (\n          <>\n            {/* Advanced Options */}\n            <div>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setShowAdvanced(!showAdvanced)}\n                className=\"text-muted-foreground\"\n              >\n                {showAdvanced\n                  ? t('hideAdvanced', 'Hide options')\n                  : t('showAdvanced', 'Show options')}\n              </Button>\n\n              {showAdvanced && (\n                <div className=\"mt-2 space-y-2\">\n                  <label className=\"text-sm font-medium mb-1 block\">\n                    {t('customPrompt', 'Custom instructions (optional)')}\n                  </label>\n                  <Textarea\n                    value={customPrompt}\n                    onChange={(e) => setCustomPrompt(e.target.value)}\n                    placeholder={t(\n                      'customPromptPlaceholder',\n                      'e.g., Focus on trade agreements and recent developments',\n                    )}\n                    className=\"resize-none\"\n                    rows={3}\n                    maxLength={500}\n                  />\n                  <p className=\"text-xs text-muted-foreground text-end\">\n                    {customPrompt.length}/500\n                  </p>\n                </div>\n              )}\n            </div>\n\n            {/* Generate Button */}\n            <Button\n              onClick={handleGenerate}\n              disabled={!engagementId && !dossierId}\n              className=\"w-full min-h-11\"\n            >\n              <Sparkles className={cn('h-4 w-4 me-2', isRTL && 'rotate-180')} />\n              {t('generate', 'Generate Brief')}\n            </Button>\n          </>\n        )}\n\n        {/* Manual Fallback UI */}\n        {phase === 'manual' && (\n          <div className=\"space-y-4\">\n            <Alert className=\"bg-amber-50 border-amber-200 dark:bg-amber-950 dark:border-amber-800\">\n              <PenLine className=\"h-4 w-4 text-amber-600\" />\n              <AlertTitle className=\"text-amber-800 dark:text-amber-200\">\n                {t('fallback.title', 'Manual Brief Entry')}\n              </AlertTitle>\n              <AlertDescription className=\"text-amber-700 dark:text-amber-300\">\n                {t(\n                  'fallback.description',\n                  'AI service is unavailable. You can enter the brief details manually.',\n                )}\n              </AlertDescription>\n            </Alert>\n\n            <div className=\"space-y-4\">\n              {/* Executive Summary */}\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"manual-summary\" className=\"text-sm font-medium\">\n                  {t('fallback.summary', 'Executive Summary')}\n                </Label>\n                <Textarea\n                  id=\"manual-summary\"\n                  value={manualContent.summary}\n                  onChange={(e) => setManualContent({ ...manualContent, summary: e.target.value })}\n                  placeholder={t(\n                    'fallback.summaryPlaceholder',\n                    'Enter a brief executive summary...',\n                  )}\n                  className=\"resize-none min-h-[100px]\"\n                  rows={4}\n                  dir={isRTL ? 'rtl' : 'ltr'}\n                />\n              </div>\n\n              {/* Background */}\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"manual-background\" className=\"text-sm font-medium\">\n                  {t('fallback.background', 'Background')}\n                </Label>\n                <Textarea\n                  id=\"manual-background\"\n                  value={manualContent.background}\n                  onChange={(e) =>\n                    setManualContent({ ...manualContent, background: e.target.value })\n                  }\n                  placeholder={t(\n                    'fallback.backgroundPlaceholder',\n                    'Enter background information...',\n                  )}\n                  className=\"resize-none min-h-[80px]\"\n                  rows={3}\n                  dir={isRTL ? 'rtl' : 'ltr'}\n                />\n              </div>\n\n              {/* Recommendations */}\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"manual-recommendations\" className=\"text-sm font-medium\">\n                  {t('fallback.recommendations', 'Recommendations')}\n                </Label>\n                <Textarea\n                  id=\"manual-recommendations\"\n                  value={manualContent.recommendations}\n                  onChange={(e) =>\n                    setManualContent({ ...manualContent, recommendations: e.target.value })\n                  }\n                  placeholder={t(\n                    'fallback.recommendationsPlaceholder',\n                    'Enter your recommendations...',\n                  )}\n                  className=\"resize-none min-h-[80px]\"\n                  rows={3}\n                  dir={isRTL ? 'rtl' : 'ltr'}\n                />\n              </div>\n\n              {/* Action Buttons */}\n              <div className=\"flex flex-col sm:flex-row gap-2\">\n                <Button\n                  onClick={handleManualSubmit}\n                  disabled={!manualContent.summary.trim()}\n                  className=\"flex-1 min-h-11\"\n                >\n                  <CheckCircle className=\"h-4 w-4 me-2\" />\n                  {t('fallback.submit', 'Submit Brief')}\n                </Button>\n                <Button variant=\"outline\" onClick={handleGenerateAnother} className=\"min-h-11\">\n                  <RotateCcw className=\"h-3 w-3 me-2\" />\n                  {t('startOver', 'Start over')}\n                </Button>\n              </div>\n            </div>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  )\n}\n\ninterface StepIndicatorProps {\n  step: number\n  label: string\n  active: boolean\n  complete: boolean\n}\n\nfunction StepIndicator({ step, label, active, complete }: StepIndicatorProps) {\n  return (\n    <div className=\"flex flex-col items-center gap-1\">\n      <div\n        className={cn(\n          'w-6 h-6 rounded-full flex items-center justify-center text-xs font-medium transition-colors',\n          complete\n            ? 'bg-primary text-primary-foreground'\n            : active\n              ? 'bg-primary/20 text-primary border-2 border-primary'\n              : 'bg-muted text-muted-foreground',\n        )}\n      >\n        {complete ? <CheckCircle className=\"h-3 w-3\" /> : step}\n      </div>\n      <span\n        className={cn('text-xs', active || complete ? 'text-foreground' : 'text-muted-foreground')}\n      >\n        {label}\n      </span>\n    </div>\n  )\n}\n\nexport default BriefGenerationPanel\n","/**\n * BriefViewer Component\n * Feature: 033-ai-brief-generation\n * Task: T025\n *\n * Component for viewing generated briefs with sections, citations, and export\n */\n\nimport { useTranslation } from 'react-i18next'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Badge } from '@/components/ui/badge'\nimport { Button } from '@/components/ui/button'\nimport { ScrollArea } from '@/components/ui/scroll-area'\nimport {\n  FileText,\n  Users,\n  Target,\n  CheckCircle,\n  History,\n  MessageSquare,\n  Lightbulb,\n  ExternalLink,\n  Printer,\n  Download,\n  Copy,\n} from 'lucide-react'\nimport { cn } from '@/lib/utils'\nimport type { BriefContent } from '@/hooks/useGenerateBrief'\n\nexport interface BriefViewerProps {\n  brief: BriefContent\n  onCitationClick?: (type: string, id: string) => void\n  className?: string\n}\n\nexport function BriefViewer({ brief, onCitationClick, className }: BriefViewerProps) {\n  const { t, i18n } = useTranslation('ai-brief')\n  const isRTL = i18n.language === 'ar'\n\n  // Safely access arrays with fallbacks\n  const keyParticipants = brief.keyParticipants ?? []\n  const relevantPositions = brief.relevantPositions ?? []\n  const activeCommitments = brief.activeCommitments ?? []\n  const talkingPoints = brief.talkingPoints ?? []\n  const citations = brief.citations ?? []\n\n  const handlePrint = () => {\n    window.print()\n  }\n\n  const handleCopy = async () => {\n    const text = `\n${brief.title || 'Untitled Brief'}\n\nExecutive Summary:\n${brief.executiveSummary || ''}\n\nBackground:\n${brief.background || ''}\n\nTalking Points:\n${talkingPoints.map((p, i) => `${i + 1}. ${p}`).join('\\n')}\n\nRecommendations:\n${brief.recommendations || ''}\n    `.trim()\n\n    await navigator.clipboard.writeText(text)\n  }\n\n  const handleExport = () => {\n    const blob = new Blob([JSON.stringify(brief, null, 2)], { type: 'application/json' })\n    const url = URL.createObjectURL(blob)\n    const a = document.createElement('a')\n    a.href = url\n    a.download = `brief-${brief.id}.json`\n    a.click()\n    URL.revokeObjectURL(url)\n  }\n\n  const statusColors = {\n    completed: 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200',\n    partial: 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200',\n    failed: 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200',\n    generating: 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200',\n  }\n\n  return (\n    <div className={cn('space-y-6', className)} dir={isRTL ? 'rtl' : 'ltr'}>\n      {/* Header */}\n      <div className=\"flex items-start justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-bold\">{brief.title}</h1>\n          <div className=\"flex items-center gap-2 mt-2\">\n            <Badge className={statusColors[brief.status]}>\n              {t(`status.${brief.status}`, brief.status)}\n            </Badge>\n            <span className=\"text-sm text-muted-foreground\">\n              {citations.length} {t('citations', 'citations')}\n            </span>\n          </div>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Button variant=\"outline\" size=\"sm\" onClick={handleCopy}>\n            <Copy className=\"h-4 w-4 me-1\" />\n            {t('copy', 'Copy')}\n          </Button>\n          <Button variant=\"outline\" size=\"sm\" onClick={handlePrint}>\n            <Printer className=\"h-4 w-4 me-1\" />\n            {t('print', 'Print')}\n          </Button>\n          <Button variant=\"outline\" size=\"sm\" onClick={handleExport}>\n            <Download className=\"h-4 w-4 me-1\" />\n            {t('export', 'Export')}\n          </Button>\n        </div>\n      </div>\n\n      <ScrollArea className=\"h-[calc(100vh-200px)]\">\n        <div className=\"space-y-6 pe-4\">\n          {/* Executive Summary */}\n          {brief.executiveSummary && (\n            <Section\n              icon={<FileText className=\"h-5 w-5\" />}\n              title={t('sections.executiveSummary', 'Executive Summary')}\n            >\n              <p className=\"text-muted-foreground whitespace-pre-wrap\">{brief.executiveSummary}</p>\n            </Section>\n          )}\n\n          {/* Background */}\n          {brief.background && (\n            <Section\n              icon={<History className=\"h-5 w-5\" />}\n              title={t('sections.background', 'Background')}\n            >\n              <p className=\"text-muted-foreground whitespace-pre-wrap\">{brief.background}</p>\n            </Section>\n          )}\n\n          {/* Key Participants */}\n          {keyParticipants.length > 0 && (\n            <Section\n              icon={<Users className=\"h-5 w-5\" />}\n              title={t('sections.keyParticipants', 'Key Participants')}\n            >\n              <div className=\"space-y-3\">\n                {keyParticipants.map((participant, index) => (\n                  <div key={index} className=\"flex items-start gap-3\">\n                    <div className=\"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center shrink-0\">\n                      <Users className=\"h-4 w-4 text-primary\" />\n                    </div>\n                    <div>\n                      <p className=\"font-medium\">{participant.name}</p>\n                      <p className=\"text-sm text-muted-foreground\">{participant.role}</p>\n                      <p className=\"text-sm text-muted-foreground\">{participant.relevance}</p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </Section>\n          )}\n\n          {/* Relevant Positions */}\n          {relevantPositions.length > 0 && (\n            <Section\n              icon={<Target className=\"h-5 w-5\" />}\n              title={t('sections.positions', 'Relevant Positions')}\n            >\n              <div className=\"space-y-3\">\n                {relevantPositions.map((position, index) => (\n                  <Card key={index} className=\"bg-muted/30\">\n                    <CardContent className=\"p-4\">\n                      <div className=\"flex items-start justify-between\">\n                        <div>\n                          <p className=\"font-medium\">{position.title}</p>\n                          <p className=\"text-sm text-muted-foreground\">{position.stance}</p>\n                          <p className=\"text-xs text-muted-foreground mt-1\">\n                            {t('source', 'Source')}: {position.source}\n                          </p>\n                        </div>\n                        {onCitationClick && (\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => onCitationClick('position', position.sourceId)}\n                          >\n                            <ExternalLink className=\"h-4 w-4\" />\n                          </Button>\n                        )}\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            </Section>\n          )}\n\n          {/* Active Commitments */}\n          {activeCommitments.length > 0 && (\n            <Section\n              icon={<CheckCircle className=\"h-5 w-5\" />}\n              title={t('sections.commitments', 'Active Commitments')}\n            >\n              <div className=\"space-y-3\">\n                {activeCommitments.map((commitment, index) => (\n                  <Card key={index} className=\"bg-muted/30\">\n                    <CardContent className=\"p-4\">\n                      <div className=\"flex items-start justify-between\">\n                        <div>\n                          <p className=\"text-sm\">{commitment.description}</p>\n                          <div className=\"flex items-center gap-2 mt-2\">\n                            <Badge variant=\"outline\">{commitment.status}</Badge>\n                            {commitment.deadline && (\n                              <span className=\"text-xs text-muted-foreground\">\n                                {t('deadline', 'Deadline')}: {commitment.deadline}\n                              </span>\n                            )}\n                          </div>\n                        </div>\n                        {onCitationClick && (\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => onCitationClick('commitment', commitment.sourceId)}\n                          >\n                            <ExternalLink className=\"h-4 w-4\" />\n                          </Button>\n                        )}\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            </Section>\n          )}\n\n          {/* Historical Context */}\n          {brief.historicalContext && (\n            <Section\n              icon={<History className=\"h-5 w-5\" />}\n              title={t('sections.historicalContext', 'Historical Context')}\n            >\n              <p className=\"text-muted-foreground whitespace-pre-wrap\">{brief.historicalContext}</p>\n            </Section>\n          )}\n\n          {/* Talking Points */}\n          {talkingPoints.length > 0 && (\n            <Section\n              icon={<MessageSquare className=\"h-5 w-5\" />}\n              title={t('sections.talkingPoints', 'Talking Points')}\n            >\n              <ul className=\"space-y-2\">\n                {talkingPoints.map((point, index) => (\n                  <li key={index} className=\"flex items-start gap-2\">\n                    <span className=\"w-6 h-6 rounded-full bg-primary/10 flex items-center justify-center shrink-0 text-xs font-medium\">\n                      {index + 1}\n                    </span>\n                    <span className=\"text-muted-foreground\">{point}</span>\n                  </li>\n                ))}\n              </ul>\n            </Section>\n          )}\n\n          {/* Recommendations */}\n          {brief.recommendations && (\n            <Section\n              icon={<Lightbulb className=\"h-5 w-5\" />}\n              title={t('sections.recommendations', 'Recommendations')}\n            >\n              <p className=\"text-muted-foreground whitespace-pre-wrap\">{brief.recommendations}</p>\n            </Section>\n          )}\n\n          {/* Citations */}\n          {citations.length > 0 && (\n            <Section\n              icon={<ExternalLink className=\"h-5 w-5\" />}\n              title={t('sections.citations', 'Sources & Citations')}\n            >\n              <div className=\"space-y-2\">\n                {citations.map((citation, index) => (\n                  <div\n                    key={index}\n                    className=\"flex items-center justify-between p-2 rounded-md hover:bg-muted/50 cursor-pointer\"\n                    onClick={() => onCitationClick?.(citation.type, citation.id)}\n                  >\n                    <div className=\"flex items-center gap-2\">\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        {citation.type}\n                      </Badge>\n                      <span className=\"text-sm\">{citation.title}</span>\n                    </div>\n                    <ExternalLink className=\"h-4 w-4 text-muted-foreground\" />\n                  </div>\n                ))}\n              </div>\n            </Section>\n          )}\n        </div>\n      </ScrollArea>\n    </div>\n  )\n}\n\ninterface SectionProps {\n  icon: React.ReactNode\n  title: string\n  children: React.ReactNode\n}\n\nfunction Section({ icon, title, children }: SectionProps) {\n  return (\n    <Card>\n      <CardHeader className=\"pb-3\">\n        <CardTitle className=\"flex items-center gap-2 text-lg\">\n          {icon}\n          {title}\n        </CardTitle>\n      </CardHeader>\n      <CardContent>{children}</CardContent>\n    </Card>\n  )\n}\n\nexport default BriefViewer\n","import { useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { useQuery, useQueryClient } from '@tanstack/react-query'\nimport { Plus, FileText, Calendar, User, Eye, Download, Sparkles } from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Input } from '@/components/ui/input'\nimport { DataTable } from '@/components/Table/DataTable'\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from '@/components/ui/dialog'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select'\nimport { supabase } from '@/lib/supabase'\nimport { cn } from '@/lib/utils'\nimport { format } from 'date-fns'\nimport { BriefGenerationPanel } from '@/components/ai/BriefGenerationPanel'\nimport { BriefViewer } from '@/components/ai/BriefViewer'\nimport type { BriefContent } from '@/hooks/useGenerateBrief'\nimport { useToast } from '@/hooks/use-toast'\n\ninterface Brief {\n  id: string\n  reference_number: string\n  title_en: string\n  title_ar: string\n  summary_en: string\n  summary_ar: string\n  category: string\n  tags: string[]\n  is_published: boolean\n  published_date: string | null\n  created_at: string\n  author: {\n    full_name: string\n  }\n  related_country: {\n    name_en: string\n    name_ar: string\n  } | null\n  related_organization: {\n    name_en: string\n    name_ar: string\n  } | null\n  related_event: null\n}\n\ntype BriefRow = {\n  id: string\n  reference_number?: string | null\n  title?: string | null\n  title_en?: string | null\n  title_ar?: string | null\n  summary?: string | null\n  summary_en?: string | null\n  summary_ar?: string | null\n  status?: string | null\n  is_published?: boolean | null\n  created_at?: string | null\n  createdAt?: string | null\n  published_date?: string | null\n  published_at?: string | null\n  category?: string | null\n  tags?: string[] | null\n  author?: {\n    full_name?: string | null\n  } | null\n  author_name?: string | null\n  created_by?: string | null\n}\n\nexport function BriefsPage() {\n  const { t, i18n } = useTranslation()\n  const [searchTerm, setSearchTerm] = useState('')\n  const [filterStatus, setFilterStatus] = useState<'all' | 'published' | 'draft'>('all')\n  const [showGenerateDialog, setShowGenerateDialog] = useState(false)\n  const [selectedDossier, setSelectedDossier] = useState<string>('')\n  const [briefViewerOpen, setBriefViewerOpen] = useState(false)\n  const [generatedBrief, setGeneratedBrief] = useState<BriefContent | null>(null)\n  const isRTL = i18n.language === 'ar'\n  const { toast } = useToast()\n  const queryClient = useQueryClient()\n\n  // Fetch dossiers for selection\n  const { data: dossiers } = useQuery({\n    queryKey: ['dossiers-for-brief'],\n    queryFn: async () => {\n      const { data, error } = await supabase\n        .from('dossiers')\n        .select('id, name_en, name_ar')\n        .eq('is_active', true)\n        .order('name_en')\n        .limit(100)\n      if (error) throw error\n      return data || []\n    },\n  })\n\n  const { data: briefs, isLoading } = useQuery({\n    queryKey: ['briefs', searchTerm, filterStatus],\n    queryFn: async () => {\n      // Fetch from both briefs and ai_briefs tables\n      const [briefsResult, aiBriefsResult] = await Promise.all([\n        supabase.from('briefs').select('*').order('created_at', { ascending: false }),\n        supabase\n          .from('ai_briefs')\n          .select('*')\n          .eq('status', 'completed')\n          .order('created_at', { ascending: false }),\n      ])\n\n      if (briefsResult.error) {\n        console.error('Failed to load briefs', briefsResult.error)\n      }\n      if (aiBriefsResult.error) {\n        console.error('Failed to load AI briefs', aiBriefsResult.error)\n      }\n\n      // Normalize regular briefs\n      const normalizedBriefs =\n        (briefsResult.data as BriefRow[] | null)?.map((raw) => {\n          const title = raw.title_en ?? raw.title ?? 'Untitled brief'\n          const summary = raw.summary_en ?? raw.summary ?? ''\n          const status: string = raw.status ?? (raw.is_published ? 'published' : 'draft')\n          const isPublished = raw.is_published ?? status === 'published'\n          const createdAt = raw.created_at ?? raw.createdAt ?? new Date().toISOString()\n          const publishedDate =\n            raw.published_date ?? raw.published_at ?? (isPublished ? createdAt : null)\n\n          return {\n            id: raw.id,\n            reference_number: raw.reference_number\n              ? String(raw.reference_number)\n              : `BRF-${String(raw.id ?? '')\n                  .replace(/-/g, '')\n                  .slice(0, 8)\n                  .toUpperCase()}`,\n            title_en: title,\n            title_ar: raw.title_ar ?? title,\n            summary_en: summary,\n            summary_ar: raw.summary_ar ?? summary,\n            category: raw.category ?? 'other',\n            tags: Array.isArray(raw.tags) ? raw.tags : [],\n            is_published: Boolean(isPublished),\n            published_date: publishedDate,\n            created_at: createdAt,\n            author: {\n              full_name: raw.author?.full_name ?? raw.author_name ?? raw.created_by ?? '',\n            },\n            related_country: null,\n            related_organization: null,\n            related_event: null,\n            isAiBrief: false,\n          } satisfies Brief & { isAiBrief: boolean }\n        }) ?? []\n\n      // Normalize AI briefs\n      const normalizedAiBriefs =\n        (\n          aiBriefsResult.data as Array<{\n            id: string\n            title: string | null\n            executive_summary: string | null\n            status: string\n            created_at: string\n            completed_at: string | null\n            created_by: string | null\n          }> | null\n        )?.map((raw) => ({\n          id: raw.id,\n          reference_number: `AI-${String(raw.id).replace(/-/g, '').slice(0, 8).toUpperCase()}`,\n          title_en: raw.title ?? 'AI Generated Brief',\n          title_ar: raw.title ?? 'AI Generated Brief',\n          summary_en: raw.executive_summary?.slice(0, 200) ?? '',\n          summary_ar: raw.executive_summary?.slice(0, 200) ?? '',\n          category: 'ai-generated',\n          tags: ['AI'] as string[],\n          is_published: raw.status === 'completed',\n          published_date: raw.completed_at,\n          created_at: raw.created_at,\n          author: {\n            full_name: 'AI Assistant',\n          },\n          related_country: null,\n          related_organization: null,\n          related_event: null,\n          isAiBrief: true,\n        })) ?? []\n\n      // Combine and sort by created_at\n      const allBriefs = [...normalizedBriefs, ...normalizedAiBriefs].sort(\n        (a, b) => new Date(b.created_at).getTime() - new Date(a.created_at).getTime(),\n      )\n\n      return allBriefs.filter((brief) => {\n        const matchesStatus =\n          filterStatus === 'all'\n            ? true\n            : filterStatus === 'published'\n              ? brief.is_published\n              : !brief.is_published\n\n        const matchesSearch = searchTerm\n          ? [\n              brief.reference_number,\n              brief.title_en,\n              brief.title_ar,\n              brief.summary_en,\n              brief.summary_ar,\n            ]\n              .filter(Boolean)\n              .some((value) => value.toLowerCase().includes(searchTerm.toLowerCase()))\n          : true\n\n        return matchesStatus && matchesSearch\n      })\n    },\n  })\n\n  const columns = [\n    {\n      id: 'reference',\n      accessorKey: 'reference_number',\n      header: t('briefs.referenceNumber'),\n      size: 110,\n      cell: ({ row }: { row: { original: Brief & { isAiBrief?: boolean } } }) => {\n        const brief = row.original\n        return (\n          <div className=\"flex flex-col gap-0.5\">\n            <span className=\"font-mono text-xs\">{brief.reference_number}</span>\n            {brief.isAiBrief && (\n              <span className=\"inline-flex items-center gap-0.5 w-fit px-1 py-0.5 rounded text-[10px] font-medium bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300\">\n                <Sparkles className=\"h-2.5 w-2.5\" />\n                AI\n              </span>\n            )}\n          </div>\n        )\n      },\n    },\n    {\n      id: 'title',\n      accessorKey: 'title_en',\n      header: t('briefs.title'),\n      size: 400,\n      cell: ({ row }: { row: { original: Brief } }) => {\n        const brief = row.original\n        return (\n          <div className={cn('w-full min-w-0 overflow-hidden', isRTL ? 'text-end' : 'text-start')}>\n            <div className=\"font-medium text-sm whitespace-nowrap overflow-hidden text-ellipsis\">\n              {isRTL ? brief.title_ar : brief.title_en}\n            </div>\n            <div className=\"text-xs text-muted-foreground whitespace-nowrap overflow-hidden text-ellipsis\">\n              {isRTL ? brief.summary_ar : brief.summary_en}\n            </div>\n          </div>\n        )\n      },\n    },\n    {\n      id: 'status',\n      accessorKey: 'is_published',\n      header: t('briefs.status'),\n      size: 100,\n      cell: ({ row }: { row: { original: Brief } }) => {\n        const brief = row.original\n        return (\n          <div className=\"flex flex-col gap-0.5\">\n            {brief.is_published ? (\n              <>\n                <span className=\"inline-flex items-center gap-1 text-xs text-green-600\">\n                  <Eye className=\"h-3 w-3\" />\n                  {t('briefs.published')}\n                </span>\n                {brief.published_date && (\n                  <span className=\"text-[10px] text-muted-foreground\">\n                    {format(new Date(brief.published_date), 'dd MMM yy')}\n                  </span>\n                )}\n              </>\n            ) : (\n              <span className=\"inline-flex items-center gap-1 text-xs text-muted-foreground\">\n                <FileText className=\"h-3 w-3\" />\n                {t('briefs.draft')}\n              </span>\n            )}\n          </div>\n        )\n      },\n    },\n    {\n      id: 'actions',\n      header: '',\n      size: 70,\n      cell: ({ row }: { row: { original: Brief & { isAiBrief?: boolean } } }) => {\n        const brief = row.original\n        return (\n          <div className=\"flex items-center gap-0.5\">\n            <Button\n              size=\"icon\"\n              variant=\"ghost\"\n              className=\"h-7 w-7\"\n              onClick={async (e) => {\n                e.stopPropagation()\n                if (brief.isAiBrief) {\n                  try {\n                    const {\n                      data: { session },\n                    } = await supabase.auth.getSession()\n                    if (!session?.access_token) return\n                    const API_BASE = import.meta.env.VITE_API_URL || '/api'\n                    const response = await fetch(`${API_BASE}/ai/briefs/${brief.id}`, {\n                      headers: { Authorization: `Bearer ${session.access_token}` },\n                    })\n                    if (response.ok) {\n                      const data = await response.json()\n                      setGeneratedBrief(data.data)\n                      setBriefViewerOpen(true)\n                    }\n                  } catch (err) {\n                    console.error('Failed to fetch brief:', err)\n                  }\n                }\n              }}\n              title={t('common.view')}\n            >\n              <Eye className=\"h-3.5 w-3.5\" />\n            </Button>\n            <Button\n              size=\"icon\"\n              variant=\"ghost\"\n              className=\"h-7 w-7\"\n              onClick={(e) => {\n                e.stopPropagation()\n                const blob = new Blob([JSON.stringify(brief, null, 2)], {\n                  type: 'application/json',\n                })\n                const url = URL.createObjectURL(blob)\n                const a = document.createElement('a')\n                a.href = url\n                a.download = `brief-${brief.reference_number}.json`\n                a.click()\n                URL.revokeObjectURL(url)\n              }}\n              title={t('common.download')}\n            >\n              <Download className=\"h-3.5 w-3.5\" />\n            </Button>\n          </div>\n        )\n      },\n    },\n  ]\n\n  return (\n    <div className=\"container mx-auto py-6\">\n      <div className=\"flex justify-between items-center mb-6\">\n        <h1 className=\"text-3xl font-bold\">{t('navigation.briefs')}</h1>\n        <Button onClick={() => setShowGenerateDialog(true)}>\n          <Plus className=\"h-4 w-4 me-2\" />\n          {t('briefs.generateBrief')}\n        </Button>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-4 mb-6\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">{t('briefs.totalBriefs')}</CardTitle>\n            <FileText className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{briefs?.length || 0}</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">{t('briefs.published')}</CardTitle>\n            <Eye className=\"h-4 w-4 text-green-600\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {briefs?.filter((b) => b.is_published).length || 0}\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">{t('briefs.drafts')}</CardTitle>\n            <FileText className=\"h-4 w-4 text-gray-400\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {briefs?.filter((b) => !b.is_published).length || 0}\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">{t('briefs.thisMonth')}</CardTitle>\n            <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {briefs?.filter((b) => {\n                const briefDate = new Date(b.published_date || b.created_at)\n                const now = new Date()\n                return (\n                  briefDate.getMonth() === now.getMonth() &&\n                  briefDate.getFullYear() === now.getFullYear()\n                )\n              }).length || 0}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card className=\"mb-6\">\n        <CardHeader>\n          <CardTitle>{t('common.filter')}</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            <Input\n              placeholder={t('common.search')}\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"max-w-sm\"\n            />\n            <div className=\"flex gap-2\">\n              <span className=\"text-sm text-muted-foreground mt-2\">{t('briefs.status')}:</span>\n              <Button\n                variant={filterStatus === 'all' ? 'default' : 'outline'}\n                size=\"sm\"\n                onClick={() => setFilterStatus('all')}\n              >\n                {t('common.all')}\n              </Button>\n              <Button\n                variant={filterStatus === 'published' ? 'default' : 'outline'}\n                size=\"sm\"\n                onClick={() => setFilterStatus('published')}\n              >\n                {t('briefs.published')}\n              </Button>\n              <Button\n                variant={filterStatus === 'draft' ? 'default' : 'outline'}\n                size=\"sm\"\n                onClick={() => setFilterStatus('draft')}\n              >\n                {t('briefs.draft')}\n              </Button>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card className=\"min-w-0 overflow-hidden\">\n        <CardContent className=\"p-0\">\n          {isLoading ? (\n            <div className=\"p-8 text-center\">{t('common.loading')}</div>\n          ) : briefs && briefs.length > 0 ? (\n            <DataTable\n              data={briefs}\n              columns={columns}\n              enableFiltering={false}\n              enableColumnVisibility={false}\n              pageSize={10}\n              onRowClick={(_brief) => {\n                /* TODO: Navigate to brief detail */\n              }}\n            />\n          ) : (\n            <div className=\"p-8 text-center text-muted-foreground\">{t('common.noData')}</div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Generate Brief Dialog */}\n      <Dialog open={showGenerateDialog} onOpenChange={setShowGenerateDialog}>\n        <DialogContent className=\"sm:max-w-lg\" dir={isRTL ? 'rtl' : 'ltr'}>\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <Sparkles className={`h-5 w-5 text-primary ${isRTL ? 'rotate-180' : ''}`} />\n              {t('briefs.generateBrief')}\n            </DialogTitle>\n            <DialogDescription>\n              {t('briefs.generateDescription', 'Select a dossier to generate an AI-powered brief.')}\n            </DialogDescription>\n          </DialogHeader>\n\n          {/* Dossier selection */}\n          <div className=\"space-y-2 py-2\">\n            <label className=\"text-sm font-medium\">\n              {t('briefs.selectDossier', 'Select Dossier')}\n            </label>\n            <Select value={selectedDossier} onValueChange={setSelectedDossier}>\n              <SelectTrigger>\n                <SelectValue placeholder={t('briefs.chooseDossier', 'Choose a dossier...')} />\n              </SelectTrigger>\n              <SelectContent>\n                {dossiers?.map((dossier) => (\n                  <SelectItem key={dossier.id} value={dossier.id}>\n                    {isRTL ? dossier.name_ar : dossier.name_en}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          {/* Brief Generation Panel - only show when dossier is selected */}\n          {selectedDossier && (\n            <BriefGenerationPanel\n              dossierId={selectedDossier}\n              onBriefGenerated={async (briefId) => {\n                // Fetch the generated brief\n                try {\n                  const {\n                    data: { session },\n                  } = await supabase.auth.getSession()\n                  if (!session?.access_token) return\n\n                  const API_BASE = import.meta.env.VITE_API_URL || '/api'\n                  const response = await fetch(`${API_BASE}/ai/briefs/${briefId}`, {\n                    headers: { Authorization: `Bearer ${session.access_token}` },\n                  })\n                  if (response.ok) {\n                    const data = await response.json()\n                    setGeneratedBrief(data.data)\n                    setShowGenerateDialog(false)\n                    setBriefViewerOpen(true)\n                    // Invalidate briefs query to refresh the list\n                    queryClient.invalidateQueries({ queryKey: ['briefs'] })\n                    toast({\n                      title: t('briefs.generationComplete', 'Brief generated'),\n                      description: t(\n                        'briefs.generationCompleteDesc',\n                        'Your brief is ready to view.',\n                      ),\n                    })\n                  }\n                } catch (err) {\n                  console.error('Failed to fetch brief:', err)\n                }\n              }}\n              onClose={() => {\n                setShowGenerateDialog(false)\n                setSelectedDossier('')\n              }}\n              className=\"border-0 shadow-none p-0\"\n            />\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* Brief Viewer Dialog */}\n      <Dialog open={briefViewerOpen} onOpenChange={setBriefViewerOpen}>\n        <DialogContent\n          className=\"sm:max-w-4xl max-h-[90vh] overflow-hidden\"\n          dir={isRTL ? 'rtl' : 'ltr'}\n        >\n          <DialogHeader className=\"sr-only\">\n            <DialogTitle>{t('briefs.viewBrief', 'View Brief')}</DialogTitle>\n            <DialogDescription>\n              {t('briefs.viewBriefDescription', 'AI-generated brief content')}\n            </DialogDescription>\n          </DialogHeader>\n          {generatedBrief && (\n            <BriefViewer\n              brief={generatedBrief}\n              onCitationClick={(type, id) => {\n                // Handle citation navigation\n                console.log('Citation clicked:', type, id)\n              }}\n            />\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  )\n}\n","import { createFileRoute } from '@tanstack/react-router'\nimport { BriefsPage } from '@/pages/briefs/BriefsPage'\n\nexport const Route = createFileRoute('/_protected/briefs')({\n component: BriefsPage\n})"],"names":["API_BASE","useGenerateBrief","token","setToken","useState","brief","setBrief","useEffect","session","supabase","subscription","_event","streamingContent","setStreamingContent","isGenerating","setIsGenerating","progress","setProgress","error","setError","abortControllerRef","useRef","lastParamsRef","generate","useCallback","params","currentToken","response","errorData","reader","decoder","content","briefId","done","value","lines","line","data","p","briefResponse","briefData","err","errorMessage","cancel","retry","reset","parseAIError","isRetryableError","code","detectErrorCode","message","lowerMessage","getErrorMessage","messages","getErrorAction","formatAIError","parsedError","BriefGenerationPanel","engagementId","dossierId","onBriefGenerated","onClose","className","t","i18n","useTranslation","isRTL","customPrompt","setCustomPrompt","showAdvanced","setShowAdvanced","phase","setPhase","manualContent","setManualContent","formattedError","handleGenerate","handleViewBrief","handleGenerateAnother","handleSwitchToManual","handleManualSubmit","getPhaseLabel","jsxs","Card","cn","CardHeader","jsx","Sparkles","CardTitle","Button","X","CardDescription","CardContent","StepIndicator","Loader2","Progress","Skeleton","Alert","AlertCircle","AlertTitle","AlertDescription","RefreshCw","PenLine","RotateCcw","CheckCircle","Eye","Fragment","Textarea","e","Label","step","label","active","complete","BriefViewer","onCitationClick","keyParticipants","relevantPositions","activeCommitments","talkingPoints","citations","handlePrint","handleCopy","text","i","handleExport","blob","url","a","statusColors","Badge","Copy","Printer","Download","ScrollArea","Section","FileText","History","Users","participant","index","Target","position","ExternalLink","commitment","MessageSquare","point","Lightbulb","citation","icon","title","children","BriefsPage","searchTerm","setSearchTerm","filterStatus","setFilterStatus","showGenerateDialog","setShowGenerateDialog","selectedDossier","setSelectedDossier","briefViewerOpen","setBriefViewerOpen","generatedBrief","setGeneratedBrief","toast","useToast","queryClient","useQueryClient","dossiers","useQuery","briefs","isLoading","briefsResult","aiBriefsResult","normalizedBriefs","raw","summary","status","isPublished","createdAt","publishedDate","normalizedAiBriefs","b","matchesStatus","matchesSearch","columns","row","format","Plus","Calendar","briefDate","now","Input","DataTable","_brief","Dialog","DialogContent","DialogHeader","DialogTitle","DialogDescription","Select","SelectTrigger","SelectValue","SelectContent","dossier","SelectItem","type","id","SplitComponent"],"mappings":"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"}