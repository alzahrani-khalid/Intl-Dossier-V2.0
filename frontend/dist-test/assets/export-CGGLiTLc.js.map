{"version":3,"file":"export-CGGLiTLc.js","sources":["../../src/components/export/ExportDialog.tsx","../../src/routes/_protected/export.tsx?tsr-split=component"],"sourcesContent":["import React, { useEffect, useState } from 'react'\n\ntype ExportStatus = {\n id: string\n status: 'pending' | 'processing' | 'completed' | 'failed'\n progress?: number\n download_url?: string\n file_size_bytes?: number\n error_message?: string\n}\n\nasync function postJSON<T>(url: string, body: any): Promise<T> {\n const res = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json', Authorization: 'Bearer test-auth-token' }, body: JSON.stringify(body) })\n if (!res.ok) throw new Error(`Failed ${res.status}`)\n return res.json() as Promise<T>\n}\n\nasync function getJSON<T>(url: string): Promise<T> {\n const res = await fetch(url, { headers: { Authorization: 'Bearer test-auth-token' } })\n if (!res.ok) throw new Error(`Failed ${res.status}`)\n return res.json() as Promise<T>\n}\n\nexport default function ExportDialog() {\n const [reqId, setReqId] = useState<string | null>(null)\n const [status, setStatus] = useState<ExportStatus | null>(null)\n const [format, setFormat] = useState<'csv' | 'json' | 'excel'>('csv')\n\n const startExport = async () => {\n const resp = await postJSON<{ id: string; status: string }>(`/export`, { resource_type: 'users', format })\n setReqId(resp.id)\n }\n\n useEffect(() => {\n if (!reqId) return\n let stop = false\n const tick = async () => {\n try {\n const s = await getJSON<ExportStatus>(`/export/${reqId}`)\n if (!stop) setStatus(s)\n if (s.status === 'completed' || s.status === 'failed') return\n setTimeout(tick, 1000)\n } catch {\n setTimeout(tick, 1500)\n }\n }\n tick()\n return () => {\n stop = true\n }\n }, [reqId])\n\n return (\n <div style={{ padding: 8 }}>\n <h3>Export Data</h3>\n <div style={{ display: 'flex', gap: 8, alignItems: 'center' }}>\n <select value={format} onChange={e => setFormat(e.target.value as any)}>\n <option value=\"csv\">CSV</option>\n <option value=\"json\">JSON</option>\n <option value=\"excel\">Excel</option>\n </select>\n <button onClick={startExport}>Start Export</button>\n </div>\n {status && (\n <div style={{ marginTop: 8 }}>\n <div>Status: {status.status}</div>\n {typeof status.progress === 'number' && <div>Progress: {status.progress}%</div>}\n {status.status === 'completed' && status.download_url && (\n <a href={`/export/${status.id}/download`} target=\"_blank\" rel=\"noreferrer\">Download</a>\n )}\n {status.status === 'failed' && <div>Error: {status.error_message}</div>}\n </div>\n )}\n </div>\n )\n}\n\n","import { createFileRoute } from '@tanstack/react-router'\nimport ExportDialog from '@/components/export/ExportDialog'\n\nexport const Route = createFileRoute('/_protected/export')({\n component: ExportDialog,\n})\n"],"names":["postJSON","url","body","res","getJSON","ExportDialog","reqId","setReqId","useState","status","setStatus","format","setFormat","startExport","resp","useEffect","stop","tick","s","jsx","jsxs","e","SplitComponent"],"mappings":"qKAWA,eAAeA,EAAYC,EAAaC,EAAuB,CAC9D,MAAMC,EAAM,MAAM,MAAMF,EAAK,CAAE,OAAQ,OAAQ,QAAS,CAAE,eAAgB,mBAAoB,cAAe,0BAA4B,KAAM,KAAK,UAAUC,CAAI,EAAG,EACrK,GAAI,CAACC,EAAI,GAAI,MAAM,IAAI,MAAM,UAAUA,EAAI,MAAM,EAAE,EACnD,OAAOA,EAAI,KAAA,CACZ,CAEA,eAAeC,EAAWH,EAAyB,CAClD,MAAME,EAAM,MAAM,MAAMF,EAAK,CAAE,QAAS,CAAE,cAAe,wBAAA,EAA4B,EACrF,GAAI,CAACE,EAAI,GAAI,MAAM,IAAI,MAAM,UAAUA,EAAI,MAAM,EAAE,EACnD,OAAOA,EAAI,KAAA,CACZ,CAEA,SAAwBE,GAAe,CACtC,KAAM,CAACC,EAAOC,CAAQ,EAAIC,EAAAA,SAAwB,IAAI,EAChD,CAACC,EAAQC,CAAS,EAAIF,EAAAA,SAA8B,IAAI,EACxD,CAACG,EAAQC,CAAS,EAAIJ,EAAAA,SAAmC,KAAK,EAE9DK,EAAc,SAAY,CAChC,MAAMC,EAAO,MAAMd,EAAyC,UAAW,CAAE,cAAe,QAAS,OAAAW,EAAQ,EACzGJ,EAASO,EAAK,EAAE,CAChB,EAEAC,OAAAA,EAAAA,UAAU,IAAM,CAChB,GAAI,CAACT,EAAO,OACZ,IAAIU,EAAO,GACX,MAAMC,EAAO,SAAY,CACzB,GAAI,CACJ,MAAMC,EAAI,MAAMd,EAAsB,WAAWE,CAAK,EAAE,EAExD,GADKU,GAAMN,EAAUQ,CAAC,EAClBA,EAAE,SAAW,aAAeA,EAAE,SAAW,SAAU,OACvD,WAAWD,EAAM,GAAI,CACrB,MAAQ,CACR,WAAWA,EAAM,IAAI,CACrB,CACA,EACA,OAAAA,EAAA,EACO,IAAM,CACbD,EAAO,EACP,CACA,EAAG,CAACV,CAAK,CAAC,SAGT,MAAA,CAAI,MAAO,CAAE,QAAS,GACvB,SAAA,CAAAa,EAAAA,IAAC,MAAG,SAAA,aAAA,CAAW,EACfC,EAAAA,KAAC,MAAA,CAAI,MAAO,CAAE,QAAS,OAAQ,IAAK,EAAG,WAAY,QAAA,EACnD,SAAA,CAAAA,EAAAA,KAAC,SAAA,CAAO,MAAOT,EAAQ,YAAeC,EAAUS,EAAE,OAAO,KAAY,EACrE,SAAA,CAAAF,EAAAA,IAAC,SAAA,CAAO,MAAM,MAAM,SAAA,MAAG,EACvBA,EAAAA,IAAC,SAAA,CAAO,MAAM,OAAO,SAAA,OAAI,EACzBA,EAAAA,IAAC,SAAA,CAAO,MAAM,QAAQ,SAAA,OAAA,CAAK,CAAA,EAC3B,EACAA,EAAAA,IAAC,SAAA,CAAO,QAASN,EAAa,SAAA,cAAA,CAAY,CAAA,EAC1C,EACCJ,GACDW,EAAAA,KAAC,MAAA,CAAI,MAAO,CAAE,UAAW,GACzB,SAAA,CAAAA,OAAC,MAAA,CAAI,SAAA,CAAA,WAASX,EAAO,MAAA,EAAO,EAC3B,OAAOA,EAAO,UAAa,iBAAa,MAAA,CAAI,SAAA,CAAA,aAAWA,EAAO,SAAS,GAAA,EAAC,EACxEA,EAAO,SAAW,aAAeA,EAAO,oBACxC,IAAA,CAAE,KAAM,WAAWA,EAAO,EAAE,YAAa,OAAO,SAAS,IAAI,aAAa,SAAA,WAAQ,EAElFA,EAAO,SAAW,UAAYW,EAAAA,KAAC,MAAA,CAAI,SAAA,CAAA,UAAQX,EAAO,aAAA,CAAA,CAAc,CAAA,CAAA,CACjE,CAAA,EAEA,CAED,CC1E2D,MAAAa,EAApDjB"}