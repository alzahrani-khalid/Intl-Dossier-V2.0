{"version":3,"file":"status-transitions-DP8l_VWt.js","sources":["../../src/components/unified-kanban/utils/column-definitions.ts","../../src/hooks/useUnifiedKanban.ts","../../src/components/ui/kanban.tsx","../../src/components/ui/toggle.tsx","../../src/components/ui/toggle-group.tsx","../../src/components/unified-kanban/UnifiedKanbanHeader.tsx","../../src/components/unified-kanban/UnifiedKanbanCard.tsx","../../src/components/unified-kanban/utils/status-transitions.ts"],"sourcesContent":["/**\n * Column Definitions for Unified Kanban Board\n * Feature: 034-unified-kanban\n *\n * Defines column configurations for each column mode:\n * - Status mode: Groups by workflow status\n * - Priority mode: Groups by priority level\n * - Tracking Type mode: Groups by tracking type\n */\n\nimport type { KanbanColumn, KanbanColumnMode, WorkSource } from '@/types/work-item.types'\n\n// ============================================\n// Status Mode Columns\n// ============================================\n\nexport const STATUS_COLUMNS: KanbanColumn[] = [\n  {\n    key: 'todo',\n    title: 'To Do',\n    titleAr: 'للتنفيذ',\n    color: 'text-slate-600',\n    bgColor: 'bg-slate-100',\n    sortOrder: 1,\n  },\n  {\n    key: 'in_progress',\n    title: 'In Progress',\n    titleAr: 'قيد التنفيذ',\n    color: 'text-blue-600',\n    bgColor: 'bg-blue-50',\n    sortOrder: 2,\n  },\n  {\n    key: 'review',\n    title: 'Review',\n    titleAr: 'مراجعة',\n    color: 'text-purple-600',\n    bgColor: 'bg-purple-50',\n    sortOrder: 3,\n    allowedSources: ['task'],\n  },\n  {\n    key: 'done',\n    title: 'Done',\n    titleAr: 'مكتمل',\n    color: 'text-green-600',\n    bgColor: 'bg-green-50',\n    sortOrder: 4,\n  },\n  {\n    key: 'cancelled',\n    title: 'Cancelled',\n    titleAr: 'ملغى',\n    color: 'text-red-600',\n    bgColor: 'bg-red-50',\n    sortOrder: 5,\n  },\n]\n\n// ============================================\n// Priority Mode Columns\n// ============================================\n\nexport const PRIORITY_COLUMNS: KanbanColumn[] = [\n  {\n    key: 'urgent',\n    title: 'Urgent',\n    titleAr: 'عاجل',\n    color: 'text-red-600',\n    bgColor: 'bg-red-50',\n    sortOrder: 1,\n  },\n  {\n    key: 'high',\n    title: 'High',\n    titleAr: 'عالي',\n    color: 'text-orange-600',\n    bgColor: 'bg-orange-50',\n    sortOrder: 2,\n  },\n  {\n    key: 'medium',\n    title: 'Medium',\n    titleAr: 'متوسط',\n    color: 'text-yellow-600',\n    bgColor: 'bg-yellow-50',\n    sortOrder: 3,\n  },\n  {\n    key: 'low',\n    title: 'Low',\n    titleAr: 'منخفض',\n    color: 'text-slate-600',\n    bgColor: 'bg-slate-50',\n    sortOrder: 4,\n  },\n]\n\n// ============================================\n// Tracking Type Mode Columns\n// ============================================\n\nexport const TRACKING_TYPE_COLUMNS: KanbanColumn[] = [\n  {\n    key: 'delivery',\n    title: 'Delivery',\n    titleAr: 'تسليم',\n    color: 'text-blue-600',\n    bgColor: 'bg-blue-50',\n    sortOrder: 1,\n  },\n  {\n    key: 'follow_up',\n    title: 'Follow-up',\n    titleAr: 'متابعة',\n    color: 'text-purple-600',\n    bgColor: 'bg-purple-50',\n    sortOrder: 2,\n  },\n  {\n    key: 'sla',\n    title: 'SLA',\n    titleAr: 'اتفاقية الخدمة',\n    color: 'text-amber-600',\n    bgColor: 'bg-amber-50',\n    sortOrder: 3,\n  },\n]\n\n// ============================================\n// Column Retrieval Functions\n// ============================================\n\n/**\n * Get columns for a specific mode\n */\nexport function getColumnsForMode(mode: KanbanColumnMode): KanbanColumn[] {\n  switch (mode) {\n    case 'status':\n      return STATUS_COLUMNS\n    case 'priority':\n      return PRIORITY_COLUMNS\n    case 'tracking_type':\n      return TRACKING_TYPE_COLUMNS\n    default:\n      return STATUS_COLUMNS\n  }\n}\n\n/**\n * Get column order (keys) for a specific mode\n * Optionally reverse for RTL\n */\nexport function getColumnOrder(mode: KanbanColumnMode, isRTL = false): string[] {\n  const columns = getColumnsForMode(mode)\n  const order = columns.sort((a, b) => a.sortOrder - b.sortOrder).map((c) => c.key)\n  return isRTL ? [...order].reverse() : order\n}\n\n/**\n * Get a specific column by key\n */\nexport function getColumnByKey(mode: KanbanColumnMode, key: string): KanbanColumn | undefined {\n  return getColumnsForMode(mode).find((c) => c.key === key)\n}\n\n/**\n * Check if a source can appear in a column\n */\nexport function canSourceAppearInColumn(\n  source: WorkSource,\n  columnKey: string,\n  mode: KanbanColumnMode,\n): boolean {\n  const column = getColumnByKey(mode, columnKey)\n  if (!column) return false\n\n  // If no allowedSources specified, all sources are allowed\n  if (!column.allowedSources) return true\n\n  return column.allowedSources.includes(source)\n}\n\n// ============================================\n// Status Mapping Functions\n// ============================================\n\n/**\n * Map source-specific status to unified column key\n */\nexport function mapStatusToColumnKey(\n  source: WorkSource,\n  status: string,\n  workflowStage?: string | null,\n): string {\n  // For tasks, use workflow_stage if available\n  if (source === 'task' && workflowStage) {\n    // Map 'pending' workflow stage to 'todo'\n    if (workflowStage === 'pending') return 'todo'\n    return workflowStage\n  }\n\n  // Map commitment/intake statuses to column keys\n  switch (status) {\n    case 'pending':\n    case 'todo':\n      return 'todo'\n    case 'in_progress':\n      return 'in_progress'\n    case 'completed':\n    case 'resolved':\n    case 'closed':\n    case 'done':\n      return 'done'\n    case 'cancelled':\n      return 'cancelled'\n    case 'review':\n      return 'review'\n    default:\n      return 'todo'\n  }\n}\n\n/**\n * Map column key back to source-specific status\n */\nexport function mapColumnKeyToStatus(\n  source: WorkSource,\n  columnKey: string,\n): { status: string; workflowStage?: string } {\n  if (source === 'task') {\n    // Tasks use workflow_stage directly\n    return {\n      status:\n        columnKey === 'done'\n          ? 'completed'\n          : columnKey === 'cancelled'\n            ? 'cancelled'\n            : 'in_progress',\n      workflowStage: columnKey,\n    }\n  }\n\n  if (source === 'commitment') {\n    // Commitments: pending, in_progress, completed, cancelled\n    switch (columnKey) {\n      case 'todo':\n        return { status: 'pending' }\n      case 'in_progress':\n        return { status: 'in_progress' }\n      case 'done':\n        return { status: 'completed' }\n      case 'cancelled':\n        return { status: 'cancelled' }\n      default:\n        return { status: 'pending' }\n    }\n  }\n\n  if (source === 'intake') {\n    // Intake: pending, in_progress, resolved, closed\n    switch (columnKey) {\n      case 'todo':\n        return { status: 'pending' }\n      case 'in_progress':\n        return { status: 'in_progress' }\n      case 'done':\n        return { status: 'resolved' }\n      case 'cancelled':\n        return { status: 'closed' }\n      default:\n        return { status: 'pending' }\n    }\n  }\n\n  return { status: columnKey }\n}\n\n// ============================================\n// Visual Helpers\n// ============================================\n\n/**\n * Get badge color classes for a source type\n */\nexport function getSourceBadgeColors(source: WorkSource): { bg: string; text: string } {\n  switch (source) {\n    case 'task':\n      return { bg: 'bg-blue-100', text: 'text-blue-700' }\n    case 'commitment':\n      return { bg: 'bg-purple-100', text: 'text-purple-700' }\n    case 'intake':\n      return { bg: 'bg-amber-100', text: 'text-amber-700' }\n    default:\n      return { bg: 'bg-slate-100', text: 'text-slate-700' }\n  }\n}\n\n/**\n * Get priority indicator color\n */\nexport function getPriorityColor(priority: string): string {\n  switch (priority) {\n    case 'urgent':\n      return 'bg-red-500'\n    case 'high':\n      return 'bg-orange-500'\n    case 'medium':\n      return 'bg-yellow-500'\n    case 'low':\n      return 'bg-slate-400'\n    default:\n      return 'bg-slate-300'\n  }\n}\n","/**\n * useUnifiedKanban - Hook for fetching and managing Kanban data\n * Feature: 034-unified-kanban\n *\n * Provides:\n * - Fetch work items grouped by column\n * - Status update mutations with optimistic updates\n * - Real-time subscriptions\n */\n\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\nimport { useCallback, useEffect, useMemo } from 'react'\nimport { supabase } from '@/lib/supabase'\nimport { useToast } from '@/hooks/use-toast'\nimport { mapStatusToColumnKey } from '@/components/unified-kanban/utils/column-definitions'\nimport type {\n  KanbanContextType,\n  KanbanColumnMode,\n  WorkSource,\n  WorkItem,\n  WorkItemAssignee,\n  KanbanData,\n} from '@/types/work-item.types'\n\n// ============================================\n// Types\n// ============================================\n\ninterface UseUnifiedKanbanOptions {\n  contextType: KanbanContextType\n  contextId?: string\n  columnMode?: KanbanColumnMode\n  sourceFilter?: WorkSource[]\n  limitPerColumn?: number\n  enabled?: boolean\n}\n\ninterface KanbanRpcRow {\n  id: string\n  source: string\n  title: string\n  title_ar: string | null\n  description: string | null\n  priority: string\n  status: string\n  workflow_stage: string | null\n  column_key: string\n  tracking_type: string\n  deadline: string | null\n  is_overdue: boolean\n  days_until_due: number | null\n  assignee_id: string | null\n  assignee_name: string | null\n  assignee_avatar_url: string | null\n  dossier_id: string | null\n  engagement_id: string | null\n  created_at: string\n  updated_at: string\n  metadata: Record<string, unknown>\n}\n\n// ============================================\n// Query Keys\n// ============================================\n\nexport const kanbanKeys = {\n  all: ['unified-kanban'] as const,\n  list: (params: UseUnifiedKanbanOptions) => [...kanbanKeys.all, 'list', params] as const,\n}\n\n// ============================================\n// Data Transformation\n// ============================================\n\nfunction transformRpcRowToWorkItem(row: KanbanRpcRow): WorkItem {\n  const assignee: WorkItemAssignee | null = row.assignee_id\n    ? {\n        id: row.assignee_id,\n        name: row.assignee_name || 'Unknown',\n        avatar_url: row.assignee_avatar_url,\n      }\n    : null\n\n  return {\n    id: row.id,\n    source: row.source as WorkSource,\n    title: row.title,\n    title_ar: row.title_ar || undefined,\n    description: row.description,\n    priority: row.priority as WorkItem['priority'],\n    status: row.status as WorkItem['status'],\n    workflow_stage: row.workflow_stage as WorkItem['workflow_stage'],\n    column_key: row.column_key,\n    tracking_type: row.tracking_type as WorkItem['tracking_type'],\n    deadline: row.deadline,\n    is_overdue: row.is_overdue,\n    days_until_due: row.days_until_due,\n    assignee,\n    dossier_id: row.dossier_id,\n    engagement_id: row.engagement_id,\n    created_at: row.created_at,\n    updated_at: row.updated_at,\n    metadata: row.metadata as WorkItem['metadata'],\n  }\n}\n\nfunction groupItemsByColumn(items: WorkItem[]): Record<string, WorkItem[]> {\n  const grouped: Record<string, WorkItem[]> = {}\n\n  items.forEach((item) => {\n    const key = item.column_key\n    if (!grouped[key]) {\n      grouped[key] = []\n    }\n    grouped[key].push(item)\n  })\n\n  return grouped\n}\n\n// ============================================\n// Main Hook\n// ============================================\n\nexport function useUnifiedKanban(options: UseUnifiedKanbanOptions) {\n  const {\n    contextType,\n    contextId,\n    columnMode = 'status',\n    sourceFilter,\n    limitPerColumn = 50,\n    enabled = true,\n  } = options\n\n  const queryClient = useQueryClient()\n  const { toast } = useToast()\n\n  // Fetch kanban data\n  const query = useQuery({\n    queryKey: kanbanKeys.list(options),\n    queryFn: async (): Promise<KanbanData> => {\n      const { data, error } = await supabase.rpc('get_unified_work_kanban', {\n        p_context_type: contextType,\n        p_context_id: contextId || null,\n        p_column_mode: columnMode,\n        p_source_filter: sourceFilter?.length ? sourceFilter : null,\n        p_limit_per_column: limitPerColumn,\n      })\n\n      if (error) {\n        throw new Error(error.message)\n      }\n\n      const items = (data as KanbanRpcRow[]).map(transformRpcRowToWorkItem)\n      const columns = groupItemsByColumn(items)\n\n      // Get unique column keys and sort them\n      const columnOrder = [...new Set(items.map((i) => i.column_key))]\n\n      return {\n        columns,\n        columnOrder,\n        totalCount: items.length,\n        hasMore: {}, // TODO: Implement per-column pagination\n      }\n    },\n    enabled,\n    staleTime: 30 * 1000, // 30 seconds\n    refetchOnWindowFocus: true,\n  })\n\n  // Flatten items for easier access\n  const allItems = useMemo(() => {\n    if (!query.data?.columns) return []\n    return Object.values(query.data.columns).flat()\n  }, [query.data?.columns])\n\n  return {\n    ...query,\n    items: allItems,\n    columns: query.data?.columns || {},\n    columnOrder: query.data?.columnOrder || [],\n    totalCount: query.data?.totalCount || 0,\n  }\n}\n\n// ============================================\n// Status Update Mutation Hook\n// ============================================\n\ninterface StatusUpdateParams {\n  itemId: string\n  source: WorkSource\n  newStatus: string\n  newWorkflowStage?: string\n}\n\nexport function useUnifiedKanbanStatusUpdate() {\n  const queryClient = useQueryClient()\n  const { toast } = useToast()\n\n  return useMutation({\n    mutationFn: async ({ itemId, source, newStatus, newWorkflowStage }: StatusUpdateParams) => {\n      // Update based on source type\n      if (source === 'task') {\n        const { data, error } = await supabase\n          .from('tasks')\n          .update({\n            status: newStatus,\n            workflow_stage: newWorkflowStage,\n            updated_at: new Date().toISOString(),\n          })\n          .eq('id', itemId)\n          .select()\n          .single()\n\n        if (error) throw error\n        return data\n      }\n\n      if (source === 'commitment') {\n        const { data, error } = await supabase\n          .from('aa_commitments')\n          .update({\n            status: newStatus,\n            updated_at: new Date().toISOString(),\n          })\n          .eq('id', itemId)\n          .select()\n          .single()\n\n        if (error) throw error\n        return data\n      }\n\n      if (source === 'intake') {\n        const { data, error } = await supabase\n          .from('intake_tickets')\n          .update({\n            status: newStatus,\n            updated_at: new Date().toISOString(),\n          })\n          .eq('id', itemId)\n          .select()\n          .single()\n\n        if (error) throw error\n        return data\n      }\n\n      throw new Error('Unknown source type')\n    },\n\n    onMutate: async (variables) => {\n      // Cancel outgoing refetches\n      await queryClient.cancelQueries({ queryKey: kanbanKeys.all })\n\n      // Snapshot previous state\n      const previousData = queryClient.getQueriesData({ queryKey: kanbanKeys.all })\n\n      // Optimistically update the cache\n      queryClient.setQueriesData({ queryKey: kanbanKeys.all }, (old: KanbanData | undefined) => {\n        if (!old) return old\n\n        // Find and update the item\n        const newColumns = { ...old.columns }\n\n        for (const columnKey of Object.keys(newColumns)) {\n          const columnItems = newColumns[columnKey]\n          const itemIndex = columnItems.findIndex((i) => i.id === variables.itemId)\n\n          if (itemIndex !== -1) {\n            // Remove from current column\n            const [item] = columnItems.splice(itemIndex, 1)\n\n            // Update item status\n            const updatedItem: WorkItem = {\n              ...item,\n              status: variables.newStatus as WorkItem['status'],\n              workflow_stage:\n                (variables.newWorkflowStage as WorkItem['workflow_stage']) || item.workflow_stage,\n              column_key: mapStatusToColumnKey(\n                item.source,\n                variables.newStatus,\n                variables.newWorkflowStage,\n              ),\n            }\n\n            // Add to new column\n            const newColumnKey = updatedItem.column_key\n            if (!newColumns[newColumnKey]) {\n              newColumns[newColumnKey] = []\n            }\n            newColumns[newColumnKey].push(updatedItem)\n\n            break\n          }\n        }\n\n        return {\n          ...old,\n          columns: newColumns,\n        }\n      })\n\n      return { previousData }\n    },\n\n    onError: (error, variables, context) => {\n      // Rollback on error\n      if (context?.previousData) {\n        context.previousData.forEach(([queryKey, data]) => {\n          queryClient.setQueryData(queryKey, data)\n        })\n      }\n\n      toast({\n        title: 'Failed to update status',\n        description: error instanceof Error ? error.message : 'Unknown error',\n        variant: 'destructive',\n      })\n    },\n\n    onSettled: () => {\n      // Refetch to ensure consistency\n      queryClient.invalidateQueries({ queryKey: kanbanKeys.all })\n    },\n  })\n}\n\n// ============================================\n// Realtime Subscription Hook\n// ============================================\n\nexport function useUnifiedKanbanRealtime(\n  contextType: KanbanContextType,\n  contextId: string | null,\n  userId: string,\n  enabled = true,\n) {\n  const queryClient = useQueryClient()\n\n  // Debounced invalidation\n  const invalidateWithDebounce = useCallback(() => {\n    // Use a simple debounce - invalidate after 300ms\n    const timeoutId = setTimeout(() => {\n      queryClient.invalidateQueries({ queryKey: kanbanKeys.all })\n    }, 300)\n\n    return () => clearTimeout(timeoutId)\n  }, [queryClient])\n\n  // Set up subscriptions using useEffect (not useCallback!)\n  useEffect(() => {\n    if (!enabled) return\n\n    const channels: ReturnType<typeof supabase.channel>[] = []\n\n    // Subscribe to tasks\n    const tasksChannel = supabase\n      .channel('kanban-tasks')\n      .on(\n        'postgres_changes',\n        {\n          event: '*',\n          schema: 'public',\n          table: 'tasks',\n          filter: contextType === 'personal' ? `assignee_id=eq.${userId}` : undefined,\n        },\n        invalidateWithDebounce,\n      )\n      .subscribe()\n\n    channels.push(tasksChannel)\n\n    // Subscribe to commitments (use owner_user_id, not owner_id)\n    const commitmentsChannel = supabase\n      .channel('kanban-commitments')\n      .on(\n        'postgres_changes',\n        {\n          event: '*',\n          schema: 'public',\n          table: 'aa_commitments',\n          filter: contextType === 'personal' ? `owner_user_id=eq.${userId}` : undefined,\n        },\n        invalidateWithDebounce,\n      )\n      .subscribe()\n\n    channels.push(commitmentsChannel)\n\n    // Subscribe to intake tickets\n    const intakeChannel = supabase\n      .channel('kanban-intake')\n      .on(\n        'postgres_changes',\n        {\n          event: '*',\n          schema: 'public',\n          table: 'intake_tickets',\n          filter: contextType === 'personal' ? `assigned_to=eq.${userId}` : undefined,\n        },\n        invalidateWithDebounce,\n      )\n      .subscribe()\n\n    channels.push(intakeChannel)\n\n    // Cleanup function\n    return () => {\n      channels.forEach((channel) => {\n        supabase.removeChannel(channel)\n      })\n    }\n  }, [contextType, contextId, userId, enabled, invalidateWithDebounce])\n}\n","'use client'\n\nimport type { ReactNode } from 'react'\nimport {\n  DndContext,\n  type DragEndEvent,\n  type DragOverEvent,\n  DragOverlay,\n  type DragStartEvent,\n  type UniqueIdentifier,\n  closestCorners,\n  KeyboardSensor,\n  PointerSensor,\n  TouchSensor,\n  useSensor,\n  useSensors,\n} from '@dnd-kit/core'\nimport {\n  arrayMove,\n  SortableContext,\n  sortableKeyboardCoordinates,\n  useSortable,\n  verticalListSortingStrategy,\n} from '@dnd-kit/sortable'\nimport { CSS } from '@dnd-kit/utilities'\nimport { forwardRef, useCallback, useState } from 'react'\nimport { cn } from '@/lib/utils'\n\n/* -------------------------------------------------------------------------------------------------\n * KanbanBoard\n * -----------------------------------------------------------------------------------------------*/\n\nexport type KanbanBoardProps<TData extends { id: UniqueIdentifier }> = {\n  id: UniqueIdentifier\n  children: ReactNode\n  data: TData[]\n  onDataChange?: (data: TData[]) => void\n  className?: string\n}\n\nexport const KanbanBoard = <TData extends { id: UniqueIdentifier }>({\n  children,\n  className,\n}: KanbanBoardProps<TData>) => {\n  return (\n    <div\n      className={cn(\n        'flex gap-4 overflow-x-auto pb-4',\n        'min-h-[400px] sm:min-h-[500px] md:min-h-[600px]',\n        className,\n      )}\n    >\n      {children}\n    </div>\n  )\n}\n\n/* -------------------------------------------------------------------------------------------------\n * KanbanProvider - Main DnD Context Provider\n * -----------------------------------------------------------------------------------------------*/\n\nexport type KanbanColumn<TData> = {\n  id: UniqueIdentifier\n  title: string\n  items: TData[]\n}\n\nexport type KanbanProviderProps<TData extends { id: UniqueIdentifier }> = {\n  children: ReactNode\n  columns: KanbanColumn<TData>[]\n  onColumnsChange?: (columns: KanbanColumn<TData>[]) => void\n  onDragEnd?: (\n    itemId: UniqueIdentifier,\n    sourceColumnId: UniqueIdentifier,\n    targetColumnId: UniqueIdentifier,\n  ) => void\n  renderOverlay?: (activeItem: TData | null) => ReactNode\n}\n\nexport const KanbanProvider = <TData extends { id: UniqueIdentifier }>({\n  children,\n  columns,\n  onColumnsChange,\n  onDragEnd: onDragEndCallback,\n  renderOverlay,\n}: KanbanProviderProps<TData>) => {\n  const [activeItem, setActiveItem] = useState<TData | null>(null)\n  const [activeColumnId, setActiveColumnId] = useState<UniqueIdentifier | null>(null)\n\n  const sensors = useSensors(\n    useSensor(PointerSensor, {\n      activationConstraint: {\n        distance: 8,\n      },\n    }),\n    useSensor(TouchSensor, {\n      activationConstraint: {\n        delay: 200,\n        tolerance: 5,\n      },\n    }),\n    useSensor(KeyboardSensor, {\n      coordinateGetter: sortableKeyboardCoordinates,\n    }),\n  )\n\n  const findColumn = useCallback(\n    (id: UniqueIdentifier): KanbanColumn<TData> | undefined => {\n      // First check if id is a column\n      const column = columns.find((col) => col.id === id)\n      if (column) return column\n\n      // If not, find which column contains this item\n      return columns.find((col) => col.items.some((item) => item.id === id))\n    },\n    [columns],\n  )\n\n  const findItem = useCallback(\n    (id: UniqueIdentifier): TData | undefined => {\n      for (const column of columns) {\n        const item = column.items.find((item) => item.id === id)\n        if (item) return item\n      }\n      return undefined\n    },\n    [columns],\n  )\n\n  const handleDragStart = useCallback(\n    (event: DragStartEvent) => {\n      const { active } = event\n      const item = findItem(active.id)\n      const column = findColumn(active.id)\n\n      setActiveItem(item ?? null)\n      setActiveColumnId(column?.id ?? null)\n    },\n    [findItem, findColumn],\n  )\n\n  const handleDragOver = useCallback(\n    (event: DragOverEvent) => {\n      const { active, over } = event\n\n      if (!over) return\n\n      const activeId = active.id\n      const overId = over.id\n\n      if (activeId === overId) return\n\n      const activeColumn = findColumn(activeId)\n      const overColumn = findColumn(overId)\n\n      if (!activeColumn || !overColumn) return\n\n      // Moving to a different column\n      if (activeColumn.id !== overColumn.id) {\n        const newColumns = columns.map((col) => {\n          if (col.id === activeColumn.id) {\n            return {\n              ...col,\n              items: col.items.filter((item) => item.id !== activeId),\n            }\n          }\n          if (col.id === overColumn.id) {\n            const activeItem = activeColumn.items.find((item) => item.id === activeId)\n            if (!activeItem) return col\n\n            // Find where to insert - if over is an item, insert at that position\n            const overIndex = col.items.findIndex((item) => item.id === overId)\n\n            if (overIndex === -1) {\n              // Dropping on the column itself, add to end\n              return {\n                ...col,\n                items: [...col.items, activeItem],\n              }\n            }\n\n            // Insert at the over position\n            const newItems = [...col.items]\n            newItems.splice(overIndex, 0, activeItem)\n            return {\n              ...col,\n              items: newItems,\n            }\n          }\n          return col\n        })\n\n        onColumnsChange?.(newColumns)\n      }\n    },\n    [columns, findColumn, onColumnsChange],\n  )\n\n  const handleDragEnd = useCallback(\n    (event: DragEndEvent) => {\n      const { active, over } = event\n\n      if (!over) {\n        setActiveItem(null)\n        setActiveColumnId(null)\n        return\n      }\n\n      const activeId = active.id\n      const overId = over.id\n\n      const activeColumn = findColumn(activeId)\n      const overColumn = findColumn(overId)\n\n      if (!activeColumn || !overColumn) {\n        setActiveItem(null)\n        setActiveColumnId(null)\n        return\n      }\n\n      // Reordering within the same column\n      if (activeColumn.id === overColumn.id) {\n        const oldIndex = activeColumn.items.findIndex((item) => item.id === activeId)\n        const newIndex = activeColumn.items.findIndex((item) => item.id === overId)\n\n        if (oldIndex !== newIndex && newIndex !== -1) {\n          const newColumns = columns.map((col) => {\n            if (col.id === activeColumn.id) {\n              return {\n                ...col,\n                items: arrayMove(col.items, oldIndex, newIndex),\n              }\n            }\n            return col\n          })\n          onColumnsChange?.(newColumns)\n        }\n      }\n\n      // Notify about the drag end\n      if (activeColumnId && overColumn.id !== activeColumnId) {\n        onDragEndCallback?.(activeId, activeColumnId, overColumn.id)\n      }\n\n      setActiveItem(null)\n      setActiveColumnId(null)\n    },\n    [columns, findColumn, onColumnsChange, onDragEndCallback, activeColumnId],\n  )\n\n  const handleDragCancel = useCallback(() => {\n    setActiveItem(null)\n    setActiveColumnId(null)\n  }, [])\n\n  return (\n    <DndContext\n      sensors={sensors}\n      collisionDetection={closestCorners}\n      onDragStart={handleDragStart}\n      onDragOver={handleDragOver}\n      onDragEnd={handleDragEnd}\n      onDragCancel={handleDragCancel}\n    >\n      {children}\n      <DragOverlay dropAnimation={null}>\n        {activeItem && renderOverlay ? renderOverlay(activeItem) : null}\n      </DragOverlay>\n    </DndContext>\n  )\n}\n\n/* -------------------------------------------------------------------------------------------------\n * KanbanColumn\n * -----------------------------------------------------------------------------------------------*/\n\nexport type KanbanColumnProps<TData extends { id: UniqueIdentifier }> = {\n  id: UniqueIdentifier\n  title: string\n  titleAr?: string\n  items: TData[]\n  children: ReactNode\n  className?: string\n  headerClassName?: string\n  isRTL?: boolean\n}\n\nexport const KanbanColumn = <TData extends { id: UniqueIdentifier }>({\n  id,\n  title,\n  titleAr,\n  items,\n  children,\n  className,\n  headerClassName,\n  isRTL = false,\n}: KanbanColumnProps<TData>) => {\n  const { setNodeRef, isOver } = useSortable({\n    id,\n    data: {\n      type: 'column',\n      column: { id, title, items },\n    },\n  })\n\n  return (\n    <div\n      ref={setNodeRef}\n      className={cn(\n        'flex flex-col',\n        'w-full sm:w-[300px] sm:min-w-[300px] sm:max-w-[300px]',\n        'rounded-lg border bg-card shadow-sm',\n        'h-full min-h-[400px] sm:min-h-[500px]',\n        isOver && 'ring-2 ring-primary ring-offset-2',\n        className,\n      )}\n    >\n      <div className={cn('flex items-center justify-between px-4 py-3 border-b', headerClassName)}>\n        <h3 className=\"text-sm sm:text-base font-semibold\">{isRTL && titleAr ? titleAr : title}</h3>\n        <span className=\"text-xs sm:text-sm text-muted-foreground px-2 py-1 rounded-md bg-muted\">\n          {items.length}\n        </span>\n      </div>\n      <div className=\"flex-1 overflow-y-auto p-2 sm:p-3 space-y-2\">\n        <SortableContext\n          items={items.map((item) => item.id)}\n          strategy={verticalListSortingStrategy}\n        >\n          {children}\n        </SortableContext>\n      </div>\n    </div>\n  )\n}\n\n/* -------------------------------------------------------------------------------------------------\n * KanbanCard\n * -----------------------------------------------------------------------------------------------*/\n\nexport type KanbanCardProps = {\n  id: UniqueIdentifier\n  children: ReactNode\n  className?: string\n  disabled?: boolean\n  onClick?: () => void\n}\n\nexport const KanbanCard = forwardRef<HTMLDivElement, KanbanCardProps>(\n  ({ id, children, className, disabled = false, onClick }, ref) => {\n    const { attributes, listeners, setNodeRef, transform, transition, isDragging } = useSortable({\n      id,\n      disabled,\n      data: {\n        type: 'card',\n      },\n    })\n\n    const style = {\n      transform: CSS.Transform.toString(transform),\n      transition,\n    }\n\n    const handleClick = () => {\n      if (!isDragging && onClick) {\n        onClick()\n      }\n    }\n\n    return (\n      <div\n        ref={(node) => {\n          setNodeRef(node)\n          if (typeof ref === 'function') {\n            ref(node)\n          } else if (ref) {\n            ref.current = node\n          }\n        }}\n        style={style}\n        className={cn(\n          'rounded-lg border bg-card p-3 sm:p-4',\n          'cursor-grab active:cursor-grabbing',\n          'transition-all hover:shadow-md hover:border-primary/20',\n          'min-h-11 min-w-11',\n          'focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring',\n          isDragging && 'opacity-50 shadow-lg scale-[1.02] z-50',\n          disabled && 'cursor-not-allowed opacity-60',\n          className,\n        )}\n        onClick={handleClick}\n        {...attributes}\n        {...listeners}\n      >\n        {children}\n      </div>\n    )\n  },\n)\nKanbanCard.displayName = 'KanbanCard'\n\n/* -------------------------------------------------------------------------------------------------\n * KanbanEmpty\n * -----------------------------------------------------------------------------------------------*/\n\nexport type KanbanEmptyProps = {\n  message?: string\n  subMessage?: string\n  className?: string\n}\n\nexport const KanbanEmpty = forwardRef<HTMLDivElement, KanbanEmptyProps>(\n  ({ message = 'No items', subMessage, className }, ref) => {\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          'flex flex-col items-center justify-center',\n          'p-4 text-sm text-muted-foreground text-center',\n          'rounded-md border-2 border-dashed min-h-[100px]',\n          className,\n        )}\n      >\n        <p>{message}</p>\n        {subMessage && <p className=\"text-xs mt-1\">{subMessage}</p>}\n      </div>\n    )\n  },\n)\nKanbanEmpty.displayName = 'KanbanEmpty'\n","import * as React from 'react'\nimport * as TogglePrimitive from '@radix-ui/react-toggle'\nimport { cva, type VariantProps } from 'class-variance-authority'\n\nimport { cn } from '@/lib/utils'\n\nconst toggleVariants = cva(\n  'inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0',\n  {\n    variants: {\n      variant: {\n        default: 'bg-transparent',\n        outline:\n          'border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground',\n      },\n      size: {\n        default: 'h-9 px-2 min-w-9',\n        sm: 'h-8 px-1.5 min-w-8',\n        lg: 'h-10 px-2.5 min-w-10',\n      },\n    },\n    defaultVariants: {\n      variant: 'default',\n      size: 'default',\n    },\n  },\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> & VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","'use client'\n\nimport * as React from 'react'\nimport * as ToggleGroupPrimitive from '@radix-ui/react-toggle-group'\nimport { type VariantProps } from 'class-variance-authority'\n\nimport { cn } from '@/lib/utils'\nimport { toggleVariants } from '@/components/ui/toggle'\n\nconst ToggleGroupContext = React.createContext<VariantProps<typeof toggleVariants>>({\n  size: 'default',\n  variant: 'default',\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn('flex items-center justify-center gap-1', className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>{children}</ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className,\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","/**\n * UnifiedKanbanHeader - Board header with mode switcher and filters\n * Feature: 034-unified-kanban\n */\n\nimport { useTranslation } from 'react-i18next'\nimport { LayoutGrid, List, Filter, RefreshCw, Columns3, Signal, AlertTriangle } from 'lucide-react'\nimport { cn } from '@/lib/utils'\nimport { Button } from '@/components/ui/button'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select'\nimport { Badge } from '@/components/ui/badge'\nimport { ToggleGroup, ToggleGroupItem } from '@/components/ui/toggle-group'\nimport type { KanbanColumnMode, WorkSource } from '@/types/work-item.types'\n\ninterface UnifiedKanbanHeaderProps {\n  columnMode: KanbanColumnMode\n  onColumnModeChange: (mode: KanbanColumnMode) => void\n  viewMode?: 'list' | 'board'\n  onViewModeChange?: (mode: 'list' | 'board') => void\n  sourceFilter?: WorkSource[]\n  onSourceFilterChange?: (sources: WorkSource[]) => void\n  showFilters?: boolean\n  showModeSwitch?: boolean\n  showViewToggle?: boolean\n  isRefreshing?: boolean\n  onRefresh?: () => void\n  totalCount?: number\n  overdueCount?: number\n}\n\nexport function UnifiedKanbanHeader({\n  columnMode,\n  onColumnModeChange,\n  viewMode = 'board',\n  onViewModeChange,\n  sourceFilter = [],\n  onSourceFilterChange,\n  showFilters = true,\n  showModeSwitch = true,\n  showViewToggle = true,\n  isRefreshing = false,\n  onRefresh,\n  totalCount = 0,\n  overdueCount = 0,\n}: UnifiedKanbanHeaderProps) {\n  const { t, i18n } = useTranslation('unified-kanban')\n  const isRTL = i18n.language === 'ar'\n\n  const toggleSource = (source: WorkSource) => {\n    if (!onSourceFilterChange) return\n\n    if (sourceFilter.includes(source)) {\n      onSourceFilterChange(sourceFilter.filter((s) => s !== source))\n    } else {\n      onSourceFilterChange([...sourceFilter, source])\n    }\n  }\n\n  return (\n    <div\n      className={cn(\n        'flex flex-col gap-3 px-4 sm:px-6 py-3 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60',\n      )}\n      dir={isRTL ? 'rtl' : 'ltr'}\n    >\n      {/* Top row: Title and View Toggle */}\n      <div className=\"flex items-center justify-between gap-4\">\n        <div className=\"flex items-center gap-3\">\n          <h1 className=\"text-lg sm:text-xl font-semibold\">{t('title')}</h1>\n          {totalCount > 0 && (\n            <Badge variant=\"secondary\" className=\"text-xs\">\n              {totalCount} {t('accessibility.itemCount', { count: totalCount })}\n            </Badge>\n          )}\n          {overdueCount > 0 && (\n            <Badge variant=\"destructive\" className=\"text-xs flex items-center gap-1\">\n              <AlertTriangle className=\"h-3 w-3\" />\n              {overdueCount}\n            </Badge>\n          )}\n        </div>\n\n        <div className=\"flex items-center gap-2\">\n          {/* Refresh button */}\n          {onRefresh && (\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={onRefresh}\n              disabled={isRefreshing}\n              className=\"h-9 w-9\"\n            >\n              <RefreshCw className={cn('h-4 w-4', isRefreshing && 'animate-spin')} />\n              <span className=\"sr-only\">{t('actions.refresh')}</span>\n            </Button>\n          )}\n\n          {/* View toggle */}\n          {showViewToggle && onViewModeChange && (\n            <ToggleGroup\n              type=\"single\"\n              value={viewMode}\n              onValueChange={(value) => value && onViewModeChange(value as 'list' | 'board')}\n              className=\"bg-muted rounded-md p-0.5\"\n            >\n              <ToggleGroupItem\n                value=\"list\"\n                aria-label={t('viewModes.list')}\n                className=\"h-8 px-2.5 data-[state=on]:bg-background\"\n              >\n                <List className=\"h-4 w-4\" />\n              </ToggleGroupItem>\n              <ToggleGroupItem\n                value=\"board\"\n                aria-label={t('viewModes.board')}\n                className=\"h-8 px-2.5 data-[state=on]:bg-background\"\n              >\n                <LayoutGrid className=\"h-4 w-4\" />\n              </ToggleGroupItem>\n            </ToggleGroup>\n          )}\n        </div>\n      </div>\n\n      {/* Bottom row: Column mode and filters */}\n      <div className=\"flex flex-wrap items-center gap-3\">\n        {/* Column mode selector */}\n        {showModeSwitch && (\n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-sm text-muted-foreground\">{t('columnModes.label')}:</span>\n            <Select\n              value={columnMode}\n              onValueChange={(value) => onColumnModeChange(value as KanbanColumnMode)}\n            >\n              <SelectTrigger className=\"w-[140px] sm:w-[160px] h-9\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"status\">\n                  <div className=\"flex items-center gap-2\">\n                    <Columns3 className=\"h-4 w-4\" />\n                    {t('columnModes.status')}\n                  </div>\n                </SelectItem>\n                <SelectItem value=\"priority\">\n                  <div className=\"flex items-center gap-2\">\n                    <Signal className=\"h-4 w-4\" />\n                    {t('columnModes.priority')}\n                  </div>\n                </SelectItem>\n                <SelectItem value=\"tracking_type\">\n                  <div className=\"flex items-center gap-2\">\n                    <Filter className=\"h-4 w-4\" />\n                    {t('columnModes.trackingType')}\n                  </div>\n                </SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        )}\n\n        {/* Source filter chips */}\n        {showFilters && onSourceFilterChange && (\n          <div className=\"flex items-center gap-2 ms-auto sm:ms-4\">\n            <span className=\"text-sm text-muted-foreground hidden sm:inline\">\n              {t('filters.source')}:\n            </span>\n            <div className=\"flex gap-1\">\n              <Button\n                variant={sourceFilter.length === 0 ? 'secondary' : 'outline'}\n                size=\"sm\"\n                onClick={() => onSourceFilterChange([])}\n                className=\"h-7 px-2 text-xs\"\n              >\n                {t('filters.allSources')}\n              </Button>\n              <Button\n                variant={sourceFilter.includes('task') ? 'secondary' : 'outline'}\n                size=\"sm\"\n                onClick={() => toggleSource('task')}\n                className=\"h-7 px-2 text-xs\"\n              >\n                {t('sources.task')}\n              </Button>\n              <Button\n                variant={sourceFilter.includes('commitment') ? 'secondary' : 'outline'}\n                size=\"sm\"\n                onClick={() => toggleSource('commitment')}\n                className=\"h-7 px-2 text-xs\"\n              >\n                {t('sources.commitment')}\n              </Button>\n              <Button\n                variant={sourceFilter.includes('intake') ? 'secondary' : 'outline'}\n                size=\"sm\"\n                onClick={() => toggleSource('intake')}\n                className=\"h-7 px-2 text-xs\"\n              >\n                {t('sources.intake')}\n              </Button>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n","/**\n * UnifiedKanbanCard - Card content for work items\n * Feature: 034-unified-kanban\n *\n * Displays a single work item with:\n * - Source badge (task/commitment/intake)\n * - Priority indicator\n * - Title and deadline\n * - Assignee avatar\n * - Overdue indicator\n */\n\nimport { useTranslation } from 'react-i18next'\nimport { Calendar, User, AlertCircle, GripVertical } from 'lucide-react'\nimport { cn } from '@/lib/utils'\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar'\nimport { Badge } from '@/components/ui/badge'\nimport type { WorkItem } from '@/types/work-item.types'\nimport { getSourceBadgeColors, getPriorityColor } from './utils/column-definitions'\n\ninterface CardContentProps {\n  item: WorkItem\n  showDragHandle?: boolean\n}\n\n/**\n * Card content component - used inside KanbanCard\n */\nexport function UnifiedKanbanCardContent({ item, showDragHandle = true }: CardContentProps) {\n  const { t, i18n } = useTranslation('unified-kanban')\n  const isRTL = i18n.language === 'ar'\n\n  const sourceBadge = getSourceBadgeColors(item.source)\n  const priorityColor = getPriorityColor(item.priority)\n\n  // Format deadline display\n  const getDeadlineDisplay = () => {\n    if (!item.deadline) return null\n\n    if (item.is_overdue) {\n      return {\n        text: t('card.overdue'),\n        className: 'text-red-600 font-medium',\n      }\n    }\n\n    if (item.days_until_due === 0) {\n      return {\n        text: t('card.dueToday'),\n        className: 'text-amber-600 font-medium',\n      }\n    }\n\n    if (item.days_until_due === 1) {\n      return {\n        text: t('card.dueTomorrow'),\n        className: 'text-amber-500',\n      }\n    }\n\n    if (item.days_until_due !== null && item.days_until_due > 1) {\n      return {\n        text: t('card.dueIn', { count: item.days_until_due }),\n        className: 'text-muted-foreground',\n      }\n    }\n\n    return null\n  }\n\n  const deadlineDisplay = getDeadlineDisplay()\n\n  // Get initials for avatar fallback\n  const getInitials = (name: string) => {\n    return name\n      .split(' ')\n      .map((n) => n[0])\n      .join('')\n      .toUpperCase()\n      .slice(0, 2)\n  }\n\n  return (\n    <div className=\"relative\" dir={isRTL ? 'rtl' : 'ltr'}>\n      {/* Priority indicator bar */}\n      <div\n        className={cn(\n          'absolute -top-3 sm:-top-4 h-1 w-full rounded-t-lg',\n          priorityColor,\n          'left-0 right-0',\n        )}\n        style={{ left: '-12px', right: '-12px', width: 'calc(100% + 24px)' }}\n      />\n\n      {/* Drag handle - visible on hover */}\n      {showDragHandle && (\n        <div\n          className={cn(\n            'absolute -top-1 opacity-0 group-hover:opacity-100 transition-opacity text-muted-foreground',\n            isRTL ? 'start-0' : 'end-0',\n          )}\n        >\n          <GripVertical className=\"h-4 w-4\" />\n        </div>\n      )}\n\n      {/* Content */}\n      <div className=\"space-y-2\">\n        {/* Source badge and overdue indicator */}\n        <div className=\"flex items-center justify-between gap-2\">\n          <Badge variant=\"secondary\" className={cn('text-xs', sourceBadge.bg, sourceBadge.text)}>\n            {t(`sources.${item.source}`)}\n          </Badge>\n\n          {item.is_overdue && (\n            <div className=\"flex items-center gap-1 text-red-600\">\n              <AlertCircle className=\"h-3.5 w-3.5\" />\n            </div>\n          )}\n        </div>\n\n        {/* Title */}\n        <h4 className=\"text-sm font-medium line-clamp-2 text-start\">\n          {isRTL && item.title_ar ? item.title_ar : item.title}\n        </h4>\n\n        {/* Footer: Deadline and Assignee */}\n        <div className=\"flex items-center justify-between gap-2 pt-1\">\n          {/* Deadline */}\n          {deadlineDisplay ? (\n            <div className={cn('flex items-center gap-1 text-xs', deadlineDisplay.className)}>\n              <Calendar className=\"h-3 w-3\" />\n              <span>{deadlineDisplay.text}</span>\n            </div>\n          ) : (\n            <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\n              <Calendar className=\"h-3 w-3 opacity-50\" />\n              <span>{t('card.noDueDate')}</span>\n            </div>\n          )}\n\n          {/* Assignee */}\n          {item.assignee ? (\n            <Avatar className=\"h-6 w-6\">\n              <AvatarImage src={item.assignee.avatar_url || undefined} alt={item.assignee.name} />\n              <AvatarFallback className=\"text-xs\">{getInitials(item.assignee.name)}</AvatarFallback>\n            </Avatar>\n          ) : (\n            <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\n              <User className=\"h-3.5 w-3.5\" />\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  )\n}\n\n/**\n * Skeleton for loading state\n */\nexport function UnifiedKanbanCardSkeleton() {\n  return (\n    <div className=\"rounded-lg border bg-card p-3 shadow-sm animate-pulse\">\n      <div className=\"space-y-2\">\n        <div className=\"h-5 w-16 bg-muted rounded\" />\n        <div className=\"h-4 w-full bg-muted rounded\" />\n        <div className=\"h-4 w-3/4 bg-muted rounded\" />\n        <div className=\"flex justify-between pt-1\">\n          <div className=\"h-4 w-20 bg-muted rounded\" />\n          <div className=\"h-6 w-6 bg-muted rounded-full\" />\n        </div>\n      </div>\n    </div>\n  )\n}\n\n/**\n * @deprecated Use UnifiedKanbanCardContent with KanbanCard from ui/kanban instead\n * Legacy card component for backwards compatibility\n */\nexport function UnifiedKanbanCard({\n  item,\n  isDragging = false,\n  onClick,\n}: {\n  item: WorkItem\n  isDragging?: boolean\n  onClick?: (item: WorkItem) => void\n}) {\n  const { i18n } = useTranslation('unified-kanban')\n  const isRTL = i18n.language === 'ar'\n\n  return (\n    <div\n      className={cn(\n        'group relative rounded-lg border bg-card p-3 shadow-sm transition-all',\n        'hover:shadow-md hover:border-primary/20',\n        'focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring',\n        'cursor-grab active:cursor-grabbing',\n        'min-h-[88px]',\n        isDragging ? 'opacity-50 shadow-lg scale-105' : '',\n        item.is_overdue ? 'border-red-200 bg-red-50/50' : '',\n      )}\n      onClick={() => onClick?.(item)}\n      dir={isRTL ? 'rtl' : 'ltr'}\n    >\n      <UnifiedKanbanCardContent item={item} />\n    </div>\n  )\n}\n","/**\n * Status Transition Rules for Unified Kanban Board\n * Feature: 034-unified-kanban\n *\n * Defines valid status transitions per source type.\n * Used to validate drag-and-drop operations before allowing them.\n */\n\nimport type { WorkSource, WorkflowStage, WorkStatus } from '@/types/work-item.types'\n\n// ============================================\n// Transition Rules\n// ============================================\n\n/**\n * Valid workflow stage transitions for Tasks\n * Tasks use workflow_stage: todo, in_progress, review, done, cancelled\n */\nexport const TASK_TRANSITIONS: Record<WorkflowStage, WorkflowStage[]> = {\n  todo: ['in_progress', 'cancelled'],\n  in_progress: ['todo', 'review', 'done', 'cancelled'],\n  review: ['in_progress', 'done', 'cancelled'],\n  done: [], // Terminal state\n  cancelled: [], // Terminal state\n}\n\n/**\n * Valid status transitions for Commitments\n * Commitments use status: pending, in_progress, completed, cancelled, overdue\n * Note: 'overdue' is a special status that indicates past deadline but still active\n */\nexport const COMMITMENT_TRANSITIONS: Record<string, string[]> = {\n  pending: ['in_progress', 'cancelled'],\n  in_progress: ['pending', 'completed', 'cancelled'],\n  overdue: ['in_progress', 'completed', 'cancelled'], // Overdue items can be worked on or resolved\n  review: [], // Commitments don't use review\n  completed: [], // Terminal state\n  cancelled: [], // Terminal state\n}\n\n/**\n * Valid status transitions for Intake Tickets\n * Intake uses: pending, in_progress, resolved, closed\n */\nexport const INTAKE_TRANSITIONS: Record<string, string[]> = {\n  pending: ['in_progress', 'resolved', 'closed'],\n  in_progress: ['pending', 'resolved', 'closed'],\n  resolved: ['closed', 'in_progress'],\n  closed: [], // Terminal state\n}\n\n// ============================================\n// Validation Functions\n// ============================================\n\n/**\n * Check if a status transition is valid for a given source\n */\nexport function isValidTransition(\n  source: WorkSource,\n  fromStatus: string,\n  toStatus: string,\n): boolean {\n  if (fromStatus === toStatus) return false // Same status, no transition\n\n  switch (source) {\n    case 'task':\n      return (\n        TASK_TRANSITIONS[fromStatus as WorkflowStage]?.includes(toStatus as WorkflowStage) ?? false\n      )\n    case 'commitment':\n      // Commitment transitions include 'overdue' which is not in WorkStatus\n      return COMMITMENT_TRANSITIONS[fromStatus]?.includes(toStatus) ?? false\n    case 'intake':\n      return INTAKE_TRANSITIONS[fromStatus]?.includes(toStatus) ?? false\n    default:\n      return false\n  }\n}\n\n/**\n * Get valid target statuses for a given source and current status\n */\nexport function getValidTargetStatuses(source: WorkSource, currentStatus: string): string[] {\n  switch (source) {\n    case 'task':\n      return TASK_TRANSITIONS[currentStatus as WorkflowStage] ?? []\n    case 'commitment':\n      // Commitment transitions include 'overdue' which is not in WorkStatus\n      return COMMITMENT_TRANSITIONS[currentStatus] ?? []\n    case 'intake':\n      return INTAKE_TRANSITIONS[currentStatus] ?? []\n    default:\n      return []\n  }\n}\n\n/**\n * Check if a status is a terminal state (no further transitions allowed)\n */\nexport function isTerminalStatus(source: WorkSource, status: string): boolean {\n  const validTargets = getValidTargetStatuses(source, status)\n  return validTargets.length === 0\n}\n\n// ============================================\n// Column Key Mapping\n// ============================================\n\n/**\n * Map kanban column key to source-specific status\n * Used when dropping an item into a column\n */\nexport function columnKeyToSourceStatus(source: WorkSource, columnKey: string): string {\n  // For tasks, column keys map directly to workflow stages\n  if (source === 'task') {\n    return columnKey\n  }\n\n  // For commitments, map column keys to commitment statuses\n  if (source === 'commitment') {\n    switch (columnKey) {\n      case 'todo':\n        return 'pending'\n      case 'in_progress':\n        return 'in_progress'\n      case 'done':\n        return 'completed'\n      case 'cancelled':\n        return 'cancelled'\n      default:\n        return 'pending'\n    }\n  }\n\n  // For intake, map column keys to intake statuses\n  if (source === 'intake') {\n    switch (columnKey) {\n      case 'todo':\n        return 'pending'\n      case 'in_progress':\n        return 'in_progress'\n      case 'done':\n        return 'resolved'\n      case 'cancelled':\n        return 'closed'\n      default:\n        return 'pending'\n    }\n  }\n\n  return columnKey\n}\n\n/**\n * Map source-specific status to kanban column key\n * Used when determining which column an item belongs to\n */\nexport function sourceStatusToColumnKey(\n  source: WorkSource,\n  status: string,\n  workflowStage?: string | null,\n): string {\n  // For tasks, use workflow_stage directly\n  if (source === 'task' && workflowStage) {\n    // Map 'pending' workflow stage to 'todo' column\n    if (workflowStage === 'pending') return 'todo'\n    return workflowStage\n  }\n\n  // Map completion statuses to 'done' column\n  if (['completed', 'resolved', 'done'].includes(status)) {\n    return 'done'\n  }\n\n  // Map closed/cancelled statuses\n  if (['cancelled', 'closed'].includes(status)) {\n    return 'cancelled'\n  }\n\n  // Map pending and overdue to 'todo' column\n  if (status === 'pending' || status === 'overdue') {\n    return 'todo'\n  }\n\n  // Other statuses map directly\n  return status\n}\n\n// ============================================\n// Validation with Kanban Column Keys\n// ============================================\n\n/**\n * Check if dragging an item to a target column is valid\n * This considers the column key mapping\n */\nexport function canDropInColumn(\n  source: WorkSource,\n  currentStatus: string,\n  currentWorkflowStage: string | null,\n  targetColumnKey: string,\n): boolean {\n  // Get the current column key for the item\n  const currentColumnKey = sourceStatusToColumnKey(source, currentStatus, currentWorkflowStage)\n\n  // Same column, no action needed\n  if (currentColumnKey === targetColumnKey) {\n    return false\n  }\n\n  // Get the target status for this source\n  const targetStatus = columnKeyToSourceStatus(source, targetColumnKey)\n\n  // For tasks, validate workflow stage transitions\n  if (source === 'task') {\n    const currentStage = currentWorkflowStage || currentColumnKey\n    return isValidTransition('task', currentStage, targetColumnKey)\n  }\n\n  // For other sources, validate status transitions\n  return isValidTransition(source, currentStatus, targetStatus)\n}\n\n/**\n * Get the appropriate status/stage values for updating an item\n * after it's dropped in a target column\n */\nexport function getUpdatePayload(\n  source: WorkSource,\n  targetColumnKey: string,\n): {\n  status?: string\n  workflow_stage?: string\n} {\n  if (source === 'task') {\n    // Tasks update workflow_stage and derive status\n    const workflowStage = targetColumnKey\n    let status: string\n\n    switch (workflowStage) {\n      case 'done':\n        status = 'completed'\n        break\n      case 'cancelled':\n        status = 'cancelled'\n        break\n      default:\n        status = 'in_progress'\n    }\n\n    return { status, workflow_stage: workflowStage }\n  }\n\n  // Commitments and Intake only update status\n  const status = columnKeyToSourceStatus(source, targetColumnKey)\n  return { status }\n}\n\n// ============================================\n// Error Messages\n// ============================================\n\n/**\n * Get user-friendly error message for invalid transition\n */\nexport function getTransitionErrorMessage(\n  source: WorkSource,\n  fromStatus: string,\n  toStatus: string,\n  language: 'en' | 'ar' = 'en',\n): string {\n  const messages = {\n    en: {\n      terminal: `Items in \"${fromStatus}\" status cannot be moved`,\n      invalid: `Cannot move from \"${fromStatus}\" to \"${toStatus}\"`,\n      task_done: 'Completed tasks cannot be moved',\n      commitment_complete: 'Completed commitments cannot be changed',\n      intake_closed: 'Closed tickets cannot be reopened',\n    },\n    ar: {\n      terminal: `لا يمكن نقل العناصر في حالة \"${fromStatus}\"`,\n      invalid: `لا يمكن النقل من \"${fromStatus}\" إلى \"${toStatus}\"`,\n      task_done: 'لا يمكن نقل المهام المكتملة',\n      commitment_complete: 'لا يمكن تغيير الالتزامات المكتملة',\n      intake_closed: 'لا يمكن إعادة فتح التذاكر المغلقة',\n    },\n  }\n\n  const msg = messages[language]\n\n  if (isTerminalStatus(source, fromStatus)) {\n    if (source === 'task' && fromStatus === 'done') return msg.task_done\n    if (source === 'commitment' && fromStatus === 'completed') return msg.commitment_complete\n    if (source === 'intake' && fromStatus === 'closed') return msg.intake_closed\n    return msg.terminal\n  }\n\n  return msg.invalid\n}\n"],"names":["STATUS_COLUMNS","PRIORITY_COLUMNS","TRACKING_TYPE_COLUMNS","getColumnsForMode","mode","getColumnOrder","isRTL","order","b","c","mapStatusToColumnKey","source","status","workflowStage","getSourceBadgeColors","getPriorityColor","priority","kanbanKeys","params","transformRpcRowToWorkItem","row","assignee","groupItemsByColumn","items","grouped","item","key","useUnifiedKanban","options","contextType","contextId","columnMode","sourceFilter","limitPerColumn","enabled","useQueryClient","query","useQuery","data","error","supabase","columns","columnOrder","i","allItems","useMemo","useUnifiedKanbanStatusUpdate","queryClient","toast","useToast","useMutation","itemId","newStatus","newWorkflowStage","variables","previousData","old","newColumns","columnKey","columnItems","itemIndex","updatedItem","newColumnKey","context","queryKey","useUnifiedKanbanRealtime","userId","invalidateWithDebounce","useCallback","timeoutId","useEffect","channels","tasksChannel","commitmentsChannel","intakeChannel","channel","KanbanBoard","children","className","jsx","cn","KanbanProvider","onColumnsChange","onDragEndCallback","renderOverlay","activeItem","setActiveItem","useState","activeColumnId","setActiveColumnId","sensors","useSensors","useSensor","PointerSensor","TouchSensor","KeyboardSensor","sortableKeyboardCoordinates","findColumn","id","column","col","findItem","handleDragStart","event","active","handleDragOver","over","activeId","overId","activeColumn","overColumn","overIndex","newItems","handleDragEnd","oldIndex","newIndex","arrayMove","handleDragCancel","jsxs","DndContext","closestCorners","DragOverlay","KanbanColumn","title","titleAr","headerClassName","setNodeRef","isOver","useSortable","SortableContext","verticalListSortingStrategy","KanbanCard","forwardRef","disabled","onClick","ref","attributes","listeners","transform","transition","isDragging","style","CSS","handleClick","node","KanbanEmpty","message","subMessage","toggleVariants","cva","Toggle","React.forwardRef","variant","size","props","TogglePrimitive.Root","ToggleGroupContext","React.createContext","ToggleGroup","ToggleGroupPrimitive.Root","ToggleGroupItem","React.useContext","ToggleGroupPrimitive.Item","UnifiedKanbanHeader","onColumnModeChange","viewMode","onViewModeChange","onSourceFilterChange","showFilters","showModeSwitch","showViewToggle","isRefreshing","onRefresh","totalCount","overdueCount","t","i18n","useTranslation","toggleSource","s","Badge","AlertTriangle","Button","RefreshCw","value","List","LayoutGrid","Select","SelectTrigger","SelectValue","SelectContent","SelectItem","Columns3","Signal","Filter","UnifiedKanbanCardContent","showDragHandle","sourceBadge","priorityColor","deadlineDisplay","getInitials","name","n","GripVertical","AlertCircle","Calendar","Avatar","AvatarImage","AvatarFallback","User","UnifiedKanbanCardSkeleton","TASK_TRANSITIONS","COMMITMENT_TRANSITIONS","INTAKE_TRANSITIONS","isValidTransition","fromStatus","toStatus","getValidTargetStatuses","currentStatus","isTerminalStatus","columnKeyToSourceStatus","sourceStatusToColumnKey","canDropInColumn","currentWorkflowStage","targetColumnKey","currentColumnKey","targetStatus","getUpdatePayload","getTransitionErrorMessage","language","msg"],"mappings":"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"}