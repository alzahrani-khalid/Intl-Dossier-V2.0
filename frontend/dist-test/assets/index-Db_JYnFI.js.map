{"version":3,"file":"index-Db_JYnFI.js","sources":["../../src/routes/_protected/approvals/index.tsx?tsr-split=component"],"sourcesContent":["/**\n * Route: /approvals\n * My Approvals dashboard - positions pending current user's approval\n */\n\nimport { createFileRoute } from '@tanstack/react-router';\nimport { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Card } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { useQuery } from '@tanstack/react-query';\nimport { supabase } from '@/lib/supabase';\nimport { Link } from '@tanstack/react-router';\nimport { Clock, CheckCircle, XCircle } from 'lucide-react';\nimport { Skeleton } from '@/components/ui/skeleton';\n\nexport const Route = createFileRoute('/_protected/approvals/')({\n component: MyApprovalsPage,\n});\n\nconst API_BASE_URL = import.meta.env.VITE_SUPABASE_URL + '/functions/v1';\n\nasync function fetchMyApprovals() {\n const { data: { session } } = await supabase.auth.getSession();\n\n // This would need a dedicated endpoint, but for now we'll filter positions\n const response = await fetch(`${API_BASE_URL}/positions-list?status=under_review`, {\n headers: {\n 'Authorization': `Bearer ${session?.access_token}`,\n 'Content-Type': 'application/json',\n },\n });\n\n if (!response.ok) {\n throw new Error('Failed to fetch approvals');\n }\n\n const data = await response.json();\n return data.data || [];\n}\n\nfunction MyApprovalsPage() {\n const { t } = useTranslation();\n const [filter, setFilter] = useState<'all' | 'pending' | 'completed'>('pending');\n\n const { data: positions, isLoading } = useQuery({\n queryKey: ['approvals', 'my', filter],\n queryFn: fetchMyApprovals,\n staleTime: 30 * 1000, // 30 seconds\n });\n\n if (isLoading) {\n return (\n <div className=\"container mx-auto py-6 space-y-4\">\n <Skeleton className=\"h-8 w-64\" />\n <Skeleton className=\"h-96\" />\n </div>\n );\n }\n\n return (\n <div className=\"container mx-auto py-6 space-y-6\">\n {/* Header */}\n <div className=\"flex items-center justify-between\">\n <div>\n <h1 className=\"text-3xl font-bold\">\n {t('approvals.myApprovals', 'My Approvals')}\n </h1>\n <p className=\"text-muted-foreground\">\n {t('approvals.subtitle', 'Positions pending your review and approval')}\n </p>\n </div>\n\n <div className=\"flex gap-2\">\n <Badge variant={filter === 'all' ? 'default' : 'outline'} className=\"cursor-pointer\" onClick={() => setFilter('all')}>\n {t('approvals.filter.all', 'All')}\n </Badge>\n <Badge variant={filter === 'pending' ? 'default' : 'outline'} className=\"cursor-pointer\" onClick={() => setFilter('pending')}>\n {t('approvals.filter.pending', 'Pending')}\n </Badge>\n <Badge variant={filter === 'completed' ? 'default' : 'outline'} className=\"cursor-pointer\" onClick={() => setFilter('completed')}>\n {t('approvals.filter.completed', 'Completed')}\n </Badge>\n </div>\n </div>\n\n {/* Stats Cards */}\n <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n <Card className=\"p-4\">\n <div className=\"flex items-center gap-4\">\n <div className=\"p-3 bg-yellow-100 dark:bg-yellow-900 rounded-lg\">\n <Clock className=\"h-6 w-6 text-yellow-600 dark:text-yellow-400\" />\n </div>\n <div>\n <p className=\"text-2xl font-bold\">{positions?.length || 0}</p>\n <p className=\"text-sm text-muted-foreground\">\n {t('approvals.stats.pending', 'Pending')}\n </p>\n </div>\n </div>\n </Card>\n\n <Card className=\"p-4\">\n <div className=\"flex items-center gap-4\">\n <div className=\"p-3 bg-green-100 dark:bg-green-900 rounded-lg\">\n <CheckCircle className=\"h-6 w-6 text-green-600 dark:text-green-400\" />\n </div>\n <div>\n <p className=\"text-2xl font-bold\">0</p>\n <p className=\"text-sm text-muted-foreground\">\n {t('approvals.stats.approved', 'Approved This Month')}\n </p>\n </div>\n </div>\n </Card>\n\n <Card className=\"p-4\">\n <div className=\"flex items-center gap-4\">\n <div className=\"p-3 bg-red-100 dark:bg-red-900 rounded-lg\">\n <XCircle className=\"h-6 w-6 text-red-600 dark:text-red-400\" />\n </div>\n <div>\n <p className=\"text-2xl font-bold\">0</p>\n <p className=\"text-sm text-muted-foreground\">\n {t('approvals.stats.rejected', 'Returned for Revisions')}\n </p>\n </div>\n </div>\n </Card>\n </div>\n\n {/* Positions List */}\n <Card className=\"p-6\">\n {positions && positions.length > 0 ? (\n <div className=\"space-y-4\">\n {positions.map((position: any) => (\n <Link\n key={position.id}\n to=\"/positions/$id\"\n params={{ id: position.id }}\n className=\"block p-4 border rounded-lg hover:border-primary transition-colors\"\n >\n <div className=\"flex items-center justify-between\">\n <div className=\"flex-1\">\n <div className=\"flex items-center gap-3 mb-2\">\n <h3 className=\"font-semibold\">{position.title_en}</h3>\n <Badge variant=\"secondary\">\n {t('approvals.stage', 'Stage')} {position.current_stage}\n </Badge>\n </div>\n <p className=\"text-sm text-muted-foreground\">{position.title_ar}</p>\n <p className=\"text-xs text-muted-foreground mt-2\">\n {t('approvals.submittedBy', 'Submitted by')}: {position.author_id}\n </p>\n </div>\n\n <div className=\"flex flex-col items-end gap-2\">\n <Badge>{position.thematic_category || t('approvals.uncategorized', 'Uncategorized')}</Badge>\n <span className=\"text-xs text-muted-foreground\">\n {new Date(position.created_at).toLocaleDateString()}\n </span>\n </div>\n </div>\n </Link>\n ))}\n </div>\n ) : (\n <div className=\"text-center py-12\">\n <p className=\"text-lg text-muted-foreground\">\n {t('approvals.noPositions', 'No positions pending your approval')}\n </p>\n </div>\n )}\n </Card>\n </div>\n );\n}\n"],"names":["API_BASE_URL","import","fetchMyApprovals","data","session","supabase","auth","getSession","response","fetch","headers","access_token","ok","Error","json","MyApprovalsPage","t","useTranslation","filter","setFilter","useState","positions","isLoading","useQuery","queryKey","queryFn","staleTime","jsxs","jsx","Skeleton","Badge","Card","Clock","length","CheckCircle","XCircle","map","position","Link","id","title_en","current_stage","title_ar","author_id","thematic_category","Date","created_at","toLocaleDateString"],"mappings":"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"}