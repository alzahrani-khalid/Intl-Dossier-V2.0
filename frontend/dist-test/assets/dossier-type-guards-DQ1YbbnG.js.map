{"version":3,"file":"dossier-type-guards-DQ1YbbnG.js","sources":["../../src/lib/dossier-type-guards.ts"],"sourcesContent":["/**\n * Type guards for dossier entity types\n *\n * This module provides runtime type validation for the discriminated union pattern\n * used across all dossier entity types. It ensures type safety when working with\n * polymorphic dossier data from the API.\n *\n * @module dossier-type-guards\n * @feature 028-type-specific-dossier-pages\n *\n * @example\n * ```typescript\n * import { isCountryDossier, assertDossierType } from '@/lib/dossier-type-guards';\n *\n * // Using type guard in conditional\n * if (isCountryDossier(dossier)) {\n *   console.log(dossier.extension.iso_code_2); // TypeScript knows this is safe\n * }\n *\n * // Using assertion in route loader\n * assertDossierType(dossier, 'country'); // Throws if type mismatch\n * ```\n */\n\n/**\n * Union type of all valid dossier type strings\n *\n * @description\n * These correspond to the `type` column in the `dossiers` database table.\n * Each type has a corresponding extension table with type-specific fields.\n */\nexport type DossierType =\n  | 'country'\n  | 'organization'\n  | 'person'\n  | 'engagement'\n  | 'forum'\n  | 'working_group'\n  | 'topic'\n\n/**\n * Extension schema for country dossiers\n *\n * @description\n * Contains country-specific metadata following ISO 3166 standards.\n * IMPORTANT: Must match database schema in supabase/migrations/20251022000002_create_extension_tables.sql\n *\n * @property iso_code_2 - ISO 3166-1 alpha-2 code (e.g., \"SA\" for Saudi Arabia)\n * @property iso_code_3 - ISO 3166-1 alpha-3 code (e.g., \"SAU\" for Saudi Arabia)\n * @property capital_en - Capital city name in English\n * @property capital_ar - Capital city name in Arabic\n * @property region - Geographic region (e.g., \"Middle East\")\n * @property subregion - Geographic subregion (e.g., \"Western Asia\")\n * @property population - Current population count\n * @property area_sq_km - Land area in square kilometers\n * @property flag_url - URL to country flag image\n */\nexport interface CountryExtension {\n  iso_code_2: string // ISO 3166-1 alpha-2 (e.g., \"SA\")\n  iso_code_3: string // ISO 3166-1 alpha-3 (e.g., \"SAU\")\n  capital_en?: string // Capital city (English)\n  capital_ar?: string // Capital city (Arabic)\n  region?: string // Geographic region\n  subregion?: string // Geographic subregion\n  population?: number // Population count\n  area_sq_km?: number // Area in square kilometers\n  flag_url?: string // URL to country flag image\n}\n\n/**\n * Extension schema for organization dossiers\n *\n * @description\n * Contains organization-specific metadata including type classification,\n * hierarchy information, and basic operational data.\n *\n * @property org_code - Unique internal organization code\n * @property org_type - Organization classification\n * @property parent_org_id - Parent organization dossier ID for hierarchy\n * @property head_count - Number of employees/members\n * @property established_date - Organization founding date (ISO 8601)\n * @property website_url - Official website URL\n */\nexport interface OrganizationExtension {\n  org_code: string\n  org_type: 'government' | 'ngo' | 'international' | 'private'\n  parent_org_id?: string\n  head_count?: number\n  established_date?: string\n  website_url?: string\n}\n\n/**\n * Extension schema for person dossiers\n *\n * @description\n * Contains individual-specific metadata including professional information,\n * biographical data, and current employment details.\n *\n * @property title - Professional/honorific title (e.g., \"Ambassador\", \"Minister\")\n * @property photo_url - Profile photo URL\n * @property birth_date - Date of birth (ISO 8601)\n * @property nationality - ISO 3166-1 alpha-2 country code\n * @property education - List of educational qualifications\n * @property languages - List of spoken languages (ISO 639-1 codes)\n * @property current_position - Current employment details\n */\nexport interface PersonExtension {\n  title?: string\n  photo_url?: string\n  birth_date?: string\n  nationality?: string\n  education?: string[]\n  languages?: string[]\n  current_position?: {\n    title: string\n    organization: string\n    start_date: string\n  }\n}\n\n/**\n * Extension schema for engagement dossiers\n *\n * @description\n * Contains engagement-specific metadata for meetings, conferences,\n * visits, and negotiations. Links to participating dossiers.\n *\n * @property engagement_type - Type of engagement event\n * @property start_date - Engagement start date/time (ISO 8601)\n * @property end_date - Engagement end date/time (ISO 8601)\n * @property location - Physical or virtual location\n * @property participants - Array of participating dossiers with roles\n * @property outcomes - List of documented outcomes/decisions\n */\nexport interface EngagementExtension {\n  engagement_type: 'meeting' | 'conference' | 'visit' | 'negotiation'\n  start_date: string\n  end_date?: string\n  location?: string\n  participants: Array<{\n    dossier_id: string\n    role: string\n  }>\n  outcomes?: string[]\n}\n\n/**\n * Extension schema for forum dossiers\n *\n * @description\n * Contains forum-specific metadata for bilateral/multilateral forums\n * and working groups. Tracks membership, meetings, and deliverables.\n *\n * @property forum_type - Forum classification\n * @property member_organizations - Array of member organization dossier IDs\n * @property meeting_frequency - Human-readable meeting frequency (e.g., \"Quarterly\")\n * @property next_meeting_date - Next scheduled meeting date (ISO 8601)\n * @property deliverables - Tracked deliverables with status\n */\nexport interface ForumExtension {\n  forum_type: 'bilateral' | 'multilateral' | 'working_group'\n  member_organizations: string[]\n  meeting_frequency?: string\n  next_meeting_date?: string\n  deliverables?: Array<{\n    name: string\n    due_date: string\n    status: 'pending' | 'in_progress' | 'completed'\n  }>\n}\n\n/**\n * Extension schema for working group dossiers\n *\n * @description\n * Contains working group-specific metadata. Working groups are typically\n * sub-entities of forums with defined mandates and timeframes.\n *\n * @property parent_forum_id - Parent forum dossier ID\n * @property chair_organization - Chairing organization dossier ID\n * @property mandate - Working group mandate/purpose\n * @property start_date - Working group establishment date (ISO 8601)\n * @property end_date - Working group dissolution date (ISO 8601)\n * @property members - Array of member dossiers with roles\n */\nexport interface WorkingGroupExtension {\n  parent_forum_id?: string\n  chair_organization?: string\n  mandate: string\n  start_date: string\n  end_date?: string\n  members: Array<{\n    dossier_id: string\n    role: 'chair' | 'member' | 'observer'\n  }>\n}\n\n/**\n * Extension schema for topic dossiers\n *\n * @description\n * Contains topic-specific metadata for organizing dossiers\n * by subject matter. Supports hierarchical topic structures.\n *\n * @property topic_category - Topic classification\n * @property parent_topic_id - Parent topic dossier ID for hierarchy\n */\nexport interface TopicExtension {\n  topic_category?: 'policy' | 'technical' | 'strategic' | 'operational'\n  parent_topic_id?: string\n}\n\n/**\n * Base dossier interface shared by all dossier types\n *\n * @description\n * Contains common fields present in all dossiers. Maps to the\n * unified `dossiers` table in the database.\n *\n * @property id - Unique UUID identifier\n * @property name_en - Display name in English\n * @property name_ar - Display name in Arabic\n * @property description_en - Full description in English\n * @property description_ar - Full description in Arabic\n * @property created_at - Creation timestamp (ISO 8601)\n * @property updated_at - Last update timestamp (ISO 8601)\n * @property created_by - Creator user ID\n * @property updated_by - Last updater user ID\n */\nexport interface BaseDossier {\n  id: string\n  name_en: string\n  name_ar: string\n  description_en?: string\n  description_ar?: string\n  created_at: string\n  updated_at: string\n  created_by?: string\n  updated_by?: string\n}\n\n/**\n * Country dossier type with country-specific extension\n *\n * @see CountryExtension for type-specific fields\n */\nexport interface CountryDossier extends BaseDossier {\n  type: 'country'\n  extension: CountryExtension\n}\n\n/**\n * Organization dossier type with organization-specific extension\n *\n * @see OrganizationExtension for type-specific fields\n */\nexport interface OrganizationDossier extends BaseDossier {\n  type: 'organization'\n  extension: OrganizationExtension\n}\n\n/**\n * Person dossier type with person-specific extension\n *\n * @see PersonExtension for type-specific fields\n */\nexport interface PersonDossier extends BaseDossier {\n  type: 'person'\n  extension: PersonExtension\n}\n\n/**\n * Engagement dossier type with engagement-specific extension\n *\n * @see EngagementExtension for type-specific fields\n */\nexport interface EngagementDossier extends BaseDossier {\n  type: 'engagement'\n  extension: EngagementExtension\n}\n\n/**\n * Forum dossier type with forum-specific extension\n *\n * @see ForumExtension for type-specific fields\n */\nexport interface ForumDossier extends BaseDossier {\n  type: 'forum'\n  extension: ForumExtension\n}\n\n/**\n * Working group dossier type with working group-specific extension\n *\n * @see WorkingGroupExtension for type-specific fields\n */\nexport interface WorkingGroupDossier extends BaseDossier {\n  type: 'working_group'\n  extension: WorkingGroupExtension\n}\n\n/**\n * Topic dossier type with topic-specific extension\n *\n * @see TopicExtension for type-specific fields\n */\nexport interface TopicDossier extends BaseDossier {\n  type: 'topic'\n  extension: TopicExtension\n}\n\n/**\n * Discriminated union type for all dossier types\n *\n * @description\n * Use this type when accepting any dossier type. Use type guards\n * like `isCountryDossier()` to narrow down to specific types.\n *\n * @example\n * ```typescript\n * function processDossier(dossier: Dossier) {\n *   if (isCountryDossier(dossier)) {\n *     // TypeScript knows dossier.extension is CountryExtension\n *     console.log(dossier.extension.iso_code_2);\n *   }\n * }\n * ```\n */\nexport type Dossier =\n  | CountryDossier\n  | OrganizationDossier\n  | PersonDossier\n  | EngagementDossier\n  | ForumDossier\n  | WorkingGroupDossier\n  | TopicDossier\n\n// =============================================================================\n// TYPE GUARD FUNCTIONS\n// =============================================================================\n\n/**\n * Type guard for country dossiers\n *\n * @param dossier - Dossier to check\n * @returns True if the dossier is a country dossier\n *\n * @example\n * ```typescript\n * if (isCountryDossier(dossier)) {\n *   console.log(dossier.extension.iso_code_2); // TypeScript knows this is safe\n * }\n * ```\n */\nexport function isCountryDossier(dossier: Dossier): dossier is CountryDossier {\n  return dossier.type === 'country'\n}\n\n/**\n * Type guard for organization dossiers\n *\n * @param dossier - Dossier to check\n * @returns True if the dossier is an organization dossier\n */\nexport function isOrganizationDossier(dossier: Dossier): dossier is OrganizationDossier {\n  return dossier.type === 'organization'\n}\n\n/**\n * Type guard for person dossiers\n *\n * @param dossier - Dossier to check\n * @returns True if the dossier is a person dossier\n */\nexport function isPersonDossier(dossier: Dossier): dossier is PersonDossier {\n  return dossier.type === 'person'\n}\n\n/**\n * Type guard for engagement dossiers\n *\n * @param dossier - Dossier to check\n * @returns True if the dossier is an engagement dossier\n */\nexport function isEngagementDossier(dossier: Dossier): dossier is EngagementDossier {\n  return dossier.type === 'engagement'\n}\n\n/**\n * Type guard for forum dossiers\n *\n * @param dossier - Dossier to check\n * @returns True if the dossier is a forum dossier\n */\nexport function isForumDossier(dossier: Dossier): dossier is ForumDossier {\n  return dossier.type === 'forum'\n}\n\n/**\n * Type guard for working group dossiers\n *\n * @param dossier - Dossier to check\n * @returns True if the dossier is a working group dossier\n */\nexport function isWorkingGroupDossier(dossier: Dossier): dossier is WorkingGroupDossier {\n  return dossier.type === 'working_group'\n}\n\n/**\n * Type guard for topic dossiers\n *\n * @param dossier - Dossier to check\n * @returns True if the dossier is a topic dossier\n */\nexport function isTopicDossier(dossier: Dossier): dossier is TopicDossier {\n  return dossier.type === 'topic'\n}\n\n// =============================================================================\n// HELPER FUNCTIONS\n// =============================================================================\n\n/**\n * Validates that a dossier matches the expected type\n *\n * @param dossier - Dossier to validate\n * @param expectedType - Expected dossier type string\n * @returns True if dossier type matches expected type\n *\n * @example\n * ```typescript\n * if (validateDossierType(dossier, 'country')) {\n *   // dossier.type === 'country'\n * }\n * ```\n */\nexport function validateDossierType(dossier: Dossier, expectedType: DossierType): boolean {\n  return dossier.type === expectedType\n}\n\n/**\n * Returns the appropriate type guard function for a given dossier type\n *\n * @param type - Dossier type to get guard for\n * @returns Type guard function for the specified type\n * @throws Error if type is unknown\n *\n * @example\n * ```typescript\n * const typeGuard = getTypeGuard('country');\n * if (typeGuard(dossier)) {\n *   // dossier is a country dossier\n * }\n * ```\n */\nexport function getTypeGuard(type: DossierType): (dossier: Dossier) => boolean {\n  switch (type) {\n    case 'country':\n      return isCountryDossier\n    case 'organization':\n      return isOrganizationDossier\n    case 'person':\n      return isPersonDossier\n    case 'engagement':\n      return isEngagementDossier\n    case 'forum':\n      return isForumDossier\n    case 'working_group':\n      return isWorkingGroupDossier\n    case 'topic':\n      return isTopicDossier\n    default:\n      throw new Error(`Unknown dossier type: ${type}`)\n  }\n}\n\n/**\n * Validates that a dossier has the expected type at runtime and throws if not\n *\n * This is useful for route loaders and API responses where type mismatches\n * should stop execution with a clear error message.\n *\n * @param dossier - Dossier to validate\n * @param expectedType - Expected dossier type\n * @throws Error if types don't match\n *\n * @example\n * ```typescript\n * // In a route loader\n * export const Route = createFileRoute('/dossiers/countries/$id')({\n *   loader: async ({ params }) => {\n *     const dossier = await fetchDossier(params.id);\n *     assertDossierType(dossier, 'country');\n *     return { dossier }; // TypeScript now knows dossier is CountryDossier\n *   },\n * });\n * ```\n */\nexport function assertDossierType(\n  dossier: Dossier,\n  expectedType: DossierType,\n): asserts dossier is Extract<Dossier, { type: typeof expectedType }> {\n  if (dossier.type !== expectedType) {\n    throw new Error(`Dossier type mismatch: expected \"${expectedType}\", got \"${dossier.type}\"`)\n  }\n}\n\n/**\n * Returns a human-readable label for a dossier type\n *\n * @param type - Dossier type\n * @param language - Language code ('en' | 'ar')\n * @returns Localized type label\n *\n * @example\n * ```typescript\n * getDossierTypeLabel('country', 'en'); // Returns \"Country\"\n * getDossierTypeLabel('working_group', 'ar'); // Returns \"مجموعة عمل\"\n * ```\n */\nexport function getDossierTypeLabel(type: DossierType, language: 'en' | 'ar'): string {\n  const labels: Record<DossierType, { en: string; ar: string }> = {\n    country: { en: 'Country', ar: 'دولة' },\n    organization: { en: 'Organization', ar: 'منظمة' },\n    person: { en: 'Person', ar: 'شخص' },\n    engagement: { en: 'Engagement', ar: 'مشاركة' },\n    forum: { en: 'Forum', ar: 'منتدى' },\n    working_group: { en: 'Working Group', ar: 'مجموعة عمل' },\n    topic: { en: 'Topic', ar: 'موضوع' },\n  }\n\n  return labels[type][language]\n}\n\n/**\n * Returns an array of all dossier types\n *\n * Useful for iteration and type selection UIs\n *\n * @returns Array of all valid dossier types\n *\n * @example\n * ```typescript\n * const allTypes = getAllDossierTypes();\n * // ['country', 'organization', 'person', 'engagement', 'forum', 'working_group', 'topic']\n * ```\n */\nexport function getAllDossierTypes(): DossierType[] {\n  return ['country', 'organization', 'person', 'engagement', 'forum', 'working_group', 'topic']\n}\n"],"names":["isCountryDossier","dossier","isPersonDossier","isEngagementDossier","isTopicDossier"],"mappings":"AAmWO,SAASA,EAAiBC,EAA6C,CAC5E,OAAOA,EAAQ,OAAS,SAC1B,CAkBO,SAASC,EAAgBD,EAA4C,CAC1E,OAAOA,EAAQ,OAAS,QAC1B,CAQO,SAASE,EAAoBF,EAAgD,CAClF,OAAOA,EAAQ,OAAS,YAC1B,CA4BO,SAASG,EAAeH,EAA2C,CACxE,OAAOA,EAAQ,OAAS,OAC1B"}