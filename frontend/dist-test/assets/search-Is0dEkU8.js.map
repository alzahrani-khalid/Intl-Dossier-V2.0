{"version":3,"file":"search-Is0dEkU8.js","sources":["../../src/components/GlobalSearchInput.tsx","../../src/components/SearchSuggestions.tsx","../../src/components/EntityTypeTabs.tsx","../../src/components/SearchResultsList.tsx","../../src/components/SearchErrorBoundary.tsx","../../src/hooks/useSearch.ts","../../src/hooks/useSuggestions.ts","../../src/hooks/useSemanticSearch.ts","../../src/hooks/useKeyboardNavigation.ts","../../src/pages/SearchPage.tsx","../../src/routes/_protected/search.tsx?tsr-split=component"],"sourcesContent":["/**\n * Global Search Input Component\n * Feature: 015-search-retrieval-spec\n * Task: T042\n *\n * Bilingual search input with:\n * - Debounced onChange (200ms)\n * - Keyboard shortcuts (/ to focus)\n * - Clear button\n * - Loading indicator\n * - RTL/LTR support\n * - ARIA labels for accessibility\n */\n\nimport React, { useRef, useState, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Search, X, Loader2 } from 'lucide-react';\nimport { Input } from './ui/input';\nimport { Button } from './ui/button';\nimport { useDebouncedValue } from '../hooks/useDebouncedValue';\n\nexport interface GlobalSearchInputProps {\n /** Current search query */\n value: string;\n /** Callback when search query changes */\n onChange: (value: string) => void;\n /** Callback when user submits search (Enter key) */\n onSearch?: (value: string) => void;\n /** Show loading indicator */\n isLoading?: boolean;\n /** Placeholder text override */\n placeholder?: string;\n /** Auto-focus on mount */\n autoFocus?: boolean;\n /** CSS class name */\n className?: string;\n /** Callback when input gains focus */\n onFocus?: () => void;\n /** Callback when input loses focus */\n onBlur?: () => void;\n}\n\nexport function GlobalSearchInput({\n value,\n onChange,\n onSearch,\n isLoading = false,\n placeholder,\n autoFocus = false,\n className = '',\n onFocus,\n onBlur\n}: GlobalSearchInputProps) {\n const { t, i18n } = useTranslation();\n const inputRef = useRef<HTMLInputElement>(null);\n const [localValue, setLocalValue] = useState(value);\n\n // Debounce the onChange callback (200ms)\n const debouncedValue = useDebouncedValue(localValue, 200);\n\n // Call onChange with debounced value\n useEffect(() => {\n if (debouncedValue !== value) {\n onChange(debouncedValue);\n }\n }, [debouncedValue, onChange, value]);\n\n // Sync external value changes\n useEffect(() => {\n setLocalValue(value);\n }, [value]);\n\n // Keyboard shortcut: Press '/' to focus search\n useEffect(() => {\n const handleKeyDown = (e: KeyboardEvent) => {\n // Focus on '/' key (unless already in an input)\n if (e.key === '/' && document.activeElement?.tagName !== 'INPUT' && document.activeElement?.tagName !== 'TEXTAREA') {\n e.preventDefault();\n inputRef.current?.focus();\n }\n };\n\n window.addEventListener('keydown', handleKeyDown);\n return () => window.removeEventListener('keydown', handleKeyDown);\n }, []);\n\n const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n setLocalValue(e.target.value);\n };\n\n const handleClear = () => {\n setLocalValue('');\n onChange('');\n inputRef.current?.focus();\n };\n\n const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n if (e.key === 'Enter' && onSearch) {\n e.preventDefault();\n onSearch(localValue);\n }\n\n // Escape to clear\n if (e.key === 'Escape') {\n e.preventDefault();\n handleClear();\n }\n };\n\n // Determine text direction based on current language\n const direction = i18n.language === 'ar' ? 'rtl' : 'ltr';\n\n // Get placeholder text\n const placeholderText = placeholder || t('search.placeholder', 'Search dossiers, people, positions...');\n\n return (\n <div className={`relative w-full ${className}`} dir={direction}>\n {/* Search Icon */}\n <div className={`absolute top-1/2 -translate-y-1/2 ${direction === 'rtl' ? 'right-3' : 'left-3'} pointer-events-none text-muted-foreground`}>\n <Search className=\"size-4\" />\n </div>\n\n {/* Search Input */}\n <Input\n ref={inputRef}\n type=\"search\"\n value={localValue}\n onChange={handleInputChange}\n onKeyDown={handleKeyDown}\n onFocus={onFocus}\n onBlur={onBlur}\n placeholder={placeholderText}\n className={`w-full ${direction === 'rtl' ? 'pe-10 ps-20' : 'pe-20 ps-10'}`}\n dir=\"auto\" // Auto-detect text direction\n autoFocus={autoFocus}\n autoComplete=\"off\"\n autoCorrect=\"off\"\n autoCapitalize=\"off\"\n spellCheck=\"false\"\n // Accessibility\n role=\"searchbox\"\n aria-label={t('search.label', 'Global search')}\n aria-autocomplete=\"list\"\n aria-controls=\"search-suggestions\"\n aria-expanded={false} // Will be controlled by parent\n />\n\n {/* Right Side Actions */}\n <div className={`absolute top-1/2 -translate-y-1/2 ${direction === 'rtl' ? 'left-2' : 'right-2'} flex items-center gap-1`}>\n {/* Loading Indicator */}\n {isLoading && (\n <div className=\"me-1\" aria-label={t('search.loading', 'Loading...')}>\n <Loader2 className=\"size-4 animate-spin text-muted-foreground\" />\n </div>\n )}\n\n {/* Clear Button */}\n {localValue && !isLoading && (\n <Button\n type=\"button\"\n variant=\"ghost\"\n size=\"sm\"\n onClick={handleClear}\n className=\"size-7 p-0 hover:bg-muted\"\n aria-label={t('search.clear', 'Clear search')}\n >\n <X className=\"size-4\" />\n </Button>\n )}\n\n {/* Keyboard Shortcut Hint */}\n {!localValue && !isLoading && (\n <div className=\"hidden items-center gap-1 rounded bg-muted px-2 py-1 text-xs text-muted-foreground sm:flex\">\n <kbd className=\"font-mono\">/</kbd>\n </div>\n )}\n </div>\n </div>\n );\n}\n","/**\n * SearchSuggestions Component\n * Feature: 015-search-retrieval-spec\n * Task: T043\n *\n * Typeahead dropdown with:\n * - Keyboard navigation (â†‘/â†“ arrows, Enter, Escape)\n * - Entity type grouping\n * - Bilingual suggestions\n * - Match highlighting\n * - ARIA accessibility\n */\n\nimport React, { useEffect, useRef } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { ScrollArea } from '@/components/ui/scroll-area';\n\ninterface Suggestion {\n id: string;\n title_en: string;\n title_ar: string;\n type: 'dossier' | 'person' | 'engagement' | 'position' | 'document' | 'mou';\n preview?: string;\n score: number;\n}\n\ninterface SearchSuggestionsProps {\n suggestions: Suggestion[];\n isOpen: boolean;\n activeIndex: number;\n onSelect: (suggestion: Suggestion) => void;\n onClose: () => void;\n onActiveIndexChange: (index: number) => void;\n isLoading?: boolean;\n}\n\nconst entityTypeIcons: Record<string, string> = {\n dossier: 'ğŸ“',\n person: 'ğŸ‘¤',\n engagement: 'ğŸ¤',\n position: 'ğŸ“‹',\n document: 'ğŸ“„',\n mou: 'ğŸ“œ',\n};\n\nconst entityTypeLabels: Record<string, { en: string; ar: string }> = {\n dossier: { en: 'Dossier', ar: 'Ù…Ù„Ù' },\n person: { en: 'Person', ar: 'Ø´Ø®Øµ' },\n engagement: { en: 'Engagement', ar: 'Ù…Ø´Ø§Ø±ÙƒØ©' },\n position: { en: 'Position', ar: 'Ù…ÙˆÙ‚Ù' },\n document: { en: 'Document', ar: 'ÙˆØ«ÙŠÙ‚Ø©' },\n mou: { en: 'MoU', ar: 'Ù…Ø°ÙƒØ±Ø© ØªÙØ§Ù‡Ù…' },\n};\n\nexport function SearchSuggestions({\n suggestions,\n isOpen,\n activeIndex,\n onSelect,\n onClose,\n onActiveIndexChange,\n isLoading = false,\n}: SearchSuggestionsProps) {\n const { t, i18n } = useTranslation();\n const listRef = useRef<HTMLDivElement>(null);\n const activeItemRef = useRef<HTMLDivElement>(null);\n const isRTL = i18n.language === 'ar';\n\n // Scroll active item into view\n useEffect(() => {\n if (activeItemRef.current && isOpen) {\n activeItemRef.current.scrollIntoView({\n block: 'nearest',\n behavior: 'smooth',\n });\n }\n }, [activeIndex, isOpen]);\n\n // Handle keyboard navigation\n useEffect(() => {\n if (!isOpen) return;\n\n const handleKeyDown = (e: KeyboardEvent) => {\n switch (e.key) {\n case 'ArrowDown':\n e.preventDefault();\n onActiveIndexChange(Math.min(activeIndex + 1, suggestions.length - 1));\n break;\n case 'ArrowUp':\n e.preventDefault();\n onActiveIndexChange(Math.max(activeIndex - 1, 0));\n break;\n case 'Enter':\n e.preventDefault();\n if (activeIndex >= 0 && suggestions[activeIndex]) {\n onSelect(suggestions[activeIndex]);\n }\n break;\n case 'Escape':\n e.preventDefault();\n onClose();\n break;\n }\n };\n\n window.addEventListener('keydown', handleKeyDown);\n return () => window.removeEventListener('keydown', handleKeyDown);\n }, [isOpen, activeIndex, suggestions, onActiveIndexChange, onSelect, onClose]);\n\n if (!isOpen) return null;\n\n // Group suggestions by entity type\n const groupedSuggestions = suggestions.reduce((acc, suggestion) => {\n if (!acc[suggestion.type]) {\n acc[suggestion.type] = [];\n }\n acc[suggestion.type].push(suggestion);\n return acc;\n }, {} as Record<string, Suggestion[]>);\n\n return (\n <div\n className=\"absolute z-50 mt-2 w-full rounded-lg border border-gray-200 bg-white shadow-lg dark:border-gray-700 dark:bg-gray-800\"\n role=\"listbox\"\n aria-label={t('search.suggestions.label')}\n dir={isRTL ? 'rtl' : 'ltr'}\n >\n <ScrollArea className=\"max-h-96\">\n <div ref={listRef} className=\"p-2\">\n {isLoading ? (\n <div className=\"px-4 py-3 text-sm text-gray-500 dark:text-gray-400\">\n {t('search.suggestions.loading')}\n </div>\n ) : suggestions.length === 0 ? (\n <div className=\"px-4 py-3 text-sm text-gray-500 dark:text-gray-400\">\n {t('search.suggestions.noResults')}\n </div>\n ) : (\n Object.entries(groupedSuggestions).map(([type, items]) => (\n <div key={type} className=\"mb-3 last:mb-0\">\n {/* Entity Type Header */}\n <div className=\"px-3 py-1 text-xs font-semibold uppercase text-gray-500 dark:text-gray-400\">\n <span className=\"me-1\">{entityTypeIcons[type]}</span>\n {isRTL\n ? entityTypeLabels[type]?.ar || type\n : entityTypeLabels[type]?.en || type}\n </div>\n\n {/* Suggestions List */}\n {items.map((suggestion, idx) => {\n const globalIndex = suggestions.indexOf(suggestion);\n const isActive = globalIndex === activeIndex;\n\n return (\n <div\n key={suggestion.id}\n ref={isActive ? activeItemRef : null}\n role=\"option\"\n aria-selected={isActive}\n className={`\n cursor-pointer rounded-md px-3 py-2 transition-colors\n ${\n isActive\n ? 'bg-blue-50 dark:bg-blue-900/20'\n : 'hover:bg-gray-50 dark:hover:bg-gray-700/50'\n }\n `}\n onClick={() => onSelect(suggestion)}\n onMouseEnter={() => onActiveIndexChange(globalIndex)}\n >\n <div className=\"flex items-start justify-between\">\n {/* Title (bilingual) */}\n <div className=\"min-w-0 flex-1\">\n <div className=\"truncate text-sm font-medium text-gray-900 dark:text-gray-100\">\n {isRTL ? suggestion.title_ar : suggestion.title_en}\n </div>\n {/* Secondary title */}\n {suggestion.title_en && suggestion.title_ar && (\n <div className=\"truncate text-xs text-gray-500 dark:text-gray-400\">\n {isRTL ? suggestion.title_en : suggestion.title_ar}\n </div>\n )}\n {/* Preview text */}\n {suggestion.preview && (\n <div className=\"mt-1 line-clamp-2 text-xs text-gray-600 dark:text-gray-300\">\n {suggestion.preview}\n </div>\n )}\n </div>\n\n {/* Score badge (for debugging in dev mode) */}\n {process.env.NODE_ENV === 'development' && (\n <div className=\"ms-2 rounded bg-gray-100 px-2 py-1 text-xs dark:bg-gray-700\">\n {(suggestion.score * 100).toFixed(0)}%\n </div>\n )}\n </div>\n </div>\n );\n })}\n </div>\n ))\n )}\n </div>\n </ScrollArea>\n\n {/* Footer hint */}\n {!isLoading && suggestions.length > 0 && (\n <div className=\"border-t border-gray-200 bg-gray-50 px-4 py-2 dark:border-gray-700 dark:bg-gray-800/50\">\n <div className=\"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400\">\n <span>\n {isRTL\n ? 'Ø§Ø³ØªØ®Ø¯Ù… â†‘/â†“ Ù„Ù„ØªÙ†Ù‚Ù„ØŒ Enter Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±ØŒ Esc Ù„Ù„Ø¥ØºÙ„Ø§Ù‚'\n : 'Use â†‘/â†“ to navigate, Enter to select, Esc to close'}\n </span>\n </div>\n </div>\n )}\n </div>\n );\n}\n","/**\n * EntityTypeTabs Component\n * Feature: 015-search-retrieval-spec\n * Task: T044\n *\n * Tabs for result filtering:\n * - All, Dossiers, People, Engagements, Positions, MoUs, Documents\n * - Count badges per tab\n * - Keyboard navigation (Tab, Arrow keys)\n * - ARIA accessibility\n */\n\nimport React, { useRef, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Tabs, TabsList, TabsTrigger } from '@/components/ui/tabs';\n\nexport type EntityType =\n | 'all'\n // 7 unified dossier types\n | 'country'\n | 'organization'\n | 'forum'\n | 'engagement'\n | 'theme'\n | 'working_group'\n | 'person'\n // Other entities (not dossiers)\n | 'positions'\n | 'documents';\n\ninterface EntityTypeCounts {\n all: number;\n // 7 unified dossier types\n country: number;\n organization: number;\n forum: number;\n engagement: number;\n theme: number;\n working_group: number;\n person: number;\n // Other entities\n positions: number;\n documents: number;\n}\n\ninterface EntityTypeTabsProps {\n selectedType: EntityType;\n counts: EntityTypeCounts;\n onTypeChange: (type: EntityType) => void;\n isLoading?: boolean;\n}\n\nconst entityTypeConfig: Record<\n EntityType,\n { icon: string; labelKey: string; color: string }\n> = {\n all: { icon: 'ğŸ”', labelKey: 'all', color: 'text-gray-700 dark:text-gray-300' },\n // 7 unified dossier types\n country: { icon: 'ğŸŒ', labelKey: 'country', color: 'text-blue-600 dark:text-blue-400' },\n organization: { icon: 'ğŸ¢', labelKey: 'organization', color: 'text-purple-600 dark:text-purple-400' },\n forum: { icon: 'ğŸ‘¥', labelKey: 'forum', color: 'text-cyan-600 dark:text-cyan-400' },\n engagement: { icon: 'ğŸ¤', labelKey: 'engagement', color: 'text-green-600 dark:text-green-400' },\n theme: { icon: 'ğŸ¯', labelKey: 'theme', color: 'text-pink-600 dark:text-pink-400' },\n working_group: { icon: 'ğŸ’¼', labelKey: 'working_group', color: 'text-amber-600 dark:text-amber-400' },\n person: { icon: 'ğŸ‘¤', labelKey: 'person', color: 'text-teal-600 dark:text-teal-400' },\n // Other entities (not dossiers)\n positions: { icon: 'ğŸ“‹', labelKey: 'positions', color: 'text-orange-600 dark:text-orange-400' },\n documents: { icon: 'ğŸ“„', labelKey: 'documents', color: 'text-indigo-600 dark:text-indigo-400' },\n};\n\nexport function EntityTypeTabs({\n selectedType,\n counts,\n onTypeChange,\n isLoading = false,\n}: EntityTypeTabsProps) {\n const { t, i18n } = useTranslation();\n const tabsRef = useRef<HTMLDivElement>(null);\n const isRTL = i18n.language === 'ar';\n\n // Handle keyboard navigation\n useEffect(() => {\n const handleKeyDown = (e: KeyboardEvent) => {\n if (!tabsRef.current?.contains(document.activeElement)) return;\n\n const types = Object.keys(entityTypeConfig) as EntityType[];\n const currentIndex = types.indexOf(selectedType);\n\n switch (e.key) {\n case 'ArrowLeft':\n e.preventDefault();\n if (isRTL) {\n // RTL: Left arrow moves forward\n const nextIndex = (currentIndex + 1) % types.length;\n onTypeChange(types[nextIndex]);\n } else {\n // LTR: Left arrow moves backward\n const prevIndex = (currentIndex - 1 + types.length) % types.length;\n onTypeChange(types[prevIndex]);\n }\n break;\n case 'ArrowRight':\n e.preventDefault();\n if (isRTL) {\n // RTL: Right arrow moves backward\n const prevIndex = (currentIndex - 1 + types.length) % types.length;\n onTypeChange(types[prevIndex]);\n } else {\n // LTR: Right arrow moves forward\n const nextIndex = (currentIndex + 1) % types.length;\n onTypeChange(types[nextIndex]);\n }\n break;\n case 'Home':\n e.preventDefault();\n onTypeChange('all');\n break;\n case 'End':\n e.preventDefault();\n onTypeChange(types[types.length - 1]);\n break;\n }\n };\n\n window.addEventListener('keydown', handleKeyDown);\n return () => window.removeEventListener('keydown', handleKeyDown);\n }, [selectedType, isRTL, onTypeChange]);\n\n return (\n <div ref={tabsRef} className=\"w-full overflow-x-auto\" dir={isRTL ? 'rtl' : 'ltr'}>\n <Tabs value={selectedType} onValueChange={(value) => onTypeChange(value as EntityType)}>\n <TabsList\n className=\"inline-flex h-10 w-full items-center justify-start rounded-md bg-muted p-1 text-muted-foreground sm:w-auto\"\n role=\"tablist\"\n aria-label={t('search.tabs.label')}\n >\n {(Object.keys(entityTypeConfig) as EntityType[]).map((type) => {\n const config = entityTypeConfig[type];\n const count = counts[type] || 0;\n const isSelected = selectedType === type;\n\n return (\n <TabsTrigger\n key={type}\n value={type}\n role=\"tab\"\n aria-selected={isSelected}\n aria-controls={`search-results-${type}`}\n className={`\n inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5\n text-sm font-medium ring-offset-background transition-all\n focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\n disabled:pointer-events-none disabled:opacity-50\n data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\n ${isLoading ? 'cursor-wait' : 'cursor-pointer'}\n `}\n disabled={isLoading}\n >\n {/* Icon */}\n <span className={`me-2 ${isRTL ? 'me-0 ms-2' : ''}`}>{config.icon}</span>\n\n {/* Label */}\n <span className={isSelected ? config.color : ''}>\n {t(`search.entityTypes.${config.labelKey}`)}\n </span>\n\n {/* Count Badge */}\n {count > 0 && (\n <span\n className={`\n ms-2 ${isRTL ? 'me-2 ms-0' : ''}\n inline-flex h-5 min-w-5\n items-center justify-center rounded-full px-1.5\n text-xs font-semibold\n ${\n isSelected\n ? 'bg-primary text-primary-foreground'\n : 'bg-muted-foreground/20 text-muted-foreground'\n }\n `}\n aria-label={t('search.tabs.countLabel', { count })}\n >\n {count > 999 ? '999+' : count}\n </span>\n )}\n\n {/* Loading indicator */}\n {isLoading && isSelected && (\n <span className=\"ms-2 inline-block size-3 animate-spin rounded-full border-2 border-current border-t-transparent\" />\n )}\n </TabsTrigger>\n );\n })}\n </TabsList>\n </Tabs>\n\n {/* Keyboard hint (visible on focus) */}\n <div className=\"sr-only\" role=\"status\" aria-live=\"polite\">\n {t('search.tabs.keyboardHint')}\n </div>\n </div>\n );\n}\n","/**\n * SearchResultsList Component\n * Feature: 015-search-retrieval-spec + 017-entity-relationships-and\n * Tasks: T045, T097, T099\n *\n * Results list with:\n * - Bilingual result cards (title, snippet with highlights)\n * - Entity type badges\n * - Rank scores\n * - \"Archived\" badges\n * - Infinite scroll/pagination\n * - Empty states with typo suggestions\n * - Section dividers (Exact vs Related)\n * - Loading skeletons\n * - ARIA accessibility\n * - Relationship context display (T097)\n * - Relationship path highlighting (T099)\n */\n\nimport React, { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Badge } from '@/components/ui/badge';\nimport { ChevronRight, ChevronLeft, Network } from 'lucide-react';\n\ninterface RelationshipPathSegment {\n dossier_id: string;\n dossier_name_en: string;\n dossier_name_ar: string;\n dossier_type: string;\n relationship_type?: string;\n relationship_strength?: 'primary' | 'secondary' | 'observer';\n}\n\ninterface SearchResult {\n id: string;\n entityType: 'dossier' | 'person' | 'engagement' | 'position' | 'document' | 'mou';\n title_en: string;\n title_ar: string;\n snippet_en?: string;\n snippet_ar?: string;\n rankScore: number;\n matchType: 'exact' | 'semantic';\n isArchived?: boolean;\n updatedAt: string;\n url: string;\n // T097: Relationship context\n parentDossier?: {\n id: string;\n name_en: string;\n name_ar: string;\n type: string;\n };\n linkedDossiers?: Array<{\n id: string;\n name_en: string;\n name_ar: string;\n type: string;\n link_type?: string;\n }>;\n // T099: Relationship path for multi-dossier entities\n relationshipPath?: RelationshipPathSegment[];\n}\n\ninterface SearchResultsListProps {\n results: SearchResult[];\n exactMatches?: SearchResult[];\n isLoading?: boolean;\n hasMore?: boolean;\n onLoadMore?: () => void;\n typoSuggestions?: string[];\n searchTips?: string[];\n}\n\nconst entityTypeBadges: Record<\n string,\n { icon: string; label: { en: string; ar: string }; color: string }\n> = {\n dossier: {\n icon: 'ğŸ“',\n label: { en: 'Dossier', ar: 'Ù…Ù„Ù' },\n color: 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300',\n },\n person: {\n icon: 'ğŸ‘¤',\n label: { en: 'Person', ar: 'Ø´Ø®Øµ' },\n color: 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300',\n },\n engagement: {\n icon: 'ğŸ¤',\n label: { en: 'Engagement', ar: 'Ù…Ø´Ø§Ø±ÙƒØ©' },\n color: 'bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300',\n },\n position: {\n icon: 'ğŸ“‹',\n label: { en: 'Position', ar: 'Ù…ÙˆÙ‚Ù' },\n color: 'bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300',\n },\n document: {\n icon: 'ğŸ“„',\n label: { en: 'Document', ar: 'ÙˆØ«ÙŠÙ‚Ø©' },\n color: 'bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300',\n },\n mou: {\n icon: 'ğŸ“œ',\n label: { en: 'MoU', ar: 'Ù…Ø°ÙƒØ±Ø© ØªÙØ§Ù‡Ù…' },\n color: 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300',\n },\n};\n\nfunction ResultCard({ result, isRTL }: { result: SearchResult; isRTL: boolean }) {\n const badge = entityTypeBadges[result.entityType] || entityTypeBadges.dossier;\n const [showRelationshipPath, setShowRelationshipPath] = useState(false);\n\n // T099: Get relationship strength color\n const getRelationshipColor = (strength?: string) => {\n switch (strength) {\n case 'primary':\n return 'text-blue-600 dark:text-blue-400';\n case 'secondary':\n return 'text-gray-600 dark:text-gray-400';\n case 'observer':\n return 'text-gray-400 dark:text-gray-500';\n default:\n return 'text-gray-600 dark:text-gray-400';\n }\n };\n\n return (\n <a\n href={result.url}\n className=\"block rounded-lg border border-gray-200 p-4 transition-all hover:border-blue-500 hover:shadow-md dark:border-gray-700 dark:hover:border-blue-400\"\n role=\"listitem\"\n >\n <div className=\"flex items-start justify-between gap-3\">\n <div className=\"min-w-0 flex-1\">\n {/* Badges row */}\n <div className=\"mb-2 flex flex-wrap items-center gap-2\">\n {/* Entity type badge */}\n <span className={`inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ${badge.color}`}>\n <span className=\"me-1\">{badge.icon}</span>\n {isRTL ? badge.label.ar : badge.label.en}\n </span>\n\n {/* Archived badge */}\n {result.isArchived && (\n <span className=\"inline-flex items-center rounded-md bg-gray-100 px-2 py-1 text-xs font-medium text-gray-700 dark:bg-gray-800 dark:text-gray-300\">\n {isRTL ? 'Ù…Ø¤Ø±Ø´Ù' : 'Archived'}\n </span>\n )}\n\n {/* Match type badge */}\n {result.matchType === 'semantic' && (\n <span className=\"inline-flex items-center rounded-md bg-purple-100 px-2 py-1 text-xs font-medium text-purple-700 dark:bg-purple-900/30 dark:text-purple-300\">\n {isRTL ? 'ØªØ·Ø§Ø¨Ù‚ Ø¯Ù„Ø§Ù„ÙŠ' : 'Semantic match'}\n </span>\n )}\n\n {/* T099: Multi-dossier relationship badge */}\n {result.relationshipPath && result.relationshipPath.length > 1 && (\n <button\n onClick={(e) => {\n e.preventDefault();\n setShowRelationshipPath(!showRelationshipPath);\n }}\n className=\"inline-flex items-center rounded-md bg-indigo-100 px-2 py-1 text-xs font-medium text-indigo-700 transition-colors hover:bg-indigo-200 dark:bg-indigo-900/30 dark:text-indigo-300 dark:hover:bg-indigo-900/40\"\n >\n <Network className=\"me-1 size-3\" />\n {result.relationshipPath.length} {isRTL ? 'Ù…Ù„ÙØ§Øª' : 'dossiers'}\n </button>\n )}\n </div>\n\n {/* Title (bilingual) */}\n <h3 className=\"mb-1 text-lg font-semibold text-gray-900 dark:text-gray-100\">\n {isRTL ? result.title_ar : result.title_en}\n </h3>\n\n {/* Secondary title */}\n {result.title_en && result.title_ar && (\n <p className=\"mb-2 text-sm text-gray-600 dark:text-gray-400\">\n {isRTL ? result.title_en : result.title_ar}\n </p>\n )}\n\n {/* Snippet with highlights */}\n {(result.snippet_en || result.snippet_ar) && (\n <div\n className=\"line-clamp-2 text-sm text-gray-700 dark:text-gray-300\"\n dangerouslySetInnerHTML={{\n __html: isRTL ? result.snippet_ar || '' : result.snippet_en || '',\n }}\n />\n )}\n\n {/* Metadata */}\n <div className=\"mt-2 text-xs text-gray-500 dark:text-gray-400\">\n {isRTL ? 'Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:' : 'Updated:'} {new Date(result.updatedAt).toLocaleDateString(isRTL ? 'ar-SA' : 'en-US')}\n </div>\n\n {/* T097: Relationship Context - Parent Dossier */}\n {result.parentDossier && (\n <div className=\"mt-2 flex items-center gap-1 text-xs text-gray-600 dark:text-gray-400\">\n <span>{isRTL ? 'Ù…Ù†:' : 'from'}</span>\n <Badge variant=\"outline\" className=\"text-xs\">\n {isRTL ? result.parentDossier.name_ar : result.parentDossier.name_en}\n </Badge>\n <span className=\"text-gray-400\">({result.parentDossier.type})</span>\n </div>\n )}\n\n {/* T097: Relationship Context - Linked Dossiers */}\n {result.linkedDossiers && result.linkedDossiers.length > 0 && (\n <div className=\"mt-2 flex flex-wrap items-center gap-1 text-xs text-gray-600 dark:text-gray-400\">\n <span>{isRTL ? 'Ù…Ø±ØªØ¨Ø· Ø¨Ù€:' : 'linked to:'}</span>\n {result.linkedDossiers.slice(0, 2).map((dossier, idx) => (\n <Badge key={dossier.id} variant=\"outline\" className=\"text-xs\">\n {isRTL ? dossier.name_ar : dossier.name_en}\n </Badge>\n ))}\n {result.linkedDossiers.length > 2 && (\n <span className=\"text-gray-400\">\n {isRTL ? `...Ùˆ ${result.linkedDossiers.length - 2} Ø£Ø®Ø±Ù‰` : `...and ${result.linkedDossiers.length - 2} more`}\n </span>\n )}\n </div>\n )}\n\n {/* T099: Expandable Relationship Path */}\n {showRelationshipPath && result.relationshipPath && result.relationshipPath.length > 0 && (\n <div className=\"mt-3 rounded-md border border-gray-200 bg-gray-50 p-3 dark:border-gray-700 dark:bg-gray-800/50\">\n <div className=\"mb-2 text-xs font-medium text-gray-700 dark:text-gray-300\">\n {isRTL ? 'Ù…Ø³Ø§Ø± Ø§Ù„Ø¹Ù„Ø§Ù‚Ø©:' : 'Relationship Path:'}\n </div>\n <div className=\"flex flex-col gap-2\">\n {result.relationshipPath.map((segment, idx) => (\n <div key={segment.dossier_id} className=\"flex items-center gap-2 text-xs\">\n <Badge variant=\"outline\" className=\"text-xs\">\n {isRTL ? segment.dossier_name_ar : segment.dossier_name_en}\n </Badge>\n {idx < result.relationshipPath!.length - 1 && (\n <>\n {isRTL ? (\n <ChevronLeft className=\"size-3 text-gray-400\" />\n ) : (\n <ChevronRight className=\"size-3 text-gray-400\" />\n )}\n {segment.relationship_type && (\n <span className={`text-xs ${getRelationshipColor(segment.relationship_strength)}`}>\n {segment.relationship_type}\n </span>\n )}\n {isRTL ? (\n <ChevronLeft className=\"size-3 text-gray-400\" />\n ) : (\n <ChevronRight className=\"size-3 text-gray-400\" />\n )}\n </>\n )}\n </div>\n ))}\n </div>\n </div>\n )}\n </div>\n\n {/* Rank score (dev mode only) */}\n {process.env.NODE_ENV === 'development' && (\n <div className=\"shrink-0 text-end\">\n <div className=\"text-xs text-gray-500 dark:text-gray-400\">Rank</div>\n <div className=\"font-mono text-sm font-semibold text-gray-700 dark:text-gray-300\">\n {result.rankScore.toFixed(1)}\n </div>\n </div>\n )}\n </div>\n </a>\n );\n}\n\nfunction LoadingSkeleton() {\n return (\n <div className=\"rounded-lg border border-gray-200 p-4 dark:border-gray-700\">\n <div className=\"flex items-start gap-3\">\n <div className=\"flex-1 space-y-3\">\n <div className=\"flex gap-2\">\n <Skeleton className=\"h-6 w-20\" />\n <Skeleton className=\"h-6 w-16\" />\n </div>\n <Skeleton className=\"h-6 w-3/4\" />\n <Skeleton className=\"h-4 w-1/2\" />\n <Skeleton className=\"h-4 w-full\" />\n <Skeleton className=\"h-4 w-full\" />\n <Skeleton className=\"h-3 w-32\" />\n </div>\n </div>\n </div>\n );\n}\n\nexport function SearchResultsList({\n results,\n exactMatches = [],\n isLoading = false,\n hasMore = false,\n onLoadMore,\n typoSuggestions = [],\n searchTips = [],\n}: SearchResultsListProps) {\n const { t, i18n } = useTranslation();\n const isRTL = i18n.language === 'ar';\n\n // Empty state\n if (!isLoading && results.length === 0 && exactMatches.length === 0) {\n return (\n <div className=\"py-12 text-center\" dir={isRTL ? 'rtl' : 'ltr'}>\n <div className=\"mb-4 text-6xl\">ğŸ”</div>\n <h3 className=\"mb-2 text-lg font-semibold text-gray-900 dark:text-gray-100\">\n {t('search.noResults.title')}\n </h3>\n <p className=\"mb-6 text-gray-600 dark:text-gray-400\">\n {t('search.noResults.description')}\n </p>\n\n {/* Typo suggestions */}\n {typoSuggestions.length > 0 && (\n <div className=\"mb-6\">\n <p className=\"mb-2 text-sm text-gray-700 dark:text-gray-300\">\n {t('search.noResults.didYouMean')}\n </p>\n <div className=\"flex flex-wrap justify-center gap-2\">\n {typoSuggestions.map((suggestion, idx) => (\n <button\n key={idx}\n className=\"rounded-md bg-blue-50 px-3 py-1 text-sm text-blue-600 transition-colors hover:bg-blue-100 dark:bg-blue-900/20 dark:text-blue-400 dark:hover:bg-blue-900/30\"\n onClick={() => {\n // This would trigger a new search\n // onSearchQueryChange(suggestion);\n }}\n >\n {suggestion}\n </button>\n ))}\n </div>\n </div>\n )}\n\n {/* Search tips */}\n {searchTips.length > 0 && (\n <div className=\"mx-auto max-w-md text-start\">\n <p className=\"mb-2 text-sm font-medium text-gray-700 dark:text-gray-300\">\n {t('search.noResults.tips')}\n </p>\n <ul className=\"list-inside list-disc space-y-1 text-sm text-gray-600 dark:text-gray-400\">\n {searchTips.map((tip, idx) => (\n <li key={idx}>{tip}</li>\n ))}\n </ul>\n </div>\n )}\n </div>\n );\n }\n\n return (\n <ScrollArea className=\"h-full\" dir={isRTL ? 'rtl' : 'ltr'}>\n <div className=\"space-y-4\" role=\"list\">\n {/* Exact Matches Section */}\n {exactMatches.length > 0 && (\n <div>\n <h2 className=\"mb-3 px-1 text-sm font-semibold text-gray-700 dark:text-gray-300\">\n {t('search.sections.exactMatches')} ({exactMatches.length})\n </h2>\n <div className=\"space-y-3\">\n {exactMatches.map((result) => (\n <ResultCard key={result.id} result={result} isRTL={isRTL} />\n ))}\n </div>\n </div>\n )}\n\n {/* Related/Semantic Matches Section */}\n {results.length > 0 && (\n <div>\n {exactMatches.length > 0 && (\n <h2 className=\"mb-3 mt-6 px-1 text-sm font-semibold text-gray-700 dark:text-gray-300\">\n {t('search.sections.related')} ({results.length})\n </h2>\n )}\n <div className=\"space-y-3\">\n {results.map((result) => (\n <ResultCard key={result.id} result={result} isRTL={isRTL} />\n ))}\n </div>\n </div>\n )}\n\n {/* Loading skeletons */}\n {isLoading && (\n <div className=\"space-y-3\">\n {[...Array(3)].map((_, idx) => (\n <LoadingSkeleton key={idx} />\n ))}\n </div>\n )}\n\n {/* Load more button */}\n {!isLoading && hasMore && onLoadMore && (\n <div className=\"pt-4 text-center\">\n <button\n onClick={onLoadMore}\n className=\"rounded-md bg-blue-600 px-4 py-2 text-white transition-colors hover:bg-blue-700\"\n >\n {t('search.loadMore')}\n </button>\n </div>\n )}\n </div>\n </ScrollArea>\n );\n}\n","/**\n * SearchErrorBoundary Component\n * Feature: 015-search-retrieval-spec\n * Task: T050\n *\n * Error boundary wrapping search UI:\n * - Catches rendering errors\n * - Displays bilingual error message\n * - Provides \"Try again\" button\n * - Logs errors to console\n * - Prevents full app crash on search failures\n */\n\nimport React, { Component, ErrorInfo, ReactNode } from 'react';\n\ninterface Props {\n children: ReactNode;\n fallback?: ReactNode;\n onError?: (error: Error, errorInfo: ErrorInfo) => void;\n}\n\ninterface State {\n hasError: boolean;\n error: Error | null;\n}\n\nexport class SearchErrorBoundary extends Component<Props, State> {\n constructor(props: Props) {\n super(props);\n this.state = { hasError: false, error: null };\n }\n\n static getDerivedStateFromError(error: Error): State {\n return { hasError: true, error };\n }\n\n componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n // Log error to console\n console.error('Search Error Boundary caught an error:', error, errorInfo);\n\n // Call custom error handler if provided\n if (this.props.onError) {\n this.props.onError(error, errorInfo);\n }\n\n // In production, you might want to log to an error tracking service\n if (process.env.NODE_ENV === 'production') {\n // Example: logErrorToService(error, errorInfo);\n }\n }\n\n handleReset = () => {\n this.setState({ hasError: false, error: null });\n };\n\n render() {\n if (this.state.hasError) {\n // Use custom fallback if provided\n if (this.props.fallback) {\n return this.props.fallback;\n }\n\n // Default error UI (bilingual)\n return (\n <div className=\"flex min-h-[400px] items-center justify-center p-8\">\n <div className=\"max-w-md text-center\">\n {/* Error icon */}\n <div className=\"mb-4 text-6xl\">âš ï¸</div>\n\n {/* Error title (English) */}\n <h2 className=\"mb-2 text-xl font-semibold text-gray-900 dark:text-gray-100\">\n Search Error\n </h2>\n\n {/* Error title (Arabic) */}\n <h2\n className=\"mb-4 text-xl font-semibold text-gray-900 dark:text-gray-100\"\n dir=\"rtl\"\n >\n Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«\n </h2>\n\n {/* Error description (English) */}\n <p className=\"mb-2 text-gray-600 dark:text-gray-400\">\n Something went wrong while loading the search results.\n </p>\n\n {/* Error description (Arabic) */}\n <p className=\"mb-6 text-gray-600 dark:text-gray-400\" dir=\"rtl\">\n Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«.\n </p>\n\n {/* Error details (dev mode only) */}\n {process.env.NODE_ENV === 'development' && this.state.error && (\n <details className=\"mb-6 rounded-lg bg-gray-100 p-4 text-start dark:bg-gray-800\">\n <summary className=\"mb-2 cursor-pointer text-sm font-medium text-gray-700 dark:text-gray-300\">\n Error Details (Dev Only)\n </summary>\n <pre className=\"overflow-x-auto text-xs text-red-600 dark:text-red-400\">\n {this.state.error.toString()}\n {'\\n\\n'}\n {this.state.error.stack}\n </pre>\n </details>\n )}\n\n {/* Action buttons */}\n <div className=\"flex flex-col justify-center gap-3 sm:flex-row\">\n {/* Try again button */}\n <button\n onClick={this.handleReset}\n className=\"rounded-md bg-blue-600 px-4 py-2 text-white transition-colors hover:bg-blue-700\"\n >\n Try Again / Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰\n </button>\n\n {/* Reload page button */}\n <button\n onClick={() => window.location.reload()}\n className=\"rounded-md bg-gray-200 px-4 py-2 text-gray-900 transition-colors hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600\"\n >\n Reload Page / Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©\n </button>\n </div>\n\n {/* Help text */}\n <p className=\"mt-6 text-sm text-gray-500 dark:text-gray-400\">\n If the problem persists, please contact support.\n <br />\n Ø¥Ø°Ø§ Ø§Ø³ØªÙ…Ø±Øª Ø§Ù„Ù…Ø´ÙƒÙ„Ø©ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ.\n </p>\n </div>\n </div>\n );\n }\n\n return this.props.children;\n }\n}\n","/**\n * useSearch TanStack Query Hook\n * Feature: 015-search-retrieval-spec\n * Task: T047\n *\n * Custom hook for global search functionality using TanStack Query\n * Provides caching, automatic retry, and request cancellation\n */\n\nimport { useQuery } from '@tanstack/react-query';\nimport { supabase } from '../lib/supabase';\n\nexport type EntityType = 'dossiers' | 'people' | 'engagements' | 'positions' | 'documents' | 'all';\n\nexport interface SearchOptions {\n  /** Search query string */\n  query: string;\n  /** Entity types to search (comma-separated or array) */\n  entityTypes?: EntityType | EntityType[];\n  /** Number of results per page */\n  limit?: number;\n  /** Pagination offset */\n  offset?: number;\n  /** Include archived items */\n  includeArchived?: boolean;\n  /** Language for search (auto-detected if not provided) */\n  language?: 'en' | 'ar';\n}\n\nexport interface SearchResult {\n  /** Entity ID */\n  id: string;\n  /** Entity type */\n  type: EntityType;\n  /** Result title (bilingual) */\n  title_en: string;\n  title_ar: string;\n  /** Result snippet with highlights */\n  snippet_en?: string;\n  snippet_ar?: string;\n  /** Relevance score */\n  rank_score: number;\n  /** Last updated timestamp */\n  updated_at: string;\n  /** Is archived */\n  is_archived?: boolean;\n  /** Match type */\n  match_type: 'exact' | 'semantic';\n}\n\nexport interface SearchCounts {\n  /** Total results */\n  total: number;\n  /** Results per entity type */\n  dossiers: number;\n  people: number;\n  engagements: number;\n  positions: number;\n  documents: number;\n  /** Restricted results count */\n  restricted: number;\n}\n\nexport interface SearchResponse {\n  /** Search results */\n  results: SearchResult[];\n  /** Result counts */\n  counts: SearchCounts;\n  /** Query metadata */\n  query: {\n    text: string;\n    normalized: string;\n    language_detected: 'ar' | 'en' | 'mixed';\n    has_boolean_operators: boolean;\n  };\n  /** Performance metrics */\n  took_ms: number;\n  /** Metadata */\n  metadata?: {\n    restricted_message?: string;\n    warnings?: string[];\n  };\n}\n\n/**\n * Perform global search across entities\n *\n * @param options - Search options\n * @returns TanStack Query result with search data\n *\n * @example\n * ```typescript\n * const { data, isLoading, error } = useSearch({\n *   query: 'climate change',\n *   entityTypes: ['dossiers', 'positions'],\n *   limit: 20\n * });\n * ```\n */\nexport function useSearch(options: SearchOptions) {\n  const {\n    query,\n    entityTypes = 'all',\n    limit = 20,\n    offset = 0,\n    includeArchived = false,\n    language\n  } = options;\n\n  return useQuery({\n    queryKey: ['search', query, entityTypes, limit, offset, includeArchived, language],\n\n    queryFn: async ({ signal }) => {\n      // Build query parameters\n      const params = new URLSearchParams();\n      params.set('q', query);\n\n      if (Array.isArray(entityTypes)) {\n        params.set('type', entityTypes.join(','));\n      } else if (entityTypes !== 'all') {\n        params.set('type', entityTypes);\n      }\n\n      params.set('limit', limit.toString());\n      params.set('offset', offset.toString());\n      params.set('include_archived', includeArchived.toString());\n\n      if (language) {\n        params.set('lang', language);\n      }\n\n      // Get current session token\n      const { data: { session } } = await supabase.auth.getSession();\n\n      if (!session) {\n        throw new Error('Not authenticated');\n      }\n\n      // Make API request with AbortController for cancellation\n      const response = await fetch(`${import.meta.env.VITE_API_URL}/api/search?${params}`, {\n        method: 'GET',\n        headers: {\n          'Authorization': `Bearer ${session.access_token}`,\n          'Content-Type': 'application/json'\n        },\n        signal\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Search failed');\n      }\n\n      const data: SearchResponse = await response.json();\n      return data;\n    },\n\n    // Only run query if we have a search term\n    enabled: Boolean(query && query.trim().length > 0),\n\n    // Cache configuration\n    staleTime: 60 * 1000, // 60 seconds - consider data stale after 1 minute\n    gcTime: 5 * 60 * 1000, // 5 minutes - keep in cache for 5 minutes\n\n    // Retry configuration\n    retry: 2, // Retry failed requests twice\n    retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 30000), // Exponential backoff\n\n    // Refetch configuration\n    refetchOnWindowFocus: false, // Don't refetch when window regains focus\n    refetchOnReconnect: true, // Refetch when internet connection is restored\n  });\n}\n\n/**\n * Prefetch search results (useful for hover states, etc.)\n *\n * @param queryClient - TanStack Query client\n * @param options - Search options\n */\nexport async function prefetchSearch(\n  queryClient: any,\n  options: SearchOptions\n) {\n  await queryClient.prefetchQuery({\n    queryKey: ['search', options.query, options.entityTypes, options.limit, options.offset],\n    queryFn: async () => {\n      const params = new URLSearchParams();\n      params.set('q', options.query);\n\n      if (options.entityTypes && options.entityTypes !== 'all') {\n        params.set('type', Array.isArray(options.entityTypes) ? options.entityTypes.join(',') : options.entityTypes);\n      }\n\n      params.set('limit', (options.limit || 20).toString());\n      params.set('offset', (options.offset || 0).toString());\n\n      const { data: { session } } = await supabase.auth.getSession();\n\n      if (!session) {\n        throw new Error('Not authenticated');\n      }\n\n      const response = await fetch(`${import.meta.env.VITE_API_URL}/api/search?${params}`, {\n        headers: {\n          'Authorization': `Bearer ${session.access_token}`\n        }\n      });\n\n      return response.json();\n    },\n    staleTime: 60 * 1000\n  });\n}\n","/**\n * useSuggestions TanStack Query Hook\n * Feature: 015-search-retrieval-spec\n * Task: T048\n *\n * Custom hook for typeahead search suggestions using TanStack Query\n * Includes debouncing, caching, and automatic request cancellation\n */\n\nimport { useQuery } from '@tanstack/react-query';\nimport { useMemo } from 'react';\nimport { supabase } from '../lib/supabase';\nimport { useDebouncedValue } from './useDebouncedValue';\nimport { EntityType } from './useSearch';\n\nexport interface Suggestion {\n  /** Entity ID */\n  id: string;\n  /** Entity type */\n  type: EntityType;\n  /** Suggestion title (bilingual) */\n  title_en: string;\n  title_ar: string;\n  /** Preview text */\n  preview_en?: string;\n  preview_ar?: string;\n  /** Relevance score (0.0-1.0) */\n  score: number;\n  /** Last updated */\n  updated_at?: string;\n}\n\nexport interface SuggestionsResponse {\n  /** Array of suggestions */\n  suggestions: Suggestion[];\n  /** Query metadata */\n  query: {\n    prefix: string;\n    normalized: string;\n    language: 'en' | 'ar' | 'mixed';\n  };\n  /** Performance metrics */\n  took_ms: number;\n  /** Was this a cache hit? */\n  cache_hit: boolean;\n}\n\nexport interface SuggestionsOptions {\n  /** Search prefix */\n  prefix: string;\n  /** Entity types to suggest */\n  entityType?: EntityType;\n  /** Maximum number of suggestions */\n  limit?: number;\n  /** Language preference */\n  language?: 'en' | 'ar';\n  /** Debounce delay in milliseconds */\n  debounceMs?: number;\n}\n\n/**\n * Get typeahead search suggestions\n *\n * @param options - Suggestions options\n * @returns TanStack Query result with suggestions\n *\n * @example\n * ```typescript\n * const { suggestions, isLoading, cacheHit } = useSuggestions({\n *   prefix: 'clim',\n *   entityType: 'dossiers',\n *   limit: 10\n * });\n * ```\n */\nexport function useSuggestions(options: SuggestionsOptions) {\n  const {\n    prefix,\n    entityType = 'all',\n    limit = 10,\n    language,\n    debounceMs = 200\n  } = options;\n\n  // Debounce the prefix to avoid too many requests\n  const debouncedPrefix = useDebouncedValue(prefix, debounceMs);\n\n  const queryResult = useQuery({\n    queryKey: ['suggestions', debouncedPrefix, entityType, limit, language],\n\n    queryFn: async ({ signal }) => {\n      // Build query parameters\n      const params = new URLSearchParams();\n      params.set('q', debouncedPrefix);\n\n      if (entityType !== 'all') {\n        params.set('type', entityType);\n      }\n\n      params.set('limit', limit.toString());\n\n      if (language) {\n        params.set('lang', language);\n      }\n\n      // Get current session token\n      const { data: { session } } = await supabase.auth.getSession();\n\n      if (!session) {\n        throw new Error('Not authenticated');\n      }\n\n      // Make API request with AbortController for cancellation\n      const response = await fetch(`${import.meta.env.VITE_API_URL}/api/search/suggest?${params}`, {\n        method: 'GET',\n        headers: {\n          'Authorization': `Bearer ${session.access_token}`,\n          'Content-Type': 'application/json'\n        },\n        signal\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Failed to fetch suggestions');\n      }\n\n      const data: SuggestionsResponse = await response.json();\n\n      // Check performance requirement: must be < 200ms\n      if (data.took_ms > 200) {\n        console.warn(`Suggestions took ${data.took_ms}ms (requirement: <200ms)`);\n      }\n\n      return data;\n    },\n\n    // Only run query if we have a prefix (at least 2 characters)\n    enabled: Boolean(debouncedPrefix && debouncedPrefix.trim().length >= 2),\n\n    // Cache configuration\n    staleTime: 5 * 60 * 1000, // 5 minutes - suggestions are fairly stable\n    gcTime: 10 * 60 * 1000, // 10 minutes - keep in cache\n\n    // Retry configuration\n    retry: 1, // Only retry once for suggestions (performance-critical)\n    retryDelay: 500, // Quick retry\n\n    // Refetch configuration\n    refetchOnWindowFocus: false,\n    refetchOnReconnect: false, // Don't refetch suggestions on reconnect\n  });\n\n  // Enhanced return value with convenience properties\n  const result = useMemo(() => ({\n    ...queryResult,\n    suggestions: queryResult.data?.suggestions || [],\n    cacheHit: queryResult.data?.cache_hit || false,\n    tookMs: queryResult.data?.took_ms || 0,\n    isEmpty: (queryResult.data?.suggestions?.length || 0) === 0\n  }), [queryResult]);\n\n  return result;\n}\n\n/**\n * Prefetch suggestions for a prefix (useful for hover states)\n *\n * @param queryClient - TanStack Query client\n * @param options - Suggestion options\n */\nexport async function prefetchSuggestions(\n  queryClient: any,\n  options: SuggestionsOptions\n) {\n  const { prefix, entityType = 'all', limit = 10, language } = options;\n\n  await queryClient.prefetchQuery({\n    queryKey: ['suggestions', prefix, entityType, limit, language],\n    queryFn: async () => {\n      const params = new URLSearchParams();\n      params.set('q', prefix);\n\n      if (entityType !== 'all') {\n        params.set('type', entityType);\n      }\n\n      params.set('limit', limit.toString());\n\n      if (language) {\n        params.set('lang', language);\n      }\n\n      const { data: { session } } = await supabase.auth.getSession();\n\n      if (!session) {\n        throw new Error('Not authenticated');\n      }\n\n      const response = await fetch(`${import.meta.env.VITE_API_URL}/api/search/suggest?${params}`, {\n        headers: {\n          'Authorization': `Bearer ${session.access_token}`\n        }\n      });\n\n      return response.json();\n    },\n    staleTime: 5 * 60 * 1000\n  });\n}\n\n/**\n * Invalidate suggestions cache (useful after entity updates)\n *\n * @param queryClient - TanStack Query client\n * @param prefix - Optional prefix to invalidate (invalidates all if not provided)\n */\nexport function invalidateSuggestions(\n  queryClient: any,\n  prefix?: string\n) {\n  if (prefix) {\n    queryClient.invalidateQueries({\n      queryKey: ['suggestions', prefix]\n    });\n  } else {\n    queryClient.invalidateQueries({\n      queryKey: ['suggestions']\n    });\n  }\n}\n","/**\n * useSemanticSearch TanStack Query Hook\n * Feature: 015-search-retrieval-spec\n * Task: T049\n *\n * Custom hook for semantic vector search using TanStack Query\n * Semantic search finds conceptually similar content using embeddings\n */\n\nimport { useMutation } from '@tanstack/react-query'\nimport { supabase } from '../lib/supabase'\nimport { SearchResult } from './useSearch'\n\nexport type SemanticEntityType = 'positions' | 'documents' | 'briefs'\n\nexport interface SemanticSearchOptions {\n  /** Search query */\n  query: string\n  /** Entity types to search (only supports positions, documents, briefs) */\n  entityTypes?: SemanticEntityType[]\n  /** Minimum similarity threshold (0.0-1.0, default: 0.6) */\n  similarityThreshold?: number\n  /** Maximum number of results */\n  limit?: number\n  /** Include keyword search results */\n  includeKeywordResults?: boolean\n}\n\nexport interface SemanticSearchResult extends SearchResult {\n  /** Similarity score (0.0-1.0) */\n  similarity_score: number\n}\n\nexport interface SemanticSearchResponse {\n  /** Semantic search results */\n  results: SemanticSearchResult[]\n  /** Exact keyword matches (if includeKeywordResults=true) */\n  exact_matches?: SearchResult[]\n  /** Performance breakdown */\n  performance: {\n    embedding_generation_ms: number\n    vector_search_ms: number\n    keyword_search_ms?: number\n    total_ms: number\n  }\n  /** Query metadata */\n  query: {\n    text: string\n    normalized: string\n    embedding_model: string\n  }\n}\n\n/**\n * Perform semantic search using vector embeddings\n *\n * @param options - Semantic search options\n * @returns TanStack Mutation result\n *\n * @example\n * ```typescript\n * const { mutate, data, isLoading } = useSemanticSearch();\n *\n * // Trigger search\n * mutate({\n *   query: 'climate change policy',\n *   entityTypes: ['positions', 'documents'],\n *   includeKeywordResults: true\n * });\n * ```\n */\nexport function useSemanticSearch() {\n  return useMutation({\n    mutationFn: async (options: SemanticSearchOptions) => {\n      const {\n        query,\n        entityTypes = ['positions', 'documents', 'briefs'],\n        similarityThreshold = 0.6,\n        limit = 20,\n        includeKeywordResults = false,\n      } = options\n\n      // Get current session token\n      const {\n        data: { session },\n      } = await supabase.auth.getSession()\n\n      if (!session) {\n        throw new Error('Not authenticated')\n      }\n\n      // Build request body\n      const requestBody = {\n        query,\n        entity_types: entityTypes,\n        similarity_threshold: similarityThreshold,\n        limit,\n        include_keyword_results: includeKeywordResults,\n      }\n\n      // Make API request\n      const response = await fetch(`${import.meta.env.VITE_API_URL}/api/search/semantic`, {\n        method: 'POST',\n        headers: {\n          Authorization: `Bearer ${session.access_token}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(requestBody),\n      })\n\n      if (!response.ok) {\n        const error = await response.json()\n\n        // Handle specific error cases\n        if (response.status === 503) {\n          throw new Error('Semantic search is temporarily unavailable. Please try again later.')\n        }\n\n        throw new Error(error.message || 'Semantic search failed')\n      }\n\n      const data: SemanticSearchResponse = await response.json()\n\n      // Validate performance (total should be < 1000ms for good UX)\n      if (data.performance.total_ms > 1000) {\n        console.warn(`Semantic search took ${data.performance.total_ms}ms (target: <1000ms)`)\n      }\n\n      return data\n    },\n\n    // Retry configuration\n    retry: 1, // Only retry once (semantic search is expensive)\n    retryDelay: 1000,\n\n    // Callbacks\n    onError: (_error) => {\n      // Semantic search error handled by mutation state\n    },\n\n    onSuccess: (_data) => {\n      // Search completed successfully\n    },\n  })\n}\n\n/**\n * Hook variant that uses TanStack Query instead of mutation\n * Useful when you want automatic caching and refetching\n *\n * Note: This is disabled by default (must call refetch() manually)\n */\nexport function useSemanticSearchQuery(options: SemanticSearchOptions) {\n  const {\n    query,\n    entityTypes = ['positions', 'documents', 'briefs'],\n    similarityThreshold = 0.6,\n    limit = 20,\n    includeKeywordResults = false,\n  } = options\n\n  return useQuery({\n    queryKey: [\n      'semantic-search',\n      query,\n      entityTypes,\n      similarityThreshold,\n      limit,\n      includeKeywordResults,\n    ],\n\n    queryFn: async () => {\n      const {\n        data: { session },\n      } = await supabase.auth.getSession()\n\n      if (!session) {\n        throw new Error('Not authenticated')\n      }\n\n      const response = await fetch(`${import.meta.env.VITE_API_URL}/api/search/semantic`, {\n        method: 'POST',\n        headers: {\n          Authorization: `Bearer ${session.access_token}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          query,\n          entity_types: entityTypes,\n          similarity_threshold: similarityThreshold,\n          limit,\n          include_keyword_results: includeKeywordResults,\n        }),\n      })\n\n      if (!response.ok) {\n        const error = await response.json()\n        throw new Error(error.message || 'Semantic search failed')\n      }\n\n      return response.json() as Promise<SemanticSearchResponse>\n    },\n\n    // Disabled by default - must call refetch() manually\n    enabled: false,\n\n    // Cache configuration\n    staleTime: 2 * 60 * 1000, // 2 minutes\n    gcTime: 5 * 60 * 1000, // 5 minutes\n\n    // Retry configuration\n    retry: 1,\n    retryDelay: 1000,\n  })\n}\n\n/**\n * Utility to check if semantic search is available\n * (i.e., if embeddings service is healthy)\n */\nexport async function checkSemanticSearchAvailability(): Promise<boolean> {\n  try {\n    const {\n      data: { session },\n    } = await supabase.auth.getSession()\n\n    if (!session) {\n      return false\n    }\n\n    // Simple health check (could be a dedicated endpoint)\n    const response = await fetch(`${import.meta.env.VITE_API_URL}/api/search/semantic`, {\n      method: 'OPTIONS',\n      headers: {\n        Authorization: `Bearer ${session.access_token}`,\n      },\n    })\n\n    return response.ok\n  } catch {\n    return false\n  }\n}\n\n// Re-export useQuery for consistency\nimport { useQuery } from '@tanstack/react-query'\n","/**\n * Keyboard Navigation Hooks\n * Feature: 015-search-retrieval-spec\n * Task: T051\n * Enhanced with search-specific keyboard shortcuts\n */\n\nimport { useCallback, useEffect, useRef, useState, RefObject } from 'react';\n\nexport type UseKeyboardNavigationOptions = {\n  itemCount: number;\n  loop?: boolean;\n};\n\nexport function useKeyboardNavigation({\n  itemCount,\n  loop = true,\n}: UseKeyboardNavigationOptions) {\n  const [index, setIndex] = useState(0);\n  const containerRef = useRef<HTMLElement | null>(null);\n\n  const clamp = useCallback(\n    (i: number) => {\n      if (loop) return (i + itemCount) % itemCount;\n      return Math.max(0, Math.min(itemCount - 1, i));\n    },\n    [itemCount, loop]\n  );\n\n  const onKeyDown = useCallback(\n    (e: KeyboardEvent) => {\n      if (e.key === 'ArrowRight' || e.key === 'ArrowDown')\n        setIndex((i) => clamp(i + 1));\n      if (e.key === 'ArrowLeft' || e.key === 'ArrowUp')\n        setIndex((i) => clamp(i - 1));\n      if (e.key === 'Home') setIndex(0);\n      if (e.key === 'End') setIndex(itemCount - 1);\n    },\n    [clamp, itemCount]\n  );\n\n  useEffect(() => {\n    const cur = containerRef.current;\n    if (!cur) return;\n    const handler = (e: KeyboardEvent) => onKeyDown(e);\n    cur.addEventListener('keydown', handler);\n    return () => cur.removeEventListener('keydown', handler);\n  }, [onKeyDown]);\n\n  useEffect(() => {\n    const cur = containerRef.current;\n    if (!cur) return;\n    const el = cur.querySelector<HTMLElement>(`[data-kbindex=\"${index}\"]`);\n    el?.focus();\n  }, [index]);\n\n  return { index, setIndex, containerRef };\n}\n\n/**\n * Search-specific keyboard navigation hook\n * Manages keyboard shortcuts:\n * - `/` to focus search input\n * - `Escape` to close suggestions\n * - `Enter` to submit search\n * - `â†‘/â†“` to navigate suggestions\n * - `Tab` to cycle through tabs\n */\ninterface UseSearchKeyboardNavigationOptions {\n  searchInputRef: RefObject<HTMLInputElement>;\n  isOpen: boolean;\n  onClose: () => void;\n  onSubmit?: () => void;\n  onNavigate?: (direction: 'up' | 'down') => void;\n  onSelect?: () => void;\n  disabled?: boolean;\n}\n\nexport function useSearchKeyboardNavigation({\n  searchInputRef,\n  isOpen,\n  onClose,\n  onSubmit,\n  onNavigate,\n  onSelect,\n  disabled = false,\n}: UseSearchKeyboardNavigationOptions) {\n  const focusSearch = useCallback(() => {\n    searchInputRef.current?.focus();\n  }, [searchInputRef]);\n\n  const closeDropdown = useCallback(() => {\n    onClose();\n  }, [onClose]);\n\n  const selectSuggestion = useCallback(() => {\n    if (onSelect) {\n      onSelect();\n    }\n  }, [onSelect]);\n\n  // Global keyboard event handler\n  useEffect(() => {\n    if (disabled) return;\n\n    const handleKeyDown = (event: KeyboardEvent) => {\n      const target = event.target as HTMLElement;\n      const isInputFocused =\n        target.tagName === 'INPUT' ||\n        target.tagName === 'TEXTAREA' ||\n        target.isContentEditable;\n\n      // `/` key - Focus search input (only when not in input)\n      if (event.key === '/' && !isInputFocused) {\n        event.preventDefault();\n        focusSearch();\n        return;\n      }\n\n      // Handle keys when search input is focused or dropdown is open\n      if (isInputFocused || isOpen) {\n        switch (event.key) {\n          case 'Escape':\n            event.preventDefault();\n            if (isOpen) {\n              closeDropdown();\n            } else {\n              // Blur search input on second Escape\n              searchInputRef.current?.blur();\n            }\n            break;\n\n          case 'Enter':\n            if (!event.shiftKey && !event.ctrlKey && !event.metaKey) {\n              if (isOpen && onSelect) {\n                event.preventDefault();\n                selectSuggestion();\n              } else if (onSubmit) {\n                event.preventDefault();\n                onSubmit();\n              }\n            }\n            break;\n\n          case 'ArrowDown':\n            if (isOpen && onNavigate) {\n              event.preventDefault();\n              onNavigate('down');\n            }\n            break;\n\n          case 'ArrowUp':\n            if (isOpen && onNavigate) {\n              event.preventDefault();\n              onNavigate('up');\n            }\n            break;\n\n          case 'Tab':\n            // Allow default Tab behavior for accessibility\n            // but close suggestions dropdown if open\n            if (isOpen) {\n              closeDropdown();\n            }\n            break;\n        }\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n\n    return () => {\n      window.removeEventListener('keydown', handleKeyDown);\n    };\n  }, [\n    disabled,\n    isOpen,\n    focusSearch,\n    closeDropdown,\n    selectSuggestion,\n    onNavigate,\n    onSubmit,\n    onSelect,\n    searchInputRef,\n  ]);\n\n  // Return utility functions\n  return {\n    focusSearch,\n    closeDropdown,\n    selectSuggestion,\n  };\n}\n\n/**\n * Hook for managing Tab key navigation within a specific container\n */\nexport function useTabNavigation(containerRef: RefObject<HTMLElement>) {\n  useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (event.key !== 'Tab' || !containerRef.current) return;\n\n      const focusableElements = containerRef.current.querySelectorAll(\n        'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n      );\n\n      const focusableArray = Array.from(focusableElements) as HTMLElement[];\n      const firstElement = focusableArray[0];\n      const lastElement = focusableArray[focusableArray.length - 1];\n\n      // Trap focus within container\n      if (event.shiftKey) {\n        // Shift + Tab (backward)\n        if (document.activeElement === firstElement) {\n          event.preventDefault();\n          lastElement?.focus();\n        }\n      } else {\n        // Tab (forward)\n        if (document.activeElement === lastElement) {\n          event.preventDefault();\n          firstElement?.focus();\n        }\n      }\n    };\n\n    const container = containerRef.current;\n    container?.addEventListener('keydown', handleKeyDown);\n\n    return () => {\n      container?.removeEventListener('keydown', handleKeyDown);\n    };\n  }, [containerRef]);\n}\n\n","/**\n * SearchPage Component\n * Feature: 015-search-retrieval-spec\n * Task: T046\n *\n * Integrates search components:\n * - GlobalSearchInput\n * - SearchSuggestions\n * - EntityTypeTabs\n * - SearchResultsList\n * - TanStack Router integration\n * - Error boundary\n * - Loading & error states\n * - URL query params support\n */\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport { useNavigate, useSearch } from '@tanstack/react-router';\nimport { useTranslation } from 'react-i18next';\nimport { GlobalSearchInput } from '@/components/GlobalSearchInput';\nimport { SearchSuggestions } from '@/components/SearchSuggestions';\nimport { EntityTypeTabs, EntityType } from '@/components/EntityTypeTabs';\nimport { SearchResultsList } from '@/components/SearchResultsList';\nimport { SearchErrorBoundary } from '@/components/SearchErrorBoundary';\nimport { useSearch as useSearchQuery } from '@/hooks/useSearch';\nimport { useSuggestions } from '@/hooks/useSuggestions';\nimport { useSemanticSearch } from '@/hooks/useSemanticSearch';\nimport { useSearchKeyboardNavigation } from '@/hooks/useKeyboardNavigation';\n\nexport function SearchPage() {\n const { t, i18n } = useTranslation();\n const navigate = useNavigate();\n const searchParams = useSearch({ from: '/search' });\n const isRTL = i18n.language === 'ar';\n\n // Local state\n const [query, setQuery] = useState<string>(searchParams.q || '');\n const [selectedType, setSelectedType] = useState<EntityType>(\n (searchParams.type as EntityType) || 'all'\n );\n const [showSuggestions, setShowSuggestions] = useState(false);\n const [activeIndex, setActiveIndex] = useState(0);\n const [useSemanticMode, setUseSemanticMode] = useState(false);\n\n const searchInputRef = useRef<HTMLInputElement>(null);\n\n // Search queries\n const {\n data: searchData,\n isLoading: isSearchLoading,\n error: searchError,\n refetch: refetchSearch,\n } = useSearchQuery(query, {\n entityTypes: selectedType === 'all' ? undefined : [selectedType],\n limit: 20,\n includeArchived: searchParams.includeArchived === 'true',\n });\n\n const { suggestions, isLoading: isSuggestionsLoading } = useSuggestions(query);\n\n const {\n data: semanticData,\n isLoading: isSemanticLoading,\n mutate: performSemanticSearch,\n } = useSemanticSearch();\n\n // Keyboard navigation\n useSearchKeyboardNavigation({\n searchInputRef,\n isOpen: showSuggestions,\n onClose: () => setShowSuggestions(false),\n onSubmit: handleSearchSubmit,\n onNavigate: (direction) => {\n if (direction === 'down') {\n setActiveIndex((prev) => Math.min(prev + 1, suggestions.length - 1));\n } else {\n setActiveIndex((prev) => Math.max(prev - 1, 0));\n }\n },\n onSelect: () => {\n if (suggestions[activeIndex]) {\n handleSuggestionSelect(suggestions[activeIndex]);\n }\n },\n });\n\n // Update URL params when search changes\n useEffect(() => {\n if (query) {\n navigate({\n to: '/search',\n search: {\n q: query,\n type: selectedType !== 'all' ? selectedType : undefined,\n includeArchived: searchParams.includeArchived,\n },\n });\n }\n }, [query, selectedType, navigate, searchParams.includeArchived]);\n\n // Handlers\n function handleSearchSubmit() {\n setShowSuggestions(false);\n\n if (useSemanticMode) {\n performSemanticSearch({\n query,\n entityTypes:\n selectedType === 'all' ? ['positions', 'documents'] : [selectedType],\n includeKeywordResults: true,\n });\n } else {\n refetchSearch();\n }\n }\n\n function handleSuggestionSelect(suggestion: any) {\n setQuery(isRTL ? suggestion.title_ar : suggestion.title_en);\n setShowSuggestions(false);\n handleSearchSubmit();\n }\n\n function handleQueryChange(newQuery: string) {\n setQuery(newQuery);\n setShowSuggestions(newQuery.length > 0);\n setActiveIndex(0);\n }\n\n function handleTypeChange(type: EntityType) {\n setSelectedType(type);\n if (query) {\n refetchSearch();\n }\n }\n\n // Determine which data to display\n const displayData = useSemanticMode ? semanticData : searchData;\n const isLoading = useSemanticMode ? isSemanticLoading : isSearchLoading;\n\n return (\n <SearchErrorBoundary>\n <div className=\"container mx-auto max-w-6xl px-4 py-6\" dir={isRTL ? 'rtl' : 'ltr'}>\n {/* Page Header */}\n <div className=\"mb-6\">\n <h1 className=\"mb-2 text-3xl font-bold text-gray-900 dark:text-gray-100\">\n {t('search.title')}\n </h1>\n <p className=\"text-gray-600 dark:text-gray-400\">{t('search.description')}</p>\n </div>\n\n {/* Search Input with Suggestions */}\n <div className=\"relative mb-6\">\n <GlobalSearchInput\n ref={searchInputRef}\n value={query}\n onChange={handleQueryChange}\n onSubmit={handleSearchSubmit}\n onFocus={() => query && setShowSuggestions(true)}\n placeholder={t('search.placeholder')}\n isLoading={isSuggestionsLoading}\n />\n\n <SearchSuggestions\n suggestions={suggestions}\n isOpen={showSuggestions}\n activeIndex={activeIndex}\n onSelect={handleSuggestionSelect}\n onClose={() => setShowSuggestions(false)}\n onActiveIndexChange={setActiveIndex}\n isLoading={isSuggestionsLoading}\n />\n </div>\n\n {/* Search Mode Toggle */}\n {query && (\n <div className=\"mb-4 flex items-center gap-4\">\n <button\n onClick={() => setUseSemanticMode(false)}\n className={`rounded-md px-4 py-2 transition-colors ${\n !useSemanticMode\n ? 'bg-blue-600 text-white'\n : 'bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300'\n }`}\n >\n {t('search.modes.keyword')}\n </button>\n <button\n onClick={() => setUseSemanticMode(true)}\n className={`rounded-md px-4 py-2 transition-colors ${\n useSemanticMode\n ? 'bg-purple-600 text-white'\n : 'bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300'\n }`}\n >\n {t('search.modes.semantic')}\n </button>\n\n {/* Include archived toggle */}\n <label className=\"ms-auto flex items-center gap-2\">\n <input\n type=\"checkbox\"\n checked={searchParams.includeArchived === 'true'}\n onChange={(e) => {\n navigate({\n to: '/search',\n search: {\n ...searchParams,\n includeArchived: e.target.checked ? 'true' : undefined,\n },\n });\n }}\n className=\"size-4 rounded text-blue-600\"\n />\n <span className=\"text-sm text-gray-700 dark:text-gray-300\">\n {t('search.includeArchived')}\n </span>\n </label>\n </div>\n )}\n\n {/* Entity Type Tabs */}\n {displayData && (\n <div className=\"mb-6\">\n <EntityTypeTabs\n selectedType={selectedType}\n counts={{\n all: displayData.counts?.total || 0,\n dossiers: displayData.counts?.dossiers || 0,\n people: displayData.counts?.people || 0,\n engagements: displayData.counts?.engagements || 0,\n positions: displayData.counts?.positions || 0,\n mous: displayData.counts?.mous || 0,\n documents: displayData.counts?.documents || 0,\n }}\n onTypeChange={handleTypeChange}\n isLoading={isLoading}\n />\n </div>\n )}\n\n {/* Search Results */}\n {searchError ? (\n <div className=\"py-12 text-center\">\n <div className=\"mb-4 text-4xl\">âŒ</div>\n <h3 className=\"mb-2 text-lg font-semibold text-red-600 dark:text-red-400\">\n {t('search.error.title')}\n </h3>\n <p className=\"mb-4 text-gray-600 dark:text-gray-400\">\n {searchError instanceof Error ? searchError.message : t('search.error.generic')}\n </p>\n <button\n onClick={() => refetchSearch()}\n className=\"rounded-md bg-blue-600 px-4 py-2 text-white transition-colors hover:bg-blue-700\"\n >\n {t('search.error.retry')}\n </button>\n </div>\n ) : (\n <SearchResultsList\n results={displayData?.results || []}\n exactMatches={displayData?.exactMatches}\n isLoading={isLoading}\n hasMore={displayData?.hasMore}\n onLoadMore={() => {\n // Implement pagination\n }}\n typoSuggestions={displayData?.typoSuggestions}\n searchTips={\n query && !isLoading && !displayData?.results?.length\n ? [\n t('search.tips.tryDifferentKeywords'),\n t('search.tips.useOrOperator'),\n t('search.tips.checkSpelling'),\n ]\n : []\n }\n />\n )}\n\n {/* Performance metrics (dev mode) */}\n {process.env.NODE_ENV === 'development' && displayData?.tookMs && (\n <div className=\"mt-6 rounded-lg bg-gray-100 p-4 dark:bg-gray-800\">\n <div className=\"text-xs text-gray-600 dark:text-gray-400\">\n <div>Search took: {displayData.tookMs}ms</div>\n {displayData.cacheHit !== undefined && (\n <div>Cache hit: {displayData.cacheHit ? 'Yes' : 'No'}</div>\n )}\n {displayData.counts?.restricted && (\n <div className=\"text-orange-600 dark:text-orange-400\">\n Restricted results: {displayData.counts.restricted}\n </div>\n )}\n </div>\n </div>\n )}\n </div>\n </SearchErrorBoundary>\n );\n}\n","import { createFileRoute } from '@tanstack/react-router'\nimport { SearchPage } from '../../pages/SearchPage'\n\nexport const Route = createFileRoute('/_protected/search')({\n component: SearchPage,\n validateSearch: (search: Record<string, unknown>) => {\n return {\n q: (search.q as string) || '',\n type: search.type as string | undefined,\n includeArchived: search.includeArchived as string | undefined,\n }\n },\n})\n"],"names":["GlobalSearchInput","value","onChange","onSearch","isLoading","placeholder","autoFocus","className","onFocus","onBlur","t","i18n","useTranslation","inputRef","useRef","localValue","setLocalValue","useState","debouncedValue","useDebouncedValue","useEffect","handleKeyDown","e","handleInputChange","handleClear","direction","placeholderText","jsx","Search","Input","jsxs","Loader2","Button","X","entityTypeIcons","entityTypeLabels","SearchSuggestions","suggestions","isOpen","activeIndex","onSelect","onClose","onActiveIndexChange","listRef","activeItemRef","isRTL","groupedSuggestions","acc","suggestion","ScrollArea","type","items","idx","globalIndex","isActive","entityTypeConfig","EntityTypeTabs","selectedType","counts","onTypeChange","tabsRef","types","currentIndex","nextIndex","prevIndex","Tabs","TabsList","config","count","isSelected","TabsTrigger","entityTypeBadges","ResultCard","result","badge","showRelationshipPath","setShowRelationshipPath","getRelationshipColor","strength","Network","Badge","dossier","segment","Fragment","ChevronLeft","ChevronRight","LoadingSkeleton","Skeleton","SearchResultsList","results","exactMatches","hasMore","onLoadMore","typoSuggestions","searchTips","tip","_","SearchErrorBoundary","Component","props","error","errorInfo","useSearch","options","query","entityTypes","limit","offset","includeArchived","language","useQuery","signal","params","session","supabase","response","attemptIndex","useSuggestions","prefix","entityType","debounceMs","debouncedPrefix","queryResult","data","useMemo","useSemanticSearch","useMutation","similarityThreshold","includeKeywordResults","requestBody","_error","_data","useSearchKeyboardNavigation","searchInputRef","onSubmit","onNavigate","disabled","focusSearch","useCallback","closeDropdown","selectSuggestion","event","target","isInputFocused","SearchPage","navigate","useNavigate","searchParams","setQuery","setSelectedType","showSuggestions","setShowSuggestions","setActiveIndex","useSemanticMode","setUseSemanticMode","searchData","isSearchLoading","searchError","refetchSearch","useSearchQuery","isSuggestionsLoading","semanticData","isSemanticLoading","performSemanticSearch","handleSearchSubmit","prev","handleSuggestionSelect","handleQueryChange","newQuery","handleTypeChange","displayData","SplitComponent"],"mappings":"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"}