{"version":3,"file":"SLACountdown-Bedgm05V.js","sources":["../../src/components/SLACountdown.tsx"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { createClient } from '@supabase/supabase-js';\n\ninterface SLAEvent {\n id: string;\n ticket_id: string;\n policy_id: string;\n event_type: 'started' | 'paused' | 'resumed' | 'met' | 'breached' | 'cancelled';\n event_timestamp: string;\n elapsed_minutes: number;\n remaining_minutes: number;\n is_breached: boolean;\n}\n\ninterface SLACountdownProps {\n ticketId: string;\n targetMinutes: number;\n eventType: 'acknowledgment' | 'resolution';\n startedAt: string;\n className?: string;\n}\n\nexport function SLACountdown({\n ticketId,\n targetMinutes,\n eventType,\n startedAt,\n className = '',\n}: SLACountdownProps) {\n const { t } = useTranslation('intake');\n const [remainingMinutes, setRemainingMinutes] = useState<number>(targetMinutes);\n const [isBreached, setIsBreached] = useState<boolean>(false);\n const [isPaused, setIsPaused] = useState<boolean>(false);\n\n // Calculate initial remaining time\n useEffect(() => {\n const calculateRemaining = () => {\n const started = new Date(startedAt).getTime();\n const now = Date.now();\n const elapsedMinutes = Math.floor((now - started) / (1000 * 60));\n const remaining = targetMinutes - elapsedMinutes;\n\n setRemainingMinutes(remaining);\n setIsBreached(remaining < 0);\n };\n\n calculateRemaining();\n const interval = setInterval(calculateRemaining, 60000); // Update every minute\n\n return () => clearInterval(interval);\n }, [targetMinutes, startedAt]);\n\n // Subscribe to SLA events via Supabase Realtime\n useEffect(() => {\n const supabase = createClient(\n import.meta.env.VITE_SUPABASE_URL,\n import.meta.env.VITE_SUPABASE_ANON_KEY\n );\n\n const channel = supabase\n .channel(`sla_events:${ticketId}`)\n .on(\n 'postgres_changes',\n {\n event: 'INSERT',\n schema: 'public',\n table: 'sla_events',\n filter: `ticket_id=eq.${ticketId}`,\n },\n (payload) => {\n const event = payload.new as SLAEvent;\n\n if (event.event_type === 'paused') {\n setIsPaused(true);\n } else if (event.event_type === 'resumed') {\n setIsPaused(false);\n } else if (event.event_type === 'breached') {\n setIsBreached(true);\n } else if (event.event_type === 'met') {\n setRemainingMinutes(0);\n }\n\n // Update remaining minutes from server\n setRemainingMinutes(event.remaining_minutes);\n }\n )\n .subscribe();\n\n return () => {\n supabase.removeChannel(channel);\n };\n }, [ticketId]);\n\n // Format time remaining\n const formatTimeRemaining = (minutes: number): string => {\n if (minutes < 0) {\n const absMinutes = Math.abs(minutes);\n const hours = Math.floor(absMinutes / 60);\n const mins = absMinutes % 60;\n return hours > 0\n ? t('sla.breached_by_hours', { hours, minutes: mins })\n : t('sla.breached_by_minutes', { minutes: mins });\n }\n\n const hours = Math.floor(minutes / 60);\n const mins = minutes % 60;\n\n if (hours > 0) {\n return t('sla.time_remaining_hours', { hours, minutes: mins });\n }\n return t('sla.time_remaining_minutes', { minutes: mins });\n };\n\n // Get status color based on remaining time percentage\n const getStatusColor = (): string => {\n if (isBreached) return 'bg-red-500 text-white';\n if (isPaused) return 'bg-gray-400 text-white';\n\n const percentRemaining = (remainingMinutes / targetMinutes) * 100;\n\n if (percentRemaining > 25) return 'bg-green-500 text-white';\n if (percentRemaining > 10) return 'bg-yellow-500 text-gray-900';\n return 'bg-orange-500 text-white';\n };\n\n // Get status icon\n const getStatusIcon = (): string => {\n if (isBreached) return 'âš ï¸';\n if (isPaused) return 'â¸ï¸';\n\n const percentRemaining = (remainingMinutes / targetMinutes) * 100;\n if (percentRemaining > 25) return 'âœ“';\n if (percentRemaining > 10) return 'âš¡';\n return 'ðŸ”´';\n };\n\n // Get progress bar width\n const getProgressWidth = (): number => {\n if (isBreached) return 100;\n const percentElapsed = ((targetMinutes - remainingMinutes) / targetMinutes) * 100;\n return Math.min(Math.max(percentElapsed, 0), 100);\n };\n\n return (\n <div className={`sla-countdown ${className}`}>\n <div className=\"mb-2 flex items-center justify-between\">\n <div className=\"flex items-center gap-2\">\n <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n {eventType === 'acknowledgment'\n ? t('sla.acknowledgment')\n : t('sla.resolution')}\n </span>\n {isPaused && (\n <span className=\"text-xs text-gray-500 dark:text-gray-400\">\n {t('sla.paused')}\n </span>\n )}\n </div>\n <span\n className={`rounded-full px-3 py-1 text-xs font-semibold ${getStatusColor()}`}\n role=\"status\"\n aria-live=\"polite\"\n >\n {getStatusIcon()} {formatTimeRemaining(remainingMinutes)}\n </span>\n </div>\n\n {/* Progress bar */}\n <div className=\"h-2 w-full overflow-hidden rounded-full bg-gray-200 dark:bg-gray-700\">\n <div\n className={`h-full transition-all duration-1000 ${\n isBreached ? 'bg-red-500' :\n isPaused ? 'bg-gray-400' :\n 'bg-gradient-to-r from-green-500 to-green-600'\n }`}\n style={{ width: `${getProgressWidth()}%` }}\n role=\"progressbar\"\n aria-valuenow={getProgressWidth()}\n aria-valuemin={0}\n aria-valuemax={100}\n />\n </div>\n\n {/* Target info */}\n <div className=\"mt-1 text-xs text-gray-500 dark:text-gray-400\">\n {t('sla.target')}: {Math.floor(targetMinutes / 60)}h {targetMinutes % 60}m\n </div>\n </div>\n );\n}"],"names":["SLACountdown","ticketId","targetMinutes","eventType","startedAt","className","t","useTranslation","remainingMinutes","setRemainingMinutes","useState","isBreached","setIsBreached","isPaused","setIsPaused","useEffect","calculateRemaining","started","now","elapsedMinutes","remaining","interval","supabase","createClient","channel","payload","event","formatTimeRemaining","minutes","absMinutes","hours","mins","getStatusColor","percentRemaining","getStatusIcon","getProgressWidth","percentElapsed","jsxs","jsx"],"mappings":"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"}