{"version":3,"file":"_id-Da85llYI.js","sources":["../../src/hooks/useUpdatePosition.ts","../../src/hooks/useSubmitPosition.ts","../../src/hooks/usePositionDossierLinks.ts","../../src/hooks/useCreatePositionDossierLink.ts","../../src/hooks/useDeletePositionDossierLink.ts","../../src/components/positions/PositionDossierLinker.tsx","../../src/components/PositionEditor.tsx","../../src/components/ConsistencyPanel.tsx","../../src/routes/_protected/positions/$id.tsx?tsr-split=component"],"sourcesContent":["/**\n * TanStack Query mutation for updating a position\n *\n * Includes optimistic updates and rollback on version conflict (409)\n */\n\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\nimport { supabase } from '../lib/supabase';\nimport type { Position, UpdatePositionRequest } from '../types/position';\n\n// API base URL\nconst API_BASE_URL = import.meta.env.VITE_SUPABASE_URL + '/functions/v1';\n\n// Helper to get auth headers\nconst getAuthHeaders = async () => {\n  const { data: { session } } = await supabase.auth.getSession();\n  return {\n    'Content-Type': 'application/json',\n    'Authorization': `Bearer ${session?.access_token}`,\n  };\n};\n\ninterface UpdatePositionVariables {\n  id: string;\n  data: UpdatePositionRequest;\n}\n\n/**\n * Hook to update a position with optimistic updates\n */\nexport const useUpdatePosition = () => {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async ({ id, data }: UpdatePositionVariables): Promise<Position> => {\n      const headers = await getAuthHeaders();\n      const response = await fetch(`${API_BASE_URL}/positions-update?id=${id}`, {\n        method: 'PUT',\n        headers,\n        body: JSON.stringify(data),\n      });\n\n      if (!response.ok) {\n        const error = await response.json().catch(() => ({ message: response.statusText }));\n\n        // Special handling for version conflict (409)\n        if (response.status === 409) {\n          throw new Error('Version conflict: The position has been modified by another user. Please refresh and try again.');\n        }\n\n        throw new Error(error.message || `Failed to update position: ${response.status}`);\n      }\n\n      return response.json();\n    },\n    onMutate: async ({ id, data }) => {\n      // Cancel any outgoing refetches\n      await queryClient.cancelQueries({ queryKey: ['positions', 'detail', id] });\n\n      // Snapshot the previous value\n      const previousPosition = queryClient.getQueryData<Position>(['positions', 'detail', id]);\n\n      // Optimistically update to the new value\n      if (previousPosition) {\n        queryClient.setQueryData<Position>(['positions', 'detail', id], {\n          ...previousPosition,\n          ...data,\n          updated_at: new Date().toISOString(),\n        });\n      }\n\n      // Return context with the previous value\n      return { previousPosition };\n    },\n    onError: (err, { id }, context) => {\n      // Rollback to the previous value on error\n      if (context?.previousPosition) {\n        queryClient.setQueryData(['positions', 'detail', id], context.previousPosition);\n      }\n    },\n    onSuccess: (data, { id }) => {\n      // Update the cache with the server response\n      queryClient.setQueryData(['positions', 'detail', id], data);\n\n      // Invalidate positions list to show updated position\n      queryClient.invalidateQueries({ queryKey: ['positions', 'list'] });\n    },\n  });\n};\n","/**\n * TanStack Query mutation for submitting a position for review\n *\n * Invalidates position on success and returns consistency check results\n */\n\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\nimport { supabase } from '../lib/supabase';\nimport type { Position, ConsistencyCheck } from '../types/position';\n\n// API base URL\nconst API_BASE_URL = import.meta.env.VITE_SUPABASE_URL + '/functions/v1';\n\n// Helper to get auth headers\nconst getAuthHeaders = async () => {\n  const { data: { session } } = await supabase.auth.getSession();\n  return {\n    'Content-Type': 'application/json',\n    'Authorization': `Bearer ${session?.access_token}`,\n  };\n};\n\ninterface SubmitPositionResponse {\n  position: Position;\n  consistency_check: ConsistencyCheck;\n}\n\n/**\n * Hook to submit a position for review\n * Returns position + consistency check results\n */\nexport const useSubmitPosition = () => {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async (id: string): Promise<SubmitPositionResponse> => {\n      const headers = await getAuthHeaders();\n      const response = await fetch(`${API_BASE_URL}/positions-submit?id=${id}`, {\n        method: 'PUT',\n        headers,\n      });\n\n      if (!response.ok) {\n        const error = await response.json().catch(() => ({ message: response.statusText }));\n        throw new Error(error.message || `Failed to submit position: ${response.status}`);\n      }\n\n      return response.json();\n    },\n    onSuccess: (data, id) => {\n      // Update the position cache\n      queryClient.setQueryData(['positions', 'detail', id], data.position);\n\n      // Invalidate positions list\n      queryClient.invalidateQueries({ queryKey: ['positions', 'list'] });\n    },\n  });\n};\n","// T066: usePositionDossierLinks hook\nimport { useQuery } from '@tanstack/react-query';\nimport { supabase } from '@/lib/supabase';\n\nexport interface PositionDossierLink {\n  position_id: string;\n  dossier_id: string;\n  link_type: 'primary' | 'related' | 'reference';\n  notes?: string | null;\n  linked_by: string;\n  created_at: string;\n  dossier?: {\n    id: string;\n    name_en: string;\n    name_ar: string;\n    reference_type: string;\n    status: string;\n    description_en?: string;\n    description_ar?: string;\n  };\n}\n\nexport interface UsePositionDossierLinksFilters {\n  link_type?: string;\n}\n\nexport interface UsePositionDossierLinksResult {\n  links: PositionDossierLink[];\n  totalCount: number;\n  isLoading: boolean;\n  error: Error | null;\n  refetch: () => void;\n}\n\nexport function usePositionDossierLinks(\n  positionId: string,\n  filters?: UsePositionDossierLinksFilters\n): UsePositionDossierLinksResult {\n  const {\n    data,\n    isLoading,\n    error,\n    refetch,\n  } = useQuery({\n    queryKey: ['position-dossier-links', positionId, filters],\n    queryFn: async () => {\n      const params = new URLSearchParams({ positionId });\n      if (filters?.link_type) {\n        params.append('link_type', filters.link_type);\n      }\n\n      const { data: { session } } = await supabase.auth.getSession();\n      if (!session) {\n        throw new Error('Not authenticated');\n      }\n\n      const response = await fetch(\n        `${supabase.supabaseUrl}/functions/v1/positions-dossiers-get?${params.toString()}`,\n        {\n          headers: {\n            'Authorization': `Bearer ${session.access_token}`,\n            'Content-Type': 'application/json',\n          },\n        }\n      );\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to fetch position-dossier links');\n      }\n\n      const result = await response.json();\n      return result;\n    },\n    staleTime: 5 * 60 * 1000, // 5 minutes\n    enabled: !!positionId,\n  });\n\n  return {\n    links: data?.links || [],\n    totalCount: data?.total_count || 0,\n    isLoading,\n    error: error as Error | null,\n    refetch,\n  };\n}\n","// T067: useCreatePositionDossierLink mutation hook\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\nimport { supabase } from '@/lib/supabase';\n\nexport interface CreatePositionDossierLinkInput {\n  dossier_id: string;\n  link_type?: 'primary' | 'related' | 'reference';\n  notes?: string;\n}\n\nexport function useCreatePositionDossierLink(positionId: string) {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async (input: CreatePositionDossierLinkInput) => {\n      const { data: { session } } = await supabase.auth.getSession();\n      if (!session) {\n        throw new Error('Not authenticated');\n      }\n\n      const response = await fetch(\n        `${supabase.supabaseUrl}/functions/v1/positions-dossiers-create?positionId=${positionId}`,\n        {\n          method: 'POST',\n          headers: {\n            'Authorization': `Bearer ${session.access_token}`,\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify(input),\n        }\n      );\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to create position-dossier link');\n      }\n\n      return await response.json();\n    },\n    onSuccess: () => {\n      // Invalidate position-dossier links query to refetch\n      queryClient.invalidateQueries({ queryKey: ['position-dossier-links', positionId] });\n    },\n  });\n}\n","// T068: useDeletePositionDossierLink mutation hook\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\nimport { supabase } from '@/lib/supabase';\n\nexport interface DeletePositionDossierLinkInput {\n  positionId: string;\n  dossierId: string;\n}\n\nexport function useDeletePositionDossierLink() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async (input: DeletePositionDossierLinkInput) => {\n      const { data: { session } } = await supabase.auth.getSession();\n      if (!session) {\n        throw new Error('Not authenticated');\n      }\n\n      const params = new URLSearchParams({\n        positionId: input.positionId,\n        dossierId: input.dossierId,\n      });\n\n      const response = await fetch(\n        `${supabase.supabaseUrl}/functions/v1/positions-dossiers-delete?${params.toString()}`,\n        {\n          method: 'DELETE',\n          headers: {\n            'Authorization': `Bearer ${session.access_token}`,\n            'Content-Type': 'application/json',\n          },\n        }\n      );\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to delete position-dossier link');\n      }\n\n      return await response.json();\n    },\n    onSuccess: (_, variables) => {\n      // Invalidate position-dossier links query to refetch\n      queryClient.invalidateQueries({ queryKey: ['position-dossier-links', variables.positionId] });\n    },\n  });\n}\n","// T050: PositionDossierLinker component\nimport { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { usePositionDossierLinks } from '@/hooks/usePositionDossierLinks';\nimport { useCreatePositionDossierLink } from '@/hooks/useCreatePositionDossierLink';\nimport { useDeletePositionDossierLink } from '@/hooks/useDeletePositionDossierLink';\nimport { Card } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Badge } from '@/components/ui/badge';\nimport { Plus, X, Link as LinkIcon } from 'lucide-react';\n\ninterface PositionDossierLinkerProps {\n positionId: string;\n}\n\nexport function PositionDossierLinker({ positionId }: PositionDossierLinkerProps) {\n const { t, i18n } = useTranslation(['positions', 'translation']);\n const isRTL = i18n.language === 'ar';\n\n const [isAdding, setIsAdding] = useState(false);\n const [selectedDossierId, setSelectedDossierId] = useState('');\n const [linkType, setLinkType] = useState<'primary' | 'related' | 'reference'>('related');\n const [notes, setNotes] = useState('');\n\n const { links, isLoading, error } = usePositionDossierLinks(positionId);\n const createLink = useCreatePositionDossierLink(positionId);\n const deleteLink = useDeletePositionDossierLink();\n\n const handleAddLink = async () => {\n if (!selectedDossierId) return;\n\n try {\n await createLink.mutateAsync({\n dossier_id: selectedDossierId,\n link_type: linkType,\n notes: notes || undefined,\n });\n\n // Reset form\n setSelectedDossierId('');\n setLinkType('related');\n setNotes('');\n setIsAdding(false);\n } catch (err) {\n console.error('Failed to create link:', err);\n }\n };\n\n const handleDeleteLink = async (dossierId: string) => {\n try {\n await deleteLink.mutateAsync({\n positionId,\n dossierId,\n });\n } catch (err) {\n console.error('Failed to delete link:', err);\n }\n };\n\n if (isLoading) {\n return (\n <Card className=\"p-8 text-center\">\n <p className=\"text-muted-foreground\">{t('common.loading')}</p>\n </Card>\n );\n }\n\n if (error) {\n return (\n <Card className=\"p-8 text-center\">\n <p className=\"text-destructive\">{t('errors.failed_to_load')}</p>\n </Card>\n );\n }\n\n return (\n <div className=\"flex flex-col gap-4\" dir={isRTL ? 'rtl' : 'ltr'}>\n {/* Header */}\n <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2\">\n <h3 className=\"text-lg sm:text-xl font-semibold flex items-center gap-2\">\n <LinkIcon className=\"h-5 w-5\" />\n {t('position_dossier_links.title')}\n </h3>\n {!isAdding && (\n <Button\n size=\"sm\"\n onClick={() => setIsAdding(true)}\n className=\"w-full sm:w-auto\"\n >\n <Plus className={`h-4 w-4 ${isRTL ? 'ms-2' : 'me-2'}`} />\n {t('position_dossier_links.add_link')}\n </Button>\n )}\n </div>\n\n {/* Add Link Form */}\n {isAdding && (\n <Card className=\"p-4\">\n <div className=\"flex flex-col gap-4\">\n <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n <div className=\"flex flex-col gap-2\">\n <label className=\"text-sm font-medium\">{t('position_dossier_links.select_dossier')}</label>\n <Select value={selectedDossierId} onValueChange={setSelectedDossierId}>\n <SelectTrigger>\n <SelectValue placeholder={t('position_dossier_links.select_placeholder')} />\n </SelectTrigger>\n <SelectContent>\n {/* TODO: Fetch and display available dossiers */}\n <SelectItem value=\"placeholder\">{t('position_dossier_links.no_dossiers')}</SelectItem>\n </SelectContent>\n </Select>\n </div>\n\n <div className=\"flex flex-col gap-2\">\n <label className=\"text-sm font-medium\">{t('position_dossier_links.link_type')}</label>\n <Select value={linkType} onValueChange={(v) => setLinkType(v as typeof linkType)}>\n <SelectTrigger>\n <SelectValue />\n </SelectTrigger>\n <SelectContent>\n <SelectItem value=\"primary\">{t('position_dossier_links.types.primary')}</SelectItem>\n <SelectItem value=\"related\">{t('position_dossier_links.types.related')}</SelectItem>\n <SelectItem value=\"reference\">{t('position_dossier_links.types.reference')}</SelectItem>\n </SelectContent>\n </Select>\n </div>\n </div>\n\n <div className=\"flex flex-col gap-2\">\n <label className=\"text-sm font-medium\">{t('position_dossier_links.notes_optional')}</label>\n <Textarea\n value={notes}\n onChange={(e) => setNotes(e.target.value)}\n placeholder={t('position_dossier_links.notes_placeholder')}\n rows={2}\n />\n </div>\n\n <div className=\"flex flex-col-reverse sm:flex-row gap-2 justify-end\">\n <Button\n variant=\"outline\"\n onClick={() => {\n setIsAdding(false);\n setSelectedDossierId('');\n setNotes('');\n }}\n className=\"w-full sm:w-auto\"\n >\n {t('common.cancel')}\n </Button>\n <Button\n onClick={handleAddLink}\n disabled={!selectedDossierId || createLink.isPending}\n className=\"w-full sm:w-auto\"\n >\n {createLink.isPending ? t('common.saving') : t('position_dossier_links.add_link')}\n </Button>\n </div>\n </div>\n </Card>\n )}\n\n {/* Links List */}\n {links.length === 0 ? (\n <Card className=\"p-8 text-center\">\n <p className=\"text-muted-foreground\">{t('position_dossier_links.no_links')}</p>\n </Card>\n ) : (\n <div className=\"grid grid-cols-1 gap-2\">\n {links.map((link) => (\n <Card key={link.dossier_id} className=\"p-4\">\n <div className=\"flex flex-col sm:flex-row justify-between items-start gap-4\">\n <div className=\"flex-1 min-w-0\">\n <div className=\"flex items-center gap-2 flex-wrap\">\n <h4 className=\"font-medium text-sm sm:text-base truncate\">\n {isRTL ? link.dossier?.name_ar : link.dossier?.name_en}\n </h4>\n <Badge variant=\"outline\" className=\"shrink-0\">\n {t(`position_dossier_links.types.${link.link_type}`)}\n </Badge>\n </div>\n {link.notes && (\n <p className=\"text-xs sm:text-sm text-muted-foreground mt-1 line-clamp-2\">{link.notes}</p>\n )}\n </div>\n <Button\n variant=\"ghost\"\n size=\"sm\"\n onClick={() => handleDeleteLink(link.dossier_id)}\n disabled={deleteLink.isPending}\n className=\"shrink-0\"\n >\n <X className=\"h-4 w-4\" />\n </Button>\n </div>\n </Card>\n ))}\n </div>\n )}\n </div>\n );\n}\n","import { useState, useEffect, useRef, useCallback } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { useEditor, EditorContent, Editor } from '@tiptap/react';\nimport StarterKit from '@tiptap/starter-kit';\nimport Placeholder from '@tiptap/extension-placeholder';\nimport Link from '@tiptap/extension-link';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Label } from '@/components/ui/label';\nimport { Separator } from '@/components/ui/separator';\nimport { Badge } from '@/components/ui/badge';\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Save, Loader2, AlertCircle, RefreshCw } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { PositionDossierLinker } from '@/components/positions/PositionDossierLinker';\nimport { usePositionDossierLinks } from '@/hooks/usePositionDossierLinks';\n\n// Types for position data\ninterface PositionEditorData {\n id?: string;\n title_en: string;\n title_ar: string;\n content_en: string;\n content_ar: string;\n rationale_en?: string;\n rationale_ar?: string;\n alignment_notes_en?: string;\n alignment_notes_ar?: string;\n version: number;\n}\n\ninterface PositionEditorProps {\n initialData?: Partial<PositionEditorData>;\n onSave: (data: PositionEditorData) => Promise<void>;\n onConflict?: (currentVersion: number, serverVersion: number) => void;\n readOnly?: boolean;\n autoSaveInterval?: number; // milliseconds, default 30000 (30s)\n className?: string;\n}\n\ninterface EditorMenuBarProps {\n editor: Editor | null;\n disabled?: boolean;\n}\n\n// Editor toolbar component\nfunction EditorMenuBar({ editor, disabled = false }: EditorMenuBarProps) {\n const { t } = useTranslation('positions');\n\n if (!editor) return null;\n\n return (\n <div className=\"flex flex-wrap gap-1 border-b border-gray-200 p-2\" role=\"toolbar\" aria-label={t('editor.toolbar')}>\n <Button\n type=\"button\"\n variant=\"ghost\"\n size=\"sm\"\n onClick={() => editor.chain().focus().toggleBold().run()}\n disabled={disabled || !editor.can().chain().focus().toggleBold().run()}\n className={cn(editor.isActive('bold') && 'bg-gray-100')}\n aria-label={t('editor.bold')}\n aria-pressed={editor.isActive('bold')}\n >\n <strong>B</strong>\n </Button>\n <Button\n type=\"button\"\n variant=\"ghost\"\n size=\"sm\"\n onClick={() => editor.chain().focus().toggleItalic().run()}\n disabled={disabled || !editor.can().chain().focus().toggleItalic().run()}\n className={cn(editor.isActive('italic') && 'bg-gray-100')}\n aria-label={t('editor.italic')}\n aria-pressed={editor.isActive('italic')}\n >\n <em>I</em>\n </Button>\n <Separator orientation=\"vertical\" className=\"h-6\" />\n <Button\n type=\"button\"\n variant=\"ghost\"\n size=\"sm\"\n onClick={() => editor.chain().focus().toggleHeading({ level: 2 }).run()}\n disabled={disabled}\n className={cn(editor.isActive('heading', { level: 2 }) && 'bg-gray-100')}\n aria-label={t('editor.heading2')}\n aria-pressed={editor.isActive('heading', { level: 2 })}\n >\n H2\n </Button>\n <Button\n type=\"button\"\n variant=\"ghost\"\n size=\"sm\"\n onClick={() => editor.chain().focus().toggleHeading({ level: 3 }).run()}\n disabled={disabled}\n className={cn(editor.isActive('heading', { level: 3 }) && 'bg-gray-100')}\n aria-label={t('editor.heading3')}\n aria-pressed={editor.isActive('heading', { level: 3 })}\n >\n H3\n </Button>\n <Separator orientation=\"vertical\" className=\"h-6\" />\n <Button\n type=\"button\"\n variant=\"ghost\"\n size=\"sm\"\n onClick={() => editor.chain().focus().toggleBulletList().run()}\n disabled={disabled}\n className={cn(editor.isActive('bulletList') && 'bg-gray-100')}\n aria-label={t('editor.bulletList')}\n aria-pressed={editor.isActive('bulletList')}\n >\n â€¢\n </Button>\n <Button\n type=\"button\"\n variant=\"ghost\"\n size=\"sm\"\n onClick={() => editor.chain().focus().toggleOrderedList().run()}\n disabled={disabled}\n className={cn(editor.isActive('orderedList') && 'bg-gray-100')}\n aria-label={t('editor.orderedList')}\n aria-pressed={editor.isActive('orderedList')}\n >\n 1.\n </Button>\n <Separator orientation=\"vertical\" className=\"h-6\" />\n <Button\n type=\"button\"\n variant=\"ghost\"\n size=\"sm\"\n onClick={() => editor.chain().focus().toggleBlockquote().run()}\n disabled={disabled}\n className={cn(editor.isActive('blockquote') && 'bg-gray-100')}\n aria-label={t('editor.quote')}\n aria-pressed={editor.isActive('blockquote')}\n >\n &quot;\n </Button>\n </div>\n );\n}\n\nexport function PositionEditor({\n initialData,\n onSave,\n onConflict,\n readOnly = false,\n autoSaveInterval = 30000,\n className,\n}: PositionEditorProps) {\n const { t, i18n } = useTranslation('positions');\n const isRTL = i18n.language === 'ar';\n\n // Form state\n const [formData, setFormData] = useState<PositionEditorData>({\n title_en: initialData?.title_en || '',\n title_ar: initialData?.title_ar || '',\n content_en: initialData?.content_en || '',\n content_ar: initialData?.content_ar || '',\n rationale_en: initialData?.rationale_en || '',\n rationale_ar: initialData?.rationale_ar || '',\n alignment_notes_en: initialData?.alignment_notes_en || '',\n alignment_notes_ar: initialData?.alignment_notes_ar || '',\n version: initialData?.version || 1,\n ...(initialData?.id && { id: initialData.id }),\n });\n\n const [saving, setSaving] = useState(false);\n const [autoSaving, setAutoSaving] = useState(false);\n const [isDirty, setIsDirty] = useState(false);\n const [lastSaved, setLastSaved] = useState<Date | null>(null);\n const [error, setError] = useState<string | null>(null);\n const [showConflictDialog, setShowConflictDialog] = useState(false);\n const [conflictVersions, setConflictVersions] = useState<{ current: number; server: number } | null>(null);\n\n // Refs for scroll synchronization\n const enScrollRef = useRef<HTMLDivElement>(null);\n const arScrollRef = useRef<HTMLDivElement>(null);\n const isScrollingRef = useRef<{ en: boolean; ar: boolean }>({ en: false, ar: false });\n\n // Auto-save timer ref\n const autoSaveTimerRef = useRef<NodeJS.Timeout | null>(null);\n\n // Initialize TipTap editors with bilingual support\n const editorEn = useEditor({\n extensions: [\n StarterKit.configure({\n // Exclude link from StarterKit to avoid duplicate\n link: false,\n }),\n Placeholder.configure({\n placeholder: t('editor.placeholderEn'),\n }),\n Link.configure({\n openOnClick: false,\n HTMLAttributes: {\n class: 'text-blue-600 underline',\n },\n }),\n ],\n content: formData.content_en,\n editable: !readOnly,\n onUpdate: ({ editor }) => {\n const html = editor.getHTML();\n setFormData((prev) => ({ ...prev, content_en: html }));\n setIsDirty(true);\n scheduleAutoSave();\n },\n });\n\n const editorAr = useEditor({\n extensions: [\n StarterKit.configure({\n // Exclude link from StarterKit to avoid duplicate\n link: false,\n }),\n Placeholder.configure({\n placeholder: t('editor.placeholderAr'),\n }),\n Link.configure({\n openOnClick: false,\n HTMLAttributes: {\n class: 'text-blue-600 underline',\n },\n }),\n ],\n content: formData.content_ar,\n editable: !readOnly,\n onUpdate: ({ editor }) => {\n const html = editor.getHTML();\n setFormData((prev) => ({ ...prev, content_ar: html }));\n setIsDirty(true);\n scheduleAutoSave();\n },\n });\n\n // Schedule auto-save with debouncing\n const scheduleAutoSave = useCallback(() => {\n if (autoSaveTimerRef.current) {\n clearTimeout(autoSaveTimerRef.current);\n }\n autoSaveTimerRef.current = setTimeout(() => {\n handleAutoSave();\n }, autoSaveInterval);\n }, [autoSaveInterval]);\n\n // Auto-save handler\n const handleAutoSave = async () => {\n if (!isDirty || readOnly || saving) return;\n\n setAutoSaving(true);\n try {\n await onSave(formData);\n setIsDirty(false);\n setLastSaved(new Date());\n setError(null);\n } catch (err: any) {\n // Check for version conflict (409)\n if (err.status === 409 || err.message?.includes('version') || err.message?.includes('conflict')) {\n const serverVersion = err.serverVersion || formData.version + 1;\n setConflictVersions({ current: formData.version, server: serverVersion });\n setShowConflictDialog(true);\n if (onConflict) {\n onConflict(formData.version, serverVersion);\n }\n } else {\n setError(err.message || t('editor.autoSaveError'));\n }\n } finally {\n setAutoSaving(false);\n }\n };\n\n // Manual save handler\n const handleManualSave = async () => {\n if (saving) return;\n\n setSaving(true);\n setError(null);\n try {\n await onSave(formData);\n setIsDirty(false);\n setLastSaved(new Date());\n setFormData((prev) => ({ ...prev, version: prev.version + 1 }));\n } catch (err: any) {\n if (err.status === 409 || err.message?.includes('version') || err.message?.includes('conflict')) {\n const serverVersion = err.serverVersion || formData.version + 1;\n setConflictVersions({ current: formData.version, server: serverVersion });\n setShowConflictDialog(true);\n if (onConflict) {\n onConflict(formData.version, serverVersion);\n }\n } else {\n setError(err.message || t('editor.saveError'));\n }\n } finally {\n setSaving(false);\n }\n };\n\n // Keyboard shortcuts\n useEffect(() => {\n const handleKeyDown = (e: KeyboardEvent) => {\n // Ctrl/Cmd + S to save\n if ((e.ctrlKey || e.metaKey) && e.key === 's') {\n e.preventDefault();\n handleManualSave();\n }\n };\n\n window.addEventListener('keydown', handleKeyDown);\n return () => window.removeEventListener('keydown', handleKeyDown);\n }, [formData, saving]);\n\n // Cleanup auto-save timer\n useEffect(() => {\n return () => {\n if (autoSaveTimerRef.current) {\n clearTimeout(autoSaveTimerRef.current);\n }\n };\n }, []);\n\n // Synchronized scroll handler\n const handleScroll = (source: 'en' | 'ar') => (e: React.UIEvent<HTMLDivElement>) => {\n const target = e.currentTarget;\n const scrollPercentage = target.scrollTop / (target.scrollHeight - target.clientHeight);\n\n if (isScrollingRef.current[source]) return;\n\n isScrollingRef.current[source] = true;\n const otherRef = source === 'en' ? arScrollRef : enScrollRef;\n const otherSource = source === 'en' ? 'ar' : 'en';\n\n if (otherRef.current) {\n const otherScrollTop = scrollPercentage * (otherRef.current.scrollHeight - otherRef.current.clientHeight);\n otherRef.current.scrollTop = otherScrollTop;\n }\n\n setTimeout(() => {\n isScrollingRef.current[otherSource] = false;\n }, 100);\n };\n\n // Handle conflict resolution - reload\n const handleConflictReload = () => {\n setShowConflictDialog(false);\n window.location.reload();\n };\n\n return (\n <div className={cn('space-y-4', className)}>\n {/* Save status indicator */}\n <div className=\"flex items-center justify-between\">\n <div className=\"flex items-center gap-2\">\n {autoSaving && (\n <Badge variant=\"outline\" className=\"gap-1\">\n <Loader2 className=\"size-3 animate-spin\" />\n {t('editor.autoSaving')}\n </Badge>\n )}\n {!autoSaving && lastSaved && (\n <Badge variant=\"outline\">\n {t('editor.lastSaved', { time: lastSaved.toLocaleTimeString() })}\n </Badge>\n )}\n {isDirty && !autoSaving && (\n <Badge variant=\"outline\" className=\"gap-1\">\n <AlertCircle className=\"size-3\" />\n {t('editor.unsavedChanges')}\n </Badge>\n )}\n </div>\n <Button\n onClick={handleManualSave}\n disabled={saving || !isDirty || readOnly}\n className=\"gap-2\"\n aria-label={t('editor.save')}\n >\n {saving ? <Loader2 className=\"size-4 animate-spin\" /> : <Save className=\"size-4\" />}\n {t('editor.save')}\n </Button>\n </div>\n\n {/* Error message */}\n {error && (\n <Card className=\"border-red-200 bg-red-50\">\n <CardContent className=\"pt-4\">\n <div className=\"flex items-center gap-2 text-red-800\">\n <AlertCircle className=\"size-4\" />\n <span>{error}</span>\n </div>\n </CardContent>\n </Card>\n )}\n\n {/* Bilingual side-by-side editor */}\n <div className=\"grid grid-cols-1 gap-4 md:grid-cols-2\">\n {/* English Editor */}\n <Card>\n <CardHeader>\n <CardTitle className=\"text-sm font-medium\">\n {t('editor.englishContent')}\n </CardTitle>\n </CardHeader>\n <CardContent className=\"space-y-2\">\n <div>\n <Label htmlFor=\"title_en\">{t('editor.title')}</Label>\n <input\n id=\"title_en\"\n type=\"text\"\n value={formData.title_en}\n onChange={(e) => {\n setFormData((prev) => ({ ...prev, title_en: e.target.value }));\n setIsDirty(true);\n scheduleAutoSave();\n }}\n readOnly={readOnly}\n className={cn(\n 'w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500',\n readOnly && 'bg-gray-100 cursor-not-allowed'\n )}\n aria-label={t('editor.titleEnglish')}\n />\n </div>\n <div>\n <Label>{t('editor.content')}</Label>\n <div\n className=\"overflow-hidden rounded-md border border-gray-300\"\n dir=\"ltr\"\n >\n <EditorMenuBar editor={editorEn} disabled={readOnly} />\n <div\n ref={enScrollRef}\n onScroll={handleScroll('en')}\n className=\"h-96 overflow-y-auto\"\n >\n <EditorContent\n editor={editorEn}\n className=\"prose prose-sm max-w-none p-4 focus:outline-none\"\n aria-label={t('editor.contentEnglish')}\n />\n </div>\n </div>\n </div>\n </CardContent>\n </Card>\n\n {/* Arabic Editor */}\n <Card>\n <CardHeader>\n <CardTitle className=\"text-sm font-medium\">\n {t('editor.arabicContent')}\n </CardTitle>\n </CardHeader>\n <CardContent className=\"space-y-2\">\n <div>\n <Label htmlFor=\"title_ar\">{t('editor.title')}</Label>\n <input\n id=\"title_ar\"\n type=\"text\"\n value={formData.title_ar}\n onChange={(e) => {\n setFormData((prev) => ({ ...prev, title_ar: e.target.value }));\n setIsDirty(true);\n scheduleAutoSave();\n }}\n readOnly={readOnly}\n className={cn(\n 'w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500',\n readOnly && 'bg-gray-100 cursor-not-allowed'\n )}\n dir=\"rtl\"\n aria-label={t('editor.titleArabic')}\n />\n </div>\n <div>\n <Label>{t('editor.content')}</Label>\n <div\n className=\"overflow-hidden rounded-md border border-gray-300\"\n dir=\"rtl\"\n >\n <EditorMenuBar editor={editorAr} disabled={readOnly} />\n <div\n ref={arScrollRef}\n onScroll={handleScroll('ar')}\n className=\"h-96 overflow-y-auto\"\n >\n <EditorContent\n editor={editorAr}\n className=\"prose prose-sm max-w-none p-4 focus:outline-none\"\n aria-label={t('editor.contentArabic')}\n />\n </div>\n </div>\n </div>\n </CardContent>\n </Card>\n </div>\n\n {/* Linked Dossiers Section */}\n {initialData?.id && (\n <Card className=\"mt-6\">\n <CardHeader>\n <CardTitle className=\"text-sm font-medium\">\n {t('editor.linkedDossiers')}\n </CardTitle>\n </CardHeader>\n <CardContent>\n <PositionDossierLinker positionId={initialData.id} />\n </CardContent>\n </Card>\n )}\n\n {/* Version Conflict Dialog */}\n <Dialog open={showConflictDialog} onOpenChange={setShowConflictDialog}>\n <DialogContent>\n <DialogHeader>\n <DialogTitle className=\"flex items-center gap-2\">\n <AlertCircle className=\"size-5 text-red-600\" />\n {t('editor.conflictTitle')}\n </DialogTitle>\n <DialogDescription>\n {t('editor.conflictDescription', {\n current: conflictVersions?.current,\n server: conflictVersions?.server,\n })}\n </DialogDescription>\n </DialogHeader>\n <DialogFooter>\n <Button variant=\"outline\" onClick={() => setShowConflictDialog(false)}>\n {t('common.cancel')}\n </Button>\n <Button onClick={handleConflictReload} className=\"gap-2\">\n <RefreshCw className=\"size-4\" />\n {t('editor.reloadPage')}\n </Button>\n </DialogFooter>\n </DialogContent>\n </Dialog>\n </div>\n );\n}\n","import { useTranslation } from 'react-i18next';\nimport { Card, CardContent, CardHeader, CardTitle } from './ui/card';\nimport { Badge } from './ui/badge';\nimport { Button } from './ui/button';\nimport { Progress } from './ui/progress';\nimport { Separator } from './ui/separator';\nimport {\n AlertTriangle,\n CheckCircle,\n AlertCircle,\n Info,\n ChevronDown,\n ChevronUp,\n ExternalLink,\n Shield,\n Clock,\n User,\n Zap,\n} from 'lucide-react';\nimport { useState } from 'react';\n\n// Types based on API spec\ninterface Conflict {\n conflict_position_id: string;\n conflict_type: 'contradiction' | 'ambiguity' | 'overlap';\n severity: 'high' | 'medium' | 'low';\n description: string;\n suggested_resolution: string;\n affected_sections: string[];\n}\n\ninterface ConsistencyCheck {\n id: string;\n position_id: string;\n check_trigger: 'manual' | 'automatic_on_submit';\n consistency_score: number;\n ai_service_available: boolean;\n conflicts: Conflict[];\n checked_at: string;\n checked_by: string;\n}\n\ninterface ConsistencyPanelProps {\n consistencyCheck: ConsistencyCheck | null;\n onResolveConflict?: (\n conflictPositionId: string,\n action: 'modify' | 'accept' | 'escalate'\n ) => void;\n onViewConflictingPosition?: (positionId: string) => void;\n loading?: boolean;\n}\n\nexport function ConsistencyPanel({\n consistencyCheck,\n onResolveConflict,\n onViewConflictingPosition,\n loading = false,\n}: ConsistencyPanelProps) {\n const { t, i18n } = useTranslation('positions');\n const isRTL = i18n.language === 'ar';\n const [expandedConflicts, setExpandedConflicts] = useState<Set<number>>(new Set());\n\n // Toggle conflict expansion\n const toggleConflict = (index: number) => {\n const newExpanded = new Set(expandedConflicts);\n if (newExpanded.has(index)) {\n newExpanded.delete(index);\n } else {\n newExpanded.add(index);\n }\n setExpandedConflicts(newExpanded);\n };\n\n // Get consistency score color and label\n const getScoreColor = (score: number): string => {\n if (score >= 90) return 'text-green-600';\n if (score >= 75) return 'text-blue-600';\n if (score >= 60) return 'text-amber-600';\n if (score >= 40) return 'text-orange-600';\n return 'text-red-600';\n };\n\n const getScoreBackgroundColor = (score: number): string => {\n if (score >= 90) return 'bg-green-50';\n if (score >= 75) return 'bg-blue-50';\n if (score >= 60) return 'bg-amber-50';\n if (score >= 40) return 'bg-orange-50';\n return 'bg-red-50';\n };\n\n const getScoreLabel = (score: number): string => {\n if (score >= 90) return t('consistency.scoreLabels.excellent');\n if (score >= 75) return t('consistency.scoreLabels.good');\n if (score >= 60) return t('consistency.scoreLabels.fair');\n if (score >= 40) return t('consistency.scoreLabels.poor');\n return t('consistency.scoreLabels.critical');\n };\n\n // Get severity badge variant and icon\n const getSeverityVariant = (\n severity: 'high' | 'medium' | 'low'\n ): 'destructive' | 'default' | 'secondary' => {\n switch (severity) {\n case 'high':\n return 'destructive';\n case 'medium':\n return 'default';\n case 'low':\n return 'secondary';\n }\n };\n\n const getSeverityIcon = (severity: 'high' | 'medium' | 'low') => {\n switch (severity) {\n case 'high':\n return <AlertTriangle className=\"size-3\" />;\n case 'medium':\n return <AlertCircle className=\"size-3\" />;\n case 'low':\n return <Info className=\"size-3\" />;\n }\n };\n\n // Get conflict type badge and icon\n const getConflictTypeBadge = (type: 'contradiction' | 'ambiguity' | 'overlap') => {\n const icons = {\n contradiction: <AlertTriangle className=\"size-3\" />,\n ambiguity: <AlertCircle className=\"size-3\" />,\n overlap: <Info className=\"size-3\" />,\n };\n\n return (\n <Badge variant=\"outline\" className=\"gap-1\">\n {icons[type]}\n {t(`consistency.conflictTypes.${type}`)}\n </Badge>\n );\n };\n\n // Format date\n const formatDate = (dateString: string): string => {\n const date = new Date(dateString);\n return new Intl.DateTimeFormat(i18n.language, {\n dateStyle: 'medium',\n timeStyle: 'short',\n }).format(date);\n };\n\n // Empty state\n if (!consistencyCheck) {\n return (\n <Card>\n <CardHeader>\n <CardTitle className=\"flex items-center gap-2 text-base\">\n <Shield className=\"size-5 text-muted-foreground\" />\n {t('consistency.title')}\n </CardTitle>\n </CardHeader>\n <CardContent>\n <div className=\"space-y-2 py-8 text-center\">\n <Shield className=\"mx-auto size-12 text-muted-foreground opacity-50\" />\n <p className=\"text-sm font-medium text-muted-foreground\">\n {t('consistency.emptyState.title')}\n </p>\n <p className=\"text-xs text-muted-foreground\">\n {t('consistency.emptyState.description')}\n </p>\n </div>\n </CardContent>\n </Card>\n );\n }\n\n const hasConflicts = consistencyCheck.conflicts.length > 0;\n const score = consistencyCheck.consistency_score;\n\n return (\n <Card>\n <CardHeader>\n <CardTitle className=\"flex items-center justify-between text-base\">\n <div className=\"flex items-center gap-2\">\n <Shield className=\"size-5\" />\n {t('consistency.title')}\n </div>\n {/* AI Service Status Badge */}\n <Badge\n variant={consistencyCheck.ai_service_available ? 'default' : 'secondary'}\n className=\"gap-1\"\n >\n <Zap className=\"size-3\" />\n {consistencyCheck.ai_service_available\n ? t('consistency.aiAvailable')\n : t('consistency.aiUnavailable')}\n </Badge>\n </CardTitle>\n </CardHeader>\n <CardContent className=\"space-y-4\">\n {/* Consistency Score Gauge */}\n <div\n className={`rounded-lg border p-4 ${getScoreBackgroundColor(score)}`}\n role=\"region\"\n aria-label={t('consistency.score')}\n >\n <div className=\"mb-2 flex items-center justify-between\">\n <span className=\"text-sm font-medium text-muted-foreground\">\n {t('consistency.score')}\n </span>\n <span className={`text-3xl font-bold ${getScoreColor(score)}`}>{score}</span>\n </div>\n <Progress\n value={score}\n className=\"mb-2 h-2\"\n aria-label={`${t('consistency.score')}: ${score} out of 100`}\n />\n <div className=\"flex items-center justify-between\">\n <span className=\"text-xs text-muted-foreground\">0</span>\n <span className={`text-sm font-medium ${getScoreColor(score)}`}>\n {getScoreLabel(score)}\n </span>\n <span className=\"text-xs text-muted-foreground\">100</span>\n </div>\n </div>\n\n {/* Check Metadata */}\n <div className=\"grid grid-cols-2 gap-3 text-sm\">\n <div className=\"flex items-center gap-2 text-muted-foreground\">\n <Shield className=\"size-4\" />\n <div>\n <p className=\"text-xs\">{t('consistency.checkTrigger')}</p>\n <p className=\"font-medium text-foreground\">\n {consistencyCheck.check_trigger === 'manual'\n ? t('consistency.manual')\n : t('consistency.automaticOnSubmit')}\n </p>\n </div>\n </div>\n <div className=\"flex items-center gap-2 text-muted-foreground\">\n <Clock className=\"size-4\" />\n <div>\n <p className=\"text-xs\">{t('consistency.checkedAt')}</p>\n <p className=\"font-medium text-foreground\">\n {formatDate(consistencyCheck.checked_at)}\n </p>\n </div>\n </div>\n </div>\n\n <Separator />\n\n {/* Conflicts Section */}\n {!hasConflicts ? (\n <div className=\"flex items-center gap-3 rounded-lg border border-green-200 bg-green-50 p-4\">\n <CheckCircle className=\"size-5 shrink-0 text-green-600\" />\n <div>\n <p className=\"text-sm font-medium text-green-900\">\n {t('consistency.noConflicts')}\n </p>\n <p className=\"text-xs text-green-700\">\n {t('consistency.noConflictsDescription')}\n </p>\n </div>\n </div>\n ) : (\n <div className=\"space-y-3\">\n {/* Conflicts Header */}\n <div className=\"flex items-center gap-3 rounded-lg border border-amber-200 bg-amber-50 p-3\">\n <AlertTriangle className=\"size-5 shrink-0 text-amber-600\" />\n <div>\n <p className=\"text-sm font-medium text-amber-900\">\n {t('consistency.conflictsFound')} ({consistencyCheck.conflicts.length})\n </p>\n <p className=\"text-xs text-amber-700\">\n {t('consistency.conflictsFoundDescription')}\n </p>\n </div>\n </div>\n\n {/* Conflicts List */}\n <div className=\"space-y-2\">\n {consistencyCheck.conflicts.map((conflict, index) => {\n const isExpanded = expandedConflicts.has(index);\n\n return (\n <div\n key={`${conflict.conflict_position_id}-${index}`}\n className=\"overflow-hidden rounded-lg border\"\n >\n {/* Conflict Header */}\n <button\n onClick={() => toggleConflict(index)}\n className=\"flex w-full items-center justify-between bg-muted/50 px-4 py-3 text-start transition-colors hover:bg-muted\"\n aria-expanded={isExpanded}\n aria-controls={`conflict-${index}`}\n >\n <div className=\"flex min-w-0 flex-1 items-center gap-2\">\n {getSeverityIcon(conflict.severity)}\n <span className=\"truncate text-sm font-medium\">\n {conflict.description}\n </span>\n </div>\n <div className=\"ms-2 flex shrink-0 items-center gap-2\">\n <Badge variant={getSeverityVariant(conflict.severity)} className=\"gap-1\">\n {t(`consistency.severityLevels.${conflict.severity}`)}\n </Badge>\n {getConflictTypeBadge(conflict.conflict_type)}\n {isExpanded ? (\n <ChevronUp className=\"size-4 text-muted-foreground\" />\n ) : (\n <ChevronDown className=\"size-4 text-muted-foreground\" />\n )}\n </div>\n </button>\n\n {/* Conflict Details (Expandable) */}\n {isExpanded && (\n <div id={`conflict-${index}`} className=\"space-y-3 bg-background p-4\">\n {/* Affected Sections */}\n {conflict.affected_sections.length > 0 && (\n <div>\n <p className=\"mb-1 text-xs font-medium text-muted-foreground\">\n {t('consistency.conflict.affectedSections')}\n </p>\n <div className=\"flex flex-wrap gap-1\">\n {conflict.affected_sections.map((section, idx) => (\n <Badge key={idx} variant=\"outline\" className=\"text-xs\">\n {section}\n </Badge>\n ))}\n </div>\n </div>\n )}\n\n {/* Suggested Resolution */}\n <div className=\"rounded-md border border-blue-200 bg-blue-50 p-3\">\n <p className=\"mb-1 text-xs font-medium text-blue-900\">\n {t('consistency.conflict.suggestedResolution')}\n </p>\n <p className=\"text-sm text-blue-800\">{conflict.suggested_resolution}</p>\n </div>\n\n {/* Action Buttons */}\n <div className=\"flex flex-wrap gap-2 pt-2\">\n <Button\n variant=\"default\"\n size=\"sm\"\n onClick={() =>\n onResolveConflict?.(conflict.conflict_position_id, 'modify')\n }\n className=\"flex-1 sm:flex-initial\"\n >\n {t('consistency.actions.modify')}\n </Button>\n <Button\n variant=\"outline\"\n size=\"sm\"\n onClick={() =>\n onViewConflictingPosition?.(conflict.conflict_position_id)\n }\n className=\"gap-1\"\n >\n {t('consistency.actions.viewPosition')}\n <ExternalLink className=\"size-3\" />\n </Button>\n <Button\n variant=\"secondary\"\n size=\"sm\"\n onClick={() =>\n onResolveConflict?.(conflict.conflict_position_id, 'accept')\n }\n >\n {t('consistency.actions.accept')}\n </Button>\n <Button\n variant=\"destructive\"\n size=\"sm\"\n onClick={() =>\n onResolveConflict?.(conflict.conflict_position_id, 'escalate')\n }\n >\n {t('consistency.actions.escalate')}\n </Button>\n </div>\n </div>\n )}\n </div>\n );\n })}\n </div>\n </div>\n )}\n </CardContent>\n </Card>\n );\n}\n","/**\n * Route: /positions/:id\n * Position detail/editor page with approval chain, consistency panel, and attachments\n */\n\nimport { createFileRoute } from '@tanstack/react-router';\nimport { useTranslation } from 'react-i18next';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Save, Send, CheckCircle, FileText, History, Users } from 'lucide-react';\nimport { usePosition } from '@/hooks/usePosition';\nimport { useUpdatePosition } from '@/hooks/useUpdatePosition';\nimport { useSubmitPosition } from '@/hooks/useSubmitPosition';\nimport { PositionEditor } from '@/components/PositionEditor';\nimport { ApprovalChain } from '@/components/ApprovalChain';\nimport { ConsistencyPanel } from '@/components/ConsistencyPanel';\nimport { AttachmentUploader } from '@/components/AttachmentUploader';\nimport { Badge } from '@/components/ui/badge';\nimport { Skeleton } from '@/components/ui/skeleton';\n\nexport const Route = createFileRoute('/_protected/positions/$id')({\n component: PositionDetailPage,\n});\n\nfunction PositionDetailPage() {\n const { id } = Route.useParams();\n const { t } = useTranslation('positions');\n const { data: position, isLoading } = usePosition(id);\n const updatePosition = useUpdatePosition();\n const submitPosition = useSubmitPosition();\n\n if (isLoading) {\n return (\n <div className=\"container mx-auto py-6 space-y-6\">\n <Skeleton className=\"h-8 w-64\" />\n <Skeleton className=\"h-96\" />\n </div>\n );\n }\n\n if (!position) {\n return (\n <div className=\"container mx-auto py-6\">\n <Card className=\"p-6 text-center\">\n <p className=\"text-lg text-muted-foreground\">\n {t('notFound', 'Position not found')}\n </p>\n </Card>\n </div>\n );\n }\n\n const handleSave = async (data: any) => {\n await updatePosition.mutateAsync({\n id: position.id,\n data: {\n ...data,\n version: position.version,\n },\n });\n };\n\n const handleSubmit = async () => {\n await submitPosition.mutateAsync(position.id);\n };\n\n const getStatusColor = (status: string) => {\n switch (status) {\n case 'draft':\n return 'default';\n case 'under_review':\n return 'secondary';\n case 'approved':\n return 'success';\n case 'published':\n return 'primary';\n default:\n return 'default';\n }\n };\n\n return (\n <div className=\"container mx-auto py-6 space-y-6\">\n {/* Header */}\n <div className=\"flex items-center justify-between\">\n <div className=\"space-y-1\">\n <div className=\"flex items-center gap-3\">\n <h1 className=\"text-3xl font-bold\">{position.title_en}</h1>\n <Badge variant={getStatusColor(position.status)}>\n {t(`status.${position.status}`, position.status)}\n </Badge>\n </div>\n <p className=\"text-sm text-muted-foreground\">{position.title_ar}</p>\n </div>\n\n <div className=\"flex gap-2\">\n {position.status === 'draft' && (\n <>\n <Button variant=\"outline\" onClick={handleSubmit}>\n <Send className=\"me-2 h-4 w-4\" />\n {t('submit', 'Submit for Review')}\n </Button>\n </>\n )}\n {position.status === 'approved' && (\n <Button>\n <CheckCircle className=\"me-2 h-4 w-4\" />\n {t('publish', 'Publish')}\n </Button>\n )}\n </div>\n </div>\n\n {/* Main Content Tabs */}\n <Tabs defaultValue=\"editor\" className=\"space-y-4\">\n <TabsList>\n <TabsTrigger value=\"editor\">\n <FileText className=\"me-2 h-4 w-4\" />\n {t('tabs.editor', 'Editor')}\n </TabsTrigger>\n {(position.status === 'under_review' || position.status === 'approved' || position.status === 'published') && (\n <TabsTrigger value=\"approvals\">\n <Users className=\"me-2 h-4 w-4\" />\n {t('tabs.approvals', 'Approvals')}\n </TabsTrigger>\n )}\n <TabsTrigger value=\"versions\">\n <History className=\"me-2 h-4 w-4\" />\n {t('tabs.versions', 'Versions')}\n </TabsTrigger>\n </TabsList>\n\n <TabsContent value=\"editor\" className=\"space-y-6\">\n {/* Editor Status Banner */}\n {position.status !== 'draft' && (\n <Card className=\"bg-muted/50 border-border\">\n <CardContent className=\"pt-3 pb-3\">\n <div className=\"flex items-start gap-2\">\n <FileText className=\"h-4 w-4 text-muted-foreground mt-0.5 flex-shrink-0\" />\n <p className=\"text-xs font-bold text-foreground\">\n {position.status === 'under_review' &&\n 'Position Under Review - Read Only. This position is currently under review and cannot be edited. It must go through the approval chain before any changes can be made.'}\n {position.status === 'approved' &&\n 'Position Approved - Read Only. This position has been approved and is awaiting publication. Contact an administrator to make changes.'}\n {position.status === 'published' &&\n 'Position Published - Read Only. This position has been published. To make changes, you must use the Emergency Correction workflow or create a new version.'}\n </p>\n </div>\n </CardContent>\n </Card>\n )}\n\n {position.status === 'draft' && (\n <Card className=\"bg-muted/50 border-border\">\n <CardContent className=\"pt-3 pb-3\">\n <div className=\"flex items-start gap-2\">\n <FileText className=\"h-4 w-4 text-muted-foreground mt-0.5 flex-shrink-0\" />\n <p className=\"text-xs font-bold text-foreground\">\n Draft Mode - Editing Enabled. You can edit this position. Changes are auto-saved every 30 seconds. Click \"Submit for Review\" when ready to start the approval process.\n </p>\n </div>\n </CardContent>\n </Card>\n )}\n\n <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n <div className=\"lg:col-span-2 space-y-6\">\n <Card className=\"p-6\">\n <PositionEditor\n initialData={position}\n onSave={handleSave}\n readOnly={position.status !== 'draft'}\n autoSaveInterval={30000}\n />\n </Card>\n\n <Card className=\"p-6\">\n <h3 className=\"text-lg font-semibold mb-4\">\n {t('attachments', 'Attachments')}\n </h3>\n <AttachmentUploader positionId={position.id} />\n </Card>\n </div>\n\n <div className=\"space-y-6\">\n {position.consistency_score !== undefined && (\n <Card className=\"p-6\">\n <h3 className=\"text-lg font-semibold mb-4\">\n {t('consistency.title', 'Consistency Check')}\n </h3>\n <ConsistencyPanel positionId={position.id} />\n </Card>\n )}\n\n {(position.status === 'under_review' || position.status === 'approved') && (\n <Card className=\"p-6\">\n <h3 className=\"text-lg font-semibold mb-4\">\n {t('approvalChain', 'Approval Progress')}\n </h3>\n <ApprovalChain positionId={position.id} currentStage={position.current_stage} />\n </Card>\n )}\n </div>\n </div>\n </TabsContent>\n\n <TabsContent value=\"approvals\">\n <Card className=\"p-6\">\n <ApprovalChain\n positionId={position.id}\n currentStage={position.current_stage}\n detailed={true}\n />\n </Card>\n </TabsContent>\n\n <TabsContent value=\"versions\">\n <Card className=\"p-6\">\n <p className=\"text-muted-foreground\">\n {t('versions.description', 'View version history and compare changes')}\n </p>\n </Card>\n </TabsContent>\n </Tabs>\n </div>\n );\n}\n"],"names":["API_BASE_URL","getAuthHeaders","session","supabase","useUpdatePosition","queryClient","useQueryClient","useMutation","id","data","headers","response","error","previousPosition","err","context","useSubmitPosition","usePositionDossierLinks","positionId","filters","isLoading","refetch","useQuery","params","useCreatePositionDossierLink","input","useDeletePositionDossierLink","_","variables","PositionDossierLinker","t","i18n","useTranslation","isRTL","isAdding","setIsAdding","useState","selectedDossierId","setSelectedDossierId","linkType","setLinkType","notes","setNotes","links","createLink","deleteLink","handleAddLink","handleDeleteLink","dossierId","jsx","Card","jsxs","LinkIcon","Button","Plus","Select","SelectTrigger","SelectValue","SelectContent","SelectItem","v","Textarea","e","link","Badge","X","EditorMenuBar","editor","disabled","cn","Separator","PositionEditor","initialData","onSave","onConflict","readOnly","autoSaveInterval","className","formData","setFormData","saving","setSaving","autoSaving","setAutoSaving","isDirty","setIsDirty","lastSaved","setLastSaved","setError","showConflictDialog","setShowConflictDialog","conflictVersions","setConflictVersions","enScrollRef","useRef","arScrollRef","isScrollingRef","autoSaveTimerRef","editorEn","useEditor","StarterKit","Placeholder","Link","html","prev","scheduleAutoSave","editorAr","useCallback","handleAutoSave","serverVersion","handleManualSave","useEffect","handleKeyDown","handleScroll","source","target","scrollPercentage","otherRef","otherSource","otherScrollTop","handleConflictReload","Loader2","AlertCircle","Save","CardContent","CardHeader","CardTitle","Label","EditorContent","Dialog","DialogContent","DialogHeader","DialogTitle","DialogDescription","DialogFooter","RefreshCw","ConsistencyPanel","consistencyCheck","onResolveConflict","onViewConflictingPosition","loading","expandedConflicts","setExpandedConflicts","toggleConflict","index","newExpanded","getScoreColor","score","getScoreBackgroundColor","getScoreLabel","getSeverityVariant","severity","getSeverityIcon","AlertTriangle","Info","getConflictTypeBadge","type","icons","formatDate","dateString","date","Shield","hasConflicts","Zap","Progress","Clock","conflict","isExpanded","ChevronUp","ChevronDown","section","idx","ExternalLink","CheckCircle","PositionDetailPage","Route","useParams","position","usePosition","updatePosition","submitPosition","Skeleton","handleSave","mutateAsync","version","handleSubmit","getStatusColor","status","title_en","title_ar","Fragment","Send","Tabs","TabsList","TabsTrigger","FileText","Users","History","TabsContent","AttachmentUploader","consistency_score","undefined","ApprovalChain","current_stage"],"mappings":"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"}