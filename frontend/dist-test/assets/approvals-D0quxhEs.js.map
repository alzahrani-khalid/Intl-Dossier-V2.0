{"version":3,"file":"approvals-D0quxhEs.js","sources":["../../src/routes/_protected/positions/$id/approvals.tsx?tsr-split=component"],"sourcesContent":["/**\n * Route: /positions/:id/approvals\n * Detailed approval tracking page\n */\n\nimport { createFileRoute } from '@tanstack/react-router';\nimport { useTranslation } from 'react-i18next';\nimport { Card } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { useQuery } from '@tanstack/react-query';\nimport { supabase } from '@/lib/supabase';\nimport { ArrowLeft, CheckCircle, XCircle, UserPlus, Users } from 'lucide-react';\nimport { Link } from '@tanstack/react-router';\nimport ApprovalChain from '@/components/ApprovalChain';\nimport { Skeleton } from '@/components/ui/skeleton';\n\nexport const Route = createFileRoute('/_protected/positions/$id/approvals')({\n component: ApprovalTrackingPage,\n});\n\nconst API_BASE_URL = import.meta.env.VITE_SUPABASE_URL + '/functions/v1';\n\nasync function fetchApprovals(positionId: string) {\n const { data: { session } } = await supabase.auth.getSession();\n const response = await fetch(`${API_BASE_URL}/positions-get?id=${positionId}`, {\n headers: {\n 'Authorization': `Bearer ${session?.access_token}`,\n 'Content-Type': 'application/json',\n },\n });\n\n if (!response.ok) {\n throw new Error('Failed to fetch position');\n }\n\n return response.json();\n}\n\nfunction ApprovalTrackingPage() {\n const { id } = Route.useParams();\n const { t } = useTranslation();\n\n const { data: position, isLoading } = useQuery({\n queryKey: ['positions', 'detail', id],\n queryFn: () => fetchApprovals(id),\n });\n\n if (isLoading) {\n return (\n <div className=\"container mx-auto py-6 space-y-4\">\n <Skeleton className=\"h-8 w-64\" />\n <Skeleton className=\"h-96\" />\n </div>\n );\n }\n\n const getActionIcon = (action: string) => {\n switch (action) {\n case 'approve':\n return <CheckCircle className=\"h-4 w-4 text-green-500\" />;\n case 'request_revisions':\n return <XCircle className=\"h-4 w-4 text-red-500\" />;\n case 'delegate':\n return <UserPlus className=\"h-4 w-4 text-blue-500\" />;\n case 'reassign':\n return <Users className=\"h-4 w-4 text-orange-500\" />;\n default:\n return null;\n }\n };\n\n return (\n <div className=\"container mx-auto py-6 space-y-6\">\n {/* Header */}\n <div className=\"flex items-center gap-4\">\n <Link to=\"/positions/$id\" params={{ id }}>\n <Button variant=\"outline\" size=\"sm\">\n <ArrowLeft className=\"me-2 h-4 w-4\" />\n {t('common.back', 'Back')}\n </Button>\n </Link>\n <h1 className=\"text-3xl font-bold\">\n {t('positions.approvals.title', 'Approval Tracking')}\n </h1>\n </div>\n\n {/* Approval Chain Visualization */}\n <Card className=\"p-6\">\n <h2 className=\"text-xl font-semibold mb-4\">\n {t('positions.approvals.progress', 'Approval Progress')}\n </h2>\n <ApprovalChain\n positionId={id}\n currentStage={position?.current_stage || 0}\n detailed={true}\n />\n </Card>\n\n {/* Approval History Table */}\n <Card className=\"p-6\">\n <h2 className=\"text-xl font-semibold mb-4\">\n {t('positions.approvals.history', 'Approval History')}\n </h2>\n\n <Table>\n <TableHeader>\n <TableRow>\n <TableHead>{t('positions.approvals.stage', 'Stage')}</TableHead>\n <TableHead>{t('positions.approvals.approver', 'Approver')}</TableHead>\n <TableHead>{t('positions.approvals.action', 'Action')}</TableHead>\n <TableHead>{t('positions.approvals.stepUp', 'Step-Up Verified')}</TableHead>\n <TableHead>{t('positions.approvals.comments', 'Comments')}</TableHead>\n <TableHead>{t('positions.approvals.timestamp', 'Timestamp')}</TableHead>\n </TableRow>\n </TableHeader>\n <TableBody>\n {position?.approvals?.map((approval: any) => (\n <TableRow key={approval.id}>\n <TableCell>\n <Badge variant=\"outline\">{approval.stage}</Badge>\n </TableCell>\n <TableCell>\n <div className=\"flex flex-col\">\n <span className=\"font-medium\">{approval.approver_name || approval.approver_id}</span>\n {approval.delegated_from && (\n <span className=\"text-xs text-muted-foreground\">\n {t('positions.approvals.delegatedFrom', 'Delegated from')}: {approval.delegated_from}\n </span>\n )}\n </div>\n </TableCell>\n <TableCell>\n <div className=\"flex items-center gap-2\">\n {getActionIcon(approval.action)}\n <span className=\"capitalize\">{approval.action.replace('_', ' ')}</span>\n </div>\n </TableCell>\n <TableCell>\n {approval.step_up_verified ? (\n <Badge variant=\"success\" className=\"text-xs\">\n {t('common.yes', 'Yes')}\n </Badge>\n ) : (\n <Badge variant=\"secondary\" className=\"text-xs\">\n {t('common.no', 'No')}\n </Badge>\n )}\n </TableCell>\n <TableCell className=\"max-w-xs truncate\">{approval.comments || '-'}</TableCell>\n <TableCell className=\"text-sm text-muted-foreground\">\n {new Date(approval.created_at).toLocaleString()}\n </TableCell>\n </TableRow>\n ))}\n </TableBody>\n </Table>\n </Card>\n </div>\n );\n}\n"],"names":["API_BASE_URL","import","fetchApprovals","positionId","data","session","supabase","auth","getSession","response","fetch","headers","access_token","ok","Error","json","ApprovalTrackingPage","id","Route","useParams","t","useTranslation","position","isLoading","useQuery","queryKey","queryFn","jsxs","jsx","Skeleton","getActionIcon","action","CheckCircle","XCircle","UserPlus","Users","Link","Button","ArrowLeft","Card","ApprovalChain","current_stage","Table","TableHeader","TableRow","TableHead","TableBody","approvals","map","approval","TableCell","Badge","stage","approver_name","approver_id","delegated_from","replace","step_up_verified","comments","Date","created_at","toLocaleString"],"mappings":"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"}