{"version":3,"file":"ContactForm-Csabxwy7.js","sources":["../../src/services/ocr-api.ts","../../src/hooks/useOCR.ts","../../src/components/contacts/ContactForm.tsx"],"sourcesContent":["/**\n * OCR API Client\n * Part of: 027-contact-directory implementation - Phase 4 (Business Card Scanning)\n *\n * Typed API client for OCR operations using Supabase Edge Functions.\n * Handles business card image upload, OCR processing, and field extraction.\n */\n\nimport { supabase } from '@/lib/supabase';\n\n// Get Supabase URL for Edge Functions\nconst supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n\nif (!supabaseUrl) {\n  throw new Error('Missing VITE_SUPABASE_URL environment variable');\n}\n\n/**\n * Parsed field from OCR extraction\n */\nexport interface OCRParsedFields {\n  full_name?: string;\n  organization?: string;\n  position?: string;\n  email_addresses?: string[];\n  phone_numbers?: string[];\n  website?: string;\n  address?: string;\n}\n\n/**\n * OCR Extraction Response\n */\nexport interface OCRResponse {\n  text: string; // Raw OCR text\n  confidence: number; // 0-100 overall confidence score\n  parsed_fields: OCRParsedFields; // Structured extracted fields\n  ocr_method: 'tesseract' | 'google_vision' | 'local'; // OCR engine used\n  language_detected?: string; // Detected language (e.g., 'en', 'ar')\n  processing_time_ms?: number; // Processing time in milliseconds\n}\n\n/**\n * API Error\n */\nexport class OCRAPIError extends Error {\n  constructor(\n    message: string,\n    public statusCode?: number,\n    public details?: unknown\n  ) {\n    super(message);\n    this.name = 'OCRAPIError';\n  }\n}\n\n/**\n * Get authorization headers with current user's JWT token\n */\nasync function getAuthHeaders(): Promise<Record<string, string>> {\n  const {\n    data: { session },\n  } = await supabase.auth.getSession();\n\n  if (!session) {\n    throw new OCRAPIError('Not authenticated', 401);\n  }\n\n  return {\n    Authorization: `Bearer ${session.access_token}`,\n  };\n}\n\n/**\n * Handle Edge Function responses\n */\nasync function handleResponse<T>(response: Response): Promise<T> {\n  if (!response.ok) {\n    let errorMessage = `Request failed with status ${response.status}`;\n    try {\n      const errorData = await response.json();\n      errorMessage = errorData.error || errorData.message || errorMessage;\n    } catch {\n      // Ignore JSON parse errors\n    }\n    throw new OCRAPIError(errorMessage, response.status);\n  }\n\n  try {\n    return await response.json();\n  } catch (error) {\n    throw new OCRAPIError('Failed to parse response', response.status, error);\n  }\n}\n\n/**\n * Upload and extract text from business card image\n *\n * @param file - Image file (JPEG, PNG, HEIC/HEIF)\n * @param consentCloudOCR - Whether user consented to cloud OCR (Google Vision API)\n * @returns OCR extraction result with parsed fields\n */\nexport async function uploadBusinessCard(\n  file: File,\n  consentCloudOCR: boolean = false\n): Promise<OCRResponse> {\n  // Validate file type\n  const validTypes = [\n    'image/jpeg',\n    'image/jpg',\n    'image/png',\n    'image/heic',\n    'image/heif',\n  ];\n  if (!validTypes.includes(file.type.toLowerCase())) {\n    throw new OCRAPIError(\n      'Invalid file type. Please upload JPEG, PNG, or HEIC image.',\n      400\n    );\n  }\n\n  // Validate file size (max 10MB)\n  const maxSize = 10 * 1024 * 1024; // 10MB\n  if (file.size > maxSize) {\n    throw new OCRAPIError(\n      'File too large. Maximum size is 10MB.',\n      400\n    );\n  }\n\n  const headers = await getAuthHeaders();\n\n  // Create FormData for multipart upload\n  const formData = new FormData();\n  formData.append('image', file);\n  formData.append('consent_cloud_ocr', String(consentCloudOCR));\n\n  const response = await fetch(`${supabaseUrl}/functions/v1/ocr-extract`, {\n    method: 'POST',\n    headers, // Note: Don't set Content-Type for FormData, browser will set it with boundary\n    body: formData,\n  });\n\n  return handleResponse<OCRResponse>(response);\n}\n\n/**\n * Validate extracted email address format\n */\nexport function isValidEmail(email: string): boolean {\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n  return emailRegex.test(email);\n}\n\n/**\n * Validate extracted phone number format (basic check)\n */\nexport function isValidPhone(phone: string): boolean {\n  // Remove spaces, dashes, parentheses\n  const cleaned = phone.replace(/[\\s\\-()]/g, '');\n  // Check if it contains at least 7 digits\n  return /\\d{7,}/.test(cleaned);\n}\n\n/**\n * Clean and normalize OCR extracted fields\n * Removes duplicates, validates formats, and normalizes data\n */\nexport function normalizeOCRFields(fields: OCRParsedFields): OCRParsedFields {\n  const normalized: OCRParsedFields = { ...fields };\n\n  // Normalize full name (trim, title case)\n  if (normalized.full_name) {\n    normalized.full_name = normalized.full_name.trim();\n  }\n\n  // Normalize organization and position\n  if (normalized.organization) {\n    normalized.organization = normalized.organization.trim();\n  }\n  if (normalized.position) {\n    normalized.position = normalized.position.trim();\n  }\n\n  // Validate and deduplicate emails\n  if (normalized.email_addresses && normalized.email_addresses.length > 0) {\n    normalized.email_addresses = Array.from(\n      new Set(\n        normalized.email_addresses\n          .map((e) => e.toLowerCase().trim())\n          .filter(isValidEmail)\n      )\n    );\n  }\n\n  // Deduplicate and clean phone numbers\n  if (normalized.phone_numbers && normalized.phone_numbers.length > 0) {\n    normalized.phone_numbers = Array.from(\n      new Set(\n        normalized.phone_numbers\n          .map((p) => p.trim())\n          .filter(isValidPhone)\n      )\n    );\n  }\n\n  return normalized;\n}\n\n/**\n * Document Upload Response\n */\nexport interface DocumentUploadResponse {\n  document_source_id: string;\n  processing_status: 'pending' | 'processing' | 'completed' | 'failed';\n}\n\n/**\n * Extracted Contact from Document\n */\nexport interface ExtractedContact {\n  full_name: string;\n  organization?: string;\n  position?: string;\n  email_addresses?: string[];\n  phone_numbers?: string[];\n  confidence: number; // 0-100 confidence score for this contact\n  source_page?: number; // Page number where contact was found\n}\n\n/**\n * Document Status Response\n */\nexport interface DocumentStatusResponse {\n  document_source_id: string;\n  processing_status: 'pending' | 'processing' | 'completed' | 'failed';\n  extracted_contacts?: ExtractedContact[];\n  extracted_contacts_count: number;\n  processing_error?: string;\n  file_name: string;\n  file_type: string;\n  file_format: string;\n  processing_time_ms?: number;\n}\n\n/**\n * Upload and extract contacts from document\n *\n * @param file - Document file (PDF, DOCX, TXT, CSV)\n * @returns Document upload response with processing status\n */\nexport async function uploadDocument(file: File): Promise<DocumentUploadResponse> {\n  // Validate file type\n  const validTypes = [\n    'application/pdf',\n    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n    'application/msword',\n    'text/plain',\n    'text/csv',\n    'application/vnd.ms-excel',\n    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n  ];\n\n  const fileExtension = file.name.toLowerCase().split('.').pop();\n  const validExtensions = ['pdf', 'docx', 'doc', 'txt', 'csv', 'xls', 'xlsx'];\n\n  if (!validTypes.includes(file.type.toLowerCase()) && !validExtensions.includes(fileExtension || '')) {\n    throw new OCRAPIError(\n      'Invalid file type. Please upload PDF, DOCX, DOC, TXT, CSV, or Excel file.',\n      400\n    );\n  }\n\n  // Validate file size (max 50MB for documents)\n  const maxSize = 50 * 1024 * 1024; // 50MB\n  if (file.size > maxSize) {\n    throw new OCRAPIError(\n      'File too large. Maximum size is 50MB.',\n      400\n    );\n  }\n\n  const headers = await getAuthHeaders();\n\n  // Create FormData for multipart upload\n  const formData = new FormData();\n  formData.append('file', file);\n\n  const response = await fetch(`${supabaseUrl}/functions/v1/contacts-extract-document`, {\n    method: 'POST',\n    headers: {\n      Authorization: headers.Authorization, // Only send auth header, let browser set Content-Type with boundary\n    },\n    body: formData,\n  });\n\n  return handleResponse<DocumentUploadResponse>(response);\n}\n\n/**\n * Check document processing status and get extracted contacts\n *\n * @param documentSourceId - Document source UUID\n * @returns Document status with extracted contacts if processing is complete\n */\nexport async function checkDocumentStatus(\n  documentSourceId: string\n): Promise<DocumentStatusResponse> {\n  const headers = await getAuthHeaders();\n\n  const response = await fetch(\n    `${supabaseUrl}/functions/v1/contacts-extract-document/${documentSourceId}`,\n    {\n      method: 'GET',\n      headers,\n    }\n  );\n\n  return handleResponse<DocumentStatusResponse>(response);\n}\n","/**\n * OCR Hooks\n * Part of: 027-contact-directory implementation - Phase 4 (Business Card Scanning)\n *\n * TanStack Query hooks for OCR operations with automatic error handling\n * and optimistic updates.\n */\n\nimport { useMutation, useQuery, type UseMutationResult, type UseQueryResult } from '@tanstack/react-query';\nimport {\n  uploadBusinessCard,\n  normalizeOCRFields,\n  uploadDocument,\n  checkDocumentStatus,\n  type OCRResponse,\n  type OCRParsedFields,\n  type DocumentUploadResponse,\n  type DocumentStatusResponse,\n  OCRAPIError,\n} from '@/services/ocr-api';\nimport { toast } from 'sonner';\nimport { useTranslation } from 'react-i18next';\n\n/**\n * Upload Business Card Parameters\n */\nexport interface UploadBusinessCardParams {\n  file: File;\n  consentCloudOCR?: boolean;\n}\n\n/**\n * Normalized OCR Response with cleaned fields\n */\nexport interface NormalizedOCRResponse extends OCRResponse {\n  normalized_fields: OCRParsedFields;\n}\n\n/**\n * Hook to upload and extract data from business card\n * Automatically normalizes extracted fields and shows success/error toasts\n */\nexport function useUploadBusinessCard(): UseMutationResult<\n  NormalizedOCRResponse,\n  OCRAPIError,\n  UploadBusinessCardParams,\n  unknown\n> {\n  const { t } = useTranslation('contacts');\n\n  return useMutation({\n    mutationFn: async ({ file, consentCloudOCR = false }: UploadBusinessCardParams) => {\n      const result = await uploadBusinessCard(file, consentCloudOCR);\n\n      // Normalize extracted fields\n      const normalized_fields = normalizeOCRFields(result.parsed_fields);\n\n      return {\n        ...result,\n        normalized_fields,\n      };\n    },\n    onSuccess: (data) => {\n      // Show success toast with extracted fields count\n      const fieldsCount = Object.keys(data.normalized_fields).filter(\n        (key) => {\n          const value = data.normalized_fields[key as keyof OCRParsedFields];\n          return value && (Array.isArray(value) ? value.length > 0 : true);\n        }\n      ).length;\n\n      toast.success(\n        t('contactDirectory.ocr.extraction_success', {\n          confidence: Math.round(data.confidence),\n          fieldsCount,\n        })\n      );\n    },\n    onError: (error: OCRAPIError) => {\n      // Show error toast\n      toast.error(\n        t('contactDirectory.ocr.extraction_error', { error: error.message })\n      );\n    },\n  });\n}\n\n/**\n * Hook to prefetch OCR capabilities (for feature detection)\n * Can be used to check if cloud OCR is available\n */\nexport function useOCRCapabilities() {\n  // This could be expanded to check server capabilities\n  // For now, we assume OCR is always available\n  return {\n    tesseractAvailable: true,\n    googleVisionAvailable: true, // Requires user consent\n    languagesSupported: ['en', 'ar'],\n  };\n}\n\n/**\n * Utility function to check if OCR confidence is acceptable\n * @param confidence - Confidence score (0-100)\n * @returns boolean indicating if confidence is acceptable\n */\nexport function isConfidenceAcceptable(confidence: number): boolean {\n  return confidence >= 70; // 70% threshold for acceptable confidence\n}\n\n/**\n * Get confidence level label for UI\n */\nexport function getConfidenceLevel(\n  confidence: number\n): 'high' | 'medium' | 'low' {\n  if (confidence >= 85) return 'high';\n  if (confidence >= 70) return 'medium';\n  return 'low';\n}\n\n/**\n * Get confidence color for UI badges\n */\nexport function getConfidenceColor(confidence: number): string {\n  const level = getConfidenceLevel(confidence);\n  switch (level) {\n    case 'high':\n      return 'bg-green-100 text-green-800 border-green-300';\n    case 'medium':\n      return 'bg-yellow-100 text-yellow-800 border-yellow-300';\n    case 'low':\n      return 'bg-red-100 text-red-800 border-red-300';\n  }\n}\n\n/**\n * Upload Document Parameters\n */\nexport interface UploadDocumentParams {\n  file: File;\n}\n\n/**\n * Hook to upload document for contact extraction\n * Returns document_source_id and initiates background processing\n */\nexport function useUploadDocument(): UseMutationResult<\n  DocumentUploadResponse,\n  OCRAPIError,\n  UploadDocumentParams,\n  unknown\n> {\n  const { t } = useTranslation('contacts');\n\n  return useMutation({\n    mutationFn: async ({ file }: UploadDocumentParams) => {\n      return await uploadDocument(file);\n    },\n    onSuccess: () => {\n      toast.success(t('contactDirectory.documentExtraction.upload_success'));\n    },\n    onError: (error: OCRAPIError) => {\n      toast.error(\n        t('contactDirectory.documentExtraction.upload_error', { error: error.message })\n      );\n    },\n  });\n}\n\n/**\n * Hook to check document processing status with automatic polling\n * Polls every 2 seconds while processing, stops when completed or failed\n */\nexport function useDocumentStatus(\n  documentSourceId: string | null,\n  options?: {\n    enabled?: boolean;\n    onCompleted?: (data: DocumentStatusResponse) => void;\n    onFailed?: (error: string) => void;\n  }\n): UseQueryResult<DocumentStatusResponse, OCRAPIError> {\n  return useQuery({\n    queryKey: ['document-status', documentSourceId],\n    queryFn: async () => {\n      if (!documentSourceId) throw new OCRAPIError('Document source ID is required', 400);\n      return await checkDocumentStatus(documentSourceId);\n    },\n    enabled: options?.enabled !== false && !!documentSourceId,\n    refetchInterval: (query) => {\n      // Stop polling if processing is complete or failed\n      const data = query.state.data;\n      if (!data) return false;\n      if (data.processing_status === 'completed') {\n        options?.onCompleted?.(data);\n        return false;\n      }\n      if (data.processing_status === 'failed') {\n        options?.onFailed?.(data.processing_error || 'Processing failed');\n        return false;\n      }\n      // Continue polling every 2 seconds while pending or processing\n      return 2000;\n    },\n    refetchIntervalInBackground: true, // Continue polling even when tab is not focused\n  });\n}\n","/**\n * ContactForm Component\n * Part of: 027-contact-directory implementation\n *\n * Mobile-first, RTL-ready contact creation/edit form with validation.\n * Supports manual entry with all contact fields.\n */\n\nimport { useForm } from 'react-hook-form';\nimport { useTranslation } from 'react-i18next';\nimport { Button } from '@/components/ui/button';\nimport {\n Form,\n FormControl,\n FormDescription,\n FormField,\n FormItem,\n FormLabel,\n FormMessage,\n} from '@/components/ui/form';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport {\n Select,\n SelectContent,\n SelectItem,\n SelectTrigger,\n SelectValue,\n} from '@/components/ui/select';\nimport { Badge } from '@/components/ui/badge';\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';\nimport { X, Plus, Loader2, Sparkles } from 'lucide-react';\nimport { getConfidenceColor } from '@/hooks/useOCR';\nimport type { PersonMetadata } from '@/hooks/usePersonDossiers';\n\ntype Organization = {\n id: string;\n name_en: string;\n name_ar: string;\n};\n\n/**\n * OCR confidence scores for individual fields\n */\nexport interface OCRFieldConfidence {\n full_name?: number;\n organization?: number;\n position?: number;\n email_addresses?: number;\n phone_numbers?: number;\n}\n\nexport interface PersonFormData {\n name_en: string;\n name_ar: string;\n description_en?: string;\n description_ar?: string;\n metadata: PersonMetadata;\n tags?: string[];\n}\n\ninterface ContactFormProps {\n defaultValues?: Partial<PersonFormData>;\n organizations?: Organization[];\n tags?: Array<{ id: string; name: string; color?: string }>;\n onSubmit: (data: PersonFormData) => void;\n onCancel?: () => void;\n isSubmitting?: boolean;\n mode?: 'create' | 'edit';\n ocrConfidence?: OCRFieldConfidence; // OCR confidence scores for extracted fields\n ocrRawText?: string; // Raw OCR text for reference\n}\n\ninterface FormValues {\n full_name: string;\n organization_id: string;\n position: string;\n email_addresses: string[];\n phone_numbers: string[];\n notes: string;\n tags: string[];\n source_type: 'manual' | 'business_card' | 'document';\n}\n\nexport function ContactForm({\n defaultValues,\n organizations = [],\n tags = [],\n onSubmit,\n onCancel,\n isSubmitting = false,\n mode = 'create',\n ocrConfidence,\n ocrRawText,\n}: ContactFormProps) {\n const { t, i18n } = useTranslation('contacts');\n const isRTL = i18n.language === 'ar';\n\n // Render OCR confidence badge\n const renderConfidenceBadge = (fieldName: keyof OCRFieldConfidence) => {\n if (!ocrConfidence || ocrConfidence[fieldName] === undefined) return null;\n\n const confidence = ocrConfidence[fieldName]!;\n const colorClass = getConfidenceColor(confidence);\n\n return (\n <TooltipProvider>\n <Tooltip>\n <TooltipTrigger asChild>\n <Badge\n variant=\"outline\"\n className={`${colorClass} text-xs gap-1 ${isRTL ? 'mr-2' : 'ml-2'}`}\n >\n <Sparkles className=\"h-3 w-3\" />\n {Math.round(confidence)}%\n </Badge>\n </TooltipTrigger>\n <TooltipContent>\n <p>{t('contactDirectory.ocr.confidence_tooltip', { confidence: Math.round(confidence) })}</p>\n </TooltipContent>\n </Tooltip>\n </TooltipProvider>\n );\n };\n\n const form = useForm<FormValues>({\n defaultValues: {\n full_name: defaultValues?.name_en || '',\n organization_id: defaultValues?.metadata?.organization_id || '',\n position: defaultValues?.metadata?.title_en || '',\n email_addresses: defaultValues?.metadata?.email || [''],\n phone_numbers: defaultValues?.metadata?.phone || [''],\n notes: defaultValues?.metadata?.notes || '',\n tags: defaultValues?.tags || [],\n source_type: (defaultValues?.metadata?.source_type as 'manual' | 'business_card' | 'document') || 'manual',\n },\n });\n\n const handleSubmit = (data: FormValues) => {\n // Filter out empty email/phone entries\n const emails = data.email_addresses.filter((e) => e.trim() !== '');\n const phones = data.phone_numbers.filter((p) => p.trim() !== '');\n\n // Find organization name for metadata\n const org = organizations.find(o => o.id === data.organization_id);\n\n // Transform form data to person dossier format\n const personData: PersonFormData = {\n name_en: data.full_name,\n name_ar: data.full_name, // TODO: Add Arabic name field\n metadata: {\n title_en: data.position,\n organization_id: data.organization_id || undefined,\n organization_name_en: org?.name_en,\n organization_name_ar: org?.name_ar,\n email: emails.length > 0 ? emails : undefined,\n phone: phones.length > 0 ? phones : undefined,\n notes: data.notes || undefined,\n source_type: data.source_type,\n },\n tags: data.tags,\n };\n\n onSubmit(personData);\n };\n\n const addEmailField = () => {\n const current = form.getValues('email_addresses');\n form.setValue('email_addresses', [...current, '']);\n };\n\n const removeEmailField = (index: number) => {\n const current = form.getValues('email_addresses');\n form.setValue(\n 'email_addresses',\n current.filter((_, i) => i !== index)\n );\n };\n\n const addPhoneField = () => {\n const current = form.getValues('phone_numbers');\n form.setValue('phone_numbers', [...current, '']);\n };\n\n const removePhoneField = (index: number) => {\n const current = form.getValues('phone_numbers');\n form.setValue(\n 'phone_numbers',\n current.filter((_, i) => i !== index)\n );\n };\n\n const toggleTag = (tagId: string) => {\n const current = form.getValues('tags');\n if (current.includes(tagId)) {\n form.setValue(\n 'tags',\n current.filter((id) => id !== tagId)\n );\n } else {\n form.setValue('tags', [...current, tagId]);\n }\n };\n\n return (\n <Form {...form}>\n <form\n onSubmit={form.handleSubmit(handleSubmit)}\n className=\"space-y-4 sm:space-y-6\"\n dir={isRTL ? 'rtl' : 'ltr'}\n >\n {/* Full Name - Required */}\n <FormField\n control={form.control}\n name=\"full_name\"\n rules={{\n required: t('contactDirectory.form.full_name_required'),\n minLength: { value: 2, message: t('contactDirectory.form.full_name_min_length') },\n maxLength: { value: 200, message: t('contactDirectory.form.full_name_max_length') },\n }}\n render={({ field }) => (\n <FormItem>\n <div className=\"flex items-center\">\n <FormLabel className=\"text-sm sm:text-base\">{t('contactDirectory.form.full_name')}</FormLabel>\n {renderConfidenceBadge('full_name')}\n </div>\n <FormControl>\n <Input\n {...field}\n placeholder={t('contactDirectory.form.full_name_placeholder')}\n className=\"h-11 px-4 text-base sm:h-10\"\n dir={isRTL ? 'rtl' : 'ltr'}\n />\n </FormControl>\n <FormMessage />\n </FormItem>\n )}\n />\n\n {/* Organization - Optional */}\n <FormField\n control={form.control}\n name=\"organization_id\"\n render={({ field }) => (\n <FormItem>\n <FormLabel className=\"text-sm sm:text-base\">{t('contactDirectory.form.organization')}</FormLabel>\n <Select onValueChange={field.onChange} defaultValue={field.value}>\n <FormControl>\n <SelectTrigger className=\"h-11 px-4 text-base sm:h-10\">\n <SelectValue placeholder={t('contactDirectory.form.select_organization')} />\n </SelectTrigger>\n </FormControl>\n <SelectContent>\n {organizations.map((org) => (\n <SelectItem key={org.id} value={org.id}>\n {org.name}\n </SelectItem>\n ))}\n </SelectContent>\n </Select>\n <FormMessage />\n </FormItem>\n )}\n />\n\n {/* Position/Title - Optional */}\n <FormField\n control={form.control}\n name=\"position\"\n render={({ field }) => (\n <FormItem>\n <div className=\"flex items-center\">\n <FormLabel className=\"text-sm sm:text-base\">{t('contactDirectory.form.position')}</FormLabel>\n {renderConfidenceBadge('position')}\n </div>\n <FormControl>\n <Input\n {...field}\n placeholder={t('contactDirectory.form.position_placeholder')}\n className=\"h-11 px-4 text-base sm:h-10\"\n dir={isRTL ? 'rtl' : 'ltr'}\n />\n </FormControl>\n <FormMessage />\n </FormItem>\n )}\n />\n\n {/* Email Addresses - Dynamic Array */}\n <div className=\"space-y-2\">\n <div className=\"flex items-center\">\n <FormLabel className=\"text-sm sm:text-base\">{t('contactDirectory.form.email_addresses')}</FormLabel>\n {renderConfidenceBadge('email_addresses')}\n </div>\n {form.watch('email_addresses').map((_, index) => (\n <div key={index} className=\"flex gap-2\">\n <FormField\n control={form.control}\n name={`email_addresses.${index}`}\n rules={{\n pattern: {\n value: /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/,\n message: t('contactDirectory.form.email_invalid'),\n },\n }}\n render={({ field }) => (\n <FormItem className=\"flex-1\">\n <FormControl>\n <Input\n {...field}\n type=\"email\"\n placeholder={t('contactDirectory.form.email_placeholder')}\n className=\"h-11 px-4 text-base sm:h-10\"\n />\n </FormControl>\n <FormMessage />\n </FormItem>\n )}\n />\n {form.watch('email_addresses').length > 1 && (\n <Button\n type=\"button\"\n variant=\"outline\"\n size=\"icon\"\n onClick={() => removeEmailField(index)}\n className=\" sm:h-10 sm:w-10\"\n >\n <X className=\"h-4 w-4\" />\n </Button>\n )}\n </div>\n ))}\n <Button\n type=\"button\"\n variant=\"outline\"\n size=\"sm\"\n onClick={addEmailField}\n className=\"h-9 gap-2\"\n >\n <Plus className=\"h-4 w-4\" />\n {t('contactDirectory.form.add_email')}\n </Button>\n </div>\n\n {/* Phone Numbers - Dynamic Array */}\n <div className=\"space-y-2\">\n <div className=\"flex items-center\">\n <FormLabel className=\"text-sm sm:text-base\">{t('contactDirectory.form.phone_numbers')}</FormLabel>\n {renderConfidenceBadge('phone_numbers')}\n </div>\n {form.watch('phone_numbers').map((_, index) => (\n <div key={index} className=\"flex gap-2\">\n <FormField\n control={form.control}\n name={`phone_numbers.${index}`}\n render={({ field }) => (\n <FormItem className=\"flex-1\">\n <FormControl>\n <Input\n {...field}\n type=\"tel\"\n placeholder={t('contactDirectory.form.phone_placeholder')}\n className=\"h-11 px-4 text-base sm:h-10\"\n />\n </FormControl>\n <FormMessage />\n </FormItem>\n )}\n />\n {form.watch('phone_numbers').length > 1 && (\n <Button\n type=\"button\"\n variant=\"outline\"\n size=\"icon\"\n onClick={() => removePhoneField(index)}\n className=\" sm:h-10 sm:w-10\"\n >\n <X className=\"h-4 w-4\" />\n </Button>\n )}\n </div>\n ))}\n <Button\n type=\"button\"\n variant=\"outline\"\n size=\"sm\"\n onClick={addPhoneField}\n className=\"h-9 gap-2\"\n >\n <Plus className=\"h-4 w-4\" />\n {t('contactDirectory.form.add_phone')}\n </Button>\n </div>\n\n {/* Tags - Multi-select */}\n {tags.length > 0 && (\n <div className=\"space-y-2\">\n <FormLabel className=\"text-sm sm:text-base\">{t('contactDirectory.form.tags')}</FormLabel>\n <div className=\"flex flex-wrap gap-2\">\n {tags.map((tag) => {\n const isSelected = form.watch('tags').includes(tag.id);\n return (\n <Badge\n key={tag.id}\n variant={isSelected ? 'default' : 'outline'}\n className=\"cursor-pointer px-3 py-1.5 text-sm\"\n onClick={() => toggleTag(tag.id)}\n style={\n isSelected && tag.color\n ? { backgroundColor: tag.color, borderColor: tag.color }\n : undefined\n }\n >\n {tag.name}\n </Badge>\n );\n })}\n </div>\n </div>\n )}\n\n {/* Notes - Optional */}\n <FormField\n control={form.control}\n name=\"notes\"\n render={({ field }) => (\n <FormItem>\n <FormLabel className=\"text-sm sm:text-base\">{t('contactDirectory.form.notes')}</FormLabel>\n <FormControl>\n <Textarea\n {...field}\n placeholder={t('contactDirectory.form.notes_placeholder')}\n className=\"min-h-[100px] px-4 py-3 text-base resize-y\"\n dir={isRTL ? 'rtl' : 'ltr'}\n />\n </FormControl>\n <FormDescription>{t('contactDirectory.form.notes_description')}</FormDescription>\n <FormMessage />\n </FormItem>\n )}\n />\n\n {/* Form Actions */}\n <div className=\"flex flex-col-reverse gap-3 pt-4 sm:flex-row sm:justify-end\">\n {onCancel && (\n <Button\n type=\"button\"\n variant=\"outline\"\n onClick={onCancel}\n disabled={isSubmitting}\n className=\"h-11 px-6 sm:h-10\"\n >\n {t('contactDirectory.form.cancel')}\n </Button>\n )}\n <Button\n type=\"submit\"\n disabled={isSubmitting}\n className=\"h-11 px-6 sm:h-10\"\n >\n {isSubmitting && <Loader2 className={`h-4 w-4 animate-spin ${isRTL ? 'ml-2' : 'mr-2'}`} />}\n {mode === 'create' ? t('contactDirectory.form.create_contact') : t('contactDirectory.form.save_changes')}\n </Button>\n </div>\n </form>\n </Form>\n );\n}\n"],"names":["supabaseUrl","OCRAPIError","message","statusCode","details","getAuthHeaders","session","supabase","handleResponse","response","errorMessage","errorData","error","uploadBusinessCard","file","consentCloudOCR","maxSize","headers","formData","isValidEmail","email","isValidPhone","phone","cleaned","normalizeOCRFields","fields","normalized","e","p","uploadDocument","validTypes","fileExtension","validExtensions","checkDocumentStatus","documentSourceId","useUploadBusinessCard","useTranslation","useMutation","result","normalized_fields","data","fieldsCount","key","value","toast","getConfidenceLevel","confidence","getConfidenceColor","useUploadDocument","useDocumentStatus","options","useQuery","query","ContactForm","defaultValues","organizations","tags","onSubmit","onCancel","isSubmitting","mode","ocrConfidence","ocrRawText","t","i18n","isRTL","renderConfidenceBadge","fieldName","colorClass","jsx","TooltipProvider","jsxs","Tooltip","TooltipTrigger","Badge","Sparkles","TooltipContent","form","useForm","handleSubmit","emails","phones","org","o","personData","addEmailField","current","removeEmailField","index","_","i","addPhoneField","removePhoneField","toggleTag","tagId","id","Form","FormField","field","FormItem","FormLabel","FormControl","Input","FormMessage","Select","SelectTrigger","SelectValue","SelectContent","SelectItem","Button","X","Plus","tag","isSelected","Textarea","FormDescription","Loader2"],"mappings":"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"}