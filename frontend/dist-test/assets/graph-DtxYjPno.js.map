{"version":3,"file":"graph-DtxYjPno.js","sources":["../../src/components/relationships/GraphVisualization.tsx","../../src/components/relationships/RelationshipNavigator.tsx","../../src/pages/relationships/RelationshipGraphPage.tsx","../../src/routes/_protected/relationships/graph.tsx?tsr-split=component"],"sourcesContent":["// T081: GraphVisualization Component for Network Graph Display\n// User Story 3: Traverse Entity Relationships as Graph\n// T085: Added graph visualization controls (zoom, filter by type)\n// T086: Implemented memoization for expensive graph rendering\n// Visualizes dossier relationships as interactive network graph using React Flow\nimport { useCallback, useMemo, useState, memo } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport ReactFlow, {\n Node,\n Edge,\n Controls,\n Background,\n BackgroundVariant,\n MiniMap,\n useNodesState,\n useEdgesState,\n ConnectionMode,\n Panel,\n NodeTypes,\n useReactFlow,\n} from 'reactflow';\nimport 'reactflow/dist/style.css';\nimport { Card } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport {\n Select,\n SelectContent,\n SelectItem,\n SelectTrigger,\n SelectValue,\n} from '@/components/ui/select';\nimport { ZoomIn, ZoomOut, Maximize2, Filter } from 'lucide-react';\n\n// Node data structure\ninterface NodeData {\n id: string;\n type: string;\n name_en: string;\n name_ar: string;\n status: string;\n degree: number;\n}\n\n// Props interface\ninterface GraphVisualizationProps {\n nodes: NodeData[];\n edges: Array<{\n source_id: string;\n target_id: string;\n relationship_type: string;\n }>;\n onNodeClick?: (nodeId: string) => void;\n height?: string;\n showMiniMap?: boolean;\n showControls?: boolean;\n enableTypeFilter?: boolean; // T085: Enable node type filtering\n enableRelationshipFilter?: boolean; // T085: Enable relationship type filtering\n}\n\n// T086: Memoized custom node component to prevent unnecessary re-renders\nconst DossierNode = memo(({ data }: { data: NodeData }) => {\n const { i18n } = useTranslation();\n const isRTL = i18n.language === 'ar';\n const name = isRTL ? data.name_ar : data.name_en;\n\n return (\n <Card className=\"min-w-[200px] px-4 py-3 border-2 shadow-md\">\n <div className=\"flex flex-col gap-2\">\n <div className=\"flex items-center justify-between gap-2\">\n <span className=\"text-sm font-semibold truncate\">{name}</span>\n {data.degree > 0 && (\n <Badge variant=\"outline\" className=\"text-xs shrink-0\">\n {data.degree}°\n </Badge>\n )}\n </div>\n <div className=\"flex items-center gap-2\">\n <Badge variant=\"secondary\" className=\"text-xs\">\n {data.type}\n </Badge>\n <Badge\n variant={data.status === 'active' ? 'default' : 'outline'}\n className=\"text-xs\"\n >\n {data.status}\n </Badge>\n </div>\n </div>\n </Card>\n );\n});\n\n// Node types configuration\nconst nodeTypes: NodeTypes = {\n dossier: DossierNode,\n};\n\n// Node color mapping by type\nconst getNodeColor = (type: string): string => {\n const colorMap: Record<string, string> = {\n country: '#3b82f6', // blue\n organization: '#8b5cf6', // purple\n individual: '#10b981', // green\n forum: '#f59e0b', // amber\n engagement: '#ec4899', // pink\n mou: '#14b8a6', // teal\n position: '#6366f1', // indigo\n };\n return colorMap[type] || '#6b7280'; // default gray\n};\n\n// Edge color by relationship type\nconst getEdgeColor = (relationshipType: string): string => {\n const colorMap: Record<string, string> = {\n member_of: '#3b82f6',\n partner: '#10b981',\n parent_org: '#8b5cf6',\n hosted_by: '#f59e0b',\n participant: '#ec4899',\n signatory: '#14b8a6',\n };\n return colorMap[relationshipType] || '#9ca3af'; // default gray\n};\n\nexport function GraphVisualization({\n nodes: rawNodes,\n edges: rawEdges,\n onNodeClick,\n height = '600px',\n showMiniMap = true,\n showControls = true,\n enableTypeFilter = true, // T085: Node type filtering\n enableRelationshipFilter = true, // T085: Relationship type filtering\n}: GraphVisualizationProps) {\n const { t, i18n } = useTranslation();\n const isRTL = i18n.language === 'ar';\n const { zoomIn, zoomOut, fitView } = useReactFlow();\n\n // T085: Filter state for node types and relationship types\n const [selectedNodeType, setSelectedNodeType] = useState<string>('all');\n const [selectedRelationshipType, setSelectedRelationshipType] = useState<string>('all');\n\n // T085: Extract unique node types and relationship types\n const nodeTypes = useMemo(() => {\n const types = new Set(rawNodes.map((n) => n.type));\n return ['all', ...Array.from(types)];\n }, [rawNodes]);\n\n const relationshipTypes = useMemo(() => {\n const types = new Set(rawEdges.map((e) => e.relationship_type));\n return ['all', ...Array.from(types)];\n }, [rawEdges]);\n\n // T086: Memoized filtered nodes based on selected type\n const filteredNodes = useMemo(() => {\n if (selectedNodeType === 'all') return rawNodes;\n return rawNodes.filter((node) => node.type === selectedNodeType);\n }, [rawNodes, selectedNodeType]);\n\n // T086: Memoized filtered edges based on selected relationship type and visible nodes\n const filteredEdges = useMemo(() => {\n const nodeIds = new Set(filteredNodes.map((n) => n.id));\n let edges = rawEdges.filter(\n (edge) => nodeIds.has(edge.source_id) && nodeIds.has(edge.target_id)\n );\n\n if (selectedRelationshipType !== 'all') {\n edges = edges.filter((edge) => edge.relationship_type === selectedRelationshipType);\n }\n\n return edges;\n }, [rawEdges, filteredNodes, selectedRelationshipType]);\n\n // T086: Transform nodes to React Flow format with memoization\n const nodes: Node[] = useMemo(() => {\n return filteredNodes.map((node, index) => {\n const angle = (index / filteredNodes.length) * 2 * Math.PI;\n const radius = 250;\n\n return {\n id: node.id,\n type: 'dossier',\n data: node,\n position: {\n x: 400 + radius * Math.cos(angle),\n y: 300 + radius * Math.sin(angle),\n },\n style: {\n borderColor: getNodeColor(node.type),\n borderWidth: node.degree === 0 ? 3 : 2,\n },\n };\n });\n }, [filteredNodes]);\n\n // T086: Transform edges to React Flow format with memoization\n const edges: Edge[] = useMemo(() => {\n return filteredEdges.map((edge, index) => ({\n id: `edge-${index}`,\n source: edge.source_id,\n target: edge.target_id,\n type: 'smoothstep',\n animated: false,\n label: edge.relationship_type.replace(/_/g, ' '),\n style: {\n stroke: getEdgeColor(edge.relationship_type),\n strokeWidth: 2,\n },\n labelStyle: {\n fontSize: 12,\n fontWeight: 500,\n },\n }));\n }, [filteredEdges]);\n\n const [reactFlowNodes, , onNodesChange] = useNodesState(nodes);\n const [reactFlowEdges, , onEdgesChange] = useEdgesState(edges);\n\n const handleNodeClick = useCallback(\n (_event: React.MouseEvent, node: Node) => {\n if (onNodeClick) {\n onNodeClick(node.id);\n }\n },\n [onNodeClick]\n );\n\n return (\n <div\n className=\"relative w-full rounded-lg border bg-background\"\n style={{ height }}\n dir={isRTL ? 'rtl' : 'ltr'}\n >\n <ReactFlow\n nodes={reactFlowNodes}\n edges={reactFlowEdges}\n onNodesChange={onNodesChange}\n onEdgesChange={onEdgesChange}\n onNodeClick={handleNodeClick}\n nodeTypes={nodeTypes}\n connectionMode={ConnectionMode.Loose}\n fitView\n attributionPosition={isRTL ? 'bottom-left' : 'bottom-right'}\n >\n <Background variant={BackgroundVariant.Dots} gap={16} size={1} />\n\n {showControls && <Controls position={isRTL ? 'top-left' : 'top-right'} />}\n\n {showMiniMap && (\n <MiniMap\n position={isRTL ? 'bottom-left' : 'bottom-right'}\n nodeColor={(node) => getNodeColor(node.data?.type || '')}\n nodeBorderRadius={8}\n maskColor=\"rgba(0, 0, 0, 0.1)\"\n />\n )}\n\n {/* T085: Custom Zoom Controls Panel */}\n <Panel position={isRTL ? 'bottom-right' : 'bottom-left'} className=\"flex gap-2\">\n <Button\n size=\"sm\"\n variant=\"outline\"\n className=\"h-8 w-8 p-0\"\n onClick={() => zoomIn()}\n title={t('graph.zoomIn', 'Zoom In')}\n >\n <ZoomIn className=\"h-4 w-4\" />\n </Button>\n <Button\n size=\"sm\"\n variant=\"outline\"\n className=\"h-8 w-8 p-0\"\n onClick={() => zoomOut()}\n title={t('graph.zoomOut', 'Zoom Out')}\n >\n <ZoomOut className=\"h-4 w-4\" />\n </Button>\n <Button\n size=\"sm\"\n variant=\"outline\"\n className=\"h-8 w-8 p-0\"\n onClick={() => fitView()}\n title={t('graph.fitView', 'Fit View')}\n >\n <Maximize2 className=\"h-4 w-4\" />\n </Button>\n </Panel>\n\n {/* T085: Filter Controls Panel */}\n {(enableTypeFilter || enableRelationshipFilter) && (\n <Panel\n position={isRTL ? 'top-left' : 'top-right'}\n className=\"bg-background/95 p-3 rounded-lg border shadow-sm flex flex-col gap-3\"\n >\n <div className=\"flex items-center gap-2 text-sm font-semibold\">\n <Filter className=\"h-4 w-4\" />\n <span>{t('graph.filters', 'Filters')}</span>\n </div>\n\n {enableTypeFilter && (\n <div className=\"flex flex-col gap-1.5\">\n <label className=\"text-xs text-muted-foreground\">\n {t('graph.nodeType', 'Node Type')}\n </label>\n <Select value={selectedNodeType} onValueChange={setSelectedNodeType}>\n <SelectTrigger className=\"h-8 w-[160px] text-xs\">\n <SelectValue />\n </SelectTrigger>\n <SelectContent>\n {nodeTypes.map((type) => (\n <SelectItem key={type} value={type} className=\"text-xs\">\n {type === 'all'\n ? t('graph.allTypes', 'All Types')\n : type.replace(/_/g, ' ')}\n </SelectItem>\n ))}\n </SelectContent>\n </Select>\n </div>\n )}\n\n {enableRelationshipFilter && (\n <div className=\"flex flex-col gap-1.5\">\n <label className=\"text-xs text-muted-foreground\">\n {t('graph.relationshipType', 'Relationship')}\n </label>\n <Select\n value={selectedRelationshipType}\n onValueChange={setSelectedRelationshipType}\n >\n <SelectTrigger className=\"h-8 w-[160px] text-xs\">\n <SelectValue />\n </SelectTrigger>\n <SelectContent>\n {relationshipTypes.map((type) => (\n <SelectItem key={type} value={type} className=\"text-xs\">\n {type === 'all'\n ? t('graph.allRelationships', 'All Relationships')\n : type.replace(/_/g, ' ')}\n </SelectItem>\n ))}\n </SelectContent>\n </Select>\n </div>\n )}\n\n <div className=\"text-xs text-muted-foreground pt-1 border-t\">\n {filteredNodes.length} {t('graph.nodesShown', 'nodes')} ·{' '}\n {filteredEdges.length} {t('graph.edgesShown', 'edges')}\n </div>\n </Panel>\n )}\n\n <Panel position={isRTL ? 'top-right' : 'top-left'} className=\"bg-background/95 p-3 rounded-lg border shadow-sm\">\n <div className=\"flex flex-col gap-2\">\n <div className=\"text-sm font-semibold\">{t('graph.legend', 'Legend')}</div>\n <div className=\"flex flex-col gap-1 text-xs\">\n <div className=\"flex items-center gap-2\">\n <div className=\"h-3 w-3 rounded-full\" style={{ backgroundColor: '#3b82f6' }} />\n <span>{t('graph.country', 'Country')}</span>\n </div>\n <div className=\"flex items-center gap-2\">\n <div className=\"h-3 w-3 rounded-full\" style={{ backgroundColor: '#8b5cf6' }} />\n <span>{t('graph.organization', 'Organization')}</span>\n </div>\n <div className=\"flex items-center gap-2\">\n <div className=\"h-3 w-3 rounded-full\" style={{ backgroundColor: '#10b981' }} />\n <span>{t('graph.individual', 'Individual')}</span>\n </div>\n <div className=\"flex items-center gap-2\">\n <div className=\"h-3 w-3 rounded-full\" style={{ backgroundColor: '#f59e0b' }} />\n <span>{t('graph.forum', 'Forum')}</span>\n </div>\n </div>\n </div>\n </Panel>\n </ReactFlow>\n </div>\n );\n}\n","// T082: RelationshipNavigator Component for Browsing Relationships\n// User Story 3: Traverse Entity Relationships as Graph\n// Provides filterable list view of relationships with degree navigation\nimport { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Separator } from '@/components/ui/separator';\nimport { Search, ChevronRight, Filter } from 'lucide-react';\n\n// Node data structure\ninterface NodeData {\n id: string;\n type: string;\n name_en: string;\n name_ar: string;\n status: string;\n degree: number;\n path: string[];\n}\n\n// Props interface\ninterface RelationshipNavigatorProps {\n nodes: NodeData[];\n startDossierId: string;\n onNodeSelect?: (nodeId: string) => void;\n}\n\nexport function RelationshipNavigator({\n nodes,\n startDossierId,\n onNodeSelect,\n}: RelationshipNavigatorProps) {\n const { t, i18n } = useTranslation();\n const isRTL = i18n.language === 'ar';\n\n const [searchQuery, setSearchQuery] = useState('');\n const [degreeFilter, setDegreeFilter] = useState<string>('all');\n const [typeFilter, setTypeFilter] = useState<string>('all');\n\n // Get unique node types for filter\n const nodeTypes = [...new Set(nodes.map((n) => n.type))];\n\n // Get max degree for filter options\n const maxDegree = Math.max(...nodes.map((n) => n.degree));\n\n // Filter nodes based on search and filters\n const filteredNodes = nodes.filter((node) => {\n if (node.id === startDossierId) return false; // Exclude starting node\n\n // Search filter\n if (searchQuery) {\n const query = searchQuery.toLowerCase();\n const matchesEn = node.name_en.toLowerCase().includes(query);\n const matchesAr = node.name_ar.toLowerCase().includes(query);\n if (!matchesEn && !matchesAr) return false;\n }\n\n // Degree filter\n if (degreeFilter !== 'all' && node.degree !== parseInt(degreeFilter)) {\n return false;\n }\n\n // Type filter\n if (typeFilter !== 'all' && node.type !== typeFilter) {\n return false;\n }\n\n return true;\n });\n\n // Group nodes by degree\n const nodesByDegree = filteredNodes.reduce((acc, node) => {\n const degree = node.degree;\n if (!acc[degree]) {\n acc[degree] = [];\n }\n acc[degree].push(node);\n return acc;\n }, {} as Record<number, NodeData[]>);\n\n const handleNodeClick = (nodeId: string) => {\n if (onNodeSelect) {\n onNodeSelect(nodeId);\n }\n };\n\n return (\n <Card className=\"w-full\">\n <CardHeader>\n <CardTitle className=\"flex items-center gap-2\">\n <Filter className=\"h-5 w-5\" />\n {t('relationship.navigator.title', 'Relationship Navigator')}\n </CardTitle>\n <CardDescription>\n {t(\n 'relationship.navigator.description',\n 'Browse and filter connected entities by degree and type'\n )}\n </CardDescription>\n </CardHeader>\n <CardContent>\n {/* Search and Filters */}\n <div className=\"flex flex-col gap-4 mb-6\">\n <div className=\"relative\">\n <Search className={`absolute ${isRTL ? 'right-3' : 'left-3'} top-3 h-4 w-4 text-muted-foreground`} />\n <Input\n placeholder={t('relationship.navigator.search', 'Search entities...')}\n value={searchQuery}\n onChange={(e) => setSearchQuery(e.target.value)}\n className={isRTL ? 'pe-9' : 'ps-9'}\n />\n </div>\n\n <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n <div>\n <label className=\"text-sm font-medium mb-2 block\">\n {t('relationship.navigator.degree', 'Degree')}\n </label>\n <Select value={degreeFilter} onValueChange={setDegreeFilter}>\n <SelectTrigger>\n <SelectValue />\n </SelectTrigger>\n <SelectContent>\n <SelectItem value=\"all\">\n {t('relationship.navigator.allDegrees', 'All Degrees')}\n </SelectItem>\n {Array.from({ length: maxDegree }, (_, i) => i + 1).map((degree) => (\n <SelectItem key={degree} value={degree.toString()}>\n {degree}° {t('relationship.navigator.separation', 'separation')}\n </SelectItem>\n ))}\n </SelectContent>\n </Select>\n </div>\n\n <div>\n <label className=\"text-sm font-medium mb-2 block\">\n {t('relationship.navigator.type', 'Entity Type')}\n </label>\n <Select value={typeFilter} onValueChange={setTypeFilter}>\n <SelectTrigger>\n <SelectValue />\n </SelectTrigger>\n <SelectContent>\n <SelectItem value=\"all\">\n {t('relationship.navigator.allTypes', 'All Types')}\n </SelectItem>\n {nodeTypes.map((type) => (\n <SelectItem key={type} value={type}>\n {t(`dossier.type.${type}`, type)}\n </SelectItem>\n ))}\n </SelectContent>\n </Select>\n </div>\n </div>\n </div>\n\n {/* Results Count */}\n <div className=\"mb-4 text-sm text-muted-foreground\">\n {t('relationship.navigator.results', {\n count: filteredNodes.length,\n defaultValue: '{{count}} entities found',\n })}\n </div>\n\n {/* Nodes List */}\n <ScrollArea className=\"h-[400px]\">\n {Object.keys(nodesByDegree)\n .sort((a, b) => parseInt(a) - parseInt(b))\n .map((degree) => (\n <div key={degree} className=\"mb-6\">\n <div className=\"flex items-center gap-2 mb-3\">\n <Badge variant=\"outline\" className=\"text-sm font-semibold\">\n {degree}° {t('relationship.navigator.separation', 'Separation')}\n </Badge>\n <Separator className=\"flex-1\" />\n </div>\n\n <div className=\"space-y-2\">\n {nodesByDegree[parseInt(degree)].map((node) => {\n const name = isRTL ? node.name_ar : node.name_en;\n\n return (\n <Button\n key={node.id}\n variant=\"ghost\"\n className=\"w-full justify-start h-auto p-3 hover:bg-accent\"\n onClick={() => handleNodeClick(node.id)}\n >\n <div className=\"flex items-center gap-3 w-full\">\n <div className=\"flex-1 text-start\">\n <div className=\"font-medium mb-1\">{name}</div>\n <div className=\"flex items-center gap-2 flex-wrap\">\n <Badge variant=\"secondary\" className=\"text-xs\">\n {t(`dossier.type.${node.type}`, node.type)}\n </Badge>\n <Badge\n variant={node.status === 'active' ? 'default' : 'outline'}\n className=\"text-xs\"\n >\n {t(`dossier.status.${node.status}`, node.status)}\n </Badge>\n </div>\n </div>\n <ChevronRight className={`h-4 w-4 shrink-0 ${isRTL ? 'rotate-180' : ''}`} />\n </div>\n </Button>\n );\n })}\n </div>\n </div>\n ))}\n\n {filteredNodes.length === 0 && (\n <div className=\"text-center py-8 text-muted-foreground\">\n {t('relationship.navigator.noResults', 'No entities match your filters')}\n </div>\n )}\n </ScrollArea>\n </CardContent>\n </Card>\n );\n}\n","// T083: RelationshipGraphPage - Full-page Graph Visualization\n// User Story 3: Traverse Entity Relationships as Graph\n// Main page for exploring dossier relationships with graph and list views\nimport { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { useQuery } from '@tanstack/react-query';\nimport { useNavigate, useSearch } from '@tanstack/react-router';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { GraphVisualization } from '@/components/relationships/GraphVisualization';\nimport { RelationshipNavigator } from '@/components/relationships/RelationshipNavigator';\nimport { Network, List, AlertCircle, Settings } from 'lucide-react';\nimport { supabase } from '@/lib/supabase';\n\n// Graph data interface\ninterface GraphData {\n start_dossier_id: string;\n start_dossier: {\n id: string;\n type: string;\n name_en: string;\n name_ar: string;\n status: string;\n };\n max_degrees: number;\n relationship_type_filter: string;\n nodes: Array<{\n id: string;\n type: string;\n name_en: string;\n name_ar: string;\n status: string;\n degree: number;\n path: string[];\n }>;\n edges: Array<{\n source_id: string;\n target_id: string;\n relationship_type: string;\n }>;\n stats: {\n node_count: number;\n edge_count: number;\n max_degree: number;\n query_time_ms: number;\n performance_warning: string | null;\n };\n}\n\n// Fetch graph data from Edge Function\nasync function fetchGraphData(\n startDossierId: string,\n maxDegrees: number,\n relationshipType?: string\n): Promise<GraphData> {\n const { data: { session } } = await supabase.auth.getSession();\n if (!session) {\n throw new Error('Not authenticated');\n }\n\n const params = new URLSearchParams({\n startDossierId,\n maxDegrees: maxDegrees.toString(),\n });\n\n if (relationshipType && relationshipType !== 'all') {\n params.append('relationshipType', relationshipType);\n }\n\n const response = await fetch(\n `${import.meta.env.VITE_SUPABASE_URL}/functions/v1/graph-traversal?${params}`,\n {\n headers: {\n Authorization: `Bearer ${session.access_token}`,\n },\n }\n );\n\n if (!response.ok) {\n const error = await response.json();\n throw new Error(error.error || 'Failed to fetch graph data');\n }\n\n return response.json();\n}\n\nexport function RelationshipGraphPage() {\n const { t, i18n } = useTranslation();\n const isRTL = i18n.language === 'ar';\n const navigate = useNavigate();\n\n // Get query parameters\n const search = useSearch({ strict: false });\n const startDossierId = (search as any)?.dossierId as string | undefined;\n\n // State\n const [maxDegrees, setMaxDegrees] = useState(2);\n const [relationshipType, setRelationshipType] = useState<string>('all');\n const [activeTab, setActiveTab] = useState<'graph' | 'list'>('graph');\n\n // Fetch graph data\n const {\n data: graphData,\n isLoading,\n error,\n refetch,\n } = useQuery({\n queryKey: ['graph-traversal', startDossierId, maxDegrees, relationshipType],\n queryFn: () => fetchGraphData(startDossierId!, maxDegrees, relationshipType),\n enabled: !!startDossierId,\n staleTime: 30000, // Cache for 30 seconds\n });\n\n const handleNodeSelect = (nodeId: string) => {\n navigate({\n to: '/dossiers/$dossierId',\n params: { dossierId: nodeId },\n });\n };\n\n const handleRefresh = () => {\n refetch();\n };\n\n if (!startDossierId) {\n return (\n <div className=\"container mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n <Alert>\n <AlertCircle className=\"h-4 w-4\" />\n <AlertDescription>\n {t('graph.noDossier', 'No dossier selected. Please select a dossier to view its relationship graph.')}\n </AlertDescription>\n </Alert>\n </div>\n );\n }\n\n return (\n <div className=\"container mx-auto px-4 sm:px-6 lg:px-8 py-8\" dir={isRTL ? 'rtl' : 'ltr'}>\n {/* Header */}\n <div className=\"mb-6\">\n <h1 className=\"text-2xl sm:text-3xl font-bold mb-2\">\n {t('graph.title', 'Relationship Graph')}\n </h1>\n <p className=\"text-muted-foreground\">\n {t('graph.description', 'Explore connections between entities')}\n </p>\n </div>\n\n {/* Controls */}\n <Card className=\"mb-6\">\n <CardContent className=\"pt-6\">\n <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\n <div>\n <Label htmlFor=\"maxDegrees\" className=\"mb-2 block\">\n {t('graph.maxDegrees', 'Degrees of Separation')}\n </Label>\n <Select\n value={maxDegrees.toString()}\n onValueChange={(value) => setMaxDegrees(parseInt(value))}\n >\n <SelectTrigger id=\"maxDegrees\">\n <SelectValue />\n </SelectTrigger>\n <SelectContent>\n <SelectItem value=\"1\">1° {t('graph.degree', 'degree')}</SelectItem>\n <SelectItem value=\"2\">2° {t('graph.degrees', 'degrees')}</SelectItem>\n <SelectItem value=\"3\">3° {t('graph.degrees', 'degrees')}</SelectItem>\n <SelectItem value=\"4\">4° {t('graph.degrees', 'degrees')}</SelectItem>\n <SelectItem value=\"5\">5° {t('graph.degrees', 'degrees')}</SelectItem>\n </SelectContent>\n </Select>\n </div>\n\n <div>\n <Label htmlFor=\"relationshipType\" className=\"mb-2 block\">\n {t('graph.relationshipType', 'Relationship Type')}\n </Label>\n <Select value={relationshipType} onValueChange={setRelationshipType}>\n <SelectTrigger id=\"relationshipType\">\n <SelectValue />\n </SelectTrigger>\n <SelectContent>\n <SelectItem value=\"all\">{t('graph.allTypes', 'All Types')}</SelectItem>\n <SelectItem value=\"member_of\">{t('relationship.memberOf', 'Member Of')}</SelectItem>\n <SelectItem value=\"partner\">{t('relationship.partner', 'Partner')}</SelectItem>\n <SelectItem value=\"parent_org\">{t('relationship.parentOrg', 'Parent Organization')}</SelectItem>\n <SelectItem value=\"hosted_by\">{t('relationship.hostedBy', 'Hosted By')}</SelectItem>\n <SelectItem value=\"participant\">{t('relationship.participant', 'Participant')}</SelectItem>\n <SelectItem value=\"signatory\">{t('relationship.signatory', 'Signatory')}</SelectItem>\n </SelectContent>\n </Select>\n </div>\n\n <div className=\"flex items-end\">\n <Button onClick={handleRefresh} variant=\"outline\" className=\"w-full\">\n <Settings className=\"h-4 w-4 me-2\" />\n {t('graph.refresh', 'Refresh')}\n </Button>\n </div>\n </div>\n\n {/* Stats */}\n {graphData && (\n <div className=\"mt-4 p-4 bg-muted rounded-lg\">\n <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-4 text-center\">\n <div>\n <div className=\"text-2xl font-bold\">{graphData.stats.node_count}</div>\n <div className=\"text-xs text-muted-foreground\">{t('graph.nodes', 'Entities')}</div>\n </div>\n <div>\n <div className=\"text-2xl font-bold\">{graphData.stats.edge_count}</div>\n <div className=\"text-xs text-muted-foreground\">{t('graph.edges', 'Relationships')}</div>\n </div>\n <div>\n <div className=\"text-2xl font-bold\">{graphData.stats.max_degree}°</div>\n <div className=\"text-xs text-muted-foreground\">{t('graph.maxDegree', 'Max Degree')}</div>\n </div>\n <div>\n <div className=\"text-2xl font-bold\">{graphData.stats.query_time_ms}ms</div>\n <div className=\"text-xs text-muted-foreground\">{t('graph.queryTime', 'Query Time')}</div>\n </div>\n </div>\n\n {graphData.stats.performance_warning && (\n <Alert variant=\"destructive\" className=\"mt-4\">\n <AlertCircle className=\"h-4 w-4\" />\n <AlertDescription>{graphData.stats.performance_warning}</AlertDescription>\n </Alert>\n )}\n </div>\n )}\n </CardContent>\n </Card>\n\n {/* Error State */}\n {error && (\n <Alert variant=\"destructive\" className=\"mb-6\">\n <AlertCircle className=\"h-4 w-4\" />\n <AlertDescription>\n {t('graph.error', 'Failed to load graph data')}: {(error as Error).message}\n </AlertDescription>\n </Alert>\n )}\n\n {/* Loading State */}\n {isLoading && (\n <Card>\n <CardContent className=\"pt-6\">\n <Skeleton className=\"h-[600px] w-full\" />\n </CardContent>\n </Card>\n )}\n\n {/* Graph Visualization */}\n {graphData && (\n <Tabs value={activeTab} onValueChange={(v) => setActiveTab(v as 'graph' | 'list')}>\n <TabsList className=\"mb-4\">\n <TabsTrigger value=\"graph\" className=\"gap-2\">\n <Network className=\"h-4 w-4\" />\n {t('graph.graphView', 'Graph View')}\n </TabsTrigger>\n <TabsTrigger value=\"list\" className=\"gap-2\">\n <List className=\"h-4 w-4\" />\n {t('graph.listView', 'List View')}\n </TabsTrigger>\n </TabsList>\n\n <TabsContent value=\"graph\">\n <GraphVisualization\n nodes={[graphData.start_dossier, ...graphData.nodes]}\n edges={graphData.edges}\n onNodeClick={handleNodeSelect}\n height=\"calc(100vh - 500px)\"\n showMiniMap\n showControls\n />\n </TabsContent>\n\n <TabsContent value=\"list\">\n <RelationshipNavigator\n nodes={[graphData.start_dossier, ...graphData.nodes]}\n startDossierId={startDossierId}\n onNodeSelect={handleNodeSelect}\n />\n </TabsContent>\n </Tabs>\n )}\n </div>\n );\n}\n","// TanStack Router route for Relationship Graph Page\n// User Story 3: Traverse Entity Relationships as Graph\nimport { createFileRoute } from '@tanstack/react-router';\nimport { RelationshipGraphPage } from '@/pages/relationships/RelationshipGraphPage';\n\nexport const Route = createFileRoute('/_protected/relationships/graph')({\n component: RelationshipGraphPage,\n validateSearch: (search: Record<string, unknown>) => {\n return {\n dossierId: (search.dossierId as string) || undefined,\n };\n },\n});\n"],"names":["memo","data","i18n","useTranslation","name","Card","jsxs","jsx","Badge","getNodeColor","type","getEdgeColor","relationshipType","GraphVisualization","rawNodes","rawEdges","onNodeClick","height","showMiniMap","showControls","enableTypeFilter","enableRelationshipFilter","t","isRTL","zoomIn","zoomOut","fitView","useReactFlow","selectedNodeType","setSelectedNodeType","useState","selectedRelationshipType","setSelectedRelationshipType","nodeTypes","useMemo","types","n","relationshipTypes","e","filteredNodes","node","filteredEdges","nodeIds","edges","edge","nodes","index","angle","radius","reactFlowNodes","onNodesChange","useNodesState","reactFlowEdges","onEdgesChange","useEdgesState","handleNodeClick","useCallback","_event","ReactFlow","ConnectionMode","Background","BackgroundVariant","Controls","MiniMap","Panel","Button","ZoomIn","ZoomOut","Maximize2","Filter","Select","SelectTrigger","SelectValue","SelectContent","SelectItem","RelationshipNavigator","startDossierId","onNodeSelect","searchQuery","setSearchQuery","degreeFilter","setDegreeFilter","typeFilter","setTypeFilter","maxDegree","query","matchesEn","matchesAr","nodesByDegree","acc","degree","nodeId","CardHeader","CardTitle","CardDescription","CardContent","Search","Input","_","i","ScrollArea","b","Separator","ChevronRight","fetchGraphData","maxDegrees","session","supabase","params","response","error","RelationshipGraphPage","navigate","useNavigate","useSearch","setMaxDegrees","setRelationshipType","activeTab","setActiveTab","graphData","isLoading","refetch","useQuery","handleNodeSelect","handleRefresh","Label","value","Settings","Alert","AlertCircle","AlertDescription","Skeleton","Tabs","v","TabsList","TabsTrigger","Network","List","TabsContent","SplitComponent"],"mappings":"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"}