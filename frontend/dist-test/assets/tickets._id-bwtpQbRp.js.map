{"version":3,"mappings":"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","names":["DuplicateComparison","ticketId","t","i18n","useTranslation","queryClient","useQueryClient","selectedCandidate","setSelectedCandidate","useState","mergeReason","setMergeReason","response","isLoading","error","useDuplicateCandidates","candidates","mergeMutation","useMergeTickets","notDuplicateMutation","useMutation","candidateId","handleMerge","primaryId","targetId","jsxs","jsx","highConfidence","c","mediumConfidence","candidate","DuplicateCandidateCard","e","onSelect","onNotDuplicate","isSelected","getSimilarityColor","score","Link","EntityLinkManager","lazy","__vitePreload","TicketDetail","id","useParams","navigate","useNavigate","activeTab","setActiveTab","useTicket","ticket","attachments","useUpdateTicket","convertMutation","useConvertTicket","closeMutation","useCloseTicket","getStatusBadgeColor","status","SLACountdown","tab","key","value","attachment","targetType","resolution","TriagePanel","Suspense","TicketDetailPage"],"ignoreList":[],"sources":["../../src/components/DuplicateComparison.tsx","../../src/pages/TicketDetail.tsx","../../src/routes/_protected/intake/tickets.$id.tsx?tsr-split=component"],"sourcesContent":["import { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\nimport { Link } from '@tanstack/react-router';\nimport { useDuplicateCandidates, useMergeTickets } from '../hooks/useIntakeApi';\n\ninterface DuplicateCandidate {\n id: string;\n target_ticket_id: string;\n target_ticket: {\n id: string;\n ticket_number: string;\n title: string;\n title_ar?: string;\n description: string;\n description_ar?: string;\n request_type: string;\n status: string;\n created_at: string;\n };\n overall_score: number;\n title_similarity: number;\n content_similarity: number;\n metadata_similarity: number;\n status: 'pending' | 'confirmed_duplicate' | 'not_duplicate' | 'merged';\n}\n\ninterface DuplicateComparisonProps {\n ticketId: string;\n}\n\nexport function DuplicateComparison({ ticketId }: DuplicateComparisonProps) {\n const { t, i18n } = useTranslation('intake');\n const queryClient = useQueryClient();\n const [selectedCandidate, setSelectedCandidate] = useState<DuplicateCandidate | null>(null);\n const [mergeReason, setMergeReason] = useState('');\n\n // Fetch duplicate candidates using the proper hook\n const { data: response, isLoading, error } = useDuplicateCandidates(ticketId);\n const candidates = response?.candidates || [];\n\n // Use the merge tickets hook\n const mergeMutation = useMergeTickets(ticketId);\n\n // Mark as not duplicate mutation\n const notDuplicateMutation = useMutation({\n mutationFn: async (candidateId: string) => {\n const response = await fetch(\n `${import.meta.env.VITE_API_URL}/intake/duplicates/${candidateId}`,\n {\n method: 'PATCH',\n headers: {\n 'Content-Type': 'application/json',\n Authorization: `Bearer ${localStorage.getItem('access_token')}`,\n },\n body: JSON.stringify({\n status: 'not_duplicate',\n }),\n }\n );\n\n if (!response.ok) {\n throw new Error('Failed to update duplicate status');\n }\n\n return response.json();\n },\n onSuccess: () => {\n queryClient.invalidateQueries({ queryKey: ['duplicate-candidates', ticketId] });\n },\n });\n\n const getSimilarityColor = (score: number): string => {\n if (score >= 0.8) return 'text-red-600 bg-red-100 dark:bg-red-900/20';\n if (score >= 0.65) return 'text-yellow-600 bg-yellow-100 dark:bg-yellow-900/20';\n return 'text-green-600 bg-green-100 dark:bg-green-900/20';\n };\n\n const getSimilarityLabel = (score: number): string => {\n if (score >= 0.8) return t('duplicates.similarity.high', 'High Similarity');\n if (score >= 0.65) return t('duplicates.similarity.medium', 'Medium Similarity');\n return t('duplicates.similarity.low', 'Low Similarity');\n };\n\n const handleMerge = (primaryId: string) => {\n if (!selectedCandidate || !mergeReason.trim()) {\n alert(t('duplicates.mergeReasonRequired', 'Please provide a reason for merging'));\n return;\n }\n\n const targetId = primaryId === ticketId ? selectedCandidate.target_ticket_id : ticketId;\n\n mergeMutation.mutate({\n targetTicketIds: [targetId],\n primaryTicketId: primaryId,\n mergeReason: mergeReason,\n mergeReasonAr: i18n.language === 'ar' ? mergeReason : undefined,\n }, {\n onSuccess: () => {\n setSelectedCandidate(null);\n setMergeReason('');\n }\n });\n };\n\n if (isLoading) {\n return (\n <div className=\"py-8 text-center\">\n <div className=\"inline-block size-8 animate-spin rounded-full border-b-2 border-blue-600\"></div>\n <p className=\"mt-4 text-gray-600 dark:text-gray-400\">\n {t('duplicates.loading', 'Checking for duplicates...')}\n </p>\n </div>\n );\n }\n\n if (error) {\n return (\n <div className=\"rounded-lg border border-red-200 bg-red-50 p-4 text-red-700 dark:border-red-800 dark:bg-red-900/20 dark:text-red-400\">\n {t('duplicates.error', 'Failed to load duplicate candidates. Please try again.')}\n </div>\n );\n }\n\n if (!candidates || candidates.length === 0) {\n return (\n <div className=\"py-8 text-center\">\n <div className=\"mb-4 text-6xl\">‚úì</div>\n <p className=\"text-lg text-gray-600 dark:text-gray-400\">\n {t('duplicates.noDuplicates', 'No potential duplicates detected')}\n </p>\n </div>\n );\n }\n\n // Separate high-confidence and medium-confidence candidates\n const highConfidence = candidates.filter((c) => c.overall_score >= 0.8);\n const mediumConfidence = candidates.filter((c) => c.overall_score >= 0.65 && c.overall_score < 0.8);\n\n return (\n <div className=\"space-y-6\">\n {/* Warning Banner for High Confidence Duplicates */}\n {highConfidence.length > 0 && (\n <div className=\"rounded-lg border border-red-200 bg-red-50 p-4 dark:border-red-800 dark:bg-red-900/20\">\n <div className=\"mb-2 flex items-center gap-2\">\n <span className=\"text-xl text-red-600 dark:text-red-400\">‚ö†Ô∏è</span>\n <h3 className=\"font-semibold text-red-800 dark:text-red-300\">\n {t('duplicates.highConfidenceWarning', 'High Confidence Duplicates Detected')}\n </h3>\n </div>\n <p className=\"text-sm text-red-700 dark:text-red-400\">\n {t(\n 'duplicates.highConfidenceMessage',\n 'We found {{count}} ticket(s) with high similarity. Please review and consider merging.',\n { count: highConfidence.length }\n )}\n </p>\n </div>\n )}\n\n {/* High Confidence Candidates */}\n {highConfidence.length > 0 && (\n <div>\n <h3 className=\"mb-4 text-lg font-semibold text-gray-900 dark:text-white\">\n {t('duplicates.highConfidence', 'High Confidence Duplicates')}\n </h3>\n <div className=\"space-y-4\">\n {highConfidence.map((candidate) => (\n <DuplicateCandidateCard\n key={candidate.id}\n candidate={candidate}\n onSelect={() => setSelectedCandidate(candidate)}\n onNotDuplicate={() => notDuplicateMutation.mutate(candidate.id)}\n isSelected={selectedCandidate?.id === candidate.id}\n />\n ))}\n </div>\n </div>\n )}\n\n {/* Medium Confidence Candidates */}\n {mediumConfidence.length > 0 && (\n <div>\n <h3 className=\"mb-4 text-lg font-semibold text-gray-900 dark:text-white\">\n {t('duplicates.mediumConfidence', 'Possible Duplicates')}\n </h3>\n <div className=\"space-y-4\">\n {mediumConfidence.map((candidate) => (\n <DuplicateCandidateCard\n key={candidate.id}\n candidate={candidate}\n onSelect={() => setSelectedCandidate(candidate)}\n onNotDuplicate={() => notDuplicateMutation.mutate(candidate.id)}\n isSelected={selectedCandidate?.id === candidate.id}\n />\n ))}\n </div>\n </div>\n )}\n\n {/* Merge Dialog */}\n {selectedCandidate && (\n <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4\">\n <div className=\"max-h-[90vh] w-full max-w-2xl overflow-y-auto rounded-lg bg-white shadow-xl dark:bg-gray-800\">\n <div className=\"p-6\">\n <h2 className=\"mb-4 text-2xl font-bold text-gray-900 dark:text-white\">\n {t('duplicates.mergDialog.title', 'Merge Tickets')}\n </h2>\n\n <div className=\"mb-6 space-y-4\">\n <div>\n <label className=\"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300\">\n {t('duplicates.mergeDialog.primaryTicket', 'Select Primary Ticket')}\n </label>\n <p className=\"mb-3 text-sm text-gray-600 dark:text-gray-400\">\n {t(\n 'duplicates.mergeDialog.primaryTicketHelp',\n 'The primary ticket will remain active, and the other will be marked as merged.'\n )}\n </p>\n <div className=\"space-y-2\">\n <button\n onClick={() => handleMerge(ticketId)}\n className=\"w-full rounded-lg border-2 border-blue-500 bg-blue-50 p-3 text-start hover:bg-blue-100 dark:bg-blue-900/20 dark:hover:bg-blue-900/30\"\n >\n <div className=\"font-medium text-gray-900 dark:text-white\">\n {t('duplicates.mergeDialog.currentTicket', 'Current Ticket')}\n </div>\n <div className=\"text-sm text-gray-600 dark:text-gray-400\">{ticketId}</div>\n </button>\n <button\n onClick={() => handleMerge(selectedCandidate.target_ticket_id)}\n className=\"w-full rounded-lg border-2 border-gray-300 p-3 text-start hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-700\"\n >\n <div className=\"font-medium text-gray-900 dark:text-white\">\n {selectedCandidate.target_ticket.ticket_number}\n </div>\n <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n {i18n.language === 'ar' && selectedCandidate.target_ticket.title_ar\n ? selectedCandidate.target_ticket.title_ar\n : selectedCandidate.target_ticket.title}\n </div>\n </button>\n </div>\n </div>\n\n <div>\n <label className=\"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300\">\n {t('duplicates.mergeDialog.reason', 'Reason for Merge')} *\n </label>\n <textarea\n value={mergeReason}\n onChange={(e) => setMergeReason(e.target.value)}\n placeholder={t(\n 'duplicates.mergeDialog.reasonPlaceholder',\n 'Explain why these tickets should be merged'\n )}\n rows={3}\n className=\"w-full rounded-md border-gray-300 bg-white text-gray-900 dark:border-gray-600 dark:bg-gray-700 dark:text-white\"\n />\n </div>\n </div>\n\n <div className=\"flex gap-3\">\n <button\n onClick={() => {\n setSelectedCandidate(null);\n setMergeReason('');\n }}\n className=\"flex-1 rounded-md border border-gray-300 px-4 py-2 text-gray-700 hover:bg-gray-50 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700\"\n >\n {t('common.cancel', 'Cancel')}\n </button>\n </div>\n </div>\n </div>\n </div>\n )}\n </div>\n );\n}\n\n// Sub-component for individual candidate cards\nfunction DuplicateCandidateCard({\n candidate,\n onSelect,\n onNotDuplicate,\n isSelected,\n}: {\n candidate: DuplicateCandidate;\n onSelect: () => void;\n onNotDuplicate: () => void;\n isSelected: boolean;\n}) {\n const { t, i18n } = useTranslation('intake');\n\n const getSimilarityColor = (score: number): string => {\n if (score >= 0.8) return 'text-red-600 bg-red-100 dark:bg-red-900/20';\n if (score >= 0.65) return 'text-yellow-600 bg-yellow-100 dark:bg-yellow-900/20';\n return 'text-green-600 bg-green-100 dark:bg-green-900/20';\n };\n\n return (\n <div\n className={`rounded-lg border-2 p-4 transition-all ${\n isSelected\n ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20'\n : 'border-gray-200 hover:border-gray-300 dark:border-gray-700 dark:hover:border-gray-600'\n }`}\n >\n <div className=\"mb-3 flex items-start justify-between\">\n <div className=\"flex-1\">\n <Link\n to={`/intake/tickets/${candidate.target_ticket_id}`}\n className=\"font-medium text-blue-600 hover:text-blue-700 dark:text-blue-400\"\n target=\"_blank\"\n >\n {candidate.target_ticket.ticket_number} ‚Üó\n </Link>\n <h4 className=\"mt-1 text-lg font-semibold text-gray-900 dark:text-white\">\n {i18n.language === 'ar' && candidate.target_ticket.title_ar\n ? candidate.target_ticket.title_ar\n : candidate.target_ticket.title}\n </h4>\n </div>\n <div className={`rounded-full px-3 py-1 text-sm font-semibold ${getSimilarityColor(candidate.overall_score)}`}>\n {Math.round(candidate.overall_score * 100)}%\n </div>\n </div>\n\n <p className=\"mb-3 line-clamp-2 text-sm text-gray-600 dark:text-gray-400\">\n {i18n.language === 'ar' && candidate.target_ticket.description_ar\n ? candidate.target_ticket.description_ar\n : candidate.target_ticket.description}\n </p>\n\n <div className=\"mb-4 grid grid-cols-3 gap-2\">\n <div className=\"text-center\">\n <div className=\"mb-1 text-xs text-gray-500 dark:text-gray-400\">\n {t('duplicates.titleSimilarity', 'Title')}\n </div>\n <div className=\"text-sm font-semibold text-gray-900 dark:text-white\">\n {Math.round(candidate.title_similarity * 100)}%\n </div>\n </div>\n <div className=\"text-center\">\n <div className=\"mb-1 text-xs text-gray-500 dark:text-gray-400\">\n {t('duplicates.contentSimilarity', 'Content')}\n </div>\n <div className=\"text-sm font-semibold text-gray-900 dark:text-white\">\n {Math.round(candidate.content_similarity * 100)}%\n </div>\n </div>\n <div className=\"text-center\">\n <div className=\"mb-1 text-xs text-gray-500 dark:text-gray-400\">\n {t('duplicates.metadataSimilarity', 'Metadata')}\n </div>\n <div className=\"text-sm font-semibold text-gray-900 dark:text-white\">\n {Math.round(candidate.metadata_similarity * 100)}%\n </div>\n </div>\n </div>\n\n <div className=\"flex gap-2\">\n <button\n onClick={onSelect}\n className=\"flex-1 rounded-md bg-blue-600 px-4 py-2 text-sm text-white hover:bg-blue-700\"\n >\n {t('duplicates.merge', 'Merge Tickets')}\n </button>\n <button\n onClick={onNotDuplicate}\n className=\"rounded-md border border-gray-300 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700\"\n >\n {t('duplicates.notDuplicate', 'Not a Duplicate')}\n </button>\n </div>\n </div>\n );\n}","import { useState, lazy, Suspense } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { useParams, useNavigate } from '@tanstack/react-router';\nimport { SLACountdown } from '../components/SLACountdown';\nimport { TriagePanel } from '../components/TriagePanel';\nimport { DuplicateComparison } from '../components/DuplicateComparison';\nimport { useTicket, useUpdateTicket, useConvertTicket, useCloseTicket } from '../hooks/useIntakeApi';\n\n// Lazy load EntityLinkManager for performance (Task T049)\nconst EntityLinkManager = lazy(() => import('../components/entity-links/EntityLinkManager'));\n\nexport function TicketDetail() {\n const { t, i18n } = useTranslation('intake');\n const { id } = useParams({ strict: false });\n const navigate = useNavigate();\n const [activeTab, setActiveTab] = useState<'details' | 'triage' | 'duplicates' | 'history' | 'links'>('details');\n\n // Use the proper hooks\n const { data: response, isLoading, error } = useTicket(id || '');\n const ticket = response?.ticket;\n const attachments = response?.attachments || [];\n\n const updateMutation = useUpdateTicket(id || '');\n const convertMutation = useConvertTicket(id || '');\n const closeMutation = useCloseTicket(id || '');\n\n const getStatusBadgeColor = (status: string): string => {\n const colors: Record<string, string> = {\n draft: 'bg-gray-200 text-gray-800',\n submitted: 'bg-blue-100 text-blue-800',\n triaged: 'bg-purple-100 text-purple-800',\n assigned: 'bg-yellow-100 text-yellow-800',\n in_progress: 'bg-indigo-100 text-indigo-800',\n converted: 'bg-green-100 text-green-800',\n closed: 'bg-gray-300 text-gray-700',\n merged: 'bg-orange-100 text-orange-800',\n };\n return colors[status] || 'bg-gray-200 text-gray-800';\n };\n\n if (isLoading) {\n return (\n <div className=\"container mx-auto px-4 py-8\">\n <div className=\"py-12 text-center\">\n <div className=\"inline-block size-12 animate-spin rounded-full border-b-2 border-gray-900 dark:border-white\"></div>\n <p className=\"mt-4 text-gray-600 dark:text-gray-400\">{t('common.loading', 'Loading...')}</p>\n </div>\n </div>\n );\n }\n\n if (error || !ticket) {\n return (\n <div className=\"container mx-auto px-4 py-8\">\n <div className=\"rounded-lg border border-red-200 bg-red-50 p-4 text-red-700 dark:border-red-800 dark:bg-red-900/20 dark:text-red-400\">\n {t('ticketDetail.error', 'Failed to load ticket. Please try again.')}\n </div>\n </div>\n );\n }\n\n return (\n <div className=\"container mx-auto px-4 py-8\" dir={i18n.language === 'ar' ? 'rtl' : 'ltr'}>\n {/* Header */}\n <div className=\"mb-6\">\n <div className=\"mb-4 flex items-center justify-between\">\n <div>\n <h1 className=\"mb-2 text-3xl font-bold text-gray-900 dark:text-white\">\n {ticket.ticket_number}\n </h1>\n <p className=\"text-gray-600 dark:text-gray-400\">\n {i18n.language === 'ar' && ticket.title_ar ? ticket.title_ar : ticket.title}\n </p>\n </div>\n <div className=\"flex items-center gap-3\">\n <span\n className={`inline-flex rounded-full px-4 py-2 text-sm font-semibold ${getStatusBadgeColor(\n ticket.status\n )}`}\n >\n {t(`queue.status.${ticket.status}`)}\n </span>\n <button\n onClick={() => navigate({ to: '/intake/queue' })}\n className=\"rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700\"\n >\n {t('common.back', 'Back to Queue')}\n </button>\n </div>\n </div>\n\n {/* SLA Indicators */}\n {ticket.status !== 'closed' && ticket.status !== 'converted' && ticket.submitted_at && (\n <div className=\"mb-6 grid grid-cols-1 gap-4 md:grid-cols-2\">\n <SLACountdown\n ticketId={ticket.id}\n targetMinutes={ticket.priority === 'urgent' || ticket.priority === 'high' ? 30 : 60}\n eventType=\"acknowledgment\"\n startedAt={ticket.submitted_at}\n />\n <SLACountdown\n ticketId={ticket.id}\n targetMinutes={ticket.priority === 'urgent' || ticket.priority === 'high' ? 480 : 1440}\n eventType=\"resolution\"\n startedAt={ticket.submitted_at}\n />\n </div>\n )}\n </div>\n\n {/* Tabs */}\n <div className=\"mb-6 border-b border-gray-200 dark:border-gray-700\">\n <nav className=\"-mb-px flex\">\n {['details', 'triage', 'duplicates', 'history', 'links'].map((tab) => (\n <button\n key={tab}\n onClick={() => setActiveTab(tab as typeof activeTab)}\n className={`border-b-2 px-6 py-3 text-sm font-medium transition-colors ${\n activeTab === tab\n ? 'border-blue-500 text-blue-600 dark:text-blue-400'\n : 'border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300'\n }`}\n >\n {t(`ticketDetail.tabs.${tab}`, tab.charAt(0).toUpperCase() + tab.slice(1))}\n </button>\n ))}\n </nav>\n </div>\n\n {/* Tab Content */}\n <div className=\"rounded-lg bg-white p-6 shadow-md dark:bg-gray-800\">\n {activeTab === 'details' && (\n <div className=\"space-y-6\">\n {/* Basic Information */}\n <div className=\"grid grid-cols-1 gap-6 md:grid-cols-2\">\n <div>\n <label className=\"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300\">\n {t('ticketDetail.requestType', 'Request Type')}\n </label>\n <p className=\"text-gray-900 dark:text-white\">\n {t(`form.requestType.options.${ticket.requestType}`)}\n </p>\n </div>\n <div>\n <label className=\"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300\">\n {t('ticketDetail.urgency', 'Urgency')}\n </label>\n <p className=\"text-gray-900 dark:text-white\">\n {t(`queue.urgency.${ticket.urgency}`)}\n </p>\n </div>\n <div>\n <label className=\"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300\">\n {t('ticketDetail.sensitivity', 'Sensitivity')}\n </label>\n <p className=\"capitalize text-gray-900 dark:text-white\">{ticket.sensitivity}</p>\n </div>\n <div>\n <label className=\"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300\">\n {t('ticketDetail.priority', 'Priority')}\n </label>\n <p className=\"text-gray-900 dark:text-white\">\n {t(`queue.priority.${ticket.priority}`)}\n </p>\n </div>\n </div>\n\n {/* Description */}\n <div>\n <label className=\"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300\">\n {t('ticketDetail.description', 'Description')}\n </label>\n <div className=\"rounded-lg bg-gray-50 p-4 dark:bg-gray-900\">\n <p className=\"whitespace-pre-wrap text-gray-900 dark:text-white\">\n {i18n.language === 'ar' && ticket.description_ar ? ticket.description_ar : ticket.description}\n </p>\n </div>\n </div>\n\n {/* Type-Specific Fields */}\n {ticket.type_specific_fields && Object.keys(ticket.type_specific_fields).length > 0 && (\n <div>\n <label className=\"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300\">\n {t('ticketDetail.additionalInfo', 'Additional Information')}\n </label>\n <div className=\"space-y-2 rounded-lg bg-gray-50 p-4 dark:bg-gray-900\">\n {Object.entries(ticket.type_specific_fields).map(([key, value]) => (\n <div key={key} className=\"flex justify-between\">\n <span className=\"capitalize text-gray-600 dark:text-gray-400\">{key}:</span>\n <span className=\"text-gray-900 dark:text-white\">{String(value)}</span>\n </div>\n ))}\n </div>\n </div>\n )}\n\n {/* Attachments */}\n {attachments && attachments.length > 0 && (\n <div>\n <label className=\"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300\">\n {t('ticketDetail.attachments', 'Attachments')}\n </label>\n <div className=\"space-y-2\">\n {attachments.map((attachment: any) => (\n <div\n key={attachment.id}\n className=\"flex items-center justify-between rounded-lg bg-gray-50 p-3 dark:bg-gray-900\"\n >\n <div className=\"flex items-center gap-3\">\n <span className=\"text-2xl\">üìé</span>\n <div>\n <p className=\"text-sm font-medium text-gray-900 dark:text-white\">\n {attachment.file_name}\n </p>\n <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n {(attachment.file_size / 1024 / 1024).toFixed(2)} MB\n </p>\n </div>\n </div>\n <button className=\"text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400\">\n {t('common.download', 'Download')}\n </button>\n </div>\n ))}\n </div>\n </div>\n )}\n\n {/* Actions */}\n {ticket.status !== 'closed' && ticket.status !== 'converted' && (\n <div className=\"flex gap-3 border-t border-gray-200 pt-4 dark:border-gray-700\">\n {ticket.status === 'triaged' && (\n <button\n onClick={() => {\n const targetType = window.prompt(t('ticketDetail.convertPrompt', 'Enter target type (dossier/engagement/position):'));\n if (targetType) {\n convertMutation.mutate({ targetType: targetType as 'dossier' | 'engagement' | 'position' });\n }\n }}\n disabled={convertMutation.isPending}\n className=\"rounded-md bg-green-600 px-4 py-2 text-white hover:bg-green-700 disabled:opacity-50\"\n >\n {t('ticketDetail.convert', 'Convert to Artifact')}\n </button>\n )}\n <button\n onClick={() => {\n const resolution = window.prompt(t('ticketDetail.closePrompt', 'Enter resolution:'));\n if (resolution) {\n closeMutation.mutate({\n resolution,\n resolutionAr: i18n.language === 'ar' ? resolution : undefined\n });\n }\n }}\n disabled={closeMutation.isPending}\n className=\"rounded-md bg-gray-600 px-4 py-2 text-white hover:bg-gray-700 disabled:opacity-50\"\n >\n {t('ticketDetail.close', 'Close Ticket')}\n </button>\n </div>\n )}\n </div>\n )}\n\n {activeTab === 'triage' && <TriagePanel ticketId={ticket.id} />}\n\n {activeTab === 'duplicates' && <DuplicateComparison ticketId={ticket.id} />}\n\n {activeTab === 'history' && (\n <div className=\"text-gray-600 dark:text-gray-400\">\n {t('ticketDetail.historyPlaceholder', 'Audit history will be displayed here')}\n </div>\n )}\n\n {activeTab === 'links' && (\n <Suspense\n fallback={\n <div className=\"flex items-center justify-center py-12\">\n <div className=\"inline-block size-12 animate-spin rounded-full border-b-2 border-gray-900 dark:border-white\"></div>\n <p className=\"ms-4 text-gray-600 dark:text-gray-400\">{t('common.loading', 'Loading...')}</p>\n </div>\n }\n >\n <EntityLinkManager\n intakeId={ticket.id}\n organizationId={ticket.organization_id}\n classificationLevel={ticket.classification_level || 0}\n canRestore={false} // TODO: Check user role for steward+ permission\n enableReorder={true}\n />\n </Suspense>\n )}\n </div>\n </div>\n );\n}","import { createFileRoute } from '@tanstack/react-router';\nimport { TicketDetail } from '../../../pages/TicketDetail';\n\nexport const Route = createFileRoute('/_protected/intake/tickets/$id')({\n component: TicketDetailPage,\n});\n\nfunction TicketDetailPage() {\n return <TicketDetail />;\n}"],"file":"assets/tickets._id-bwtpQbRp.js"}