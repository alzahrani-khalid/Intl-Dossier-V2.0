{"version":3,"file":"queue-CTKP4ix-.js","sources":["../../src/hooks/useAssignmentQueue.ts","../../src/pages/AssignmentQueue.tsx","../../src/routes/_protected/tasks/queue.tsx?tsr-split=component"],"sourcesContent":["/**\n * useAssignmentQueue Hook\n *\n * TanStack Query hook for fetching queued work items awaiting capacity.\n * Used by supervisors to view and manually assign queued items.\n *\n * @see specs/013-assignment-engine-sla/contracts/api-spec.yaml#GET /assignments/queue\n */\n\nimport { useQuery } from '@tanstack/react-query'\nimport { createClient } from '@/lib/supabase-client'\n\nconst supabase = createClient()\n\nexport interface QueueItem {\n  queue_id: string\n  work_item_id: string\n  work_item_type: 'dossier' | 'ticket' | 'position' | 'task'\n  required_skills: Array<{\n    skill_id: string\n    skill_name_en: string\n    skill_name_ar: string\n  }>\n  priority: 'urgent' | 'high' | 'normal' | 'low'\n  queued_at: string\n  position: number\n  attempts: number\n}\n\nexport interface QueueListResponse {\n  items: QueueItem[]\n  total_count: number\n  page: number\n  page_size: number\n  has_next_page: boolean\n}\n\ninterface UseAssignmentQueueOptions {\n  priority?: string\n  work_item_type?: string\n  unit_id?: string\n  page?: number\n  page_size?: number\n}\n\nexport function useAssignmentQueue(options: UseAssignmentQueueOptions = {}) {\n  return useQuery<QueueListResponse>({\n    queryKey: ['assignment-queue', options],\n    queryFn: async () => {\n      const params = new URLSearchParams()\n      if (options.priority) params.append('priority', options.priority)\n      if (options.work_item_type) params.append('work_item_type', options.work_item_type)\n      if (options.unit_id) params.append('unit_id', options.unit_id)\n      if (options.page) params.append('page', String(options.page))\n      if (options.page_size) params.append('page_size', String(options.page_size))\n\n      const { data, error } = await supabase.functions.invoke('assignments-queue', {\n        method: 'GET',\n        ...(params.toString() && { body: Object.fromEntries(params) }),\n      })\n\n      if (error) {\n        throw new Error(error.message || 'Failed to fetch assignment queue')\n      }\n\n      return data as QueueListResponse\n    },\n    enabled: true,\n    refetchInterval: 15000, // Refetch every 15s for queue updates\n  })\n}\n","import React, { useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { useAssignmentQueue } from '../hooks/useAssignmentQueue'\nimport { Alert, AlertDescription } from '../components/ui/alert'\nimport { Badge } from '../components/ui/badge'\nimport { Button } from '../components/ui/button'\nimport { Card, CardContent, CardHeader, CardTitle } from '../components/ui/card'\nimport {\n Select,\n SelectContent,\n SelectItem,\n SelectTrigger,\n SelectValue,\n} from '../components/ui/select'\nimport { AlertCircle, Clock, UserPlus } from 'lucide-react'\n\nexport function AssignmentQueuePage() {\n const { t } = useTranslation()\n const [priorityFilter, setPriorityFilter] = useState<string | undefined>()\n const [typeFilter, setTypeFilter] = useState<string | undefined>()\n\n const { data, isLoading, error } = useAssignmentQueue({\n priority: priorityFilter,\n work_item_type: typeFilter,\n })\n\n const getPriorityColor = (priority: string): string => {\n const colors = {\n urgent: 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200',\n high: 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200',\n normal: 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200',\n low: 'bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200',\n }\n return colors[priority as keyof typeof colors] || colors.normal\n }\n\n const urgentCount = data?.items.filter(i => i.priority === 'urgent').length || 0\n const highCount = data?.items.filter(i => i.priority === 'high').length || 0\n const normalLowCount = data?.items.filter(i => ['normal', 'low'].includes(i.priority)).length || 0\n\n if (error) {\n return (\n <div className=\"container mx-auto p-6\">\n <Alert variant=\"destructive\">\n <AlertCircle className=\"size-4\" />\n <AlertDescription>\n {error.message || 'Failed to load queue. Edge Functions may not be deployed yet.'}\n </AlertDescription>\n </Alert>\n </div>\n )\n }\n\n return (\n <div className=\"container mx-auto space-y-6 p-6\">\n <div>\n <h1 className=\"text-3xl font-bold\">Assignment Queue</h1>\n <p className=\"mt-1 text-muted-foreground\">\n Manage queued work items awaiting capacity\n </p>\n </div>\n\n {/* Summary Stats */}\n <div className=\"grid grid-cols-1 gap-4 md:grid-cols-4\">\n <Card>\n <CardHeader className=\"pb-3\">\n <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n Total Queued\n </CardTitle>\n </CardHeader>\n <CardContent>\n <div className=\"text-2xl font-bold\">\n {isLoading ? '...' : data?.total_count || 0}\n </div>\n </CardContent>\n </Card>\n\n <Card className=\"border-red-200 dark:border-red-800\">\n <CardHeader className=\"pb-3\">\n <CardTitle className=\"text-sm font-medium text-red-700 dark:text-red-300\">\n Urgent\n </CardTitle>\n </CardHeader>\n <CardContent>\n <div className=\"text-2xl font-bold text-red-700 dark:text-red-300\">\n {isLoading ? '...' : urgentCount}\n </div>\n </CardContent>\n </Card>\n\n <Card className=\"border-orange-200 dark:border-orange-800\">\n <CardHeader className=\"pb-3\">\n <CardTitle className=\"text-sm font-medium text-orange-700 dark:text-orange-300\">\n High\n </CardTitle>\n </CardHeader>\n <CardContent>\n <div className=\"text-2xl font-bold text-orange-700 dark:text-orange-300\">\n {isLoading ? '...' : highCount}\n </div>\n </CardContent>\n </Card>\n\n <Card>\n <CardHeader className=\"pb-3\">\n <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n Normal/Low\n </CardTitle>\n </CardHeader>\n <CardContent>\n <div className=\"text-2xl font-bold\">\n {isLoading ? '...' : normalLowCount}\n </div>\n </CardContent>\n </Card>\n </div>\n\n {/* Filters */}\n <div className=\"flex gap-4\">\n <Select value={priorityFilter} onValueChange={setPriorityFilter}>\n <SelectTrigger className=\"w-[180px]\">\n <SelectValue placeholder=\"Filter by priority\" />\n </SelectTrigger>\n <SelectContent>\n <SelectItem value=\"all\">All Priorities</SelectItem>\n <SelectItem value=\"urgent\">Urgent</SelectItem>\n <SelectItem value=\"high\">High</SelectItem>\n <SelectItem value=\"normal\">Normal</SelectItem>\n <SelectItem value=\"low\">Low</SelectItem>\n </SelectContent>\n </Select>\n\n <Select value={typeFilter} onValueChange={setTypeFilter}>\n <SelectTrigger className=\"w-[180px]\">\n <SelectValue placeholder=\"Filter by type\" />\n </SelectTrigger>\n <SelectContent>\n <SelectItem value=\"all\">All Types</SelectItem>\n <SelectItem value=\"dossier\">Dossier</SelectItem>\n <SelectItem value=\"ticket\">Ticket</SelectItem>\n <SelectItem value=\"position\">Position</SelectItem>\n <SelectItem value=\"task\">Task</SelectItem>\n </SelectContent>\n </Select>\n\n {(priorityFilter || typeFilter) && (\n <Button\n variant=\"outline\"\n onClick={() => {\n setPriorityFilter(undefined)\n setTypeFilter(undefined)\n }}\n >\n Clear Filters\n </Button>\n )}\n </div>\n\n {/* Queue Items */}\n <div className=\"space-y-4\">\n <h2 className=\"text-xl font-semibold\">Queued Items</h2>\n {isLoading ? (\n <Card>\n <CardContent className=\"p-6 text-center text-muted-foreground\">\n Loading queue...\n </CardContent>\n </Card>\n ) : data?.items && data.items.length > 0 ? (\n data.items.map((item) => (\n <Card key={item.queue_id} className=\"transition-shadow hover:shadow-md\">\n <CardContent className=\"p-6\">\n <div className=\"flex items-start justify-between\">\n <div className=\"flex-1\">\n <div className=\"mb-2 flex items-center gap-2\">\n <Badge className={getPriorityColor(item.priority)}>\n {item.priority}\n </Badge>\n <Badge variant=\"outline\">{item.work_item_type}</Badge>\n <Badge variant=\"secondary\">Position #{item.position}</Badge>\n </div>\n <p className=\"text-sm text-muted-foreground\">\n Work Item: {item.work_item_id}\n </p>\n <p className=\"mt-1 text-sm text-muted-foreground\">\n Queued: {new Date(item.queued_at).toLocaleString()}\n </p>\n {item.required_skills && item.required_skills.length > 0 && (\n <div className=\"mt-2\">\n <p className=\"mb-1 text-xs text-muted-foreground\">Required Skills:</p>\n <div className=\"flex flex-wrap gap-1\">\n {item.required_skills.map((skill) => (\n <Badge key={skill.skill_id} variant=\"outline\" className=\"text-xs\">\n {skill.skill_name_en}\n </Badge>\n ))}\n </div>\n </div>\n )}\n </div>\n <div className=\"flex flex-col gap-2 text-end\">\n <Button size=\"sm\" className=\"gap-2\">\n <UserPlus className=\"size-4\" />\n Assign\n </Button>\n {item.attempts > 0 && (\n <p className=\"text-xs text-muted-foreground\">\n {item.attempts} failed attempt{item.attempts > 1 ? 's' : ''}\n </p>\n )}\n </div>\n </div>\n </CardContent>\n </Card>\n ))\n ) : (\n <Card>\n <CardContent className=\"p-6 text-center text-muted-foreground\">\n <Clock className=\"mx-auto mb-2 size-12 text-blue-500\" />\n <p>No items in queue</p>\n </CardContent>\n </Card>\n )}\n </div>\n </div>\n )\n}\n","import { createFileRoute } from '@tanstack/react-router'\nimport { AssignmentQueuePage } from '../../../pages/AssignmentQueue'\n\nexport const Route = createFileRoute('/_protected/tasks/queue')({\n component: AssignmentQueuePage,\n})\n"],"names":["supabase","createClient","useAssignmentQueue","options","useQuery","params","data","error","AssignmentQueuePage","useTranslation","priorityFilter","setPriorityFilter","useState","typeFilter","setTypeFilter","isLoading","getPriorityColor","priority","colors","urgentCount","i","highCount","normalLowCount","jsxs","Alert","jsx","AlertCircle","AlertDescription","Card","CardHeader","CardTitle","CardContent","Select","SelectTrigger","SelectValue","SelectContent","SelectItem","Button","item","Badge","skill","UserPlus","Clock","SplitComponent"],"mappings":"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"}