{"version":3,"file":"contacts-B8fxq_Ce.js","sources":["../../src/components/contacts/ContactSearch.tsx","../../src/components/contacts/ContactCard.tsx","../../src/components/contacts/ContactList.tsx","../../src/hooks/usePersonDossiers.ts","../../src/services/export-api.ts","../../src/pages/contacts/ContactsDirectory.tsx","../../src/routes/_protected/contacts.tsx?tsr-split=component"],"sourcesContent":["/**\n * ContactSearch Component\n * Part of: 027-contact-directory implementation\n *\n * Mobile-first search and filter UI for contacts.\n * Includes full-text search, organization filter, tag multi-select, and sort options.\n */\n\nimport { useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport {\n Select,\n SelectContent,\n SelectItem,\n SelectTrigger,\n SelectValue,\n} from '@/components/ui/select';\nimport { Badge } from '@/components/ui/badge';\nimport { Search, Filter, X, SlidersHorizontal } from 'lucide-react';\nimport {\n Sheet,\n SheetContent,\n SheetDescription,\n SheetHeader,\n SheetTitle,\n SheetTrigger,\n} from '@/components/ui/sheet';\nimport type { ContactSearchParams } from '@/services/contact-api';\nimport type { Database } from '@/types/contact-directory.types';\n\ntype Organization = Database['public']['Tables']['cd_organizations']['Row'];\n\ninterface ContactSearchProps {\n onSearch: (params: ContactSearchParams) => void;\n organizations?: Organization[];\n tags?: Array<{ id: string; name: string; color?: string; category?: string }>;\n defaultParams?: ContactSearchParams;\n isLoading?: boolean;\n}\n\nexport function ContactSearch({\n onSearch,\n organizations = [],\n tags = [],\n defaultParams,\n isLoading = false,\n}: ContactSearchProps) {\n const { t, i18n } = useTranslation('contacts');\n const isRTL = i18n.language === 'ar';\n\n const [searchTerm, setSearchTerm] = useState(defaultParams?.search || '');\n const [organizationId, setOrganizationId] = useState(defaultParams?.organization_id || '');\n const [selectedTags, setSelectedTags] = useState<string[]>(defaultParams?.tags || []);\n const [sourceType, setSourceType] = useState<'manual' | 'business_card' | 'document' | ''>(\n (defaultParams?.source_type as 'manual' | 'business_card' | 'document') || ''\n );\n const [sortBy, setSortBy] = useState<'full_name' | 'created_at' | 'updated_at'>(\n defaultParams?.sort_by || 'full_name'\n );\n const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>(defaultParams?.sort_order || 'asc');\n const [includeArchived, setIncludeArchived] = useState(defaultParams?.include_archived || false);\n\n const handleSearch = () => {\n const params: ContactSearchParams = {\n search: searchTerm || undefined,\n organization_id: organizationId || undefined,\n tags: selectedTags.length > 0 ? selectedTags : undefined,\n source_type: sourceType || undefined,\n sort_by: sortBy,\n sort_order: sortOrder,\n include_archived: includeArchived,\n };\n onSearch(params);\n };\n\n const handleReset = () => {\n setSearchTerm('');\n setOrganizationId('');\n setSelectedTags([]);\n setSourceType('');\n setSortBy('full_name');\n setSortOrder('asc');\n setIncludeArchived(false);\n onSearch({});\n };\n\n const toggleTag = (tagId: string) => {\n setSelectedTags((prev) =>\n prev.includes(tagId) ? prev.filter((id) => id !== tagId) : [...prev, tagId]\n );\n };\n\n const hasActiveFilters =\n searchTerm ||\n organizationId ||\n selectedTags.length > 0 ||\n sourceType ||\n sortBy !== 'full_name' ||\n sortOrder !== 'asc' ||\n includeArchived;\n\n return (\n <div className=\"space-y-4\" dir={isRTL ? 'rtl' : 'ltr'}>\n {/* Search Input - Always Visible */}\n <div className=\"flex gap-2\">\n <div className=\"relative flex-1\">\n <Search\n className={`absolute top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground ${\n isRTL ? 'right-3' : 'left-3'\n }`}\n />\n <Input\n type=\"search\"\n placeholder={t('contactDirectory.placeholders.searchContacts')}\n value={searchTerm}\n onChange={(e) => setSearchTerm(e.target.value)}\n onKeyDown={(e) => e.key === 'Enter' && handleSearch()}\n className={`h-11 ${isRTL ? 'pr-10 pl-4' : 'pl-10 pr-4'} text-base sm:h-10`}\n dir={isRTL ? 'rtl' : 'ltr'}\n />\n </div>\n\n <Button\n onClick={handleSearch}\n disabled={isLoading}\n className=\"h-11 px-6 sm:h-10\"\n >\n {t('contactDirectory.search.search')}\n </Button>\n\n {/* Mobile Filter Sheet */}\n <Sheet>\n <SheetTrigger asChild>\n <Button\n variant=\"outline\"\n size=\"icon\"\n className=\"h-11 w-11 sm:h-10 sm:w-10 md:hidden\"\n >\n <SlidersHorizontal className=\"h-4 w-4\" />\n </Button>\n </SheetTrigger>\n <SheetContent side={isRTL ? 'left' : 'right'} className=\"w-full sm:max-w-md\">\n <SheetHeader>\n <SheetTitle>{t('contactDirectory.search.filters')}</SheetTitle>\n <SheetDescription>{t('contactDirectory.search.refine_search')}</SheetDescription>\n </SheetHeader>\n <div className=\"mt-6 space-y-4\">\n <FilterContent\n organizations={organizations}\n tags={tags}\n organizationId={organizationId}\n setOrganizationId={setOrganizationId}\n selectedTags={selectedTags}\n toggleTag={toggleTag}\n sourceType={sourceType}\n setSourceType={setSourceType}\n sortBy={sortBy}\n setSortBy={setSortBy}\n sortOrder={sortOrder}\n setSortOrder={setSortOrder}\n includeArchived={includeArchived}\n setIncludeArchived={setIncludeArchived}\n isRTL={isRTL}\n t={t}\n />\n <div className=\"flex gap-2 pt-4\">\n <Button onClick={handleSearch} className=\"flex-1\">\n {t('contactDirectory.search.apply_filters')}\n </Button>\n <Button onClick={handleReset} variant=\"outline\" className=\"flex-1\">\n {t('contactDirectory.search.reset')}\n </Button>\n </div>\n </div>\n </SheetContent>\n </Sheet>\n </div>\n\n {/* Desktop Filters - Hidden on Mobile */}\n <div className=\"hidden md:block space-y-4\">\n <FilterContent\n organizations={organizations}\n tags={tags}\n organizationId={organizationId}\n setOrganizationId={setOrganizationId}\n selectedTags={selectedTags}\n toggleTag={toggleTag}\n sourceType={sourceType}\n setSourceType={setSourceType}\n sortBy={sortBy}\n setSortBy={setSortBy}\n sortOrder={sortOrder}\n setSortOrder={setSortOrder}\n includeArchived={includeArchived}\n setIncludeArchived={setIncludeArchived}\n isRTL={isRTL}\n t={t}\n />\n </div>\n\n {/* Active Filters Summary */}\n {hasActiveFilters && (\n <div className=\"flex flex-wrap items-center gap-2 text-sm\">\n <Filter className=\"h-4 w-4 text-muted-foreground\" />\n {selectedTags.map((tagId) => {\n const tag = tags.find((t) => t.id === tagId);\n return tag ? (\n <Badge key={tagId} variant=\"secondary\" className=\"gap-1\">\n {tag.name}\n <X\n className=\"h-3 w-3 cursor-pointer\"\n onClick={() => toggleTag(tagId)}\n />\n </Badge>\n ) : null;\n })}\n {organizationId && (\n <Badge variant=\"secondary\" className=\"gap-1\">\n {organizations.find((o) => o.id === organizationId)?.name}\n <X\n className=\"h-3 w-3 cursor-pointer\"\n onClick={() => setOrganizationId('')}\n />\n </Badge>\n )}\n {sourceType && (\n <Badge variant=\"secondary\" className=\"gap-1\">\n {t(`contactDirectory.sourceTypes.${sourceType}`)}\n <X\n className=\"h-3 w-3 cursor-pointer\"\n onClick={() => setSourceType('')}\n />\n </Badge>\n )}\n <Button\n variant=\"ghost\"\n size=\"sm\"\n onClick={handleReset}\n className=\"h-7 text-xs\"\n >\n {t('contactDirectory.search.clear_all')}\n </Button>\n </div>\n )}\n </div>\n );\n}\n\n// Filter content component (shared between desktop and mobile)\nfunction FilterContent({\n organizations,\n tags,\n organizationId,\n setOrganizationId,\n selectedTags,\n toggleTag,\n sourceType,\n setSourceType,\n sortBy,\n setSortBy,\n sortOrder,\n setSortOrder,\n includeArchived,\n setIncludeArchived,\n isRTL,\n t,\n}: any) {\n return (\n <>\n {/* Organization Filter */}\n {organizations.length > 0 && (\n <div className=\"space-y-2\">\n <label className=\"text-sm font-medium\">{t('contactDirectory.search.filter_by_organization')}</label>\n <Select value={organizationId || 'all'} onValueChange={(value) => setOrganizationId(value === 'all' ? '' : value)}>\n <SelectTrigger className=\"h-10\">\n <SelectValue placeholder={t('contactDirectory.search.all_organizations')} />\n </SelectTrigger>\n <SelectContent>\n <SelectItem value=\"all\">{t('contactDirectory.search.all_organizations')}</SelectItem>\n {organizations.map((org: any) => (\n <SelectItem key={org.id} value={org.id}>\n {org.name}\n </SelectItem>\n ))}\n </SelectContent>\n </Select>\n </div>\n )}\n\n {/* Tag Filter */}\n {tags.length > 0 && (\n <div className=\"space-y-2\">\n <label className=\"text-sm font-medium\">{t('contactDirectory.search.filter_by_tags')}</label>\n <div className=\"flex flex-wrap gap-2\">\n {tags.map((tag: any) => {\n const isSelected = selectedTags.includes(tag.id);\n return (\n <Badge\n key={tag.id}\n variant={isSelected ? 'default' : 'outline'}\n className=\"cursor-pointer px-3 py-1.5 text-sm\"\n onClick={() => toggleTag(tag.id)}\n style={\n isSelected && tag.color\n ? { backgroundColor: tag.color, borderColor: tag.color }\n : undefined\n }\n >\n {tag.name}\n </Badge>\n );\n })}\n </div>\n </div>\n )}\n\n {/* Source Type Filter */}\n <div className=\"space-y-2\">\n <label className=\"text-sm font-medium\">{t('contactDirectory.search.filter_by_source')}</label>\n <Select value={sourceType || 'all'} onValueChange={(value) => setSourceType(value === 'all' ? '' : value as any)}>\n <SelectTrigger className=\"h-10\">\n <SelectValue placeholder={t('contactDirectory.search.all_sources')} />\n </SelectTrigger>\n <SelectContent>\n <SelectItem value=\"all\">{t('contactDirectory.search.all_sources')}</SelectItem>\n <SelectItem value=\"manual\">{t('contactDirectory.sourceTypes.manual')}</SelectItem>\n <SelectItem value=\"business_card\">{t('contactDirectory.sourceTypes.businessCard')}</SelectItem>\n <SelectItem value=\"document\">{t('contactDirectory.sourceTypes.document')}</SelectItem>\n </SelectContent>\n </Select>\n </div>\n\n {/* Sort Options */}\n <div className=\"grid grid-cols-2 gap-3\">\n <div className=\"space-y-2\">\n <label className=\"text-sm font-medium\">{t('contactDirectory.search.sort_by')}</label>\n <Select value={sortBy} onValueChange={setSortBy}>\n <SelectTrigger className=\"h-10\">\n <SelectValue />\n </SelectTrigger>\n <SelectContent>\n <SelectItem value=\"full_name\">{t('contactDirectory.search.sort_name')}</SelectItem>\n <SelectItem value=\"created_at\">{t('contactDirectory.search.sort_created')}</SelectItem>\n <SelectItem value=\"updated_at\">{t('contactDirectory.search.sort_updated')}</SelectItem>\n </SelectContent>\n </Select>\n </div>\n\n <div className=\"space-y-2\">\n <label className=\"text-sm font-medium\">{t('contactDirectory.search.order')}</label>\n <Select value={sortOrder} onValueChange={setSortOrder}>\n <SelectTrigger className=\"h-10\">\n <SelectValue />\n </SelectTrigger>\n <SelectContent>\n <SelectItem value=\"asc\">{t('contactDirectory.search.ascending')}</SelectItem>\n <SelectItem value=\"desc\">{t('contactDirectory.search.descending')}</SelectItem>\n </SelectContent>\n </Select>\n </div>\n </div>\n\n {/* Include Archived Toggle */}\n <div className=\"flex items-center gap-2\">\n <input\n type=\"checkbox\"\n id=\"include-archived\"\n checked={includeArchived}\n onChange={(e) => setIncludeArchived(e.target.checked)}\n className=\"h-4 w-4 rounded border-gray-300\"\n />\n <label htmlFor=\"include-archived\" className=\"text-sm\">\n {t('contactDirectory.search.include_archived')}\n </label>\n </div>\n </>\n );\n}\n","/**\n * ContactCard Component\n * Part of: 027-contact-directory implementation\n *\n * Mobile-first, RTL-ready contact summary card.\n * Displays contact information with organization badge, position, and tags.\n */\n\nimport { useTranslation } from 'react-i18next';\nimport { Card, CardContent, CardHeader } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Mail, Phone, Building2, Briefcase, Tag, Network } from 'lucide-react';\nimport { useRelationshipStats } from '@/hooks/useContactRelationships';\nimport type { Database } from '@/types/contact-directory.types';\n\ntype Contact = Database['public']['Tables']['cd_contacts']['Row'];\ntype Organization = Database['public']['Tables']['cd_organizations']['Row'];\n\ninterface ContactCardProps {\n contact: Contact & {\n organization?: Organization | null;\n };\n tags?: Array<{ id: string; name: string; color?: string }>;\n onClick?: () => void;\n className?: string;\n}\n\nexport function ContactCard({ contact, tags = [], onClick, className = '' }: ContactCardProps) {\n const { t, i18n } = useTranslation('contacts');\n const isRTL = i18n.language === 'ar';\n\n // Get relationship stats\n const { data: relationshipStats } = useRelationshipStats(contact.id);\n\n // Get primary email and phone\n const primaryEmail = contact.email_addresses?.[0];\n const primaryPhone = contact.phone_numbers?.[0];\n\n // Get contact tags\n const contactTags = tags.filter((tag) => contact.tags?.includes(tag.id));\n\n return (\n <Card\n className={`cursor-pointer transition-shadow hover:shadow-md ${className}`}\n onClick={onClick}\n dir={isRTL ? 'rtl' : 'ltr'}\n >\n <CardHeader className=\"pb-3\">\n <div className=\"flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between\">\n <div className=\"flex-1 min-w-0\">\n <h3 className=\"text-lg font-semibold truncate text-start\">{contact.full_name}</h3>\n {contact.position && (\n <div className=\"flex items-center gap-2 mt-1 text-sm text-muted-foreground\">\n <Briefcase className=\"h-3.5 w-3.5 flex-shrink-0\" />\n <span className=\"truncate text-start\">{contact.position}</span>\n </div>\n )}\n </div>\n\n <div className=\"flex items-center gap-2\">\n {contact.organization && (\n <Badge variant=\"secondary\" className=\"flex items-center gap-1.5 px-3 py-1 text-xs whitespace-nowrap\">\n <Building2 className=\"h-3 w-3\" />\n <span className=\"truncate max-w-[120px] sm:max-w-none\">{contact.organization.name}</span>\n </Badge>\n )}\n {relationshipStats && relationshipStats.total > 0 && (\n <Badge variant=\"outline\" className=\"flex items-center gap-1.5 px-2 py-1 text-xs\">\n <Network className=\"h-3 w-3\" />\n <span>{relationshipStats.total}</span>\n </Badge>\n )}\n </div>\n </div>\n </CardHeader>\n\n <CardContent className=\"space-y-3\">\n {/* Contact Information */}\n <div className=\"space-y-2\">\n {primaryEmail && (\n <div className=\"flex items-center gap-2 text-sm\">\n <Mail className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" />\n <span className=\"truncate text-start\">{primaryEmail}</span>\n </div>\n )}\n\n {primaryPhone && (\n <div className=\"flex items-center gap-2 text-sm\">\n <Phone className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" />\n <span className={`${isRTL ? 'text-end' : 'text-start'}`} dir=\"ltr\">\n {primaryPhone}\n </span>\n </div>\n )}\n </div>\n\n {/* Tags */}\n {contactTags.length > 0 && (\n <div className=\"flex items-start gap-2 pt-2 border-t\">\n <Tag className=\"h-3.5 w-3.5 text-muted-foreground flex-shrink-0 mt-0.5\" />\n <div className=\"flex flex-wrap gap-1.5 flex-1\">\n {contactTags.map((tag) => (\n <Badge\n key={tag.id}\n variant=\"outline\"\n className=\"text-xs px-2 py-0.5\"\n style={tag.color ? { borderColor: tag.color, color: tag.color } : undefined}\n >\n {tag.name}\n </Badge>\n ))}\n </div>\n </div>\n )}\n\n {/* Additional email/phone count indicators */}\n {((contact.email_addresses?.length || 0) > 1 || (contact.phone_numbers?.length || 0) > 1) && (\n <div className=\"flex gap-3 text-xs text-muted-foreground pt-2\">\n {(contact.email_addresses?.length || 0) > 1 && (\n <span>\n +{contact.email_addresses!.length - 1} email{contact.email_addresses!.length - 1 > 1 ? 's' : ''}\n </span>\n )}\n {(contact.phone_numbers?.length || 0) > 1 && (\n <span>\n +{contact.phone_numbers!.length - 1} phone{contact.phone_numbers!.length - 1 > 1 ? 's' : ''}\n </span>\n )}\n </div>\n )}\n </CardContent>\n </Card>\n );\n}\n","/**\n * ContactList Component\n * Part of: 027-contact-directory implementation\n *\n * Virtualized contact list for performance with 10,000+ contacts.\n * Mobile-first, RTL-ready with grid layout.\n */\n\nimport { useRef, useMemo } from 'react';\nimport { useVirtualizer } from '@tanstack/react-virtual';\nimport { useTranslation } from 'react-i18next';\nimport { ContactCard } from './ContactCard';\nimport { Loader2, Users, Building2, ChevronDown } from 'lucide-react';\nimport { Badge } from '@/components/ui/badge';\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from '@/components/ui/collapsible';\nimport { Button } from '@/components/ui/button';\nimport type { ContactResponse } from '@/services/contact-api';\n\ninterface ContactListProps {\n contacts: ContactResponse[];\n tags?: Array<{ id: string; name: string; color?: string }>;\n onContactClick?: (contact: ContactResponse) => void;\n isLoading?: boolean;\n isEmpty?: boolean;\n emptyMessage?: string;\n className?: string;\n}\n\nexport function ContactList({\n contacts,\n tags = [],\n onContactClick,\n isLoading = false,\n isEmpty = false,\n emptyMessage,\n className = '',\n}: ContactListProps) {\n const { t, i18n } = useTranslation('contacts');\n const isRTL = i18n.language === 'ar';\n const parentRef = useRef<HTMLDivElement>(null);\n\n // Virtual scrolling for large lists\n const rowVirtualizer = useVirtualizer({\n count: contacts.length,\n getScrollElement: () => parentRef.current,\n estimateSize: () => 180, // Estimated card height in pixels\n overscan: 5, // Number of items to render outside viewport\n });\n\n // Loading state\n if (isLoading) {\n return (\n <div className=\"flex flex-col items-center justify-center py-12 gap-4\">\n <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n <p className=\"text-sm text-muted-foreground\">{t('contactDirectory.list.loading_contacts')}</p>\n </div>\n );\n }\n\n // Empty state\n if (isEmpty || contacts.length === 0) {\n return (\n <div className=\"flex flex-col items-center justify-center py-12 gap-4\">\n <div className=\"rounded-full bg-muted p-4\">\n <Users className=\"h-8 w-8 text-muted-foreground\" />\n </div>\n <div className=\"text-center space-y-1\">\n <p className=\"font-medium\">{emptyMessage || t('contactDirectory.list.no_contacts_found')}</p>\n <p className=\"text-sm text-muted-foreground\">{t('contactDirectory.list.try_different_filters')}</p>\n </div>\n </div>\n );\n }\n\n return (\n <div\n ref={parentRef}\n className={`overflow-auto ${className}`}\n style={{ height: '100%' }}\n dir={isRTL ? 'rtl' : 'ltr'}\n >\n <div\n style={{\n height: `${rowVirtualizer.getTotalSize()}px`,\n width: '100%',\n position: 'relative',\n }}\n >\n {rowVirtualizer.getVirtualItems().map((virtualRow) => {\n const contact = contacts[virtualRow.index];\n return (\n <div\n key={virtualRow.key}\n style={{\n position: 'absolute',\n top: 0,\n [isRTL ? 'right' : 'left']: 0,\n width: '100%',\n height: `${virtualRow.size}px`,\n transform: `translateY(${virtualRow.start}px)`,\n }}\n className=\"px-4 sm:px-6 lg:px-8 pb-4\"\n >\n <ContactCard\n contact={contact}\n tags={tags}\n onClick={() => onContactClick?.(contact)}\n />\n </div>\n );\n })}\n </div>\n </div>\n );\n}\n\n/**\n * Grid variant of ContactList (non-virtualized, better for smaller lists)\n */\nexport function ContactListGrid({\n contacts,\n tags = [],\n onContactClick,\n isLoading = false,\n isEmpty = false,\n emptyMessage,\n className = '',\n}: ContactListProps) {\n const { t, i18n } = useTranslation('contacts');\n const isRTL = i18n.language === 'ar';\n\n // Loading state\n if (isLoading) {\n return (\n <div className=\"flex flex-col items-center justify-center py-12 gap-4\">\n <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n <p className=\"text-sm text-muted-foreground\">{t('contactDirectory.list.loading_contacts')}</p>\n </div>\n );\n }\n\n // Empty state\n if (isEmpty || contacts.length === 0) {\n return (\n <div className=\"flex flex-col items-center justify-center py-12 gap-4\">\n <div className=\"rounded-full bg-muted p-4\">\n <Users className=\"h-8 w-8 text-muted-foreground\" />\n </div>\n <div className=\"text-center space-y-1\">\n <p className=\"font-medium\">{emptyMessage || t('contactDirectory.list.no_contacts_found')}</p>\n <p className=\"text-sm text-muted-foreground\">{t('contactDirectory.list.try_different_filters')}</p>\n </div>\n </div>\n );\n }\n\n return (\n <div\n className={`grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 ${className}`}\n dir={isRTL ? 'rtl' : 'ltr'}\n >\n {contacts.map((contact) => (\n <ContactCard\n key={contact.id}\n contact={contact}\n tags={tags}\n onClick={() => onContactClick?.(contact)}\n />\n ))}\n </div>\n );\n}\n\n/**\n * Grouped variant of ContactList - Groups contacts by organization\n */\nexport function ContactListGrouped({\n contacts,\n tags = [],\n onContactClick,\n isLoading = false,\n isEmpty = false,\n emptyMessage,\n className = '',\n}: ContactListProps) {\n const { t, i18n } = useTranslation('contacts');\n const isRTL = i18n.language === 'ar';\n\n // Group contacts by organization\n const groupedContacts = useMemo(() => {\n const groups = new Map<string, ContactResponse[]>();\n\n contacts.forEach((contact) => {\n const orgId = contact.organization?.id || 'no-organization';\n const orgName = contact.organization?.name || t('contactDirectory.organizations.no_organization');\n\n if (!groups.has(orgId)) {\n groups.set(orgId, []);\n }\n groups.get(orgId)!.push(contact);\n });\n\n // Convert to array and sort by organization name\n return Array.from(groups.entries())\n .map(([orgId, orgContacts]) => ({\n id: orgId,\n name: orgContacts[0]?.organization?.name || t('contactDirectory.organizations.no_organization'),\n contacts: orgContacts,\n }))\n .sort((a, b) => {\n // \"No Organization\" always at the end\n if (a.id === 'no-organization') return 1;\n if (b.id === 'no-organization') return -1;\n return a.name.localeCompare(b.name);\n });\n }, [contacts, t]);\n\n // Loading state\n if (isLoading) {\n return (\n <div className=\"flex flex-col items-center justify-center py-12 gap-4\">\n <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n <p className=\"text-sm text-muted-foreground\">{t('contactDirectory.list.loading_contacts')}</p>\n </div>\n );\n }\n\n // Empty state\n if (isEmpty || contacts.length === 0) {\n return (\n <div className=\"flex flex-col items-center justify-center py-12 gap-4\">\n <div className=\"rounded-full bg-muted p-4\">\n <Users className=\"h-8 w-8 text-muted-foreground\" />\n </div>\n <div className=\"text-center space-y-1\">\n <p className=\"font-medium\">{emptyMessage || t('contactDirectory.list.no_contacts_found')}</p>\n <p className=\"text-sm text-muted-foreground\">{t('contactDirectory.list.try_different_filters')}</p>\n </div>\n </div>\n );\n }\n\n return (\n <div className={`space-y-6 ${className}`} dir={isRTL ? 'rtl' : 'ltr'}>\n {groupedContacts.map((group) => (\n <Collapsible key={group.id} defaultOpen className=\"space-y-4\">\n <div className=\"flex items-center justify-between\">\n <div className=\"flex items-center gap-3\">\n <div className=\"flex items-center gap-2\">\n <Building2 className=\"h-5 w-5 text-muted-foreground\" />\n <h3 className=\"text-lg font-semibold\">{group.name}</h3>\n </div>\n <Badge variant=\"secondary\" className=\"text-xs\">\n {t('contactDirectory.organizations.contact_count', { count: group.contacts.length })}\n </Badge>\n </div>\n <CollapsibleTrigger asChild>\n <Button variant=\"ghost\" size=\"sm\" className=\"h-9 w-9 p-0\">\n <ChevronDown className=\"h-4 w-4 transition-transform duration-200\" />\n <span className=\"sr-only\">Toggle</span>\n </Button>\n </CollapsibleTrigger>\n </div>\n\n <CollapsibleContent className=\"space-y-4\">\n <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\n {group.contacts.map((contact) => (\n <ContactCard\n key={contact.id}\n contact={contact}\n tags={tags}\n onClick={() => onContactClick?.(contact)}\n />\n ))}\n </div>\n </CollapsibleContent>\n </Collapsible>\n ))}\n </div>\n );\n}\n","/**\n * Person Dossier Hooks\n * Part of: Enhanced Unified Dossier Architecture\n *\n * Specialized hooks for person dossiers (type='person') with contact-specific features.\n * Uses the unified dossiers table with metadata JSONB for person-specific fields.\n */\n\nimport { useMutation, useQuery, useQueryClient, type UseQueryOptions } from '@tanstack/react-query';\nimport { useTranslation } from 'react-i18next';\nimport { toast } from 'sonner';\nimport {\n  createDossier,\n  getDossier,\n  updateDossier,\n  getDossiersByType,\n  type CreateDossierRequest,\n  type UpdateDossierRequest,\n  type DossierWithExtension,\n  type DossiersListResponse,\n  DossierAPIError,\n} from '@/services/dossier-api';\nimport { dossierKeys } from './useDossier';\n\n/**\n * Person-specific metadata structure\n * Stored in dossiers.metadata JSONB column\n */\nexport interface PersonMetadata {\n  title_en?: string;\n  title_ar?: string;\n  organization_id?: string;\n  organization_name_en?: string;\n  organization_name_ar?: string;\n  email?: string[];\n  phone?: string[];\n  notes?: string;\n  source_type?: 'manual' | 'business_card' | 'document';\n  [key: string]: unknown;\n}\n\n/**\n * Person dossier type helper\n */\nexport interface PersonDossier extends DossierWithExtension {\n  type: 'person';\n  metadata: PersonMetadata;\n}\n\n/**\n * Person search parameters\n */\nexport interface PersonSearchParams {\n  search?: string;\n  organization_id?: string;\n  tags?: string[];\n  source_type?: 'manual' | 'business_card' | 'document';\n  limit?: number;\n  offset?: number;\n}\n\n/**\n * Hook to fetch a single person dossier by ID\n */\nexport function usePersonDossier(\n  id: string,\n  options?: Omit<UseQueryOptions<PersonDossier, DossierAPIError>, 'queryKey' | 'queryFn'>\n) {\n  return useQuery({\n    queryKey: dossierKeys.detail(id),\n    queryFn: async () => {\n      const dossier = await getDossier(id);\n      if (dossier.type !== 'person') {\n        throw new Error('Dossier is not a person');\n      }\n      return dossier as PersonDossier;\n    },\n    enabled: !!id,\n    ...options,\n  });\n}\n\n/**\n * Hook to search person dossiers\n * Uses the unified dossiers table filtered by type='person'\n */\nexport function useSearchPersonDossiers(\n  params?: PersonSearchParams,\n  options?: Omit<UseQueryOptions<DossiersListResponse, DossierAPIError>, 'queryKey' | 'queryFn'>\n) {\n  return useQuery({\n    queryKey: [...dossierKeys.byType('person'), { params }],\n    queryFn: () => getDossiersByType('person', 1, params?.limit || 50),\n    ...options,\n  });\n}\n\n/**\n * Hook to create a new person dossier\n */\nexport function useCreatePersonDossier() {\n  const queryClient = useQueryClient();\n  const { t } = useTranslation('contacts');\n\n  return useMutation({\n    mutationFn: async (data: {\n      name_en: string;\n      name_ar: string;\n      description_en?: string;\n      description_ar?: string;\n      metadata: PersonMetadata;\n      tags?: string[];\n    }) => {\n      const request: CreateDossierRequest = {\n        type: 'person',\n        name_en: data.name_en,\n        name_ar: data.name_ar,\n        description_en: data.description_en,\n        description_ar: data.description_ar,\n        status: 'active',\n        sensitivity_level: 0,\n        tags: data.tags || [],\n        metadata: data.metadata as Record<string, unknown>,\n      };\n      return createDossier(request);\n    },\n    onSuccess: (data) => {\n      // Invalidate all person dossier lists\n      queryClient.invalidateQueries({ queryKey: dossierKeys.byType('person') });\n      queryClient.invalidateQueries({ queryKey: dossierKeys.lists() });\n\n      // Set newly created person in cache\n      queryClient.setQueryData(dossierKeys.detail(data.id), data);\n\n      toast.success(t('hooks.contact_created_success', { name: data.name_en }));\n    },\n    onError: (error: DossierAPIError) => {\n      toast.error(t('hooks.contact_created_error', { error: error.message }));\n    },\n  });\n}\n\n/**\n * Hook to update a person dossier\n */\nexport function useUpdatePersonDossier() {\n  const queryClient = useQueryClient();\n  const { t } = useTranslation('contacts');\n\n  return useMutation({\n    mutationFn: async ({\n      id,\n      updates,\n    }: {\n      id: string;\n      updates: {\n        name_en?: string;\n        name_ar?: string;\n        description_en?: string;\n        description_ar?: string;\n        metadata?: Partial<PersonMetadata>;\n        tags?: string[];\n        status?: 'active' | 'inactive' | 'archived';\n      };\n    }) => {\n      const request: UpdateDossierRequest = {\n        ...updates,\n        metadata: updates.metadata as Record<string, unknown> | undefined,\n      };\n      return updateDossier(id, request);\n    },\n    onMutate: async ({ id, updates }) => {\n      // Cancel outgoing refetches\n      await queryClient.cancelQueries({ queryKey: dossierKeys.detail(id) });\n\n      // Snapshot previous value\n      const previousDossier = queryClient.getQueryData<PersonDossier>(dossierKeys.detail(id));\n\n      // Optimistic update\n      if (previousDossier) {\n        queryClient.setQueryData<PersonDossier>(dossierKeys.detail(id), {\n          ...previousDossier,\n          ...updates,\n          metadata: {\n            ...previousDossier.metadata,\n            ...updates.metadata,\n          },\n          updated_at: new Date().toISOString(),\n        });\n      }\n\n      return { previousDossier };\n    },\n    onSuccess: (data, variables) => {\n      // Replace optimistic update with actual data\n      queryClient.setQueryData(dossierKeys.detail(variables.id), data);\n\n      // Invalidate lists\n      queryClient.invalidateQueries({ queryKey: dossierKeys.byType('person') });\n      queryClient.invalidateQueries({ queryKey: dossierKeys.lists() });\n\n      toast.success(t('hooks.contact_updated_success', { name: data.name_en }));\n    },\n    onError: (error: DossierAPIError, variables, context) => {\n      // Rollback on error\n      if (context?.previousDossier) {\n        queryClient.setQueryData(dossierKeys.detail(variables.id), context.previousDossier);\n      }\n      toast.error(t('hooks.contact_updated_error', { error: error.message }));\n    },\n  });\n}\n\n/**\n * Hook to archive a person dossier (soft delete)\n */\nexport function useArchivePersonDossier() {\n  const queryClient = useQueryClient();\n  const { t } = useTranslation('contacts');\n\n  return useMutation({\n    mutationFn: async (id: string) => {\n      return updateDossier(id, { status: 'archived' });\n    },\n    onSuccess: (_, id) => {\n      // Remove from detail cache\n      queryClient.removeQueries({ queryKey: dossierKeys.detail(id) });\n\n      // Invalidate lists\n      queryClient.invalidateQueries({ queryKey: dossierKeys.byType('person') });\n      queryClient.invalidateQueries({ queryKey: dossierKeys.lists() });\n\n      toast.success(t('hooks.contact_archived_success'));\n    },\n    onError: (error: DossierAPIError) => {\n      toast.error(t('hooks.contact_archived_error', { error: error.message }));\n    },\n  });\n}\n\n/**\n * Hook to invalidate all person dossier queries\n */\nexport function useInvalidatePersonDossiers() {\n  const queryClient = useQueryClient();\n\n  return () => {\n    queryClient.invalidateQueries({ queryKey: dossierKeys.byType('person') });\n    queryClient.invalidateQueries({ queryKey: dossierKeys.lists() });\n  };\n}\n","/**\n * Export API Client\n *\n * Handles contact export functionality in CSV and vCard formats.\n * Supports filtering by contact IDs, organization, and tags.\n */\n\nimport { supabase } from '@/lib/supabase';\n\nexport type ExportFormat = 'csv' | 'vcard';\n\nexport interface ExportFilters {\n  contact_ids?: string[];\n  organization_id?: string;\n  tags?: string[];\n  limit?: number;\n}\n\nexport class ExportApiError extends Error {\n  constructor(public status: number, message: string) {\n    super(message);\n    this.name = 'ExportApiError';\n  }\n}\n\n/**\n * Export contacts in the specified format\n *\n * @param format - Export format: 'csv' or 'vcard'\n * @param filters - Optional filters to apply\n * @returns Blob containing the exported data\n */\nexport async function exportContacts(\n  format: ExportFormat,\n  filters?: ExportFilters\n): Promise<Blob> {\n  try {\n    // Get current session token\n    const { data: { session } } = await supabase.auth.getSession();\n\n    if (!session) {\n      throw new ExportApiError(401, 'Authentication required');\n    }\n\n    // Prepare request body\n    const requestBody = {\n      format,\n      ...filters,\n      limit: filters?.limit || 1000\n    };\n\n    // Call the Edge Function\n    const { data, error } = await supabase.functions.invoke('contacts-export', {\n      body: requestBody,\n      headers: {\n        'Content-Type': 'application/json',\n      }\n    });\n\n    if (error) {\n      throw new ExportApiError(500, error.message || 'Export failed');\n    }\n\n    // The Edge Function returns the file content directly\n    // Convert to Blob for download\n    const contentType = format === 'csv'\n      ? 'text/csv;charset=utf-8'\n      : 'text/vcard;charset=utf-8';\n\n    return new Blob([data], { type: contentType });\n\n  } catch (error) {\n    if (error instanceof ExportApiError) {\n      throw error;\n    }\n\n    console.error('Export error:', error);\n    throw new ExportApiError(\n      500,\n      error instanceof Error ? error.message : 'Export failed'\n    );\n  }\n}\n\n/**\n * Download exported contacts as a file\n *\n * @param format - Export format: 'csv' or 'vcard'\n * @param filters - Optional filters to apply\n * @param filename - Optional custom filename\n */\nexport async function downloadContacts(\n  format: ExportFormat,\n  filters?: ExportFilters,\n  filename?: string\n): Promise<void> {\n  try {\n    // Get the exported data\n    const blob = await exportContacts(format, filters);\n\n    // Generate filename if not provided\n    const defaultFilename = `contacts_${new Date().toISOString().split('T')[0]}.${\n      format === 'csv' ? 'csv' : 'vcf'\n    }`;\n    const finalFilename = filename || defaultFilename;\n\n    // Create download link and trigger download\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = finalFilename;\n\n    // Append to body, click, and remove\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n\n    // Clean up the URL\n    URL.revokeObjectURL(url);\n\n  } catch (error) {\n    console.error('Download error:', error);\n    throw error;\n  }\n}\n\n/**\n * Export selected contacts\n *\n * @param contactIds - Array of contact IDs to export\n * @param format - Export format: 'csv' or 'vcard'\n */\nexport async function exportSelectedContacts(\n  contactIds: string[],\n  format: ExportFormat\n): Promise<void> {\n  if (contactIds.length === 0) {\n    throw new ExportApiError(400, 'No contacts selected');\n  }\n\n  return downloadContacts(format, { contact_ids: contactIds });\n}\n\n/**\n * Export all contacts (with optional filters)\n *\n * @param format - Export format: 'csv' or 'vcard'\n * @param organizationId - Optional organization filter\n * @param tags - Optional tags filter\n */\nexport async function exportAllContacts(\n  format: ExportFormat,\n  organizationId?: string,\n  tags?: string[]\n): Promise<void> {\n  const filters: ExportFilters = {};\n\n  if (organizationId) {\n    filters.organization_id = organizationId;\n  }\n\n  if (tags?.length) {\n    filters.tags = tags;\n  }\n\n  return downloadContacts(format, filters);\n}\n\n/**\n * Get export size estimate\n *\n * @param filters - Optional filters to apply\n * @returns Estimated number of contacts to export\n */\nexport async function getExportSizeEstimate(\n  filters?: ExportFilters\n): Promise<number> {\n  try {\n    let query = supabase\n      .from('cd_contacts')\n      .select('id', { count: 'exact', head: true })\n      .eq('is_archived', false);\n\n    // Apply filters\n    if (filters?.contact_ids?.length) {\n      query = query.in('id', filters.contact_ids);\n    }\n\n    if (filters?.organization_id) {\n      query = query.eq('organization_id', filters.organization_id);\n    }\n\n    if (filters?.tags?.length) {\n      query = query.contains('tags', filters.tags);\n    }\n\n    const { count, error } = await query;\n\n    if (error) {\n      throw new ExportApiError(500, error.message);\n    }\n\n    return count || 0;\n\n  } catch (error) {\n    console.error('Count error:', error);\n    return 0;\n  }\n}","/**\n * ContactsDirectory Page\n * Part of: 027-contact-directory implementation\n *\n * Main contact directory page with search, filters, and list.\n * Mobile-first, RTL-ready with virtualized list for 10k+ contacts.\n */\n\nimport { useState, useMemo } from 'react';\nimport { useNavigate } from '@tanstack/react-router';\nimport { useTranslation } from 'react-i18next';\nimport { Button } from '@/components/ui/button';\nimport {\n DropdownMenu,\n DropdownMenuContent,\n DropdownMenuItem,\n DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { ContactSearch } from '@/components/contacts/ContactSearch';\nimport { ContactList } from '@/components/contacts/ContactList';\nimport { Plus, Download, FileText, CreditCard, Check } from 'lucide-react';\nimport { useSearchPersonDossiers, type PersonSearchParams } from '@/hooks/usePersonDossiers';\nimport { exportAllContacts, exportSelectedContacts } from '@/services/export-api';\nimport { useToast } from '@/hooks/use-toast';\n\nexport function ContactsDirectory() {\n const { t, i18n } = useTranslation('contacts');\n const isRTL = i18n.language === 'ar';\n const navigate = useNavigate();\n const { toast } = useToast();\n\n const [searchParams, setSearchParams] = useState<PersonSearchParams>({});\n const [selectedContacts, setSelectedContacts] = useState<string[]>([]);\n const [isExporting, setIsExporting] = useState(false);\n\n // Fetch person dossiers with search/filter params\n const { data: dossierResults, isLoading } = useSearchPersonDossiers(searchParams);\n\n // Transform person dossiers to contact format for display\n const searchResults = useMemo(() => {\n if (!dossierResults?.data) return null;\n\n return {\n contacts: dossierResults.data.map(dossier => ({\n id: dossier.id,\n full_name: dossier.name_en,\n organization_id: dossier.metadata?.organization_id,\n organization_name: dossier.metadata?.organization_name_en,\n position: dossier.metadata?.title_en,\n email_addresses: dossier.metadata?.email || [],\n phone_numbers: dossier.metadata?.phone || [],\n tags: dossier.tags,\n source_type: dossier.metadata?.source_type || 'manual',\n created_at: dossier.created_at,\n updated_at: dossier.updated_at,\n })),\n total: dossierResults.total || 0,\n organizations: [], // TODO: Extract from dossiers\n tags: [], // TODO: Extract unique tags\n };\n }, [dossierResults]);\n\n const handleCreateContact = () => {\n navigate({ to: '/contacts/create' });\n };\n\n const handleContactClick = (contactId: string) => {\n navigate({ to: `/contacts/$contactId`, params: { contactId } });\n };\n\n const handleExportAll = async (format: 'csv' | 'vcard') => {\n try {\n setIsExporting(true);\n\n // Apply current filters to export\n await exportAllContacts(\n format,\n searchParams.organization_id,\n searchParams.tags\n );\n\n toast({\n title: t('contactDirectory.export.success'),\n description: t('contactDirectory.export.successDescription', {\n count: searchResults?.total || 0,\n format: format.toUpperCase()\n }),\n });\n } catch (error) {\n console.error('Export error:', error);\n toast({\n title: t('contactDirectory.export.error'),\n description: t('contactDirectory.export.errorDescription'),\n variant: 'destructive',\n });\n } finally {\n setIsExporting(false);\n }\n };\n\n const handleExportSelected = async (format: 'csv' | 'vcard') => {\n if (selectedContacts.length === 0) {\n toast({\n title: t('contactDirectory.export.noSelection'),\n description: t('contactDirectory.export.noSelectionDescription'),\n variant: 'destructive',\n });\n return;\n }\n\n try {\n setIsExporting(true);\n\n await exportSelectedContacts(selectedContacts, format);\n\n toast({\n title: t('contactDirectory.export.success'),\n description: t('contactDirectory.export.successDescription', {\n count: selectedContacts.length,\n format: format.toUpperCase()\n }),\n });\n\n // Clear selection after export\n setSelectedContacts([]);\n } catch (error) {\n console.error('Export error:', error);\n toast({\n title: t('contactDirectory.export.error'),\n description: t('contactDirectory.export.errorDescription'),\n variant: 'destructive',\n });\n } finally {\n setIsExporting(false);\n }\n };\n\n return (\n <div className=\"min-h-screen flex flex-col\" dir={isRTL ? 'rtl' : 'ltr'}>\n {/* Header */}\n <div className=\"border-b bg-background\">\n <div className=\"container mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6\">\n <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\n <div>\n <h1 className=\"text-2xl sm:text-3xl font-bold text-start\">\n {t('contactDirectory.title')}\n </h1>\n <p className=\"text-sm sm:text-base text-muted-foreground mt-1 text-start\">\n {t('contactDirectory.subtitle')}\n </p>\n </div>\n\n <div className=\"flex gap-2 sm:gap-3\">\n {/* Export Dropdown */}\n <DropdownMenu>\n <DropdownMenuTrigger asChild>\n <Button\n variant=\"outline\"\n disabled={isExporting || (searchResults?.total || 0) === 0}\n className=\"px-4\"\n >\n <Download className={`h-4 w-4 ${isRTL ? 'ms-2' : 'me-2'}`} />\n {t('contactDirectory.buttons.export')}\n </Button>\n </DropdownMenuTrigger>\n <DropdownMenuContent align={isRTL ? 'start' : 'end'} className=\"min-w-[200px]\">\n {/* Export All Section */}\n <div className=\"px-2 py-1.5 text-sm font-medium\">\n {t('contactDirectory.export.exportAll')}\n </div>\n <DropdownMenuItem\n onClick={() => handleExportAll('csv')}\n disabled={isExporting}\n className=\"\"\n >\n <FileText className={`h-4 w-4 ${isRTL ? 'ms-2' : 'me-2'}`} />\n {t('contactDirectory.export.csv')}\n <span className=\"ms-auto text-xs text-muted-foreground\">\n Excel {t('contactDirectory.export.compatible')}\n </span>\n </DropdownMenuItem>\n <DropdownMenuItem\n onClick={() => handleExportAll('vcard')}\n disabled={isExporting}\n className=\"\"\n >\n <CreditCard className={`h-4 w-4 ${isRTL ? 'ms-2' : 'me-2'}`} />\n {t('contactDirectory.export.vcard')}\n <span className=\"ms-auto text-xs text-muted-foreground\">\n Outlook {t('contactDirectory.export.compatible')}\n </span>\n </DropdownMenuItem>\n\n {/* Export Selected Section (if any selected) */}\n {selectedContacts.length > 0 && (\n <>\n <div className=\"my-2 border-t\" />\n <div className=\"px-2 py-1.5 text-sm font-medium\">\n {t('contactDirectory.export.exportSelected', {\n count: selectedContacts.length\n })}\n </div>\n <DropdownMenuItem\n onClick={() => handleExportSelected('csv')}\n disabled={isExporting}\n className=\"\"\n >\n <Check className={`h-4 w-4 ${isRTL ? 'ms-2' : 'me-2'}`} />\n {t('contactDirectory.export.selectedCsv')}\n </DropdownMenuItem>\n <DropdownMenuItem\n onClick={() => handleExportSelected('vcard')}\n disabled={isExporting}\n className=\"\"\n >\n <Check className={`h-4 w-4 ${isRTL ? 'ms-2' : 'me-2'}`} />\n {t('contactDirectory.export.selectedVCard')}\n </DropdownMenuItem>\n </>\n )}\n </DropdownMenuContent>\n </DropdownMenu>\n\n {/* Create Contact Button */}\n <Button\n onClick={handleCreateContact}\n className=\"px-4 sm:px-6\"\n >\n <Plus className={`h-4 w-4 ${isRTL ? 'ms-2' : 'me-2'}`} />\n {t('contactDirectory.buttons.createContact')}\n </Button>\n </div>\n </div>\n\n {/* Search & Filters */}\n <div className=\"mt-6\">\n <ContactSearch\n onSearch={setSearchParams}\n organizations={searchResults?.organizations || []}\n tags={searchResults?.tags || []}\n defaultParams={searchParams}\n isLoading={isLoading}\n />\n </div>\n </div>\n </div>\n\n {/* Contact List */}\n <div className=\"flex-1 container mx-auto py-6\">\n <ContactList\n contacts={searchResults?.contacts || []}\n tags={searchResults?.tags || []}\n onContactClick={(contact) => handleContactClick(contact.id)}\n isLoading={isLoading}\n isEmpty={searchResults?.total === 0}\n className=\"h-[calc(100vh-400px)] min-h-[400px]\"\n />\n\n {/* Results Summary */}\n {searchResults && searchResults.total > 0 && (\n <div className=\"mt-4 text-center text-sm text-muted-foreground\">\n {t('contactDirectory.messages.showingResults', {\n showing: searchResults.contacts.length,\n total: searchResults.total,\n })}\n </div>\n )}\n </div>\n </div>\n );\n}\n","/**\n * Contacts Directory Route - Main Index\n * Part of: 027-contact-directory implementation\n *\n * Route: /contacts\n * Displays the contact directory with search and filtering\n */\n\nimport { createFileRoute } from '@tanstack/react-router';\nimport { ContactsDirectory } from '@/pages/contacts/ContactsDirectory';\n\nexport const Route = createFileRoute('/_protected/contacts')({\n component: ContactsDirectory,\n meta: () => [\n {\n title: 'Contact Directory - GASTAT',\n },\n ],\n});\n"],"names":["ContactSearch","onSearch","organizations","tags","defaultParams","isLoading","t","i18n","useTranslation","isRTL","searchTerm","setSearchTerm","useState","organizationId","setOrganizationId","selectedTags","setSelectedTags","sourceType","setSourceType","sortBy","setSortBy","sortOrder","setSortOrder","includeArchived","setIncludeArchived","handleSearch","params","handleReset","toggleTag","tagId","prev","id","hasActiveFilters","jsxs","jsx","Search","Input","e","Button","Sheet","SheetTrigger","SlidersHorizontal","SheetContent","SheetHeader","SheetTitle","SheetDescription","FilterContent","Filter","tag","Badge","X","o","Fragment","Select","value","SelectTrigger","SelectValue","SelectContent","SelectItem","org","isSelected","ContactCard","contact","onClick","className","relationshipStats","useRelationshipStats","primaryEmail","primaryPhone","contactTags","Card","CardHeader","Briefcase","Building2","Network","CardContent","Mail","Phone","Tag","ContactList","contacts","onContactClick","isEmpty","emptyMessage","parentRef","useRef","rowVirtualizer","useVirtualizer","Loader2","Users","virtualRow","useSearchPersonDossiers","options","useQuery","dossierKeys","getDossiersByType","ExportApiError","status","message","exportContacts","format","filters","session","supabase","requestBody","data","error","contentType","downloadContacts","filename","blob","defaultFilename","finalFilename","url","link","exportSelectedContacts","contactIds","exportAllContacts","ContactsDirectory","navigate","useNavigate","toast","useToast","searchParams","setSearchParams","selectedContacts","setSelectedContacts","isExporting","setIsExporting","dossierResults","searchResults","useMemo","dossier","handleCreateContact","handleContactClick","contactId","handleExportAll","handleExportSelected","DropdownMenu","DropdownMenuTrigger","Download","DropdownMenuContent","DropdownMenuItem","FileText","CreditCard","Check","Plus","SplitComponent"],"mappings":"g1BA0CO,SAASA,GAAc,CAC7B,SAAAC,EACA,cAAAC,EAAgB,CAAA,EAChB,KAAAC,EAAO,CAAA,EACP,cAAAC,EACA,UAAAC,EAAY,EACb,EAAuB,CACtB,KAAM,CAAE,EAAAC,EAAG,KAAAC,GAASC,EAAe,UAAU,EACvCC,EAAQF,EAAK,WAAa,KAE1B,CAACG,EAAYC,CAAa,EAAIC,EAAAA,SAASR,GAAe,QAAU,EAAE,EAClE,CAACS,EAAgBC,CAAiB,EAAIF,EAAAA,SAASR,GAAe,iBAAmB,EAAE,EACnF,CAACW,EAAcC,CAAe,EAAIJ,EAAAA,SAAmBR,GAAe,MAAQ,EAAE,EAC9E,CAACa,EAAYC,CAAa,EAAIN,EAAAA,SACnCR,GAAe,aAA2D,EAAA,EAErE,CAACe,EAAQC,CAAS,EAAIR,EAAAA,SAC5BR,GAAe,SAAW,WAAA,EAEpB,CAACiB,EAAWC,CAAY,EAAIV,EAAAA,SAAyBR,GAAe,YAAc,KAAK,EACvF,CAACmB,EAAiBC,CAAkB,EAAIZ,EAAAA,SAASR,GAAe,kBAAoB,EAAK,EAEzFqB,EAAe,IAAM,CAC3B,MAAMC,EAA8B,CACpC,OAAQhB,GAAc,OACtB,gBAAiBG,GAAkB,OACnC,KAAME,EAAa,OAAS,EAAIA,EAAe,OAC/C,YAAaE,GAAc,OAC3B,QAASE,EACT,WAAYE,EACZ,iBAAkBE,CAAA,EAElBtB,EAASyB,CAAM,CACf,EAEMC,EAAc,IAAM,CAC1BhB,EAAc,EAAE,EAChBG,EAAkB,EAAE,EACpBE,EAAgB,CAAA,CAAE,EAClBE,EAAc,EAAE,EAChBE,EAAU,WAAW,EACrBE,EAAa,KAAK,EAClBE,EAAmB,EAAK,EACxBvB,EAAS,CAAA,CAAE,CACX,EAEM2B,EAAaC,GAAkB,CACrCb,EAAiBc,GACjBA,EAAK,SAASD,CAAK,EAAIC,EAAK,OAAQC,GAAOA,IAAOF,CAAK,EAAI,CAAC,GAAGC,EAAMD,CAAK,CAAA,CAE1E,EAEMG,EACNtB,GACAG,GACAE,EAAa,OAAS,GACtBE,GACAE,IAAW,aACXE,IAAc,OACdE,EAEA,cACC,MAAA,CAAI,UAAU,YAAY,IAAKd,EAAQ,MAAQ,MAEhD,SAAA,CAAAwB,EAAAA,KAAC,MAAA,CAAI,UAAU,aACf,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,kBACf,SAAA,CAAAC,EAAAA,IAACC,GAAA,CACD,UAAW,mEACX1B,EAAQ,UAAY,QACpB,EAAA,CAAA,EAEAyB,EAAAA,IAACE,EAAA,CACD,KAAK,SACL,YAAa9B,EAAE,8CAA8C,EAC7D,MAAOI,EACP,SAAW2B,GAAM1B,EAAc0B,EAAE,OAAO,KAAK,EAC7C,UAAYA,GAAMA,EAAE,MAAQ,SAAWZ,EAAA,EACvC,UAAW,QAAQhB,EAAQ,aAAe,YAAY,qBACtD,IAAKA,EAAQ,MAAQ,KAAA,CAAA,CACrB,EACA,EAEAyB,EAAAA,IAACI,EAAA,CACD,QAASb,EACT,SAAUpB,EACV,UAAU,oBAET,WAAE,gCAAgC,CAAA,CAAA,SAIlCkC,EAAA,CACD,SAAA,CAAAL,EAAAA,IAACM,EAAA,CAAa,QAAO,GACrB,SAAAN,EAAAA,IAACI,EAAA,CACD,QAAQ,UACR,KAAK,OACL,UAAU,sCAEV,SAAAJ,EAAAA,IAACO,GAAA,CAAkB,UAAU,SAAA,CAAU,CAAA,CAAA,EAEvC,SACCC,EAAA,CAAa,KAAMjC,EAAQ,OAAS,QAAS,UAAU,qBACxD,SAAA,CAAAwB,OAACU,EAAA,CACD,SAAA,CAAAT,EAAAA,IAACU,EAAA,CAAY,SAAAtC,EAAE,iCAAiC,CAAA,CAAE,EAClD4B,EAAAA,IAACW,GAAA,CAAkB,SAAAvC,EAAE,uCAAuC,CAAA,CAAE,CAAA,EAC9D,EACA2B,EAAAA,KAAC,MAAA,CAAI,UAAU,iBACf,SAAA,CAAAC,EAAAA,IAACY,EAAA,CACD,cAAA5C,EACA,KAAAC,EACA,eAAAU,EACA,kBAAAC,EACA,aAAAC,EACA,UAAAa,EACA,WAAAX,EACA,cAAAC,EACA,OAAAC,EACA,UAAAC,EACA,UAAAC,EACA,aAAAC,EACA,gBAAAC,EACA,mBAAAC,EACA,MAAAf,EACA,EAAAH,CAAA,CAAA,EAEA2B,EAAAA,KAAC,MAAA,CAAI,UAAU,kBACf,SAAA,CAAAC,EAAAA,IAACI,GAAO,QAASb,EAAc,UAAU,SACxC,SAAAnB,EAAE,uCAAuC,EAC1C,EACA4B,EAAAA,IAACI,EAAA,CAAO,QAASX,EAAa,QAAQ,UAAU,UAAU,SACzD,SAAArB,EAAE,+BAA+B,CAAA,CAClC,CAAA,CAAA,CACA,CAAA,CAAA,CACA,CAAA,CAAA,CACA,CAAA,CAAA,CACA,CAAA,EACA,EAGA4B,EAAAA,IAAC,MAAA,CAAI,UAAU,4BACf,SAAAA,EAAAA,IAACY,EAAA,CACD,cAAA5C,EACA,KAAAC,EACA,eAAAU,EACA,kBAAAC,EACA,aAAAC,EACA,UAAAa,EACA,WAAAX,EACA,cAAAC,EACA,OAAAC,EACA,UAAAC,EACA,UAAAC,EACA,aAAAC,EACA,gBAAAC,EACA,mBAAAC,EACA,MAAAf,EACA,EAAAH,CAAA,CAAA,EAEA,EAGC0B,GACDC,EAAAA,KAAC,MAAA,CAAI,UAAU,4CACf,SAAA,CAAAC,EAAAA,IAACa,GAAA,CAAO,UAAU,+BAAA,CAAgC,EACjDhC,EAAa,IAAKc,GAAU,CAC7B,MAAMmB,EAAM7C,EAAK,KAAMG,GAAMA,EAAE,KAAOuB,CAAK,EAC3C,OAAOmB,EACPf,EAAAA,KAACgB,EAAA,CAAkB,QAAQ,YAAY,UAAU,QAChD,SAAA,CAAAD,EAAI,KACLd,EAAAA,IAACgB,EAAA,CACD,UAAU,yBACV,QAAS,IAAMtB,EAAUC,CAAK,CAAA,CAAA,CAC9B,CAAA,EALYA,CAMZ,EACI,IACJ,CAAC,EACAhB,GACDoB,EAAAA,KAACgB,EAAA,CAAM,QAAQ,YAAY,UAAU,QACpC,SAAA,CAAA/C,EAAc,KAAMiD,GAAMA,EAAE,KAAOtC,CAAc,GAAG,KACrDqB,EAAAA,IAACgB,EAAA,CACD,UAAU,yBACV,QAAS,IAAMpC,EAAkB,EAAE,CAAA,CAAA,CACnC,EACA,EAECG,GACDgB,EAAAA,KAACgB,EAAA,CAAM,QAAQ,YAAY,UAAU,QACpC,SAAA,CAAA3C,EAAE,gCAAgCW,CAAU,EAAE,EAC/CiB,EAAAA,IAACgB,EAAA,CACD,UAAU,yBACV,QAAS,IAAMhC,EAAc,EAAE,CAAA,CAAA,CAC/B,EACA,EAEAgB,EAAAA,IAACI,EAAA,CACD,QAAQ,QACR,KAAK,KACL,QAASX,EACT,UAAU,cAET,WAAE,mCAAmC,CAAA,CAAA,CACtC,CAAA,CACA,CAAA,EAEA,CAED,CAGA,SAASmB,EAAc,CACtB,cAAA5C,EACA,KAAAC,EACA,eAAAU,EACA,kBAAAC,EACA,aAAAC,EACA,UAAAa,EACA,WAAAX,EACA,cAAAC,EACA,OAAAC,EACA,UAAAC,EACA,UAAAC,EACA,aAAAC,EACA,gBAAAC,EACA,mBAAAC,EACA,MAAAf,EACA,EAAAH,CACD,EAAQ,CACP,OACA2B,EAAAA,KAAAmB,WAAA,CAEC,SAAA,CAAAlD,EAAc,OAAS,GACxB+B,EAAAA,KAAC,MAAA,CAAI,UAAU,YACf,SAAA,CAAAC,MAAC,QAAA,CAAM,UAAU,sBAAuB,SAAA5B,EAAE,gDAAgD,EAAE,EAC5F2B,EAAAA,KAACoB,EAAA,CAAO,MAAOxC,GAAkB,MAAO,cAAgByC,GAAUxC,EAAkBwC,IAAU,MAAQ,GAAKA,CAAK,EAChH,SAAA,CAAApB,EAAAA,IAACqB,EAAA,CAAc,UAAU,OACzB,SAAArB,EAAAA,IAACsB,GAAY,YAAalD,EAAE,2CAA2C,CAAA,CAAG,CAAA,CAC1E,SACCmD,EAAA,CACD,SAAA,CAAAvB,MAACwB,EAAA,CAAW,MAAM,MAAO,SAAApD,EAAE,2CAA2C,EAAE,EACvEJ,EAAc,IAAKyD,GACpBzB,EAAAA,IAACwB,EAAA,CAAwB,MAAOC,EAAI,GACnC,SAAAA,EAAI,IAAA,EADYA,EAAI,EAErB,CACC,CAAA,CAAA,CACD,CAAA,CAAA,CACA,CAAA,EACA,EAICxD,EAAK,OAAS,GACf8B,EAAAA,KAAC,MAAA,CAAI,UAAU,YACf,SAAA,CAAAC,MAAC,QAAA,CAAM,UAAU,sBAAuB,SAAA5B,EAAE,wCAAwC,EAAE,QACnF,MAAA,CAAI,UAAU,uBACd,SAAAH,EAAK,IAAK6C,GAAa,CACxB,MAAMY,EAAa7C,EAAa,SAASiC,EAAI,EAAE,EAC/C,OACAd,EAAAA,IAACe,EAAA,CAED,QAASW,EAAa,UAAY,UAClC,UAAU,qCACV,QAAS,IAAMhC,EAAUoB,EAAI,EAAE,EAC/B,MACAY,GAAcZ,EAAI,MAChB,CAAE,gBAAiBA,EAAI,MAAO,YAAaA,EAAI,KAAA,EAC/C,OAGD,SAAAA,EAAI,IAAA,EAVAA,EAAI,EAAA,CAaT,CAAC,CAAA,CACD,CAAA,EACA,EAIAf,EAAAA,KAAC,MAAA,CAAI,UAAU,YACf,SAAA,CAAAC,MAAC,QAAA,CAAM,UAAU,sBAAuB,SAAA5B,EAAE,0CAA0C,EAAE,EACtF2B,EAAAA,KAACoB,EAAA,CAAO,MAAOpC,GAAc,MAAO,cAAgBqC,GAAUpC,EAAcoC,IAAU,MAAQ,GAAKA,CAAY,EAC/G,SAAA,CAAApB,EAAAA,IAACqB,EAAA,CAAc,UAAU,OACzB,SAAArB,EAAAA,IAACsB,GAAY,YAAalD,EAAE,qCAAqC,CAAA,CAAG,CAAA,CACpE,SACCmD,EAAA,CACD,SAAA,CAAAvB,MAACwB,EAAA,CAAW,MAAM,MAAO,SAAApD,EAAE,qCAAqC,EAAE,QACjEoD,EAAA,CAAW,MAAM,SAAU,SAAApD,EAAE,qCAAqC,EAAE,QACpEoD,EAAA,CAAW,MAAM,gBAAiB,SAAApD,EAAE,2CAA2C,EAAE,QACjFoD,EAAA,CAAW,MAAM,WAAY,SAAApD,EAAE,uCAAuC,CAAA,CAAE,CAAA,CAAA,CACzE,CAAA,CAAA,CACA,CAAA,EACA,EAGA2B,EAAAA,KAAC,MAAA,CAAI,UAAU,yBACf,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,YACf,SAAA,CAAAC,MAAC,QAAA,CAAM,UAAU,sBAAuB,SAAA5B,EAAE,iCAAiC,EAAE,EAC7E2B,EAAAA,KAACoB,EAAA,CAAO,MAAOlC,EAAQ,cAAeC,EACtC,SAAA,CAAAc,MAACqB,EAAA,CAAc,UAAU,OACzB,SAAArB,MAACsB,IAAY,EACb,SACCC,EAAA,CACD,SAAA,CAAAvB,MAACwB,EAAA,CAAW,MAAM,YAAa,SAAApD,EAAE,mCAAmC,EAAE,QACrEoD,EAAA,CAAW,MAAM,aAAc,SAAApD,EAAE,sCAAsC,EAAE,QACzEoD,EAAA,CAAW,MAAM,aAAc,SAAApD,EAAE,sCAAsC,CAAA,CAAE,CAAA,CAAA,CAC1E,CAAA,CAAA,CACA,CAAA,EACA,EAEA2B,EAAAA,KAAC,MAAA,CAAI,UAAU,YACf,SAAA,CAAAC,MAAC,QAAA,CAAM,UAAU,sBAAuB,SAAA5B,EAAE,+BAA+B,EAAE,EAC3E2B,EAAAA,KAACoB,EAAA,CAAO,MAAOhC,EAAW,cAAeC,EACzC,SAAA,CAAAY,MAACqB,EAAA,CAAc,UAAU,OACzB,SAAArB,MAACsB,IAAY,EACb,SACCC,EAAA,CACD,SAAA,CAAAvB,MAACwB,EAAA,CAAW,MAAM,MAAO,SAAApD,EAAE,mCAAmC,EAAE,QAC/DoD,EAAA,CAAW,MAAM,OAAQ,SAAApD,EAAE,oCAAoC,CAAA,CAAE,CAAA,CAAA,CAClE,CAAA,CAAA,CACA,CAAA,CAAA,CACA,CAAA,EACA,EAGA2B,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACf,SAAA,CAAAC,EAAAA,IAAC,QAAA,CACD,KAAK,WACL,GAAG,mBACH,QAASX,EACT,SAAWc,GAAMb,EAAmBa,EAAE,OAAO,OAAO,EACpD,UAAU,iCAAA,CAAA,EAEVH,MAAC,SAAM,QAAQ,mBAAmB,UAAU,UAC3C,SAAA5B,EAAE,0CAA0C,CAAA,CAC7C,CAAA,CAAA,CACA,CAAA,EACA,CAED,CChWO,SAASuD,GAAY,CAAE,QAAAC,EAAS,KAAA3D,EAAO,CAAA,EAAI,QAAA4D,EAAS,UAAAC,EAAY,IAAwB,CAC9F,KAAM,CAAE,EAAA1D,EAAG,KAAAC,GAASC,EAAe,UAAU,EACvCC,EAAQF,EAAK,WAAa,KAG1B,CAAE,KAAM0D,CAAA,EAAsBC,GAAqBJ,EAAQ,EAAE,EAG7DK,EAAeL,EAAQ,kBAAkB,CAAC,EAC1CM,EAAeN,EAAQ,gBAAgB,CAAC,EAGxCO,EAAclE,EAAK,OAAQ6C,GAAQc,EAAQ,MAAM,SAASd,EAAI,EAAE,CAAC,EAEvE,OACAf,EAAAA,KAACqC,GAAA,CACD,UAAW,oDAAoDN,CAAS,GACxE,QAAAD,EACA,IAAKtD,EAAQ,MAAQ,MAErB,SAAA,CAAAyB,EAAAA,IAACqC,IAAW,UAAU,OACtB,SAAAtC,EAAAA,KAAC,MAAA,CAAI,UAAU,oEACf,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,iBACf,SAAA,CAAAC,EAAAA,IAAC,KAAA,CAAG,UAAU,4CAA6C,SAAA4B,EAAQ,UAAU,EAC5EA,EAAQ,UACT7B,OAAC,MAAA,CAAI,UAAU,6DACf,SAAA,CAAAC,EAAAA,IAACsC,GAAA,CAAU,UAAU,2BAAA,CAA4B,EACjDtC,EAAAA,IAAC,OAAA,CAAK,UAAU,sBAAuB,WAAQ,QAAA,CAAS,CAAA,CAAA,CACxD,CAAA,EAEA,EAEAD,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACd,SAAA,CAAA6B,EAAQ,cACT7B,EAAAA,KAACgB,EAAA,CAAM,QAAQ,YAAY,UAAU,gEACrC,SAAA,CAAAf,EAAAA,IAACuC,GAAA,CAAU,UAAU,SAAA,CAAU,QAC9B,OAAA,CAAK,UAAU,uCAAwC,SAAAX,EAAQ,aAAa,IAAA,CAAK,CAAA,EAClF,EAECG,GAAqBA,EAAkB,MAAQ,UAC/ChB,EAAA,CAAM,QAAQ,UAAU,UAAU,8CACnC,SAAA,CAAAf,EAAAA,IAACwC,GAAA,CAAQ,UAAU,SAAA,CAAU,EAC7BxC,EAAAA,IAAC,OAAA,CAAM,SAAA+B,EAAkB,KAAA,CAAM,CAAA,CAAA,CAC/B,CAAA,CAAA,CAEA,CAAA,CAAA,CACA,CAAA,CACA,EAEAhC,EAAAA,KAAC0C,GAAA,CAAY,UAAU,YAEvB,SAAA,CAAA1C,EAAAA,KAAC,MAAA,CAAI,UAAU,YACd,SAAA,CAAAkC,GACDlC,EAAAA,KAAC,MAAA,CAAI,UAAU,kCACf,SAAA,CAAAC,EAAAA,IAAC0C,GAAA,CAAK,UAAU,6CAAA,CAA8C,EAC9D1C,EAAAA,IAAC,OAAA,CAAK,UAAU,sBAAuB,SAAAiC,CAAA,CAAa,CAAA,EACpD,EAGCC,GACDnC,EAAAA,KAAC,MAAA,CAAI,UAAU,kCACf,SAAA,CAAAC,EAAAA,IAAC2C,GAAA,CAAM,UAAU,6CAAA,CAA8C,EAC/D3C,EAAAA,IAAC,OAAA,CAAK,UAAW,GAAGzB,EAAQ,WAAa,YAAY,GAAI,IAAI,MAC5D,SAAA2D,CAAA,CACD,CAAA,CAAA,CACA,CAAA,EAEA,EAGCC,EAAY,OAAS,GACtBpC,EAAAA,KAAC,MAAA,CAAI,UAAU,uCACf,SAAA,CAAAC,EAAAA,IAAC4C,GAAA,CAAI,UAAU,wDAAA,CAAyD,QACvE,MAAA,CAAI,UAAU,gCACd,SAAAT,EAAY,IAAKrB,GAClBd,EAAAA,IAACe,EAAA,CAED,QAAQ,UACR,UAAU,sBACV,MAAOD,EAAI,MAAQ,CAAE,YAAaA,EAAI,MAAO,MAAOA,EAAI,KAAA,EAAU,OAEjE,SAAAA,EAAI,IAAA,EALAA,EAAI,EAAA,CAOR,CAAA,CACD,CAAA,EACA,IAIGc,EAAQ,iBAAiB,QAAU,GAAK,IAAMA,EAAQ,eAAe,QAAU,GAAK,IACvF7B,EAAAA,KAAC,MAAA,CAAI,UAAU,gDACb,SAAA,EAAA6B,EAAQ,iBAAiB,QAAU,GAAK,UACzC,OAAA,CAAK,SAAA,CAAA,IACJA,EAAQ,gBAAiB,OAAS,EAAE,SAAOA,EAAQ,gBAAiB,OAAS,EAAI,EAAI,IAAM,EAAA,EAC7F,GAEEA,EAAQ,eAAe,QAAU,GAAK,UACvC,OAAA,CAAK,SAAA,CAAA,IACJA,EAAQ,cAAe,OAAS,EAAE,SAAOA,EAAQ,cAAe,OAAS,EAAI,EAAI,IAAM,EAAA,CAAA,CACzF,CAAA,CAAA,CAEA,CAAA,CAAA,CAEA,CAAA,CAAA,CAAA,CAGD,CCzGO,SAASiB,GAAY,CAC3B,SAAAC,EACA,KAAA7E,EAAO,CAAA,EACP,eAAA8E,EACA,UAAA5E,EAAY,GACZ,QAAA6E,EAAU,GACV,aAAAC,EACA,UAAAnB,EAAY,EACb,EAAqB,CACpB,KAAM,CAAE,EAAA1D,EAAG,KAAAC,GAASC,EAAe,UAAU,EACvCC,EAAQF,EAAK,WAAa,KAC1B6E,EAAYC,EAAAA,OAAuB,IAAI,EAGvCC,EAAiBC,GAAe,CACtC,MAAOP,EAAS,OAChB,iBAAkB,IAAMI,EAAU,QAClC,aAAc,IAAM,IACpB,SAAU,CAAA,CACT,EAGD,OAAI/E,EAEJ4B,EAAAA,KAAC,MAAA,CAAI,UAAU,wDACf,SAAA,CAAAC,EAAAA,IAACsD,GAAA,CAAQ,UAAU,4CAAA,CAA6C,QAC/D,IAAA,CAAE,UAAU,gCAAiC,SAAAlF,EAAE,wCAAwC,CAAA,CAAE,CAAA,EAC1F,EAKI4E,GAAWF,EAAS,SAAW,EAEnC/C,EAAAA,KAAC,MAAA,CAAI,UAAU,wDACf,SAAA,CAAAC,EAAAA,IAAC,OAAI,UAAU,4BACf,eAACuD,GAAA,CAAM,UAAU,gCAAgC,CAAA,CACjD,EACAxD,EAAAA,KAAC,MAAA,CAAI,UAAU,wBACf,SAAA,CAAAC,MAAC,KAAE,UAAU,cAAe,SAAAiD,GAAgB7E,EAAE,yCAAyC,EAAE,QACxF,IAAA,CAAE,UAAU,gCAAiC,SAAAA,EAAE,6CAA6C,CAAA,CAAE,CAAA,CAAA,CAC/F,CAAA,EACA,EAKA4B,EAAAA,IAAC,MAAA,CACD,IAAKkD,EACL,UAAW,iBAAiBpB,CAAS,GACrC,MAAO,CAAE,OAAQ,MAAA,EACjB,IAAKvD,EAAQ,MAAQ,MAErB,SAAAyB,EAAAA,IAAC,MAAA,CACD,MAAO,CACP,OAAQ,GAAGoD,EAAe,aAAA,CAAc,KACxC,MAAO,OACP,SAAU,UAAA,EAGT,SAAAA,EAAe,gBAAA,EAAkB,IAAKI,GAAe,CACtD,MAAM5B,EAAUkB,EAASU,EAAW,KAAK,EACzC,OACAxD,EAAAA,IAAC,MAAA,CAED,MAAO,CACP,SAAU,WACV,IAAK,EACL,CAACzB,EAAQ,QAAU,MAAM,EAAG,EAC5B,MAAO,OACP,OAAQ,GAAGiF,EAAW,IAAI,KAC1B,UAAW,cAAcA,EAAW,KAAK,KAAA,EAEzC,UAAU,4BAEV,SAAAxD,EAAAA,IAAC2B,GAAA,CACD,QAAAC,EACA,KAAA3D,EACA,QAAS,IAAM8E,IAAiBnB,CAAO,CAAA,CAAA,CACvC,EAfK4B,EAAW,GAAA,CAkBhB,CAAC,CAAA,CAAA,CACD,CAAA,CAGD,CC5BO,SAASC,GACdjE,EACAkE,EACA,CACA,OAAOC,EAAS,CACd,SAAU,CAAC,GAAGC,GAAY,OAAO,QAAQ,EAAG,CAAE,OAAApE,EAAQ,EACtD,QAAS,IAAMqE,GAAkB,SAAU,EAAGrE,GAAQ,OAAS,EAAE,EACjE,GAAGkE,CAAA,CACJ,CACH,CC7EO,MAAMI,UAAuB,KAAM,CACxC,YAAmBC,EAAgBC,EAAiB,CAClD,MAAMA,CAAO,EADI,KAAA,OAAAD,EAEjB,KAAK,KAAO,gBACd,CACF,CASA,eAAsBE,GACpBC,EACAC,EACe,CACf,GAAI,CAEF,KAAM,CAAE,KAAM,CAAE,QAAAC,CAAA,GAAc,MAAMC,EAAS,KAAK,WAAA,EAElD,GAAI,CAACD,EACH,MAAM,IAAIN,EAAe,IAAK,yBAAyB,EAIzD,MAAMQ,EAAc,CAClB,OAAAJ,EACA,GAAGC,EACH,MAAOA,GAAS,OAAS,GAAA,EAIrB,CAAE,KAAAI,EAAM,MAAAC,CAAA,EAAU,MAAMH,EAAS,UAAU,OAAO,kBAAmB,CACzE,KAAMC,EACN,QAAS,CACP,eAAgB,kBAAA,CAClB,CACD,EAED,GAAIE,EACF,MAAM,IAAIV,EAAe,IAAKU,EAAM,SAAW,eAAe,EAKhE,MAAMC,EAAcP,IAAW,MAC3B,yBACA,2BAEJ,OAAO,IAAI,KAAK,CAACK,CAAI,EAAG,CAAE,KAAME,EAAa,CAE/C,OAASD,EAAO,CACd,MAAIA,aAAiBV,EACbU,GAGR,QAAQ,MAAM,gBAAiBA,CAAK,EAC9B,IAAIV,EACR,IACAU,aAAiB,MAAQA,EAAM,QAAU,eAAA,EAE7C,CACF,CASA,eAAsBE,EACpBR,EACAC,EACAQ,EACe,CACf,GAAI,CAEF,MAAMC,EAAO,MAAMX,GAAeC,EAAQC,CAAO,EAG3CU,EAAkB,YAAY,IAAI,KAAA,EAAO,cAAc,MAAM,GAAG,EAAE,CAAC,CAAC,IACxEX,IAAW,MAAQ,MAAQ,KAC7B,GACMY,EAAgBH,GAAYE,EAG5BE,EAAM,IAAI,gBAAgBH,CAAI,EAC9BI,EAAO,SAAS,cAAc,GAAG,EACvCA,EAAK,KAAOD,EACZC,EAAK,SAAWF,EAGhB,SAAS,KAAK,YAAYE,CAAI,EAC9BA,EAAK,MAAA,EACL,SAAS,KAAK,YAAYA,CAAI,EAG9B,IAAI,gBAAgBD,CAAG,CAEzB,OAASP,EAAO,CACd,cAAQ,MAAM,kBAAmBA,CAAK,EAChCA,CACR,CACF,CAQA,eAAsBS,GACpBC,EACAhB,EACe,CACf,GAAIgB,EAAW,SAAW,EACxB,MAAM,IAAIpB,EAAe,IAAK,sBAAsB,EAGtD,OAAOY,EAAiBR,EAAQ,CAAE,YAAagB,EAAY,CAC7D,CASA,eAAsBC,GACpBjB,EACAvF,EACAV,EACe,CACf,MAAMkG,EAAyB,CAAA,EAE/B,OAAIxF,IACFwF,EAAQ,gBAAkBxF,GAGxBV,GAAM,SACRkG,EAAQ,KAAOlG,GAGVyG,EAAiBR,EAAQC,CAAO,CACzC,CC7IO,SAASiB,IAAoB,CACnC,KAAM,CAAE,EAAAhH,EAAG,KAAAC,GAASC,EAAe,UAAU,EACvCC,EAAQF,EAAK,WAAa,KAC1BgH,EAAWC,EAAA,EACX,CAAE,MAAAC,CAAA,EAAUC,GAAA,EAEZ,CAACC,EAAcC,CAAe,EAAIhH,EAAAA,SAA6B,CAAA,CAAE,EACjE,CAACiH,EAAkBC,CAAmB,EAAIlH,EAAAA,SAAmB,CAAA,CAAE,EAC/D,CAACmH,EAAaC,CAAc,EAAIpH,EAAAA,SAAS,EAAK,EAG9C,CAAE,KAAMqH,EAAgB,UAAA5H,CAAA,EAAcsF,GAAwBgC,CAAY,EAG1EO,EAAgBC,EAAAA,QAAQ,IACzBF,GAAgB,KAEd,CACP,SAAUA,EAAe,KAAK,IAAIG,IAAY,CAC9C,GAAIA,EAAQ,GACZ,UAAWA,EAAQ,QACnB,gBAAiBA,EAAQ,UAAU,gBACnC,kBAAmBA,EAAQ,UAAU,qBACrC,SAAUA,EAAQ,UAAU,SAC5B,gBAAiBA,EAAQ,UAAU,OAAS,CAAA,EAC5C,cAAeA,EAAQ,UAAU,OAAS,CAAA,EAC1C,KAAMA,EAAQ,KACd,YAAaA,EAAQ,UAAU,aAAe,SAC9C,WAAYA,EAAQ,WACpB,WAAYA,EAAQ,UAAA,EAClB,EACF,MAAOH,EAAe,OAAS,EAC/B,cAAe,CAAA,EACf,KAAM,CAAA,CAAC,EAlB2B,KAoB/B,CAACA,CAAc,CAAC,EAEbI,EAAsB,IAAM,CAClCd,EAAS,CAAE,GAAI,mBAAoB,CACnC,EAEMe,EAAsBC,GAAsB,CAClDhB,EAAS,CAAE,GAAI,uBAAwB,OAAQ,CAAE,UAAAgB,CAAA,EAAa,CAC9D,EAEMC,EAAkB,MAAOpC,GAA4B,CAC3D,GAAI,CACJ4B,EAAe,EAAI,EAGnB,MAAMX,GACNjB,EACAuB,EAAa,gBACbA,EAAa,IAAA,EAGbF,EAAM,CACN,MAAOnH,EAAE,iCAAiC,EAC1C,YAAaA,EAAE,6CAA8C,CAC7D,MAAO4H,GAAe,OAAS,EAC/B,OAAQ9B,EAAO,YAAA,CAAY,CAC1B,CAAA,CACA,CACD,OAASM,EAAO,CAChB,QAAQ,MAAM,gBAAiBA,CAAK,EACpCe,EAAM,CACN,MAAOnH,EAAE,+BAA+B,EACxC,YAAaA,EAAE,0CAA0C,EACzD,QAAS,aAAA,CACR,CACD,QAAA,CACA0H,EAAe,EAAK,CACpB,CACA,EAEMS,EAAuB,MAAOrC,GAA4B,CAChE,GAAIyB,EAAiB,SAAW,EAAG,CACnCJ,EAAM,CACN,MAAOnH,EAAE,qCAAqC,EAC9C,YAAaA,EAAE,gDAAgD,EAC/D,QAAS,aAAA,CACR,EACD,MACA,CAEA,GAAI,CACJ0H,EAAe,EAAI,EAEnB,MAAMb,GAAuBU,EAAkBzB,CAAM,EAErDqB,EAAM,CACN,MAAOnH,EAAE,iCAAiC,EAC1C,YAAaA,EAAE,6CAA8C,CAC7D,MAAOuH,EAAiB,OACxB,OAAQzB,EAAO,YAAA,CAAY,CAC1B,CAAA,CACA,EAGD0B,EAAoB,CAAA,CAAE,CACtB,OAASpB,EAAO,CAChB,QAAQ,MAAM,gBAAiBA,CAAK,EACpCe,EAAM,CACN,MAAOnH,EAAE,+BAA+B,EACxC,YAAaA,EAAE,0CAA0C,EACzD,QAAS,aAAA,CACR,CACD,QAAA,CACA0H,EAAe,EAAK,CACpB,CACA,EAEA,cACC,MAAA,CAAI,UAAU,6BAA6B,IAAKvH,EAAQ,MAAQ,MAEjE,SAAA,CAAAyB,EAAAA,IAAC,OAAI,UAAU,yBACf,SAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,sDACf,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,qEACf,SAAA,CAAAA,OAAC,MAAA,CACD,SAAA,CAAAC,MAAC,KAAA,CAAG,UAAU,4CACb,SAAA5B,EAAE,wBAAwB,EAC3B,QACC,IAAA,CAAE,UAAU,6DACZ,SAAAA,EAAE,2BAA2B,CAAA,CAC9B,CAAA,EACA,EAEA2B,EAAAA,KAAC,MAAA,CAAI,UAAU,sBAEf,SAAA,CAAAA,OAACyG,GAAA,CACD,SAAA,CAAAxG,EAAAA,IAACyG,GAAA,CAAoB,QAAO,GAC5B,SAAA1G,EAAAA,KAACK,EAAA,CACD,QAAQ,UACR,SAAUyF,IAAgBG,GAAe,OAAS,KAAO,EACzD,UAAU,OAEV,SAAA,CAAAhG,MAAC0G,IAAS,UAAW,WAAWnI,EAAQ,OAAS,MAAM,GAAI,EAC1DH,EAAE,iCAAiC,CAAA,CAAA,CAAA,EAEpC,SACCuI,GAAA,CAAoB,MAAOpI,EAAQ,QAAU,MAAO,UAAU,gBAE/D,SAAA,CAAAyB,MAAC,MAAA,CAAI,UAAU,kCACd,SAAA5B,EAAE,mCAAmC,EACtC,EACA2B,EAAAA,KAAC6G,EAAA,CACD,QAAS,IAAMN,EAAgB,KAAK,EACpC,SAAUT,EACV,UAAU,GAEV,SAAA,CAAA7F,MAAC6G,IAAS,UAAW,WAAWtI,EAAQ,OAAS,MAAM,GAAI,EAC1DH,EAAE,6BAA6B,EAChC2B,EAAAA,KAAC,OAAA,CAAK,UAAU,wCAAwC,SAAA,CAAA,SACjD3B,EAAE,oCAAoC,CAAA,CAAA,CAC7C,CAAA,CAAA,CAAA,EAEA2B,EAAAA,KAAC6G,EAAA,CACD,QAAS,IAAMN,EAAgB,OAAO,EACtC,SAAUT,EACV,UAAU,GAEV,SAAA,CAAA7F,MAAC8G,IAAW,UAAW,WAAWvI,EAAQ,OAAS,MAAM,GAAI,EAC5DH,EAAE,+BAA+B,EAClC2B,EAAAA,KAAC,OAAA,CAAK,UAAU,wCAAwC,SAAA,CAAA,WAC/C3B,EAAE,oCAAoC,CAAA,CAAA,CAC/C,CAAA,CAAA,CAAA,EAICuH,EAAiB,OAAS,GAC3B5F,EAAAA,KAAAmB,EAAAA,SAAA,CACA,SAAA,CAAAlB,EAAAA,IAAC,MAAA,CAAI,UAAU,eAAA,CAAgB,EAC/BA,EAAAA,IAAC,MAAA,CAAI,UAAU,kCACd,WAAE,yCAA0C,CAC7C,MAAO2F,EAAiB,MAAA,CACvB,EACD,EACA5F,EAAAA,KAAC6G,EAAA,CACD,QAAS,IAAML,EAAqB,KAAK,EACzC,SAAUV,EACV,UAAU,GAEV,SAAA,CAAA7F,MAAC+G,GAAM,UAAW,WAAWxI,EAAQ,OAAS,MAAM,GAAI,EACvDH,EAAE,qCAAqC,CAAA,CAAA,CAAA,EAExC2B,EAAAA,KAAC6G,EAAA,CACD,QAAS,IAAML,EAAqB,OAAO,EAC3C,SAAUV,EACV,UAAU,GAEV,SAAA,CAAA7F,MAAC+G,GAAM,UAAW,WAAWxI,EAAQ,OAAS,MAAM,GAAI,EACvDH,EAAE,uCAAuC,CAAA,CAAA,CAAA,CAC1C,CAAA,CACA,CAAA,CAAA,CAEA,CAAA,EACA,EAGA2B,EAAAA,KAACK,EAAA,CACD,QAAS+F,EACT,UAAU,eAEV,SAAA,CAAAnG,MAACgH,IAAK,UAAW,WAAWzI,EAAQ,OAAS,MAAM,GAAI,EACtDH,EAAE,wCAAwC,CAAA,CAAA,CAAA,CAC3C,CAAA,CACA,CAAA,EACA,EAGA4B,EAAAA,IAAC,MAAA,CAAI,UAAU,OACf,SAAAA,EAAAA,IAAClC,GAAA,CACD,SAAU4H,EACV,cAAeM,GAAe,eAAiB,CAAA,EAC/C,KAAMA,GAAe,MAAQ,CAAA,EAC7B,cAAeP,EACf,UAAAtH,CAAA,CAAA,CACA,CACA,CAAA,CAAA,CACA,CAAA,CACA,EAGA4B,EAAAA,KAAC,MAAA,CAAI,UAAU,gCACf,SAAA,CAAAC,EAAAA,IAAC6C,GAAA,CACD,SAAUmD,GAAe,UAAY,CAAA,EACrC,KAAMA,GAAe,MAAQ,CAAA,EAC7B,eAAiBpE,GAAYwE,EAAmBxE,EAAQ,EAAE,EAC1D,UAAAzD,EACA,QAAS6H,GAAe,QAAU,EAClC,UAAU,qCAAA,CAAA,EAITA,GAAiBA,EAAc,MAAQ,SACvC,MAAA,CAAI,UAAU,iDACd,SAAA5H,EAAE,2CAA4C,CAC/C,QAAS4H,EAAc,SAAS,OAChC,MAAOA,EAAc,KAAA,CACpB,CAAA,CACD,CAAA,CAAA,CAEA,CAAA,EACA,CAED,CCrQuE,MAAAiB,GAA9D7B"}