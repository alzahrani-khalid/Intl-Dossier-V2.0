{"version":3,"file":"MyAssignments-Dhhp18mM.js","sources":["../../src/hooks/useMyAssignments.ts","../../src/pages/MyAssignments.tsx"],"sourcesContent":["/**\n * useMyAssignments Hook\n *\n * TanStack Query hook for fetching current user's assignments\n * with SLA deadlines and time remaining.\n *\n * @see specs/013-assignment-engine-sla/contracts/api-spec.yaml#GET /assignments/my-assignments\n */\n\nimport { useQuery } from '@tanstack/react-query'\nimport { createClient } from '@/lib/supabase-client'\n\nconst supabase = createClient()\n\nexport interface Assignment {\n  id: string\n  work_item_id: string\n  work_item_type: 'dossier' | 'ticket' | 'position' | 'task'\n  work_item_title?: string\n  assigned_at: string\n  sla_deadline: string\n  time_remaining_seconds: number\n  priority: 'urgent' | 'high' | 'normal' | 'low'\n  status: 'pending' | 'assigned' | 'in_progress' | 'completed' | 'cancelled'\n  warning_sent: boolean\n  escalated: boolean\n  escalated_at?: string | null\n  escalation_recipient_name?: string | null\n}\n\nexport interface MyAssignmentsResponse {\n  assignments: Assignment[]\n  total_count: number\n  summary: {\n    active_count: number\n    at_risk_count: number\n    breached_count: number\n  }\n}\n\ninterface UseMyAssignmentsOptions {\n  status?: string\n  include_completed?: boolean\n}\n\nexport function useMyAssignments(options: UseMyAssignmentsOptions = {}) {\n  return useQuery<MyAssignmentsResponse>({\n    queryKey: ['my-assignments', options],\n    queryFn: async () => {\n      const params = new URLSearchParams()\n      if (options.status) params.append('status', options.status)\n      if (options.include_completed !== undefined) {\n        params.append('include_completed', String(options.include_completed))\n      }\n\n      const { data, error } = await supabase.functions.invoke('assignments-my-assignments', {\n        method: 'GET',\n        ...(params.toString() && { body: Object.fromEntries(params) }),\n      })\n\n      if (error) {\n        throw new Error(error.message || 'Failed to fetch my assignments')\n      }\n\n      return data as MyAssignmentsResponse\n    },\n    enabled: true,\n    refetchInterval: 30000, // Refetch every 30s for SLA countdown updates\n  })\n}\n","import React from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { useNavigate } from '@tanstack/react-router'\nimport { useMyAssignments } from '../hooks/useMyAssignments'\nimport { Alert, AlertDescription } from '../components/ui/alert'\nimport { Badge } from '../components/ui/badge'\nimport { Card, CardContent, CardHeader, CardTitle } from '../components/ui/card'\nimport { AlertCircle, Clock, CheckCircle2, XCircle } from 'lucide-react'\n\nexport function MyAssignmentsPage() {\n const { t } = useTranslation('assignments')\n const navigate = useNavigate()\n const { data, isLoading, error } = useMyAssignments()\n\n const handleAssignmentClick = (assignment: any) => {\n // Navigate to assignment detail page\n navigate({ to: `/tasks/${assignment.id}` })\n }\n\n const formatTimeRemaining = (seconds: number): string => {\n if (seconds < 0) return t('sla_breached')\n const hours = Math.floor(seconds / 3600)\n const minutes = Math.floor((seconds % 3600) / 60)\n if (hours > 24) {\n const days = Math.floor(hours / 24)\n return `${days}d ${hours % 24}h`\n }\n return `${hours}h ${minutes}m`\n }\n\n const getPriorityColor = (priority: string): string => {\n const colors = {\n urgent: 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200',\n high: 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200',\n normal: 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200',\n low: 'bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200',\n }\n return colors[priority as keyof typeof colors] || colors.normal\n }\n\n if (error) {\n return (\n <div className=\"container mx-auto p-6\">\n <Alert variant=\"destructive\">\n <AlertCircle className=\"size-4\" />\n <AlertDescription>\n {error.message || 'Failed to load assignments. Edge Functions may not be deployed yet.'}\n </AlertDescription>\n </Alert>\n </div>\n )\n }\n\n return (\n <div className=\"container mx-auto space-y-6 p-6\">\n <div>\n <h1 className=\"text-3xl font-bold\">{t('my_assignments')}</h1>\n <p className=\"mt-1 text-muted-foreground\">\n {t('my_assignments_description')}\n </p>\n </div>\n\n {/* Summary Stats */}\n <div className=\"grid grid-cols-1 gap-4 md:grid-cols-3\">\n <Card>\n <CardHeader className=\"pb-3\">\n <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n Total Active\n </CardTitle>\n </CardHeader>\n <CardContent>\n <div className=\"text-2xl font-bold\">\n {isLoading ? '...' : data?.summary.active_count || 0}\n </div>\n </CardContent>\n </Card>\n\n <Card className=\"border-yellow-200 dark:border-yellow-800\">\n <CardHeader className=\"pb-3\">\n <CardTitle className=\"text-sm font-medium text-yellow-700 dark:text-yellow-300\">\n At Risk (75%+ SLA)\n </CardTitle>\n </CardHeader>\n <CardContent>\n <div className=\"text-2xl font-bold text-yellow-700 dark:text-yellow-300\">\n {isLoading ? '...' : data?.summary.at_risk_count || 0}\n </div>\n </CardContent>\n </Card>\n\n <Card className=\"border-red-200 dark:border-red-800\">\n <CardHeader className=\"pb-3\">\n <CardTitle className=\"text-sm font-medium text-red-700 dark:text-red-300\">\n SLA Breached\n </CardTitle>\n </CardHeader>\n <CardContent>\n <div className=\"text-2xl font-bold text-red-700 dark:text-red-300\">\n {isLoading ? '...' : data?.summary.breached_count || 0}\n </div>\n </CardContent>\n </Card>\n </div>\n\n {/* Assignments List */}\n <div className=\"space-y-4\">\n <h2 className=\"text-xl font-semibold\">Active Assignments</h2>\n {isLoading ? (\n <Card>\n <CardContent className=\"p-6 text-center text-muted-foreground\">\n Loading assignments...\n </CardContent>\n </Card>\n ) : data?.assignments && data.assignments.length > 0 ? (\n data.assignments.map((assignment) => (\n <Card\n key={assignment.id}\n className=\"cursor-pointer transition-shadow hover:shadow-md\"\n onClick={() => handleAssignmentClick(assignment)}\n >\n <CardContent className=\"p-6\">\n <div className=\"flex items-start justify-between\">\n <div className=\"flex-1\">\n <div className=\"mb-2 flex items-center gap-2\">\n <Badge className={getPriorityColor(assignment.priority)}>\n {assignment.priority}\n </Badge>\n <Badge variant=\"outline\">{assignment.work_item_type}</Badge>\n {assignment.escalated_at && (\n <Badge variant=\"destructive\">Escalated</Badge>\n )}\n </div>\n <h3 className=\"mb-1 text-lg font-semibold\">\n {assignment.work_item_title || assignment.work_item_id}\n </h3>\n <p className=\"mt-1 text-sm text-muted-foreground\">\n Assigned: {new Date(assignment.assigned_at).toLocaleString()}\n </p>\n </div>\n <div className=\"text-end\">\n <div className=\"flex items-center justify-end gap-2\">\n <Clock className={`size-4 ${\n assignment.time_remaining_seconds < 0 ? 'text-red-500' :\n assignment.warning_sent_at ? 'text-yellow-500' :\n 'text-green-500'\n }`} />\n <span className={`font-semibold ${\n assignment.time_remaining_seconds < 0 ? 'text-red-500' :\n assignment.warning_sent_at ? 'text-yellow-500' :\n 'text-green-500'\n }`}>\n {formatTimeRemaining(assignment.time_remaining_seconds)}\n </span>\n </div>\n <p className=\"mt-1 text-xs text-muted-foreground\">\n Due: {new Date(assignment.sla_deadline).toLocaleString()}\n </p>\n </div>\n </div>\n </CardContent>\n </Card>\n ))\n ) : (\n <Card>\n <CardContent className=\"p-6 text-center text-muted-foreground\">\n <CheckCircle2 className=\"mx-auto mb-2 size-12 text-green-500\" />\n <p>No active assignments</p>\n </CardContent>\n </Card>\n )}\n </div>\n </div>\n )\n}\n"],"names":["supabase","createClient","useMyAssignments","options","useQuery","params","data","error","MyAssignmentsPage","useTranslation","navigate","useNavigate","isLoading","handleAssignmentClick","assignment","formatTimeRemaining","seconds","hours","minutes","getPriorityColor","priority","colors","jsxs","Alert","jsx","AlertCircle","AlertDescription","Card","CardHeader","CardTitle","CardContent","Badge","Clock","CheckCircle2"],"mappings":"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"}