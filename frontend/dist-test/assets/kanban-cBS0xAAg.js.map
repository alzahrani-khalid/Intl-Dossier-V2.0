{"version":3,"file":"kanban-cBS0xAAg.js","sources":["../../src/components/unified-kanban/utils/swimlane-utils.ts","../../src/components/unified-kanban/utils/wip-limits.ts","../../src/hooks/useBulkKanbanOperations.ts","../../src/components/unified-kanban/EnhancedKanbanBoard.tsx","../../src/routes/_protected/kanban.tsx?tsr-split=component"],"sourcesContent":["/**\n * Swimlane Utilities for Unified Kanban Board\n * Feature: kanban-task-board\n *\n * Provides utilities for grouping work items into swimlanes\n * by assignee or priority.\n */\n\nimport type { WorkItem, SwimlaneMode, Swimlane, Priority } from '@/types/work-item.types'\n\n/**\n * Priority display info\n */\nconst PRIORITY_INFO: Record<Priority, { title: string; titleAr: string }> = {\n  urgent: { title: 'Urgent', titleAr: 'عاجل' },\n  high: { title: 'High Priority', titleAr: 'أولوية عالية' },\n  medium: { title: 'Medium Priority', titleAr: 'أولوية متوسطة' },\n  low: { title: 'Low Priority', titleAr: 'أولوية منخفضة' },\n}\n\n/**\n * Group items into swimlanes based on the selected mode\n */\nexport function groupIntoSwimlanes(\n  items: WorkItem[],\n  mode: SwimlaneMode,\n): Swimlane[] {\n  if (mode === 'none') {\n    return []\n  }\n\n  if (mode === 'assignee') {\n    return groupByAssignee(items)\n  }\n\n  if (mode === 'priority') {\n    return groupByPriority(items)\n  }\n\n  return []\n}\n\n/**\n * Group items by assignee\n */\nfunction groupByAssignee(items: WorkItem[]): Swimlane[] {\n  const grouped = new Map<string, WorkItem[]>()\n  const unassigned: WorkItem[] = []\n\n  items.forEach((item) => {\n    if (item.assignee) {\n      const key = item.assignee.id\n      if (!grouped.has(key)) {\n        grouped.set(key, [])\n      }\n      grouped.get(key)!.push(item)\n    } else {\n      unassigned.push(item)\n    }\n  })\n\n  const swimlanes: Swimlane[] = []\n\n  // Add assignee swimlanes sorted by name\n  const sortedEntries = Array.from(grouped.entries()).sort((a, b) => {\n    const nameA = items.find((i) => i.assignee?.id === a[0])?.assignee?.name || ''\n    const nameB = items.find((i) => i.assignee?.id === b[0])?.assignee?.name || ''\n    return nameA.localeCompare(nameB)\n  })\n\n  sortedEntries.forEach(([assigneeId, assigneeItems]) => {\n    const firstItem = assigneeItems[0]\n    if (!firstItem || !firstItem.assignee) return\n    const assignee = firstItem.assignee\n    swimlanes.push({\n      id: assigneeId,\n      title: assignee.name,\n      titleAr: assignee.name_ar,\n      items: assigneeItems,\n      collapsed: false,\n    })\n  })\n\n  // Add unassigned swimlane at the end\n  if (unassigned.length > 0) {\n    swimlanes.push({\n      id: 'unassigned',\n      title: 'Unassigned',\n      titleAr: 'غير مسند',\n      items: unassigned,\n      collapsed: false,\n    })\n  }\n\n  return swimlanes\n}\n\n/**\n * Group items by priority\n */\nfunction groupByPriority(items: WorkItem[]): Swimlane[] {\n  const grouped = new Map<Priority, WorkItem[]>()\n\n  // Initialize all priority groups\n  const priorities: Priority[] = ['urgent', 'high', 'medium', 'low']\n  priorities.forEach((p) => grouped.set(p, []))\n\n  items.forEach((item) => {\n    const priority = item.priority || 'medium'\n    grouped.get(priority)!.push(item)\n  })\n\n  const swimlanes: Swimlane[] = []\n\n  // Add swimlanes in priority order\n  priorities.forEach((priority) => {\n    const priorityItems = grouped.get(priority)!\n    if (priorityItems.length > 0) {\n      swimlanes.push({\n        id: priority,\n        title: PRIORITY_INFO[priority].title,\n        titleAr: PRIORITY_INFO[priority].titleAr,\n        items: priorityItems,\n        collapsed: false,\n      })\n    }\n  })\n\n  return swimlanes\n}\n\n/**\n * Get items for a specific swimlane and column\n */\nexport function getSwimlanColumnItems(\n  swimlane: Swimlane,\n  columnKey: string,\n): WorkItem[] {\n  return swimlane.items.filter((item) => item.column_key === columnKey)\n}\n\n/**\n * Get swimlane color based on priority (for priority swimlanes)\n */\nexport function getSwimlaneColor(swimlaneId: string): string {\n  switch (swimlaneId) {\n    case 'urgent':\n      return 'border-s-red-500'\n    case 'high':\n      return 'border-s-orange-500'\n    case 'medium':\n      return 'border-s-yellow-500'\n    case 'low':\n      return 'border-s-slate-400'\n    default:\n      return 'border-s-blue-500'\n  }\n}\n\n/**\n * Get swimlane background color\n */\nexport function getSwimlaneBackground(swimlaneId: string): string {\n  switch (swimlaneId) {\n    case 'urgent':\n      return 'bg-red-50/50'\n    case 'high':\n      return 'bg-orange-50/50'\n    case 'medium':\n      return 'bg-yellow-50/50'\n    case 'low':\n      return 'bg-slate-50/50'\n    case 'unassigned':\n      return 'bg-muted/30'\n    default:\n      return 'bg-background'\n  }\n}\n","/**\n * WIP (Work In Progress) Limits Utilities\n * Feature: kanban-task-board\n *\n * Provides utilities for managing and validating WIP limits\n * on Kanban board columns.\n */\n\nimport type { WorkItem, WipLimits } from '@/types/work-item.types'\n\n/**\n * WIP limit status\n */\nexport interface WipStatus {\n  current: number\n  limit: number | null\n  isAtLimit: boolean\n  isOverLimit: boolean\n  percentage: number\n}\n\n/**\n * Check if a column is at or over its WIP limit\n */\nexport function checkWipLimit(\n  columnKey: string,\n  itemCount: number,\n  wipLimits: WipLimits,\n): WipStatus {\n  const limit = wipLimits[columnKey]\n\n  if (limit === undefined || limit === null || limit <= 0) {\n    return {\n      current: itemCount,\n      limit: null,\n      isAtLimit: false,\n      isOverLimit: false,\n      percentage: 0,\n    }\n  }\n\n  return {\n    current: itemCount,\n    limit,\n    isAtLimit: itemCount >= limit,\n    isOverLimit: itemCount > limit,\n    percentage: Math.min(100, Math.round((itemCount / limit) * 100)),\n  }\n}\n\n/**\n * Check if adding an item to a column would exceed the WIP limit\n */\nexport function wouldExceedWipLimit(\n  columnKey: string,\n  currentCount: number,\n  wipLimits: WipLimits,\n): boolean {\n  const limit = wipLimits[columnKey]\n  if (limit === undefined || limit === null || limit <= 0) {\n    return false\n  }\n  return currentCount >= limit\n}\n\n/**\n * Get WIP limit warning level\n */\nexport type WipWarningLevel = 'none' | 'approaching' | 'at_limit' | 'over_limit'\n\nexport function getWipWarningLevel(status: WipStatus): WipWarningLevel {\n  if (status.limit === null) return 'none'\n  if (status.isOverLimit) return 'over_limit'\n  if (status.isAtLimit) return 'at_limit'\n  if (status.percentage >= 80) return 'approaching'\n  return 'none'\n}\n\n/**\n * Get WIP indicator color classes\n */\nexport function getWipIndicatorColor(level: WipWarningLevel): string {\n  switch (level) {\n    case 'over_limit':\n      return 'text-red-600 bg-red-100'\n    case 'at_limit':\n      return 'text-amber-600 bg-amber-100'\n    case 'approaching':\n      return 'text-yellow-600 bg-yellow-100'\n    default:\n      return 'text-muted-foreground bg-muted'\n  }\n}\n\n/**\n * Get WIP progress bar color\n */\nexport function getWipProgressColor(level: WipWarningLevel): string {\n  switch (level) {\n    case 'over_limit':\n      return 'bg-red-500'\n    case 'at_limit':\n      return 'bg-amber-500'\n    case 'approaching':\n      return 'bg-yellow-500'\n    default:\n      return 'bg-primary'\n  }\n}\n\n/**\n * Calculate WIP statistics for all columns\n */\nexport function calculateColumnWipStats(\n  columns: Record<string, WorkItem[]>,\n  wipLimits: WipLimits,\n): Record<string, WipStatus> {\n  const stats: Record<string, WipStatus> = {}\n\n  Object.entries(columns).forEach(([columnKey, items]) => {\n    stats[columnKey] = checkWipLimit(columnKey, items.length, wipLimits)\n  })\n\n  return stats\n}\n\n/**\n * Get columns that are at or over WIP limit\n */\nexport function getColumnsOverWip(\n  columns: Record<string, WorkItem[]>,\n  wipLimits: WipLimits,\n): string[] {\n  return Object.entries(columns)\n    .filter(([columnKey, items]) => {\n      const status = checkWipLimit(columnKey, items.length, wipLimits)\n      return status.isAtLimit || status.isOverLimit\n    })\n    .map(([columnKey]) => columnKey)\n}\n","/**\n * useBulkKanbanOperations - Hook for bulk operations on Kanban items\n * Feature: kanban-task-board\n *\n * Provides:\n * - Multi-select functionality\n * - Bulk move operations\n * - Bulk assign operations\n * - Bulk priority updates\n */\n\nimport { useState, useCallback, useMemo } from 'react'\nimport { useMutation, useQueryClient } from '@tanstack/react-query'\nimport { supabase } from '@/lib/supabase'\nimport { useToast } from '@/hooks/use-toast'\nimport { kanbanKeys } from '@/hooks/useUnifiedKanban'\nimport type {\n  WorkItem,\n  WorkSource,\n  SelectionState,\n  Priority,\n} from '@/types/work-item.types'\n\ninterface BulkMoveParams {\n  itemIds: string[]\n  targetColumn: string\n  items: WorkItem[]\n}\n\ninterface BulkAssignParams {\n  itemIds: string[]\n  assigneeId: string | null\n  items: WorkItem[]\n}\n\ninterface BulkPriorityParams {\n  itemIds: string[]\n  priority: Priority\n  items: WorkItem[]\n}\n\n/**\n * Hook for managing item selection state\n */\nexport function useKanbanSelection(items: WorkItem[]) {\n  const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set())\n  const [isSelecting, setIsSelecting] = useState(false)\n  const [lastSelectedId, setLastSelectedId] = useState<string | null>(null)\n\n  const toggleSelection = useCallback((itemId: string, shiftKey = false) => {\n    setSelectedIds((prev) => {\n      const next = new Set(prev)\n\n      if (shiftKey && lastSelectedId) {\n        // Range selection\n        const allIds = items.map((i) => i.id)\n        const startIndex = allIds.indexOf(lastSelectedId)\n        const endIndex = allIds.indexOf(itemId)\n\n        if (startIndex !== -1 && endIndex !== -1) {\n          const [from, to] = startIndex < endIndex\n            ? [startIndex, endIndex]\n            : [endIndex, startIndex]\n\n          for (let i = from; i <= to; i++) {\n            const id = allIds[i]\n            if (id) next.add(id)\n          }\n        }\n      } else {\n        // Toggle single item\n        if (next.has(itemId)) {\n          next.delete(itemId)\n        } else {\n          next.add(itemId)\n        }\n      }\n\n      return next\n    })\n\n    setLastSelectedId(itemId)\n  }, [items, lastSelectedId])\n\n  const selectAll = useCallback(() => {\n    setSelectedIds(new Set(items.map((i) => i.id)))\n  }, [items])\n\n  const clearSelection = useCallback(() => {\n    setSelectedIds(new Set())\n    setLastSelectedId(null)\n  }, [])\n\n  const selectByColumn = useCallback((columnKey: string) => {\n    const columnItems = items.filter((i) => i.column_key === columnKey)\n    setSelectedIds(new Set(columnItems.map((i) => i.id)))\n  }, [items])\n\n  const toggleSelectMode = useCallback(() => {\n    setIsSelecting((prev) => {\n      if (prev) {\n        // Exiting select mode, clear selection\n        setSelectedIds(new Set())\n        setLastSelectedId(null)\n      }\n      return !prev\n    })\n  }, [])\n\n  const selectedItems = useMemo(() => {\n    return items.filter((i) => selectedIds.has(i.id))\n  }, [items, selectedIds])\n\n  const selectionState: SelectionState = {\n    selectedIds,\n    isSelecting,\n    lastSelectedId,\n  }\n\n  return {\n    selectionState,\n    selectedItems,\n    selectedCount: selectedIds.size,\n    toggleSelection,\n    selectAll,\n    clearSelection,\n    selectByColumn,\n    toggleSelectMode,\n    isSelected: (id: string) => selectedIds.has(id),\n  }\n}\n\n/**\n * Hook for bulk move operations\n */\nexport function useBulkMove() {\n  const queryClient = useQueryClient()\n  const { toast } = useToast()\n\n  return useMutation({\n    mutationFn: async ({ itemIds, targetColumn, items }: BulkMoveParams) => {\n      const results = await Promise.allSettled(\n        itemIds.map(async (itemId) => {\n          const item = items.find((i) => i.id === itemId)\n          if (!item) throw new Error(`Item ${itemId} not found`)\n\n          const table = getTableForSource(item.source)\n          const updateData = getUpdateDataForMove(item.source, targetColumn)\n\n          const { error } = await supabase\n            .from(table)\n            .update(updateData)\n            .eq('id', itemId)\n\n          if (error) throw error\n          return { itemId, success: true }\n        }),\n      )\n\n      const succeeded = results.filter((r) => r.status === 'fulfilled').length\n      const failed = results.filter((r) => r.status === 'rejected').length\n\n      return { succeeded, failed, total: itemIds.length }\n    },\n\n    onSuccess: ({ succeeded, failed, total }) => {\n      queryClient.invalidateQueries({ queryKey: kanbanKeys.all })\n\n      if (failed === 0) {\n        toast({\n          title: 'Items moved successfully',\n          description: `Moved ${succeeded} item${succeeded > 1 ? 's' : ''} to the new column.`,\n        })\n      } else {\n        toast({\n          title: 'Partial success',\n          description: `Moved ${succeeded} of ${total} items. ${failed} failed.`,\n          variant: 'destructive',\n        })\n      }\n    },\n\n    onError: (error) => {\n      toast({\n        title: 'Failed to move items',\n        description: error instanceof Error ? error.message : 'Unknown error',\n        variant: 'destructive',\n      })\n    },\n  })\n}\n\n/**\n * Hook for bulk assign operations\n */\nexport function useBulkAssign() {\n  const queryClient = useQueryClient()\n  const { toast } = useToast()\n\n  return useMutation({\n    mutationFn: async ({ itemIds, assigneeId, items }: BulkAssignParams) => {\n      const results = await Promise.allSettled(\n        itemIds.map(async (itemId) => {\n          const item = items.find((i) => i.id === itemId)\n          if (!item) throw new Error(`Item ${itemId} not found`)\n\n          const table = getTableForSource(item.source)\n          const assigneeField = getAssigneeFieldForSource(item.source)\n\n          const { error } = await supabase\n            .from(table)\n            .update({\n              [assigneeField]: assigneeId,\n              updated_at: new Date().toISOString(),\n            })\n            .eq('id', itemId)\n\n          if (error) throw error\n          return { itemId, success: true }\n        }),\n      )\n\n      const succeeded = results.filter((r) => r.status === 'fulfilled').length\n      const failed = results.filter((r) => r.status === 'rejected').length\n\n      return { succeeded, failed, total: itemIds.length }\n    },\n\n    onSuccess: ({ succeeded, failed, total }) => {\n      queryClient.invalidateQueries({ queryKey: kanbanKeys.all })\n\n      if (failed === 0) {\n        toast({\n          title: 'Items assigned successfully',\n          description: `Assigned ${succeeded} item${succeeded > 1 ? 's' : ''}.`,\n        })\n      } else {\n        toast({\n          title: 'Partial success',\n          description: `Assigned ${succeeded} of ${total} items. ${failed} failed.`,\n          variant: 'destructive',\n        })\n      }\n    },\n\n    onError: (error) => {\n      toast({\n        title: 'Failed to assign items',\n        description: error instanceof Error ? error.message : 'Unknown error',\n        variant: 'destructive',\n      })\n    },\n  })\n}\n\n/**\n * Hook for bulk priority updates\n */\nexport function useBulkPriority() {\n  const queryClient = useQueryClient()\n  const { toast } = useToast()\n\n  return useMutation({\n    mutationFn: async ({ itemIds, priority, items }: BulkPriorityParams) => {\n      const results = await Promise.allSettled(\n        itemIds.map(async (itemId) => {\n          const item = items.find((i) => i.id === itemId)\n          if (!item) throw new Error(`Item ${itemId} not found`)\n\n          const table = getTableForSource(item.source)\n\n          const { error } = await supabase\n            .from(table)\n            .update({\n              priority,\n              updated_at: new Date().toISOString(),\n            })\n            .eq('id', itemId)\n\n          if (error) throw error\n          return { itemId, success: true }\n        }),\n      )\n\n      const succeeded = results.filter((r) => r.status === 'fulfilled').length\n      const failed = results.filter((r) => r.status === 'rejected').length\n\n      return { succeeded, failed, total: itemIds.length }\n    },\n\n    onSuccess: ({ succeeded, failed, total }) => {\n      queryClient.invalidateQueries({ queryKey: kanbanKeys.all })\n\n      if (failed === 0) {\n        toast({\n          title: 'Priority updated successfully',\n          description: `Updated priority for ${succeeded} item${succeeded > 1 ? 's' : ''}.`,\n        })\n      } else {\n        toast({\n          title: 'Partial success',\n          description: `Updated ${succeeded} of ${total} items. ${failed} failed.`,\n          variant: 'destructive',\n        })\n      }\n    },\n\n    onError: (error) => {\n      toast({\n        title: 'Failed to update priority',\n        description: error instanceof Error ? error.message : 'Unknown error',\n        variant: 'destructive',\n      })\n    },\n  })\n}\n\n/**\n * Combined hook for all bulk operations\n */\nexport function useBulkKanbanOperations(items: WorkItem[]) {\n  const selection = useKanbanSelection(items)\n  const bulkMove = useBulkMove()\n  const bulkAssign = useBulkAssign()\n  const bulkPriority = useBulkPriority()\n\n  const moveSelected = useCallback(\n    async (targetColumn: string) => {\n      if (selection.selectedCount === 0) return\n      await bulkMove.mutateAsync({\n        itemIds: Array.from(selection.selectionState.selectedIds),\n        targetColumn,\n        items,\n      })\n      selection.clearSelection()\n    },\n    [selection, bulkMove, items],\n  )\n\n  const assignSelected = useCallback(\n    async (assigneeId: string | null) => {\n      if (selection.selectedCount === 0) return\n      await bulkAssign.mutateAsync({\n        itemIds: Array.from(selection.selectionState.selectedIds),\n        assigneeId,\n        items,\n      })\n      selection.clearSelection()\n    },\n    [selection, bulkAssign, items],\n  )\n\n  const updatePrioritySelected = useCallback(\n    async (priority: Priority) => {\n      if (selection.selectedCount === 0) return\n      await bulkPriority.mutateAsync({\n        itemIds: Array.from(selection.selectionState.selectedIds),\n        priority,\n        items,\n      })\n      selection.clearSelection()\n    },\n    [selection, bulkPriority, items],\n  )\n\n  return {\n    ...selection,\n    moveSelected,\n    assignSelected,\n    updatePrioritySelected,\n    isLoading: bulkMove.isPending || bulkAssign.isPending || bulkPriority.isPending,\n  }\n}\n\n// Helper functions\n\nfunction getTableForSource(source: WorkSource): string {\n  switch (source) {\n    case 'task':\n      return 'tasks'\n    case 'commitment':\n      return 'aa_commitments'\n    case 'intake':\n      return 'intake_tickets'\n    default:\n      throw new Error(`Unknown source: ${source}`)\n  }\n}\n\nfunction getAssigneeFieldForSource(source: WorkSource): string {\n  switch (source) {\n    case 'task':\n      return 'assignee_id'\n    case 'commitment':\n      return 'owner_user_id'\n    case 'intake':\n      return 'assigned_to'\n    default:\n      throw new Error(`Unknown source: ${source}`)\n  }\n}\n\nfunction getUpdateDataForMove(\n  source: WorkSource,\n  targetColumn: string,\n): Record<string, unknown> {\n  const baseUpdate = {\n    updated_at: new Date().toISOString(),\n  }\n\n  if (source === 'task') {\n    // Tasks use workflow_stage\n    const statusMap: Record<string, { status: string; workflow_stage: string }> = {\n      todo: { status: 'pending', workflow_stage: 'todo' },\n      in_progress: { status: 'in_progress', workflow_stage: 'in_progress' },\n      review: { status: 'in_progress', workflow_stage: 'review' },\n      done: { status: 'completed', workflow_stage: 'done' },\n      cancelled: { status: 'cancelled', workflow_stage: 'cancelled' },\n    }\n    return { ...baseUpdate, ...statusMap[targetColumn] }\n  }\n\n  if (source === 'commitment') {\n    const statusMap: Record<string, string> = {\n      todo: 'pending',\n      in_progress: 'in_progress',\n      done: 'completed',\n      cancelled: 'cancelled',\n    }\n    return { ...baseUpdate, status: statusMap[targetColumn] || 'pending' }\n  }\n\n  if (source === 'intake') {\n    const statusMap: Record<string, string> = {\n      todo: 'pending',\n      in_progress: 'in_progress',\n      done: 'resolved',\n      cancelled: 'closed',\n    }\n    return { ...baseUpdate, status: statusMap[targetColumn] || 'pending' }\n  }\n\n  return baseUpdate\n}\n","/**\n * EnhancedKanbanBoard - Full-featured Kanban board\n * Feature: kanban-task-board\n *\n * Enhanced features:\n * - Swimlanes (by assignee or priority)\n * - WIP (Work In Progress) limits with warnings\n * - Bulk operations (multi-select, bulk move, bulk assign)\n * - Real-time collaboration\n * - Mobile-first responsive design\n * - RTL support for Arabic\n */\n\nimport { useState, useCallback, useMemo } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport type { UniqueIdentifier } from '@dnd-kit/core'\nimport {\n  ChevronDown,\n  ChevronUp,\n  CheckSquare,\n  X,\n  Move,\n  UserPlus,\n  Signal,\n  AlertTriangle,\n  Users,\n} from 'lucide-react'\nimport { cn } from '@/lib/utils'\nimport { useToast } from '@/hooks/use-toast'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { Checkbox } from '@/components/ui/checkbox'\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select'\nimport {\n  KanbanProvider,\n  KanbanBoard,\n  KanbanColumn,\n  KanbanCard,\n  KanbanEmpty,\n  type KanbanColumn as KanbanColumnType,\n} from '@/components/ui/kanban'\nimport { UnifiedKanbanHeader } from './UnifiedKanbanHeader'\nimport { UnifiedKanbanCardContent, UnifiedKanbanCardSkeleton } from './UnifiedKanbanCard'\nimport { getColumnsForMode, getColumnOrder } from './utils/column-definitions'\nimport { groupIntoSwimlanes, getSwimlaneColor, getSwimlaneBackground } from './utils/swimlane-utils'\nimport {\n  checkWipLimit,\n  getWipWarningLevel,\n  getWipIndicatorColor,\n  getWipProgressColor,\n} from './utils/wip-limits'\nimport {\n  canDropInColumn,\n  getTransitionErrorMessage,\n  getUpdatePayload,\n} from './utils/status-transitions'\nimport { useBulkKanbanOperations } from '@/hooks/useBulkKanbanOperations'\nimport type {\n  WorkItem,\n  KanbanColumnMode,\n  WorkSource,\n  KanbanColumn as ColumnDefinition,\n  SwimlaneMode,\n  WipLimits,\n  Swimlane,\n  Priority,\n} from '@/types/work-item.types'\n\ninterface EnhancedBoardProps {\n  contextType: 'personal' | 'dossier' | 'engagement'\n  contextId?: string\n  columnMode?: KanbanColumnMode\n  sourceFilter?: WorkSource[]\n  showFilters?: boolean\n  showModeSwitch?: boolean\n  onItemClick?: (item: WorkItem) => void\n  className?: string\n  items?: WorkItem[]\n  isLoading?: boolean\n  isError?: boolean\n  onStatusChange?: (\n    itemId: string,\n    source: WorkSource,\n    newStatus: string,\n    workflowStage?: string,\n  ) => Promise<void>\n  onRefresh?: () => void\n  isRefreshing?: boolean\n  // Enhanced features\n  swimlaneMode?: SwimlaneMode\n  onSwimlaneChange?: (mode: SwimlaneMode) => void\n  wipLimits?: WipLimits\n  enableBulkOperations?: boolean\n  enableWipWarnings?: boolean\n  // Available assignees for bulk assign\n  availableAssignees?: Array<{ id: string; name: string; avatar_url?: string }>\n}\n\nexport function EnhancedKanbanBoard({\n  contextType: _contextType,\n  contextId: _contextId,\n  columnMode: initialColumnMode = 'status',\n  sourceFilter: initialSourceFilter = [],\n  showFilters = true,\n  showModeSwitch = true,\n  onItemClick,\n  className,\n  items = [],\n  isLoading = false,\n  isError = false,\n  onStatusChange,\n  onRefresh,\n  isRefreshing = false,\n  swimlaneMode: initialSwimlaneMode = 'none',\n  onSwimlaneChange,\n  wipLimits = { in_progress: 5, review: 3 },\n  enableBulkOperations = true,\n  enableWipWarnings = true,\n  availableAssignees = [],\n}: EnhancedBoardProps) {\n  const { t, i18n } = useTranslation('unified-kanban')\n  const isRTL = i18n.language === 'ar'\n  const { toast } = useToast()\n\n  // State\n  const [columnMode, setColumnMode] = useState<KanbanColumnMode>(initialColumnMode)\n  const [sourceFilter, setSourceFilter] = useState<WorkSource[]>(initialSourceFilter)\n  const [swimlaneMode, setSwimlaneMode] = useState<SwimlaneMode>(initialSwimlaneMode)\n  const [collapsedSwimlanes, setCollapsedSwimlanes] = useState<Set<string>>(new Set())\n\n  // Bulk operations\n  const bulkOps = useBulkKanbanOperations(items)\n\n  // Get column definitions\n  const columnDefinitions = useMemo(() => getColumnsForMode(columnMode), [columnMode])\n  const columnOrder = useMemo(() => getColumnOrder(columnMode, isRTL), [columnMode, isRTL])\n\n  // Filter items by source\n  const filteredItems = useMemo(() => {\n    if (sourceFilter.length === 0) return items\n    return items.filter((item) => sourceFilter.includes(item.source))\n  }, [items, sourceFilter])\n\n  // Map column_key from database to frontend column key\n  const mapColumnKey = (columnKey: string): string => {\n    if (columnKey === 'pending') return 'todo'\n    return columnKey\n  }\n\n  // Group items into swimlanes if enabled\n  const swimlanes = useMemo(() => {\n    if (swimlaneMode === 'none') return null\n    return groupIntoSwimlanes(filteredItems, swimlaneMode)\n  }, [filteredItems, swimlaneMode])\n\n  // Convert to kanban columns format\n  const kanbanColumns = useMemo((): KanbanColumnType<WorkItem>[] => {\n    return columnOrder.map((columnKey) => {\n      const columnDef = columnDefinitions.find((c) => c.key === columnKey) as ColumnDefinition\n      const columnItems = filteredItems.filter((item) => {\n        const itemColumnKey = mapColumnKey(item.column_key || 'todo')\n        return itemColumnKey === columnKey\n      })\n\n      return {\n        id: columnKey,\n        title: columnDef?.title || columnKey,\n        items: columnItems,\n      }\n    })\n  }, [columnOrder, columnDefinitions, filteredItems])\n\n  // Track columns state for DnD\n  const [columns, setColumns] = useState(kanbanColumns)\n\n  // Sync columns when kanbanColumns changes\n  useMemo(() => {\n    setColumns(kanbanColumns)\n  }, [kanbanColumns])\n\n  // Calculate counts\n  const totalCount = filteredItems.length\n  const overdueCount = filteredItems.filter((item) => item.is_overdue).length\n\n  // Handle swimlane toggle\n  const toggleSwimlane = useCallback((swimlaneId: string) => {\n    setCollapsedSwimlanes((prev) => {\n      const next = new Set(prev)\n      if (next.has(swimlaneId)) {\n        next.delete(swimlaneId)\n      } else {\n        next.add(swimlaneId)\n      }\n      return next\n    })\n  }, [])\n\n  // Handle swimlane mode change\n  const handleSwimlaneChange = useCallback((mode: SwimlaneMode) => {\n    setSwimlaneMode(mode)\n    onSwimlaneChange?.(mode)\n  }, [onSwimlaneChange])\n\n  // Handle drag end\n  const handleDragEnd = useCallback(\n    async (\n      itemId: UniqueIdentifier,\n      _sourceColumnId: UniqueIdentifier,\n      targetColumnId: UniqueIdentifier,\n    ) => {\n      if (!onStatusChange) return\n\n      const item = filteredItems.find((i) => i.id === itemId)\n      if (!item) return\n\n      const targetColumnKey = targetColumnId as string\n\n      // Check WIP limit\n      if (enableWipWarnings) {\n        const targetColumn = kanbanColumns.find((c) => c.id === targetColumnKey)\n        const wipStatus = checkWipLimit(targetColumnKey, targetColumn?.items.length || 0, wipLimits)\n        const warningLevel = getWipWarningLevel(wipStatus)\n\n        if (warningLevel === 'at_limit' || warningLevel === 'over_limit') {\n          toast({\n            title: t('wip.limitReached'),\n            description: t('wip.limitReachedDescription', {\n              column: targetColumnKey,\n              limit: wipStatus.limit,\n            }),\n            variant: 'destructive',\n          })\n        }\n      }\n\n      // Validate the transition\n      const canDrop = canDropInColumn(\n        item.source,\n        item.status,\n        item.workflow_stage,\n        targetColumnKey,\n      )\n\n      if (!canDrop) {\n        const errorMsg = getTransitionErrorMessage(\n          item.source,\n          item.column_key,\n          targetColumnKey,\n          isRTL ? 'ar' : 'en',\n        )\n\n        toast({\n          title: t('errors.invalidTransition', { column: targetColumnKey }),\n          description: errorMsg,\n          variant: 'destructive',\n        })\n\n        setColumns(kanbanColumns)\n        return\n      }\n\n      const { status, workflow_stage } = getUpdatePayload(item.source, targetColumnKey)\n\n      try {\n        await onStatusChange(item.id, item.source, status!, workflow_stage)\n        toast({\n          title: t('success.statusUpdated'),\n          description: t('success.statusUpdatedDescription'),\n        })\n      } catch (error) {\n        toast({\n          title: t('errors.updateFailed'),\n          description: t('errors.updateFailedDescription'),\n          variant: 'destructive',\n        })\n        setColumns(kanbanColumns)\n      }\n    },\n    [onStatusChange, filteredItems, isRTL, toast, t, kanbanColumns, enableWipWarnings, wipLimits],\n  )\n\n  // Handle item click\n  const handleItemClick = useCallback(\n    (item: WorkItem) => {\n      if (bulkOps.selectionState.isSelecting) {\n        bulkOps.toggleSelection(item.id)\n      } else if (onItemClick) {\n        onItemClick(item)\n      }\n    },\n    [onItemClick, bulkOps],\n  )\n\n  // Render overlay for dragging\n  const renderOverlay = useCallback((activeItem: WorkItem | null) => {\n    if (!activeItem) return null\n    return (\n      <div className=\"rounded-lg border bg-card p-3 shadow-lg cursor-grabbing min-w-[280px]\">\n        <UnifiedKanbanCardContent item={activeItem} />\n      </div>\n    )\n  }, [])\n\n  // Render WIP indicator\n  const renderWipIndicator = (columnKey: string, itemCount: number) => {\n    if (!enableWipWarnings) return null\n\n    const wipStatus = checkWipLimit(columnKey, itemCount, wipLimits)\n    if (wipStatus.limit === null) return null\n\n    const warningLevel = getWipWarningLevel(wipStatus)\n    const colorClass = getWipIndicatorColor(warningLevel)\n    const progressColor = getWipProgressColor(warningLevel)\n\n    return (\n      <div className=\"flex items-center gap-2\">\n        <div className=\"flex-1 h-1.5 bg-muted rounded-full overflow-hidden min-w-[40px]\">\n          <div\n            className={cn('h-full transition-all', progressColor)}\n            style={{ width: `${wipStatus.percentage}%` }}\n          />\n        </div>\n        <Badge variant=\"outline\" className={cn('text-[10px] px-1.5 py-0', colorClass)}>\n          {wipStatus.current}/{wipStatus.limit}\n        </Badge>\n        {(warningLevel === 'at_limit' || warningLevel === 'over_limit') && (\n          <AlertTriangle className=\"h-3.5 w-3.5 text-amber-500\" />\n        )}\n      </div>\n    )\n  }\n\n  // Render bulk action bar\n  const renderBulkActionBar = () => {\n    if (!enableBulkOperations) return null\n\n    return (\n      <div\n        className={cn(\n          'flex items-center gap-2 px-4 py-2 border-b bg-muted/50',\n          bulkOps.selectionState.isSelecting && 'bg-primary/5',\n        )}\n      >\n        <Button\n          variant={bulkOps.selectionState.isSelecting ? 'secondary' : 'outline'}\n          size=\"sm\"\n          onClick={bulkOps.toggleSelectMode}\n          className=\"gap-2\"\n        >\n          {bulkOps.selectionState.isSelecting ? (\n            <>\n              <X className=\"h-4 w-4\" />\n              {t('bulkActions.cancel')}\n            </>\n          ) : (\n            <>\n              <CheckSquare className=\"h-4 w-4\" />\n              {t('bulkActions.select')}\n            </>\n          )}\n        </Button>\n\n        {bulkOps.selectionState.isSelecting && (\n          <>\n            <Button variant=\"ghost\" size=\"sm\" onClick={bulkOps.selectAll}>\n              {t('bulkActions.selectAll')}\n            </Button>\n\n            {bulkOps.selectedCount > 0 && (\n              <>\n                <Badge variant=\"secondary\">{bulkOps.selectedCount} {t('bulkActions.selected')}</Badge>\n\n                <DropdownMenu>\n                  <DropdownMenuTrigger asChild>\n                    <Button variant=\"outline\" size=\"sm\" className=\"gap-2\">\n                      <Move className=\"h-4 w-4\" />\n                      {t('bulkActions.moveTo')}\n                    </Button>\n                  </DropdownMenuTrigger>\n                  <DropdownMenuContent>\n                    {columnDefinitions.map((col) => (\n                      <DropdownMenuItem\n                        key={col.key}\n                        onClick={() => bulkOps.moveSelected(col.key)}\n                      >\n                        {isRTL ? col.titleAr : col.title}\n                      </DropdownMenuItem>\n                    ))}\n                  </DropdownMenuContent>\n                </DropdownMenu>\n\n                {availableAssignees.length > 0 && (\n                  <DropdownMenu>\n                    <DropdownMenuTrigger asChild>\n                      <Button variant=\"outline\" size=\"sm\" className=\"gap-2\">\n                        <UserPlus className=\"h-4 w-4\" />\n                        {t('bulkActions.assign')}\n                      </Button>\n                    </DropdownMenuTrigger>\n                    <DropdownMenuContent>\n                      <DropdownMenuItem onClick={() => bulkOps.assignSelected(null)}>\n                        {t('bulkActions.unassign')}\n                      </DropdownMenuItem>\n                      <DropdownMenuSeparator />\n                      {availableAssignees.map((assignee) => (\n                        <DropdownMenuItem\n                          key={assignee.id}\n                          onClick={() => bulkOps.assignSelected(assignee.id)}\n                        >\n                          {assignee.name}\n                        </DropdownMenuItem>\n                      ))}\n                    </DropdownMenuContent>\n                  </DropdownMenu>\n                )}\n\n                <DropdownMenu>\n                  <DropdownMenuTrigger asChild>\n                    <Button variant=\"outline\" size=\"sm\" className=\"gap-2\">\n                      <Signal className=\"h-4 w-4\" />\n                      {t('bulkActions.priority')}\n                    </Button>\n                  </DropdownMenuTrigger>\n                  <DropdownMenuContent>\n                    {(['urgent', 'high', 'medium', 'low'] as Priority[]).map((priority) => (\n                      <DropdownMenuItem\n                        key={priority}\n                        onClick={() => bulkOps.updatePrioritySelected(priority)}\n                      >\n                        {t(`columns.${priority}`)}\n                      </DropdownMenuItem>\n                    ))}\n                  </DropdownMenuContent>\n                </DropdownMenu>\n\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={bulkOps.clearSelection}\n                  className=\"ms-auto\"\n                >\n                  {t('bulkActions.clearSelection')}\n                </Button>\n              </>\n            )}\n          </>\n        )}\n      </div>\n    )\n  }\n\n  // Render swimlane selector\n  const renderSwimlaneSelector = () => (\n    <div className=\"flex items-center gap-2 ms-4\">\n      <Users className=\"h-4 w-4 text-muted-foreground\" />\n      <Select value={swimlaneMode} onValueChange={(v) => handleSwimlaneChange(v as SwimlaneMode)}>\n        <SelectTrigger className=\"h-8 w-[140px]\">\n          <SelectValue />\n        </SelectTrigger>\n        <SelectContent>\n          <SelectItem value=\"none\">{t('swimlanes.none')}</SelectItem>\n          <SelectItem value=\"assignee\">{t('swimlanes.byAssignee')}</SelectItem>\n          <SelectItem value=\"priority\">{t('swimlanes.byPriority')}</SelectItem>\n        </SelectContent>\n      </Select>\n    </div>\n  )\n\n  // Render a single swimlane row\n  const renderSwimlane = (swimlane: Swimlane) => {\n    const isCollapsed = collapsedSwimlanes.has(swimlane.id)\n    const swimlaneItems = swimlane.items\n\n    return (\n      <div\n        key={swimlane.id}\n        className={cn(\n          'border rounded-lg mb-4',\n          getSwimlaneBackground(swimlane.id),\n          'border-s-4',\n          getSwimlaneColor(swimlane.id),\n        )}\n      >\n        {/* Swimlane header */}\n        <button\n          onClick={() => toggleSwimlane(swimlane.id)}\n          className={cn(\n            'flex items-center justify-between w-full px-4 py-2',\n            'hover:bg-muted/50 transition-colors',\n            'text-start',\n          )}\n        >\n          <div className=\"flex items-center gap-2\">\n            {isCollapsed ? (\n              <ChevronUp className={cn('h-4 w-4', isRTL && 'rotate-180')} />\n            ) : (\n              <ChevronDown className={cn('h-4 w-4', isRTL && 'rotate-180')} />\n            )}\n            <span className=\"font-medium\">\n              {isRTL && swimlane.titleAr ? swimlane.titleAr : swimlane.title}\n            </span>\n            <Badge variant=\"secondary\" className=\"text-xs\">\n              {swimlaneItems.length}\n            </Badge>\n          </div>\n        </button>\n\n        {/* Swimlane content */}\n        {!isCollapsed && (\n          <div className=\"px-2 pb-2 overflow-x-auto\">\n            <div className=\"flex gap-4 min-w-max\">\n              {columnOrder.map((columnKey) => {\n                const columnDef = columnDefinitions.find((c) => c.key === columnKey)\n                const columnItems = swimlaneItems.filter(\n                  (item) => mapColumnKey(item.column_key || 'todo') === columnKey,\n                )\n\n                return (\n                  <div\n                    key={columnKey}\n                    className=\"w-[280px] min-w-[280px] bg-card rounded-lg border p-2\"\n                  >\n                    <div className=\"flex items-center justify-between mb-2 px-2\">\n                      <span className=\"text-xs font-medium text-muted-foreground\">\n                        {isRTL && columnDef?.titleAr ? columnDef.titleAr : columnDef?.title}\n                      </span>\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        {columnItems.length}\n                      </Badge>\n                    </div>\n                    <div className=\"space-y-2 min-h-[100px]\">\n                      {columnItems.length === 0 ? (\n                        <div className=\"text-xs text-muted-foreground text-center py-4\">\n                          {t('empty.noItemsInColumn')}\n                        </div>\n                      ) : (\n                        columnItems.map((item) => (\n                          <div\n                            key={item.id}\n                            onClick={() => handleItemClick(item)}\n                            className={cn(\n                              'rounded-lg border bg-background p-2 cursor-pointer',\n                              'hover:shadow-sm transition-shadow',\n                              bulkOps.isSelected(item.id) && 'ring-2 ring-primary',\n                            )}\n                          >\n                            {bulkOps.selectionState.isSelecting && (\n                              <Checkbox\n                                checked={bulkOps.isSelected(item.id)}\n                                className=\"mb-2\"\n                              />\n                            )}\n                            <UnifiedKanbanCardContent item={item} showDragHandle={false} />\n                          </div>\n                        ))\n                      )}\n                    </div>\n                  </div>\n                )\n              })}\n            </div>\n          </div>\n        )}\n      </div>\n    )\n  }\n\n  // Error state\n  if (isError) {\n    return (\n      <div className=\"flex flex-col items-center justify-center h-96 text-center\">\n        <p className=\"text-lg text-muted-foreground mb-4\">{t('errors.loadFailed')}</p>\n        <p className=\"text-sm text-muted-foreground mb-4\">{t('errors.loadFailedDescription')}</p>\n        {onRefresh && (\n          <button onClick={onRefresh} className=\"text-primary hover:underline\">\n            {t('actions.retry')}\n          </button>\n        )}\n      </div>\n    )\n  }\n\n  return (\n    <div className={cn('flex flex-col h-full', className)} dir={isRTL ? 'rtl' : 'ltr'}>\n      {/* Header */}\n      <UnifiedKanbanHeader\n        columnMode={columnMode}\n        onColumnModeChange={setColumnMode}\n        sourceFilter={sourceFilter}\n        onSourceFilterChange={setSourceFilter}\n        showFilters={showFilters}\n        showModeSwitch={showModeSwitch}\n        showViewToggle={false}\n        isRefreshing={isRefreshing}\n        onRefresh={onRefresh}\n        totalCount={totalCount}\n        overdueCount={overdueCount}\n      />\n\n      {/* Swimlane selector */}\n      <div className=\"flex items-center px-4 py-2 border-b\">\n        {renderSwimlaneSelector()}\n      </div>\n\n      {/* Bulk action bar */}\n      {renderBulkActionBar()}\n\n      {/* Board content */}\n      <div\n        className={cn(\n          'flex-1 overflow-x-auto overflow-y-auto',\n          'px-4 sm:px-6 py-4',\n          'bg-muted/20',\n        )}\n      >\n        {isLoading ? (\n          <KanbanBoard id=\"loading\" data={[]}>\n            {[1, 2, 3, 4].map((i) => (\n              <div\n                key={i}\n                className=\"flex flex-col rounded-lg border bg-muted/30 w-full sm:w-[300px] sm:min-w-[300px] h-[500px]\"\n              >\n                <div className=\"flex items-center justify-between p-3 border-b bg-muted/50\">\n                  <div className=\"h-5 w-20 bg-muted rounded animate-pulse\" />\n                  <div className=\"h-5 w-6 bg-muted rounded-full animate-pulse\" />\n                </div>\n                <div className=\"flex-1 p-2 space-y-2\">\n                  <UnifiedKanbanCardSkeleton />\n                  <UnifiedKanbanCardSkeleton />\n                  <UnifiedKanbanCardSkeleton />\n                </div>\n              </div>\n            ))}\n          </KanbanBoard>\n        ) : swimlanes && swimlanes.length > 0 ? (\n          // Swimlane view\n          <div className=\"space-y-4\">\n            {swimlanes.map(renderSwimlane)}\n          </div>\n        ) : (\n          // Standard board view\n          <KanbanProvider<WorkItem>\n            columns={columns}\n            onColumnsChange={setColumns}\n            onDragEnd={handleDragEnd}\n            renderOverlay={renderOverlay}\n          >\n            <KanbanBoard id=\"enhanced-kanban\" data={filteredItems}>\n              {columnOrder.map((columnKey) => {\n                const columnDef = columnDefinitions.find(\n                  (c) => c.key === columnKey,\n                ) as ColumnDefinition\n                const column = columns.find((c) => c.id === columnKey)\n                const columnItems = column?.items || []\n\n                return (\n                  <KanbanColumn<WorkItem>\n                    key={columnKey}\n                    id={columnKey}\n                    title={columnDef?.title || columnKey}\n                    titleAr={columnDef?.titleAr}\n                    items={columnItems}\n                    isRTL={isRTL}\n                    className={columnDef?.bgColor}\n                    headerClassName={cn(columnDef?.bgColor, columnDef?.color)}\n                  >\n                    {/* WIP indicator */}\n                    {renderWipIndicator(columnKey, columnItems.length)}\n\n                    {columnItems.length === 0 ? (\n                      <KanbanEmpty\n                        message={t('empty.noItemsInColumn')}\n                        subMessage={t('empty.dragHere')}\n                      />\n                    ) : (\n                      columnItems.map((item) => (\n                        <KanbanCard\n                          key={item.id}\n                          id={item.id}\n                          onClick={() => handleItemClick(item)}\n                          className={cn(\n                            item.is_overdue ? 'border-red-200 bg-red-50/50' : '',\n                            bulkOps.isSelected(item.id) && 'ring-2 ring-primary',\n                          )}\n                        >\n                          {bulkOps.selectionState.isSelecting && (\n                            <div className=\"mb-2\">\n                              <Checkbox\n                                checked={bulkOps.isSelected(item.id)}\n                                onCheckedChange={() => bulkOps.toggleSelection(item.id)}\n                              />\n                            </div>\n                          )}\n                          <UnifiedKanbanCardContent item={item} />\n                        </KanbanCard>\n                      ))\n                    )}\n                  </KanbanColumn>\n                )\n              })}\n            </KanbanBoard>\n          </KanbanProvider>\n        )}\n      </div>\n\n      {/* Empty state */}\n      {!isLoading && filteredItems.length === 0 && (\n        <div className=\"absolute inset-0 flex flex-col items-center justify-center pointer-events-none\">\n          <div className=\"text-center p-8\">\n            <p className=\"text-lg font-medium text-muted-foreground mb-2\">{t('empty.noItems')}</p>\n            <p className=\"text-sm text-muted-foreground\">{t('empty.noItemsDescription')}</p>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","/**\n * Feature: kanban-task-board\n *\n * Full-featured Kanban Task Board with:\n * - Drag-and-drop between columns\n * - Swimlanes (by assignee or priority)\n * - WIP (Work In Progress) limits with warnings\n * - Bulk operations (multi-select, bulk move, bulk assign)\n * - Real-time collaboration\n * - Mobile-first responsive design\n * - RTL support for Arabic\n */\n\nimport { createFileRoute } from '@tanstack/react-router'\nimport { z } from 'zod'\nimport { useTranslation } from 'react-i18next'\nimport { useCallback, useMemo } from 'react'\nimport { useAuth } from '@/hooks/useAuth'\nimport {\n  useUnifiedKanban,\n  useUnifiedKanbanStatusUpdate,\n  useUnifiedKanbanRealtime,\n} from '@/hooks/useUnifiedKanban'\nimport { EnhancedKanbanBoard } from '@/components/unified-kanban'\nimport { Button } from '@/components/ui/button'\nimport { List } from 'lucide-react'\nimport type { KanbanColumnMode, WorkSource, WorkItem, SwimlaneMode, WipLimits } from '@/types/work-item.types'\n\n// URL search params schema\nconst kanbanSearchSchema = z.object({\n  mode: z.enum(['status', 'priority', 'tracking_type']).optional().default('status'),\n  sources: z\n    .string()\n    .optional()\n    .transform((val) => (val ? (val.split(',') as WorkSource[]) : undefined)),\n  swimlane: z.enum(['none', 'assignee', 'priority']).optional().default('none'),\n  wipInProgress: z.coerce.number().optional().default(5),\n  wipReview: z.coerce.number().optional().default(3),\n})\n\nexport type KanbanSearchParams = z.infer<typeof kanbanSearchSchema>\n\nexport const Route = createFileRoute('/_protected/kanban')({\n  component: KanbanTaskBoardPage,\n  validateSearch: (search) => kanbanSearchSchema.parse(search),\n})\n\nfunction KanbanTaskBoardPage() {\n  const { t, i18n } = useTranslation('unified-kanban')\n  const isRTL = i18n.language === 'ar'\n  const { user } = useAuth()\n  const { mode, sources, swimlane, wipInProgress, wipReview } = Route.useSearch()\n\n  // Parse sources from URL\n  const sourceFilter = sources as WorkSource[] | undefined\n\n  // Build WIP limits from URL params\n  const wipLimits: WipLimits = useMemo(() => ({\n    in_progress: wipInProgress,\n    review: wipReview,\n  }), [wipInProgress, wipReview])\n\n  // Fetch kanban data\n  const { items, isLoading, isError, refetch, isRefetching } =\n    useUnifiedKanban({\n      contextType: 'personal',\n      columnMode: mode as KanbanColumnMode,\n      sourceFilter,\n    })\n\n  // Status update mutation\n  const statusMutation = useUnifiedKanbanStatusUpdate()\n\n  // Real-time updates\n  useUnifiedKanbanRealtime('personal', null, user?.id || '', !!user)\n\n  // Handle swimlane mode change\n  const handleSwimlaneChange = useCallback(\n    (newSwimlane: SwimlaneMode) => {\n      const params = new URLSearchParams()\n      params.set('mode', mode)\n      params.set('swimlane', newSwimlane)\n      params.set('wipInProgress', String(wipInProgress))\n      params.set('wipReview', String(wipReview))\n      window.location.href = `/kanban?${params.toString()}`\n    },\n    [mode, wipInProgress, wipReview],\n  )\n\n  // Handle status change from drag and drop\n  const handleStatusChange = useCallback(\n    async (itemId: string, source: WorkSource, newStatus: string, workflowStage?: string) => {\n      await statusMutation.mutateAsync({\n        itemId,\n        source,\n        newStatus,\n        newWorkflowStage: workflowStage,\n      })\n    },\n    [statusMutation],\n  )\n\n  // Handle item click - navigate to detail page\n  const handleItemClick = useCallback(\n    (item: WorkItem) => {\n      switch (item.source) {\n        case 'task':\n          // Navigate using window.location for cross-route navigation\n          window.location.href = `/tasks/${item.id}`\n          break\n        case 'commitment':\n          window.location.href = '/commitments'\n          break\n        case 'intake':\n          window.location.href = `/intake/tickets/${item.id}`\n          break\n      }\n    },\n    [],\n  )\n\n  // Navigate to list view\n  const handleSwitchToList = useCallback(() => {\n    window.location.href = '/my-work'\n  }, [])\n\n  return (\n    <div className=\"flex flex-col h-full\" dir={isRTL ? 'rtl' : 'ltr'}>\n      {/* Top bar with view toggle */}\n      <div className=\"flex items-center justify-between px-4 sm:px-6 py-3 border-b bg-background\">\n        <div className=\"flex items-center gap-3\">\n          <h1 className=\"text-xl sm:text-2xl font-bold\">{t('title')}</h1>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={handleSwitchToList}\n            className=\"flex items-center gap-2\"\n          >\n            <List className=\"h-4 w-4\" />\n            <span className=\"hidden sm:inline\">{t('viewModes.list')}</span>\n          </Button>\n        </div>\n      </div>\n\n      {/* Kanban Board */}\n      <div className=\"flex-1 overflow-hidden\">\n        <EnhancedKanbanBoard\n          contextType=\"personal\"\n          columnMode={mode as KanbanColumnMode}\n          sourceFilter={sourceFilter}\n          items={items}\n          isLoading={isLoading}\n          isError={isError}\n          onStatusChange={handleStatusChange}\n          onItemClick={handleItemClick}\n          onRefresh={() => refetch()}\n          isRefreshing={isRefetching}\n          showFilters\n          showModeSwitch\n          swimlaneMode={swimlane as SwimlaneMode}\n          onSwimlaneChange={handleSwimlaneChange}\n          wipLimits={wipLimits}\n          enableBulkOperations\n          enableWipWarnings\n          className=\"h-full\"\n        />\n      </div>\n    </div>\n  )\n}\n"],"names":["PRIORITY_INFO","groupIntoSwimlanes","items","mode","groupByAssignee","groupByPriority","grouped","unassigned","item","key","swimlanes","a","b","nameA","i","nameB","assigneeId","assigneeItems","firstItem","assignee","priorities","p","priority","priorityItems","getSwimlaneColor","swimlaneId","getSwimlaneBackground","checkWipLimit","columnKey","itemCount","wipLimits","limit","getWipWarningLevel","status","getWipIndicatorColor","level","getWipProgressColor","useKanbanSelection","selectedIds","setSelectedIds","useState","isSelecting","setIsSelecting","lastSelectedId","setLastSelectedId","toggleSelection","useCallback","itemId","shiftKey","prev","next","allIds","startIndex","endIndex","from","to","id","selectAll","clearSelection","selectByColumn","columnItems","toggleSelectMode","selectedItems","useMemo","useBulkMove","queryClient","useQueryClient","toast","useToast","useMutation","itemIds","targetColumn","results","table","getTableForSource","updateData","getUpdateDataForMove","error","supabase","succeeded","r","failed","total","kanbanKeys","useBulkAssign","assigneeField","getAssigneeFieldForSource","useBulkPriority","useBulkKanbanOperations","selection","bulkMove","bulkAssign","bulkPriority","moveSelected","assignSelected","updatePrioritySelected","source","baseUpdate","EnhancedKanbanBoard","_contextType","_contextId","initialColumnMode","initialSourceFilter","showFilters","showModeSwitch","onItemClick","className","isLoading","isError","onStatusChange","onRefresh","isRefreshing","initialSwimlaneMode","onSwimlaneChange","enableBulkOperations","enableWipWarnings","availableAssignees","t","i18n","useTranslation","isRTL","columnMode","setColumnMode","sourceFilter","setSourceFilter","swimlaneMode","setSwimlaneMode","collapsedSwimlanes","setCollapsedSwimlanes","bulkOps","columnDefinitions","getColumnsForMode","columnOrder","getColumnOrder","filteredItems","mapColumnKey","kanbanColumns","columnDef","c","columns","setColumns","totalCount","overdueCount","toggleSwimlane","handleSwimlaneChange","handleDragEnd","_sourceColumnId","targetColumnId","targetColumnKey","wipStatus","warningLevel","canDropInColumn","errorMsg","getTransitionErrorMessage","workflow_stage","getUpdatePayload","handleItemClick","renderOverlay","activeItem","jsx","UnifiedKanbanCardContent","renderWipIndicator","colorClass","progressColor","jsxs","cn","Badge","AlertTriangle","renderBulkActionBar","Button","Fragment","X","CheckSquare","DropdownMenu","DropdownMenuTrigger","Move","DropdownMenuContent","col","DropdownMenuItem","UserPlus","DropdownMenuSeparator","Signal","renderSwimlaneSelector","Users","Select","v","SelectTrigger","SelectValue","SelectContent","SelectItem","renderSwimlane","swimlane","isCollapsed","swimlaneItems","ChevronUp","ChevronDown","Checkbox","UnifiedKanbanHeader","KanbanBoard","UnifiedKanbanCardSkeleton","KanbanProvider","KanbanColumn","KanbanEmpty","KanbanCard","z","optional","default","sources","string","transform","val","split","undefined","wipInProgress","number","wipReview","KanbanTaskBoardPage","language","user","useAuth","Route","useSearch","in_progress","review","refetch","isRefetching","useUnifiedKanban","contextType","statusMutation","useUnifiedKanbanStatusUpdate","useUnifiedKanbanRealtime","newSwimlane","params","URLSearchParams","set","String","window","location","href","toString","handleStatusChange","newStatus","workflowStage","mutateAsync","newWorkflowStage","handleSwitchToList","List"],"mappings":"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"}