{"version":3,"file":"create-C31XpbSG.js","sources":["../../src/components/contacts/BusinessCardScanner.tsx","../../src/components/contacts/DocumentExtractor.tsx","../../src/components/contacts/BatchContactReview.tsx","../../src/pages/contacts/ContactCreate.tsx","../../src/routes/_protected/contacts/create.tsx?tsr-split=component"],"sourcesContent":["/**\n * BusinessCardScanner Component\n * Part of: 027-contact-directory implementation - Phase 4 (Business Card Scanning)\n *\n * Mobile-first, RTL-ready business card scanner with camera and file upload support.\n * Features OCR processing indicator, consent checkbox, and extracted data preview.\n */\n\nimport React, { useState, useRef, useCallback } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Label } from '@/components/ui/label';\nimport { Progress } from '@/components/ui/progress';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Badge } from '@/components/ui/badge';\nimport { Camera, Upload, X, CheckCircle2, AlertCircle, Loader2 } from 'lucide-react';\nimport { useUploadBusinessCard, getConfidenceColor, getConfidenceLevel } from '@/hooks/useOCR';\nimport type { OCRParsedFields } from '@/services/ocr-api';\n\ninterface BusinessCardScannerProps {\n onExtracted: (fields: OCRParsedFields, confidence: number, rawText: string) => void;\n onCancel?: () => void;\n}\n\nexport function BusinessCardScanner({ onExtracted, onCancel }: BusinessCardScannerProps) {\n const { t, i18n } = useTranslation('contacts');\n const isRTL = i18n.language === 'ar';\n\n const [selectedFile, setSelectedFile] = useState<File | null>(null);\n const [previewUrl, setPreviewUrl] = useState<string | null>(null);\n const [consentCloudOCR, setConsentCloudOCR] = useState(false);\n const [showCamera, setShowCamera] = useState(false);\n const [cameraStream, setCameraStream] = useState<MediaStream | null>(null);\n\n const fileInputRef = useRef<HTMLInputElement>(null);\n const videoRef = useRef<HTMLVideoElement>(null);\n const canvasRef = useRef<HTMLCanvasElement>(null);\n\n const uploadMutation = useUploadBusinessCard();\n\n // Handle file selection from input\n const handleFileSelect = useCallback((event: React.ChangeEvent<HTMLInputElement>) => {\n const file = event.target.files?.[0];\n if (!file) return;\n\n // Validate file type\n const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/heic', 'image/heif'];\n if (!validTypes.includes(file.type.toLowerCase())) {\n alert(t('contactDirectory.ocr.invalid_file_type'));\n return;\n }\n\n // Validate file size (max 10MB)\n const maxSize = 10 * 1024 * 1024;\n if (file.size > maxSize) {\n alert(t('contactDirectory.ocr.file_too_large'));\n return;\n }\n\n setSelectedFile(file);\n\n // Create preview URL\n const url = URL.createObjectURL(file);\n setPreviewUrl(url);\n }, [t]);\n\n // Start camera\n const startCamera = useCallback(async () => {\n try {\n const stream = await navigator.mediaDevices.getUserMedia({\n video: { facingMode: 'environment', width: { ideal: 1920 }, height: { ideal: 1080 } },\n audio: false,\n });\n\n setCameraStream(stream);\n setShowCamera(true);\n\n // Set video stream\n if (videoRef.current) {\n videoRef.current.srcObject = stream;\n }\n } catch (error) {\n console.error('Camera error:', error);\n alert(t('contactDirectory.ocr.camera_error'));\n }\n }, [t]);\n\n // Stop camera\n const stopCamera = useCallback(() => {\n if (cameraStream) {\n cameraStream.getTracks().forEach((track) => track.stop());\n setCameraStream(null);\n }\n setShowCamera(false);\n }, [cameraStream]);\n\n // Capture photo from camera\n const capturePhoto = useCallback(() => {\n if (!videoRef.current || !canvasRef.current) return;\n\n const video = videoRef.current;\n const canvas = canvasRef.current;\n const context = canvas.getContext('2d');\n\n if (!context) return;\n\n // Set canvas dimensions to match video\n canvas.width = video.videoWidth;\n canvas.height = video.videoHeight;\n\n // Draw video frame to canvas\n context.drawImage(video, 0, 0, canvas.width, canvas.height);\n\n // Convert canvas to blob\n canvas.toBlob((blob) => {\n if (!blob) return;\n\n // Create file from blob\n const file = new File([blob], `business-card-${Date.now()}.jpg`, { type: 'image/jpeg' });\n setSelectedFile(file);\n\n // Create preview URL\n const url = URL.createObjectURL(blob);\n setPreviewUrl(url);\n\n // Stop camera\n stopCamera();\n }, 'image/jpeg', 0.95);\n }, [stopCamera]);\n\n // Clear selected file\n const clearFile = useCallback(() => {\n setSelectedFile(null);\n if (previewUrl) {\n URL.revokeObjectURL(previewUrl);\n setPreviewUrl(null);\n }\n if (fileInputRef.current) {\n fileInputRef.current.value = '';\n }\n }, [previewUrl]);\n\n // Process OCR\n const handleProcess = useCallback(async () => {\n if (!selectedFile) return;\n\n const result = await uploadMutation.mutateAsync({\n file: selectedFile,\n consentCloudOCR,\n });\n\n // Pass extracted data to parent\n onExtracted(result.normalized_fields, result.confidence, result.text);\n }, [selectedFile, consentCloudOCR, uploadMutation, onExtracted]);\n\n // Cleanup on unmount\n React.useEffect(() => {\n return () => {\n if (previewUrl) {\n URL.revokeObjectURL(previewUrl);\n }\n if (cameraStream) {\n cameraStream.getTracks().forEach((track) => track.stop());\n }\n };\n }, [previewUrl, cameraStream]);\n\n return (\n <div className=\"space-y-4 sm:space-y-6\" dir={isRTL ? 'rtl' : 'ltr'}>\n {/* Camera View */}\n {showCamera && (\n <Card>\n <CardContent className=\"p-4 sm:p-6\">\n <div className=\"relative\">\n <video\n ref={videoRef}\n autoPlay\n playsInline\n className=\"w-full rounded-lg\"\n />\n <div className=\"flex gap-3 mt-4 justify-center\">\n <Button\n type=\"button\"\n onClick={capturePhoto}\n className=\"h-11 px-6 sm:h-10\"\n >\n <Camera className={`h-4 w-4 ${isRTL ? 'ml-2' : 'mr-2'}`} />\n {t('contactDirectory.ocr.capture_photo')}\n </Button>\n <Button\n type=\"button\"\n variant=\"outline\"\n onClick={stopCamera}\n className=\"h-11 px-6 sm:h-10\"\n >\n {t('contactDirectory.ocr.cancel')}\n </Button>\n </div>\n </div>\n </CardContent>\n </Card>\n )}\n\n {/* File Selection / Preview */}\n {!showCamera && (\n <Card>\n <CardHeader>\n <CardTitle className=\"text-start\">{t('contactDirectory.ocr.scan_business_card')}</CardTitle>\n <CardDescription className=\"text-start\">\n {t('contactDirectory.ocr.scan_description')}\n </CardDescription>\n </CardHeader>\n <CardContent className=\"space-y-4\">\n {/* Preview */}\n {previewUrl && (\n <div className=\"relative\">\n <img\n src={previewUrl}\n alt=\"Business card preview\"\n className=\"w-full rounded-lg border\"\n />\n <Button\n type=\"button\"\n variant=\"destructive\"\n size=\"icon\"\n onClick={clearFile}\n className=\"absolute top-2 end-2 min-h-8 min-w-8\"\n >\n <X className=\"h-4 w-4\" />\n </Button>\n </div>\n )}\n\n {/* Upload Buttons */}\n {!previewUrl && (\n <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\n <Button\n type=\"button\"\n variant=\"outline\"\n onClick={startCamera}\n className=\"h-11 px-4 sm:h-10 sm:px-6\"\n >\n <Camera className={`h-4 w-4 ${isRTL ? 'ml-2' : 'mr-2'}`} />\n {t('contactDirectory.ocr.take_photo')}\n </Button>\n <Button\n type=\"button\"\n variant=\"outline\"\n onClick={() => fileInputRef.current?.click()}\n className=\"h-11 px-4 sm:h-10 sm:px-6\"\n >\n <Upload className={`h-4 w-4 ${isRTL ? 'ml-2' : 'mr-2'}`} />\n {t('contactDirectory.ocr.upload_image')}\n </Button>\n </div>\n )}\n\n {/* Hidden file input */}\n <input\n ref={fileInputRef}\n type=\"file\"\n accept=\"image/jpeg,image/jpg,image/png,image/heic,image/heif\"\n onChange={handleFileSelect}\n className=\"hidden\"\n />\n\n {/* Cloud OCR Consent */}\n {selectedFile && (\n <div className=\"space-y-4 pt-4 border-t\">\n <div className=\"flex items-start gap-3\">\n <Checkbox\n id=\"consent-cloud-ocr\"\n checked={consentCloudOCR}\n onCheckedChange={(checked) => setConsentCloudOCR(checked === true)}\n className=\"mt-1\"\n />\n <div className=\"flex-1\">\n <Label\n htmlFor=\"consent-cloud-ocr\"\n className=\"text-sm font-medium cursor-pointer text-start block\"\n >\n {t('contactDirectory.ocr.consent_cloud_ocr_title')}\n </Label>\n <p className=\"text-xs text-muted-foreground mt-1 text-start\">\n {t('contactDirectory.ocr.consent_cloud_ocr_description')}\n </p>\n </div>\n </div>\n\n {/* Processing Button */}\n <Button\n type=\"button\"\n onClick={handleProcess}\n disabled={uploadMutation.isPending}\n className=\"w-full h-11 sm:h-10\"\n >\n {uploadMutation.isPending && (\n <Loader2 className={`h-4 w-4 animate-spin ${isRTL ? 'ml-2' : 'mr-2'}`} />\n )}\n {t('contactDirectory.ocr.process_card')}\n </Button>\n\n {/* Processing Indicator */}\n {uploadMutation.isPending && (\n <div className=\"space-y-2\">\n <Progress value={undefined} className=\"h-2\" />\n <p className=\"text-xs text-center text-muted-foreground\">\n {t('contactDirectory.ocr.processing')}\n </p>\n </div>\n )}\n </div>\n )}\n </CardContent>\n </Card>\n )}\n\n {/* Canvas for photo capture (hidden) */}\n <canvas ref={canvasRef} className=\"hidden\" />\n\n {/* Info Alert */}\n <Alert>\n <AlertCircle className=\"h-4 w-4\" />\n <AlertDescription className=\"text-start text-sm\">\n {t('contactDirectory.ocr.info_alert')}\n </AlertDescription>\n </Alert>\n\n {/* Cancel Button */}\n {onCancel && (\n <div className=\"flex justify-end\">\n <Button\n type=\"button\"\n variant=\"ghost\"\n onClick={onCancel}\n disabled={uploadMutation.isPending}\n className=\"h-11 px-6 sm:h-10\"\n >\n {t('contactDirectory.ocr.back_to_manual')}\n </Button>\n </div>\n )}\n </div>\n );\n}\n","/**\n * DocumentExtractor Component\n * Part of: 027-contact-directory implementation - Phase 5 (Document Extraction)\n *\n * Mobile-first, RTL-ready document extractor for bulk contact import.\n * Features file upload, processing progress indicator, and extracted contacts preview.\n */\n\nimport React, { useState, useRef, useCallback, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Progress } from '@/components/ui/progress';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Badge } from '@/components/ui/badge';\nimport { Upload, X, CheckCircle2, AlertCircle, Loader2, FileText, Users } from 'lucide-react';\nimport { useUploadDocument, useDocumentStatus, getConfidenceColor } from '@/hooks/useOCR';\nimport type { ExtractedContact } from '@/services/ocr-api';\nimport type { Database } from '@/types/contact-directory.types';\n\ntype ContactInsert = Database['public']['Tables']['cd_contacts']['Insert'];\n\ninterface DocumentExtractorProps {\n onExtracted: (contacts: Partial<ContactInsert>[]) => void;\n onCancel?: () => void;\n}\n\nexport function DocumentExtractor({ onExtracted, onCancel }: DocumentExtractorProps) {\n const { t, i18n } = useTranslation('contacts');\n const isRTL = i18n.language === 'ar';\n\n const [selectedFile, setSelectedFile] = useState<File | null>(null);\n const [documentSourceId, setDocumentSourceId] = useState<string | null>(null);\n const [extractedContacts, setExtractedContacts] = useState<ExtractedContact[]>([]);\n const [processingComplete, setProcessingComplete] = useState(false);\n const [processingError, setProcessingError] = useState<string | null>(null);\n\n const fileInputRef = useRef<HTMLInputElement>(null);\n\n const uploadMutation = useUploadDocument();\n\n // Poll document status with automatic polling\n const { data: statusData, isLoading: isPolling } = useDocumentStatus(\n documentSourceId,\n {\n enabled: !!documentSourceId && !processingComplete && !processingError,\n onCompleted: (data) => {\n setProcessingComplete(true);\n if (data.extracted_contacts && data.extracted_contacts.length > 0) {\n setExtractedContacts(data.extracted_contacts);\n }\n },\n onFailed: (error) => {\n setProcessingError(error);\n },\n }\n );\n\n // Handle file selection from input\n const handleFileSelect = useCallback((event: React.ChangeEvent<HTMLInputElement>) => {\n const file = event.target.files?.[0];\n if (!file) return;\n\n // Validate file type\n const validExtensions = ['pdf', 'docx', 'doc', 'txt', 'csv', 'xls', 'xlsx'];\n const fileExtension = file.name.toLowerCase().split('.').pop();\n\n if (!fileExtension || !validExtensions.includes(fileExtension)) {\n alert(t('contactDirectory.documentExtraction.invalid_file_type'));\n return;\n }\n\n // Validate file size (max 50MB)\n const maxSize = 50 * 1024 * 1024;\n if (file.size > maxSize) {\n alert(t('contactDirectory.documentExtraction.file_too_large'));\n return;\n }\n\n setSelectedFile(file);\n }, [t]);\n\n // Clear selected file and reset state\n const clearFile = useCallback(() => {\n setSelectedFile(null);\n setDocumentSourceId(null);\n setExtractedContacts([]);\n setProcessingComplete(false);\n setProcessingError(null);\n if (fileInputRef.current) {\n fileInputRef.current.value = '';\n }\n }, []);\n\n // Upload and process document\n const handleUpload = useCallback(async () => {\n if (!selectedFile) return;\n\n try {\n const result = await uploadMutation.mutateAsync({ file: selectedFile });\n setDocumentSourceId(result.document_source_id);\n } catch (error) {\n console.error('Upload error:', error);\n }\n }, [selectedFile, uploadMutation]);\n\n // Handle continuing with extracted contacts\n const handleContinue = useCallback(() => {\n // Map extracted contacts to ContactInsert format\n const contacts: Partial<ContactInsert>[] = extractedContacts.map((contact) => ({\n full_name: contact.full_name,\n organization_id: undefined, // Will be set by user in review UI\n position: contact.position || undefined,\n email_addresses: contact.email_addresses || [],\n phone_numbers: contact.phone_numbers || [],\n source_type: 'document',\n ocr_confidence: contact.confidence,\n source_document_id: documentSourceId || undefined,\n }));\n\n onExtracted(contacts);\n }, [extractedContacts, documentSourceId, onExtracted]);\n\n // Get file icon based on extension\n const getFileIcon = (fileName: string) => {\n const ext = fileName.toLowerCase().split('.').pop();\n return <FileText className=\"h-8 w-8 text-muted-foreground\" />;\n };\n\n // Format file size for display\n const formatFileSize = (bytes: number): string => {\n if (bytes < 1024) return `${bytes} B`;\n if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n };\n\n const isProcessing = !!documentSourceId && !processingComplete && !processingError;\n\n return (\n <div className=\"space-y-4 sm:space-y-6\" dir={isRTL ? 'rtl' : 'ltr'}>\n {/* File Selection */}\n {!documentSourceId && (\n <Card>\n <CardHeader>\n <CardTitle className=\"text-start\">\n {t('contactDirectory.documentExtraction.title')}\n </CardTitle>\n <CardDescription className=\"text-start\">\n {t('contactDirectory.documentExtraction.description')}\n </CardDescription>\n </CardHeader>\n <CardContent className=\"space-y-4\">\n {/* File Preview */}\n {selectedFile && (\n <div className=\"border rounded-lg p-4 flex items-start gap-4\">\n <div className=\"flex-shrink-0\">\n {getFileIcon(selectedFile.name)}\n </div>\n <div className=\"flex-1 min-w-0\">\n <p className=\"text-sm font-medium truncate text-start\">{selectedFile.name}</p>\n <p className=\"text-xs text-muted-foreground text-start\">\n {formatFileSize(selectedFile.size)}\n </p>\n </div>\n <Button\n type=\"button\"\n variant=\"ghost\"\n size=\"icon\"\n onClick={clearFile}\n className=\"flex-shrink-0 min-h-8 min-w-8\"\n >\n <X className=\"h-4 w-4\" />\n </Button>\n </div>\n )}\n\n {/* Upload Button */}\n {!selectedFile && (\n <div\n className=\"border-2 border-dashed rounded-lg p-8 sm:p-12 text-center cursor-pointer hover:border-primary transition-colors\"\n onClick={() => fileInputRef.current?.click()}\n >\n <Upload className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n <p className=\"text-sm font-medium mb-2\">\n {t('contactDirectory.documentExtraction.click_to_upload')}\n </p>\n <p className=\"text-xs text-muted-foreground\">\n {t('contactDirectory.documentExtraction.supported_formats')}\n </p>\n </div>\n )}\n\n {/* Hidden file input */}\n <input\n ref={fileInputRef}\n type=\"file\"\n accept=\".pdf,.docx,.doc,.txt,.csv,.xls,.xlsx\"\n onChange={handleFileSelect}\n className=\"hidden\"\n />\n\n {/* Process Button */}\n {selectedFile && (\n <Button\n type=\"button\"\n onClick={handleUpload}\n disabled={uploadMutation.isPending}\n className=\"w-full h-11 sm:h-10\"\n >\n {uploadMutation.isPending && (\n <Loader2 className={`h-4 w-4 animate-spin ${isRTL ? 'ml-2' : 'mr-2'}`} />\n )}\n {t('contactDirectory.documentExtraction.extract_contacts')}\n </Button>\n )}\n </CardContent>\n </Card>\n )}\n\n {/* Processing Indicator */}\n {isProcessing && (\n <Card>\n <CardContent className=\"p-6 space-y-4\">\n <div className=\"flex items-center gap-3\">\n <Loader2 className=\"h-5 w-5 animate-spin text-primary\" />\n <div className=\"flex-1\">\n <p className=\"text-sm font-medium text-start\">\n {t('contactDirectory.documentExtraction.processing')}\n </p>\n {statusData && (\n <p className=\"text-xs text-muted-foreground text-start\">\n {t(`contactDirectory.documentExtraction.status_${statusData.processing_status}`)}\n </p>\n )}\n </div>\n </div>\n <Progress value={undefined} className=\"h-2\" />\n <p className=\"text-xs text-center text-muted-foreground\">\n {t('contactDirectory.documentExtraction.processing_time_estimate')}\n </p>\n </CardContent>\n </Card>\n )}\n\n {/* Processing Error */}\n {processingError && (\n <Alert variant=\"destructive\">\n <AlertCircle className=\"h-4 w-4\" />\n <AlertDescription className=\"text-start\">\n {t('contactDirectory.documentExtraction.processing_error', { error: processingError })}\n </AlertDescription>\n </Alert>\n )}\n\n {/* Extraction Results */}\n {processingComplete && extractedContacts.length > 0 && (\n <Card>\n <CardHeader>\n <div className=\"flex items-center justify-between\">\n <CardTitle className=\"text-start flex items-center gap-2\">\n <CheckCircle2 className=\"h-5 w-5 text-green-600\" />\n {t('contactDirectory.documentExtraction.extraction_complete')}\n </CardTitle>\n <Badge variant=\"secondary\" className=\"text-sm\">\n <Users className={`h-3 w-3 ${isRTL ? 'ml-1' : 'mr-1'}`} />\n {extractedContacts.length} {t('contactDirectory.documentExtraction.contacts_found')}\n </Badge>\n </div>\n <CardDescription className=\"text-start\">\n {t('contactDirectory.documentExtraction.review_and_edit')}\n </CardDescription>\n </CardHeader>\n <CardContent className=\"space-y-3\">\n {/* Contact Preview List */}\n <div className=\"space-y-2 max-h-[400px] overflow-y-auto\">\n {extractedContacts.map((contact, index) => (\n <div\n key={index}\n className=\"border rounded-lg p-3 sm:p-4 hover:bg-accent transition-colors\"\n >\n <div className=\"flex items-start justify-between gap-3\">\n <div className=\"flex-1 min-w-0\">\n <div className=\"flex items-center gap-2 mb-1\">\n <p className=\"text-sm font-medium truncate text-start\">\n {contact.full_name}\n </p>\n <Badge className={`text-xs ${getConfidenceColor(contact.confidence)}`}>\n {contact.confidence}%\n </Badge>\n </div>\n {contact.organization && (\n <p className=\"text-xs text-muted-foreground text-start truncate\">\n {contact.organization}\n </p>\n )}\n {contact.position && (\n <p className=\"text-xs text-muted-foreground text-start truncate\">\n {contact.position}\n </p>\n )}\n <div className=\"flex flex-wrap gap-1 mt-2\">\n {contact.email_addresses?.map((email, i) => (\n <Badge key={i} variant=\"outline\" className=\"text-xs\">\n {email}\n </Badge>\n ))}\n {contact.phone_numbers?.map((phone, i) => (\n <Badge key={i} variant=\"outline\" className=\"text-xs\">\n {phone}\n </Badge>\n ))}\n </div>\n </div>\n </div>\n </div>\n ))}\n </div>\n\n {/* Action Buttons */}\n <div className=\"flex flex-col-reverse sm:flex-row gap-2 pt-4 border-t\">\n <Button\n type=\"button\"\n variant=\"outline\"\n onClick={clearFile}\n className=\"h-11 sm:h-10\"\n >\n {t('contactDirectory.documentExtraction.start_over')}\n </Button>\n <Button\n type=\"button\"\n onClick={handleContinue}\n className=\"h-11 sm:h-10 flex-1\"\n >\n {t('contactDirectory.documentExtraction.review_and_import')}\n </Button>\n </div>\n </CardContent>\n </Card>\n )}\n\n {/* No Contacts Found */}\n {processingComplete && extractedContacts.length === 0 && (\n <Alert>\n <AlertCircle className=\"h-4 w-4\" />\n <AlertDescription className=\"text-start\">\n {t('contactDirectory.documentExtraction.no_contacts_found')}\n </AlertDescription>\n </Alert>\n )}\n\n {/* Info Alert */}\n {!documentSourceId && (\n <Alert>\n <AlertCircle className=\"h-4 w-4\" />\n <AlertDescription className=\"text-start text-sm\">\n {t('contactDirectory.documentExtraction.info_alert')}\n </AlertDescription>\n </Alert>\n )}\n\n {/* Cancel Button */}\n {onCancel && !isProcessing && (\n <div className=\"flex justify-end\">\n <Button\n type=\"button\"\n variant=\"ghost\"\n onClick={onCancel}\n className=\"h-11 px-6 sm:h-10\"\n >\n {t('contactDirectory.documentExtraction.back_to_manual')}\n </Button>\n </div>\n )}\n </div>\n );\n}\n","/**\n * BatchContactReview Component\n * Part of: 027-contact-directory implementation - Phase 5 (Document Extraction)\n *\n * Mobile-first, RTL-ready batch contact review UI with inline editing.\n * Features checkbox selection, field editing, confidence badges, and batch operations.\n */\n\nimport React, { useState, useCallback, useMemo } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Badge } from '@/components/ui/badge';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { CheckSquare, Square, AlertCircle, Trash2, Users } from 'lucide-react';\nimport { getConfidenceColor, getConfidenceLevel } from '@/hooks/useOCR';\nimport type { Database } from '@/types/contact-directory.types';\n\ntype ContactInsert = Database['public']['Tables']['cd_contacts']['Insert'];\n\nexport interface EditableContact extends Partial<ContactInsert> {\n id: string; // Temporary ID for editing\n selected: boolean;\n}\n\ninterface BatchContactReviewProps {\n contacts: EditableContact[];\n onContactsChange: (contacts: EditableContact[]) => void;\n onImport: (selectedContacts: EditableContact[]) => void;\n onCancel: () => void;\n isImporting?: boolean;\n}\n\nexport function BatchContactReview({\n contacts,\n onContactsChange,\n onImport,\n onCancel,\n isImporting = false,\n}: BatchContactReviewProps) {\n const { t, i18n } = useTranslation('contacts');\n const isRTL = i18n.language === 'ar';\n\n // Calculate selected contacts\n const selectedContacts = useMemo(\n () => contacts.filter((c) => c.selected),\n [contacts]\n );\n\n const allSelected = contacts.length > 0 && selectedContacts.length === contacts.length;\n const someSelected = selectedContacts.length > 0 && selectedContacts.length < contacts.length;\n\n // Toggle all contacts selection\n const handleToggleAll = useCallback(() => {\n const newSelected = !allSelected;\n onContactsChange(\n contacts.map((contact) => ({\n ...contact,\n selected: newSelected,\n }))\n );\n }, [allSelected, contacts, onContactsChange]);\n\n // Toggle individual contact selection\n const handleToggleContact = useCallback(\n (contactId: string) => {\n onContactsChange(\n contacts.map((contact) =>\n contact.id === contactId\n ? { ...contact, selected: !contact.selected }\n : contact\n )\n );\n },\n [contacts, onContactsChange]\n );\n\n // Update contact field\n const handleFieldChange = useCallback(\n (contactId: string, field: keyof ContactInsert, value: any) => {\n onContactsChange(\n contacts.map((contact) =>\n contact.id === contactId\n ? { ...contact, [field]: value }\n : contact\n )\n );\n },\n [contacts, onContactsChange]\n );\n\n // Add email to contact\n const handleAddEmail = useCallback(\n (contactId: string) => {\n onContactsChange(\n contacts.map((contact) => {\n if (contact.id === contactId) {\n const emails = contact.email_addresses || [];\n return {\n ...contact,\n email_addresses: [...emails, ''],\n };\n }\n return contact;\n })\n );\n },\n [contacts, onContactsChange]\n );\n\n // Update email in contact\n const handleEmailChange = useCallback(\n (contactId: string, emailIndex: number, value: string) => {\n onContactsChange(\n contacts.map((contact) => {\n if (contact.id === contactId) {\n const emails = [...(contact.email_addresses || [])];\n emails[emailIndex] = value;\n return {\n ...contact,\n email_addresses: emails,\n };\n }\n return contact;\n })\n );\n },\n [contacts, onContactsChange]\n );\n\n // Remove email from contact\n const handleRemoveEmail = useCallback(\n (contactId: string, emailIndex: number) => {\n onContactsChange(\n contacts.map((contact) => {\n if (contact.id === contactId) {\n const emails = [...(contact.email_addresses || [])];\n emails.splice(emailIndex, 1);\n return {\n ...contact,\n email_addresses: emails,\n };\n }\n return contact;\n })\n );\n },\n [contacts, onContactsChange]\n );\n\n // Add phone to contact\n const handleAddPhone = useCallback(\n (contactId: string) => {\n onContactsChange(\n contacts.map((contact) => {\n if (contact.id === contactId) {\n const phones = contact.phone_numbers || [];\n return {\n ...contact,\n phone_numbers: [...phones, ''],\n };\n }\n return contact;\n })\n );\n },\n [contacts, onContactsChange]\n );\n\n // Update phone in contact\n const handlePhoneChange = useCallback(\n (contactId: string, phoneIndex: number, value: string) => {\n onContactsChange(\n contacts.map((contact) => {\n if (contact.id === contactId) {\n const phones = [...(contact.phone_numbers || [])];\n phones[phoneIndex] = value;\n return {\n ...contact,\n phone_numbers: phones,\n };\n }\n return contact;\n })\n );\n },\n [contacts, onContactsChange]\n );\n\n // Remove phone from contact\n const handleRemovePhone = useCallback(\n (contactId: string, phoneIndex: number) => {\n onContactsChange(\n contacts.map((contact) => {\n if (contact.id === contactId) {\n const phones = [...(contact.phone_numbers || [])];\n phones.splice(phoneIndex, 1);\n return {\n ...contact,\n phone_numbers: phones,\n };\n }\n return contact;\n })\n );\n },\n [contacts, onContactsChange]\n );\n\n // Remove contact from list\n const handleRemoveContact = useCallback(\n (contactId: string) => {\n onContactsChange(contacts.filter((contact) => contact.id !== contactId));\n },\n [contacts, onContactsChange]\n );\n\n // Handle import\n const handleImportClick = useCallback(() => {\n if (selectedContacts.length === 0) {\n alert(t('contactDirectory.documentExtraction.no_contacts_selected'));\n return;\n }\n onImport(selectedContacts);\n }, [selectedContacts, onImport, t]);\n\n return (\n <div className=\"space-y-4 sm:space-y-6\" dir={isRTL ? 'rtl' : 'ltr'}>\n <Card>\n <CardHeader>\n <div className=\"flex items-center justify-between gap-4\">\n <CardTitle className=\"text-start\">\n {t('contactDirectory.documentExtraction.review_contacts')}\n </CardTitle>\n <Badge variant=\"secondary\" className=\"text-sm\">\n <Users className={`h-3 w-3 ${isRTL ? 'ml-1' : 'mr-1'}`} />\n {selectedContacts.length} / {contacts.length}\n </Badge>\n </div>\n <CardDescription className=\"text-start\">\n {t('contactDirectory.documentExtraction.review_description')}\n </CardDescription>\n </CardHeader>\n\n <CardContent className=\"space-y-4\">\n {/* Select All / Deselect All */}\n <div className=\"flex items-center justify-between gap-4 pb-4 border-b\">\n <div className=\"flex items-center gap-2\">\n <Checkbox\n id=\"select-all\"\n checked={allSelected}\n onCheckedChange={handleToggleAll}\n className=\"data-[state=indeterminate]:bg-primary\"\n {...(someSelected ? { 'data-state': 'indeterminate' } : {})}\n />\n <Label htmlFor=\"select-all\" className=\"text-sm font-medium cursor-pointer\">\n {allSelected\n ? t('contactDirectory.documentExtraction.deselect_all')\n : t('contactDirectory.documentExtraction.select_all')}\n </Label>\n </div>\n <Button\n variant=\"ghost\"\n size=\"sm\"\n onClick={handleToggleAll}\n className=\"text-xs\"\n >\n {allSelected ? (\n <Square className={`h-3 w-3 ${isRTL ? 'ml-1' : 'mr-1'}`} />\n ) : (\n <CheckSquare className={`h-3 w-3 ${isRTL ? 'ml-1' : 'mr-1'}`} />\n )}\n {allSelected\n ? t('contactDirectory.documentExtraction.deselect_all')\n : t('contactDirectory.documentExtraction.select_all')}\n </Button>\n </div>\n\n {/* Contacts List */}\n <div className=\"space-y-4 max-h-[600px] overflow-y-auto\">\n {contacts.map((contact) => (\n <Card\n key={contact.id}\n className={`border-2 transition-colors ${\n contact.selected\n ? 'border-primary bg-primary/5'\n : 'border-border'\n }`}\n >\n <CardContent className=\"p-4 space-y-3\">\n {/* Contact Header */}\n <div className=\"flex items-start gap-3\">\n <Checkbox\n checked={contact.selected}\n onCheckedChange={() => handleToggleContact(contact.id)}\n className=\"mt-1\"\n />\n <div className=\"flex-1 space-y-3\">\n {/* Full Name */}\n <div>\n <div className=\"flex items-center gap-2 mb-1\">\n <Label className=\"text-xs text-muted-foreground text-start\">\n {t('contactDirectory.form.full_name')}\n </Label>\n {contact.ocr_confidence && (\n <Badge className={`text-xs ${getConfidenceColor(contact.ocr_confidence)}`}>\n {contact.ocr_confidence}%\n </Badge>\n )}\n </div>\n <Input\n value={contact.full_name || ''}\n onChange={(e) =>\n handleFieldChange(contact.id, 'full_name', e.target.value)\n }\n placeholder={t('contactDirectory.form.full_name_placeholder')}\n className=\"h-9\"\n />\n </div>\n\n {/* Position */}\n <div>\n <Label className=\"text-xs text-muted-foreground mb-1 block text-start\">\n {t('contactDirectory.form.position')}\n </Label>\n <Input\n value={contact.position || ''}\n onChange={(e) =>\n handleFieldChange(contact.id, 'position', e.target.value)\n }\n placeholder={t('contactDirectory.form.position_placeholder')}\n className=\"h-9\"\n />\n </div>\n\n {/* Email Addresses */}\n <div>\n <Label className=\"text-xs text-muted-foreground mb-1 block text-start\">\n {t('contactDirectory.form.email_addresses')}\n </Label>\n <div className=\"space-y-2\">\n {contact.email_addresses?.map((email, index) => (\n <div key={index} className=\"flex gap-2\">\n <Input\n type=\"email\"\n value={email}\n onChange={(e) =>\n handleEmailChange(contact.id, index, e.target.value)\n }\n placeholder={t('contactDirectory.form.email_placeholder')}\n className=\"h-9\"\n />\n {contact.email_addresses && contact.email_addresses.length > 1 && (\n <Button\n type=\"button\"\n variant=\"ghost\"\n size=\"icon\"\n onClick={() => handleRemoveEmail(contact.id, index)}\n className=\"flex-shrink-0 min-h-9 min-w-9\"\n >\n <Trash2 className=\"h-3 w-3\" />\n </Button>\n )}\n </div>\n ))}\n <Button\n type=\"button\"\n variant=\"outline\"\n size=\"sm\"\n onClick={() => handleAddEmail(contact.id)}\n className=\"w-full h-8 text-xs\"\n >\n {t('contactDirectory.form.add_email')}\n </Button>\n </div>\n </div>\n\n {/* Phone Numbers */}\n <div>\n <Label className=\"text-xs text-muted-foreground mb-1 block text-start\">\n {t('contactDirectory.form.phone_numbers')}\n </Label>\n <div className=\"space-y-2\">\n {contact.phone_numbers?.map((phone, index) => (\n <div key={index} className=\"flex gap-2\">\n <Input\n type=\"tel\"\n value={phone}\n onChange={(e) =>\n handlePhoneChange(contact.id, index, e.target.value)\n }\n placeholder={t('contactDirectory.form.phone_placeholder')}\n className=\"h-9\"\n />\n {contact.phone_numbers && contact.phone_numbers.length > 1 && (\n <Button\n type=\"button\"\n variant=\"ghost\"\n size=\"icon\"\n onClick={() => handleRemovePhone(contact.id, index)}\n className=\"flex-shrink-0 min-h-9 min-w-9\"\n >\n <Trash2 className=\"h-3 w-3\" />\n </Button>\n )}\n </div>\n ))}\n <Button\n type=\"button\"\n variant=\"outline\"\n size=\"sm\"\n onClick={() => handleAddPhone(contact.id)}\n className=\"w-full h-8 text-xs\"\n >\n {t('contactDirectory.form.add_phone')}\n </Button>\n </div>\n </div>\n </div>\n\n {/* Remove Button */}\n <Button\n type=\"button\"\n variant=\"ghost\"\n size=\"icon\"\n onClick={() => handleRemoveContact(contact.id)}\n className=\"flex-shrink-0 min-h-9 min-w-9\"\n >\n <Trash2 className=\"h-4 w-4 text-destructive\" />\n </Button>\n </div>\n </CardContent>\n </Card>\n ))}\n </div>\n\n {/* No Contacts */}\n {contacts.length === 0 && (\n <Alert>\n <AlertCircle className=\"h-4 w-4\" />\n <AlertDescription className=\"text-start\">\n {t('contactDirectory.documentExtraction.no_contacts_to_review')}\n </AlertDescription>\n </Alert>\n )}\n\n {/* Action Buttons */}\n <div className=\"flex flex-col-reverse sm:flex-row gap-2 pt-4 border-t\">\n <Button\n type=\"button\"\n variant=\"outline\"\n onClick={onCancel}\n disabled={isImporting}\n className=\"h-11 sm:h-10\"\n >\n {t('contactDirectory.form.cancel')}\n </Button>\n <Button\n type=\"button\"\n onClick={handleImportClick}\n disabled={selectedContacts.length === 0 || isImporting}\n className=\"h-11 sm:h-10 flex-1\"\n >\n {isImporting ? (\n <>\n <div className={`animate-spin h-4 w-4 border-2 border-current border-t-transparent rounded-full ${isRTL ? 'ml-2' : 'mr-2'}`} />\n {t('contactDirectory.documentExtraction.importing')}\n </>\n ) : (\n <>\n {t('contactDirectory.documentExtraction.import_selected')} ({selectedContacts.length})\n </>\n )}\n </Button>\n </div>\n </CardContent>\n </Card>\n </div>\n );\n}\n","/**\n * ContactCreate Page\n * Part of: 027-contact-directory implementation\n *\n * Page for creating new contacts with duplicate detection.\n * Mobile-first, RTL-ready.\n */\n\nimport { useState } from 'react';\nimport { useNavigate } from '@tanstack/react-router';\nimport { useTranslation } from 'react-i18next';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport {\n Dialog,\n DialogContent,\n DialogDescription,\n DialogFooter,\n DialogHeader,\n DialogTitle,\n} from '@/components/ui/dialog';\nimport { ArrowLeft, AlertTriangle, FileText, Scan, Upload } from 'lucide-react';\nimport { useCreatePersonDossier } from '@/hooks/usePersonDossiers';\nimport { ContactForm, type OCRFieldConfidence } from '@/components/contacts/ContactForm';\nimport { BusinessCardScanner } from '@/components/contacts/BusinessCardScanner';\nimport { DocumentExtractor } from '@/components/contacts/DocumentExtractor';\nimport { BatchContactReview, type EditableContact } from '@/components/contacts/BatchContactReview';\nimport type { Database } from '@/types/contact-directory.types';\nimport type { DuplicateWarning } from '@/services/contact-api';\nimport type { OCRParsedFields } from '@/services/ocr-api';\n\ntype ContactInsert = Database['public']['Tables']['cd_contacts']['Insert'];\n\nexport function ContactCreate() {\n const { t, i18n } = useTranslation('contacts');\n const isRTL = i18n.language === 'ar';\n const navigate = useNavigate();\n\n const [activeTab, setActiveTab] = useState<'manual' | 'scan' | 'document'>('manual');\n const [pendingContact, setPendingContact] = useState<Omit<\n ContactInsert,\n 'created_by' | 'id' | 'created_at' | 'updated_at'\n > | null>(null);\n const [duplicates, setDuplicates] = useState<DuplicateWarning[]>([]);\n const [showDuplicateDialog, setShowDuplicateDialog] = useState(false);\n\n // OCR extracted data (business card)\n const [ocrData, setOcrData] = useState<Partial<ContactInsert> | null>(null);\n const [ocrConfidence, setOcrConfidence] = useState<OCRFieldConfidence | undefined>();\n const [ocrRawText, setOcrRawText] = useState<string | undefined>();\n\n // Document extraction (bulk import)\n const [extractedContacts, setExtractedContacts] = useState<EditableContact[]>([]);\n const [showBatchReview, setShowBatchReview] = useState(false);\n const [batchDuplicates, setBatchDuplicates] = useState<Map<string, DuplicateWarning[]>>(new Map());\n const [showBatchDuplicateDialog, setShowBatchDuplicateDialog] = useState(false);\n const [pendingBatchContacts, setPendingBatchContacts] = useState<EditableContact[]>([]);\n\n const createMutation = useCreateContact();\n const checkDuplicatesMutation = useCheckDuplicates();\n const batchCreateMutation = useBatchCreateContacts();\n\n const handleBack = () => {\n navigate({ to: '/contacts' });\n };\n\n // Handle OCR extraction\n const handleOCRExtracted = (fields: OCRParsedFields, confidence: number, rawText: string) => {\n // Map OCR fields to ContactInsert format\n const extractedData: Partial<ContactInsert> = {\n full_name: fields.full_name || '',\n position: fields.position || '',\n email_addresses: fields.email_addresses || [],\n phone_numbers: fields.phone_numbers || [],\n source_type: 'business_card',\n ocr_confidence: confidence,\n };\n\n // Set confidence scores for individual fields\n const fieldConfidence: OCRFieldConfidence = {\n full_name: fields.full_name ? confidence : undefined,\n position: fields.position ? confidence : undefined,\n email_addresses: fields.email_addresses && fields.email_addresses.length > 0 ? confidence : undefined,\n phone_numbers: fields.phone_numbers && fields.phone_numbers.length > 0 ? confidence : undefined,\n };\n\n setOcrData(extractedData);\n setOcrConfidence(fieldConfidence);\n setOcrRawText(rawText);\n\n // Switch to manual tab to review/edit extracted data\n setActiveTab('manual');\n };\n\n const handleSubmit = async (data: Omit<ContactInsert, 'created_by' | 'id' | 'created_at' | 'updated_at'>) => {\n // Check for duplicates before creating\n try {\n const duplicateResults = await checkDuplicatesMutation.mutateAsync({\n full_name: data.full_name,\n email_addresses: data.email_addresses || [],\n phone_numbers: data.phone_numbers || [],\n });\n\n if (duplicateResults && duplicateResults.length > 0) {\n // Show duplicate warning dialog\n setPendingContact(data);\n setDuplicates(duplicateResults);\n setShowDuplicateDialog(true);\n } else {\n // No duplicates, proceed with creation\n createContact(data);\n }\n } catch (error) {\n // If duplicate check fails, proceed anyway\n console.error('Duplicate check failed:', error);\n createContact(data);\n }\n };\n\n const createContact = (data: Omit<ContactInsert, 'created_by' | 'id' | 'created_at' | 'updated_at'>) => {\n createMutation.mutate(data, {\n onSuccess: (newContact) => {\n // Navigate to the newly created contact\n navigate({ to: `/contacts/$contactId`, params: { contactId: newContact.id } });\n },\n });\n };\n\n const handleProceedDespiteDuplicates = () => {\n if (pendingContact) {\n createContact(pendingContact);\n setShowDuplicateDialog(false);\n setPendingContact(null);\n setDuplicates([]);\n }\n };\n\n const handleCancelCreation = () => {\n setShowDuplicateDialog(false);\n setPendingContact(null);\n setDuplicates([]);\n };\n\n // Handle document extraction complete\n const handleDocumentExtracted = (contacts: Partial<ContactInsert>[]) => {\n // Convert to EditableContact format with temporary IDs and all selected by default\n const editableContacts: EditableContact[] = contacts.map((contact, index) => ({\n ...contact,\n id: `temp-${Date.now()}-${index}`,\n selected: true,\n }));\n\n setExtractedContacts(editableContacts);\n setShowBatchReview(true);\n };\n\n // Handle batch import with duplicate detection\n const handleBatchImport = async (selectedContacts: EditableContact[]) => {\n // Check for duplicates in selected contacts\n const duplicateMap = new Map<string, DuplicateWarning[]>();\n let hasDuplicates = false;\n\n for (const contact of selectedContacts) {\n if (!contact.full_name || !contact.full_name.trim()) continue;\n\n try {\n const duplicateResults = await checkDuplicatesMutation.mutateAsync({\n full_name: contact.full_name,\n email_addresses: contact.email_addresses || [],\n phone_numbers: contact.phone_numbers || [],\n });\n\n if (duplicateResults && duplicateResults.length > 0) {\n duplicateMap.set(contact.id, duplicateResults);\n hasDuplicates = true;\n }\n } catch (error) {\n console.error('Duplicate check failed for contact:', contact.full_name, error);\n // Continue with other contacts even if one check fails\n }\n }\n\n if (hasDuplicates) {\n // Show duplicate warning dialog\n setBatchDuplicates(duplicateMap);\n setPendingBatchContacts(selectedContacts);\n setShowBatchDuplicateDialog(true);\n } else {\n // No duplicates, proceed with import\n await performBatchImport(selectedContacts);\n }\n };\n\n // Perform the actual batch import\n const performBatchImport = async (selectedContacts: EditableContact[]) => {\n // Remove temporary fields and prepare for batch create\n const contactsToCreate = selectedContacts.map(({ id, selected, ...contact }) => contact);\n\n try {\n const result = await batchCreateMutation.mutateAsync(contactsToCreate);\n\n // Navigate to contacts list after successful import\n navigate({ to: '/contacts' });\n } catch (error) {\n console.error('Batch import error:', error);\n }\n };\n\n // Handle proceeding with import despite duplicates\n const handleProceedWithBatchImport = async () => {\n setShowBatchDuplicateDialog(false);\n await performBatchImport(pendingBatchContacts);\n setBatchDuplicates(new Map());\n setPendingBatchContacts([]);\n };\n\n // Handle canceling batch import\n const handleCancelBatchImport = () => {\n setShowBatchDuplicateDialog(false);\n setBatchDuplicates(new Map());\n setPendingBatchContacts([]);\n };\n\n // Handle cancel batch review\n const handleCancelBatchReview = () => {\n setShowBatchReview(false);\n setExtractedContacts([]);\n };\n\n return (\n <>\n <div className=\"min-h-screen\" dir={isRTL ? 'rtl' : 'ltr'}>\n <div className=\"container mx-auto px-4 sm:px-6 lg:px-8 py-6\">\n {/* Header */}\n <div className=\"mb-6\">\n <Button\n variant=\"ghost\"\n onClick={handleBack}\n className=\"mb-4\"\n >\n <ArrowLeft className={`h-4 w-4 ${isRTL ? 'ml-2' : 'mr-2'}`} />\n {t('contactDirectory.buttons.back')}\n </Button>\n\n <h1 className=\"text-2xl sm:text-3xl font-bold text-start\">\n {t('contactDirectory.buttons.createContact')}\n </h1>\n </div>\n\n {/* Tabbed Interface */}\n {!showBatchReview && (\n <Tabs value={activeTab} onValueChange={(value) => setActiveTab(value as 'manual' | 'scan' | 'document')}>\n <TabsList className=\"grid w-full grid-cols-1 sm:grid-cols-3 mb-4\">\n <TabsTrigger value=\"manual\" className=\"gap-2\">\n <FileText className=\"h-4 w-4\" />\n {t('contactDirectory.tabs.manual_entry')}\n </TabsTrigger>\n <TabsTrigger value=\"scan\" className=\"gap-2\">\n <Scan className=\"h-4 w-4\" />\n {t('contactDirectory.tabs.scan_card')}\n </TabsTrigger>\n <TabsTrigger value=\"document\" className=\"gap-2\">\n <Upload className=\"h-4 w-4\" />\n {t('contactDirectory.documentExtraction.batch_import_tab')}\n </TabsTrigger>\n </TabsList>\n\n {/* Manual Entry Tab */}\n <TabsContent value=\"manual\">\n <Card>\n <CardHeader>\n <CardTitle>{t('contactDirectory.subtitle')}</CardTitle>\n </CardHeader>\n <CardContent>\n <ContactForm\n defaultValues={ocrData || undefined}\n ocrConfidence={ocrConfidence}\n ocrRawText={ocrRawText}\n onSubmit={handleSubmit}\n onCancel={handleBack}\n isSubmitting={createMutation.isPending || checkDuplicatesMutation.isPending}\n mode=\"create\"\n />\n </CardContent>\n </Card>\n </TabsContent>\n\n {/* Business Card Scan Tab */}\n <TabsContent value=\"scan\">\n <BusinessCardScanner\n onExtracted={handleOCRExtracted}\n onCancel={() => setActiveTab('manual')}\n />\n </TabsContent>\n\n {/* Document Extraction Tab */}\n <TabsContent value=\"document\">\n <DocumentExtractor\n onExtracted={handleDocumentExtracted}\n onCancel={() => setActiveTab('manual')}\n />\n </TabsContent>\n </Tabs>\n )}\n\n {/* Batch Contact Review */}\n {showBatchReview && (\n <BatchContactReview\n contacts={extractedContacts}\n onContactsChange={setExtractedContacts}\n onImport={handleBatchImport}\n onCancel={handleCancelBatchReview}\n isImporting={batchCreateMutation.isPending}\n />\n )}\n </div>\n </div>\n\n {/* Single Contact Duplicate Warning Dialog */}\n <Dialog open={showDuplicateDialog} onOpenChange={setShowDuplicateDialog}>\n <DialogContent className=\"max-w-2xl\" dir={isRTL ? 'rtl' : 'ltr'}>\n <DialogHeader>\n <DialogTitle className=\"flex items-center gap-2 text-start\">\n <AlertTriangle className=\"h-5 w-5 text-yellow-600\" />\n {t('contactDirectory.duplicates.dialog_title')}\n </DialogTitle>\n <DialogDescription className=\"text-start\">\n {t('contactDirectory.duplicates.dialog_description')}\n </DialogDescription>\n </DialogHeader>\n\n <div className=\"space-y-3 max-h-[400px] overflow-y-auto\">\n {duplicates.map((dup) => (\n <Card key={dup.contact_id} className=\"p-4\">\n <div className=\"space-y-2\">\n <div className=\"flex items-start justify-between gap-4\">\n <div className=\"flex-1\">\n <h4 className=\"font-medium text-start\">{dup.full_name}</h4>\n {dup.organization_name && (\n <p className=\"text-sm text-muted-foreground text-start\">{dup.organization_name}</p>\n )}\n </div>\n <div className=\"text-sm font-medium text-yellow-600\">\n {dup.match_score}% {t('contactDirectory.duplicates.match')}\n </div>\n </div>\n <div className=\"flex flex-wrap gap-2\">\n {dup.match_reasons.map((reason) => (\n <span\n key={reason}\n className=\"px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800\"\n >\n {t(`contactDirectory.duplicates.reasons.${reason}`)}\n </span>\n ))}\n </div>\n <Button\n variant=\"outline\"\n size=\"sm\"\n onClick={() => navigate({ to: `/contacts/$contactId`, params: { contactId: dup.contact_id } })}\n className=\"mt-2\"\n >\n {t('contactDirectory.duplicates.view_contact')}\n </Button>\n </div>\n </Card>\n ))}\n </div>\n\n <DialogFooter className=\"flex flex-col-reverse gap-2 sm:flex-row\">\n <Button variant=\"outline\" onClick={handleCancelCreation} className=\"h-11 sm:h-10\">\n {t('contactDirectory.duplicates.cancel')}\n </Button>\n <Button onClick={handleProceedDespiteDuplicates} className=\"h-11 sm:h-10\">\n {t('contactDirectory.duplicates.proceed_anyway')}\n </Button>\n </DialogFooter>\n </DialogContent>\n </Dialog>\n\n {/* Batch Import Duplicate Warning Dialog */}\n <Dialog open={showBatchDuplicateDialog} onOpenChange={setShowBatchDuplicateDialog}>\n <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\" dir={isRTL ? 'rtl' : 'ltr'}>\n <DialogHeader>\n <DialogTitle className=\"flex items-center gap-2 text-start\">\n <AlertTriangle className=\"h-5 w-5 text-yellow-600\" />\n {t('contactDirectory.duplicates.dialog_title')} ({batchDuplicates.size} {t('contactDirectory.documentExtraction.contacts_found')})\n </DialogTitle>\n <DialogDescription className=\"text-start\">\n {t('contactDirectory.duplicates.dialog_description')}\n </DialogDescription>\n </DialogHeader>\n\n <div className=\"space-y-4\">\n {Array.from(batchDuplicates.entries()).map(([contactId, duplicates]) => {\n const contact = pendingBatchContacts.find((c) => c.id === contactId);\n if (!contact) return null;\n\n return (\n <Card key={contactId} className=\"border-yellow-200\">\n <CardHeader className=\"pb-3\">\n <CardTitle className=\"text-base text-start\">\n {contact.full_name}\n </CardTitle>\n {contact.organization_id && (\n <p className=\"text-sm text-muted-foreground text-start\">\n {/* Organization name would need to be resolved */}\n </p>\n )}\n </CardHeader>\n <CardContent className=\"space-y-2\">\n {duplicates.map((dup) => (\n <Card key={dup.contact_id} className=\"p-3 bg-yellow-50\">\n <div className=\"space-y-2\">\n <div className=\"flex items-start justify-between gap-4\">\n <div className=\"flex-1\">\n <h4 className=\"font-medium text-sm text-start\">{dup.full_name}</h4>\n {dup.organization_name && (\n <p className=\"text-xs text-muted-foreground text-start\">{dup.organization_name}</p>\n )}\n </div>\n <div className=\"text-sm font-medium text-yellow-600\">\n {dup.match_score}% {t('contactDirectory.duplicates.match')}\n </div>\n </div>\n <div className=\"flex flex-wrap gap-1\">\n {dup.match_reasons.map((reason) => (\n <span\n key={reason}\n className=\"px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800\"\n >\n {t(`contactDirectory.duplicates.reasons.${reason}`)}\n </span>\n ))}\n </div>\n <Button\n variant=\"outline\"\n size=\"sm\"\n onClick={() => {\n // Open in new tab to review\n window.open(`/contacts/${dup.contact_id}`, '_blank');\n }}\n className=\"mt-2\"\n >\n {t('contactDirectory.duplicates.view_contact')}\n </Button>\n </div>\n </Card>\n ))}\n </CardContent>\n </Card>\n );\n })}\n </div>\n\n <DialogFooter className=\"flex flex-col-reverse gap-2 sm:flex-row\">\n <Button variant=\"outline\" onClick={handleCancelBatchImport} className=\"h-11 sm:h-10\">\n {t('contactDirectory.duplicates.cancel')}\n </Button>\n <Button onClick={handleProceedWithBatchImport} disabled={batchCreateMutation.isPending} className=\"h-11 sm:h-10\">\n {batchCreateMutation.isPending ? (\n <>\n <div className={`animate-spin h-4 w-4 border-2 border-current border-t-transparent rounded-full ${isRTL ? 'ml-2' : 'mr-2'}`} />\n {t('contactDirectory.documentExtraction.importing')}\n </>\n ) : (\n t('contactDirectory.duplicates.proceed_anyway')\n )}\n </Button>\n </DialogFooter>\n </DialogContent>\n </Dialog>\n </>\n );\n}\n","/**\n * Contact Create Route\n * Part of: 027-contact-directory implementation\n *\n * Route: /contacts/create\n * Manual contact entry form\n */\n\nimport { createFileRoute } from '@tanstack/react-router';\nimport { ContactCreate } from '@/pages/contacts/ContactCreate';\n\nexport const Route = createFileRoute('/_protected/contacts/create')({\n component: ContactCreate,\n meta: () => [\n {\n title: 'Create Contact - GASTAT',\n },\n ],\n});\n"],"names":["BusinessCardScanner","onExtracted","onCancel","t","i18n","useTranslation","isRTL","selectedFile","setSelectedFile","useState","previewUrl","setPreviewUrl","consentCloudOCR","setConsentCloudOCR","showCamera","setShowCamera","cameraStream","setCameraStream","fileInputRef","useRef","videoRef","canvasRef","uploadMutation","useUploadBusinessCard","handleFileSelect","useCallback","event","file","maxSize","url","startCamera","stream","error","stopCamera","track","capturePhoto","video","canvas","context","blob","clearFile","handleProcess","result","React","jsx","Card","CardContent","jsxs","Button","Camera","CardHeader","CardTitle","CardDescription","X","Upload","Checkbox","checked","Label","Loader2","Progress","Alert","AlertCircle","AlertDescription","DocumentExtractor","documentSourceId","setDocumentSourceId","extractedContacts","setExtractedContacts","processingComplete","setProcessingComplete","processingError","setProcessingError","useUploadDocument","statusData","isPolling","useDocumentStatus","data","validExtensions","fileExtension","handleUpload","handleContinue","contacts","contact","getFileIcon","fileName","FileText","formatFileSize","bytes","isProcessing","CheckCircle2","Badge","Users","index","getConfidenceColor","email","i","phone","BatchContactReview","onContactsChange","onImport","isImporting","selectedContacts","useMemo","c","allSelected","someSelected","handleToggleAll","newSelected","handleToggleContact","contactId","handleFieldChange","field","value","handleAddEmail","emails","handleEmailChange","emailIndex","handleRemoveEmail","handleAddPhone","phones","handlePhoneChange","phoneIndex","handleRemovePhone","handleRemoveContact","handleImportClick","Square","CheckSquare","Input","e","Trash2","Fragment","ContactCreate","navigate","useNavigate","activeTab","setActiveTab","pendingContact","setPendingContact","duplicates","setDuplicates","showDuplicateDialog","setShowDuplicateDialog","ocrData","setOcrData","ocrConfidence","setOcrConfidence","ocrRawText","setOcrRawText","showBatchReview","setShowBatchReview","batchDuplicates","setBatchDuplicates","showBatchDuplicateDialog","setShowBatchDuplicateDialog","pendingBatchContacts","setPendingBatchContacts","createMutation","checkDuplicatesMutation","batchCreateMutation","handleBack","handleOCRExtracted","fields","confidence","rawText","extractedData","fieldConfidence","handleSubmit","duplicateResults","createContact","newContact","handleProceedDespiteDuplicates","handleCancelCreation","handleDocumentExtracted","editableContacts","handleBatchImport","duplicateMap","hasDuplicates","performBatchImport","contactsToCreate","id","selected","handleProceedWithBatchImport","handleCancelBatchImport","handleCancelBatchReview","ArrowLeft","Tabs","TabsList","TabsTrigger","Scan","TabsContent","ContactForm","Dialog","DialogContent","DialogHeader","DialogTitle","AlertTriangle","DialogDescription","dup","reason","DialogFooter","SplitComponent"],"mappings":"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"}