# Claude Code Configuration for International Dossier Management System v2.0

## Project Overview
- **Project Name**: Intl-DossierV2.0 (GASTAT International Dossier Management System)
- **Framework**: Vite + React 19 + TypeScript 5.8+
- **Styling**: TailwindCSS + **Kibo UI** (shadcn/ui-based component system)
- **Backend**: Supabase (PostgreSQL 15+) with Realtime
- **Mobile**: React Native + Expo (separate mobile app with offline-first)
- **Architecture**: Enterprise diplomatic/dossier management system

## 🚨 CRITICAL DESIGN PRINCIPLES

### 1. Mobile-First is MANDATORY
**Every component MUST be designed for mobile first, then enhanced for larger screens.**

- Start with mobile viewport (320px-640px)
- Use `useResponsive()` hook for adaptive behavior
- Test on mobile before desktop
- Progressive enhancement, not graceful degradation

### 2. Progressive Design Pattern (REQUIRED)
This project uses **progressive design** extensively:

```typescript
// ALWAYS use the useResponsive hook
import { useResponsive } from '@/hooks/use-responsive'

function MyComponent() {
  const { isMobile, isTablet, isDesktop, viewport, alias } = useResponsive()
  
  // Mobile-first: Design for mobile, enhance for larger screens
  return (
    <div className={cn(
      // Base (mobile) styles first
      'p-3 text-sm',
      // Then tablet overrides
      'sm:p-4 sm:text-base',
      // Then desktop overrides
      'md:p-6 md:text-lg'
    )}>
      {/* Mobile: Stack vertically */}
      {isMobile && <MobileLayout />}
      
      {/* Tablet: Two columns */}
      {isTablet && <TabletLayout />}
      
      {/* Desktop: Full grid */}
      {isDesktop && <DesktopLayout />}
    </div>
  )
}
```

### 3. Responsive Components (Use Existing Patterns)
Your project has custom responsive components - **ALWAYS USE THESE**:

```typescript
// Use ResponsiveCard for adaptive cards
import { ResponsiveCard } from '@/components/responsive/responsive-card'

<ResponsiveCard
  title="My Card"
  collapsible={true}           // Auto-collapses on mobile
  showOnMobile={true}           // Control mobile visibility
  mobileLayout="stack"          // 'stack' or 'inline'
  priority="high"               // Visual priority indicator
>
  {content}
</ResponsiveCard>

// Use ResponsiveWrapper for adaptive containers
import { ResponsiveWrapper } from '@/components/responsive/responsive-wrapper'

<ResponsiveWrapper 
  enableContainer={true}        // Enable CSS container queries
  className="..."
>
  {children}
</ResponsiveWrapper>

// Use ResponsiveCardGrid for responsive grids
import { ResponsiveCardGrid } from '@/components/responsive/responsive-card'

<ResponsiveCardGrid
  columns={{
    mobile: 1,    // 1 column on mobile
    tablet: 2,    // 2 columns on tablet
    desktop: 3,   // 3 columns on desktop
    wide: 4       // 4 columns on wide screens
  }}
  gap="md"
>
  {cards}
</ResponsiveCardGrid>
```

### 4. RTL/LTR Support (CRITICAL)
**Every component MUST support both English (LTR) and Arabic (RTL)**

```typescript
import { useDirection } from '@/hooks/use-theme'
import { useTranslation } from 'react-i18next'

function MyComponent() {
  const { isRTL } = useDirection()
  const { t, i18n } = useTranslation()
  
  return (
    <div dir={isRTL ? 'rtl' : 'ltr'}>
      {/* Use logical properties for RTL */}
      <div className="ms-4 pe-6">  {/* margin-start, padding-end */}
        {t('my.translation.key')}
      </div>
    </div>
  )
}
```

## Design System: Kibo UI

### CRITICAL: Always Use Kibo UI First
1. **NEVER build custom UI components from scratch** - Always check Kibo UI library first
2. **Component Import Pattern**: `import { ComponentName } from '@/components/ui/component-name'`
3. **Responsive Pattern**: Use `@/components/responsive/*` for adaptive layouts
4. **Component Categories**:
   - **Primitives**: Button, Input, Label, Card, Badge, Avatar, Dialog, etc. (in `src/components/ui/`)
   - **Responsive Wrappers**: ResponsiveCard, ResponsiveWrapper, ResponsiveCardGrid (in `src/components/responsive/`)
   - **Compositions**: DataTable, CommandMenu, FilterBar, etc. (build these with responsive patterns)
   - **Blocks**: Dashboard layouts, Kanban boards, Timeline views (in `src/components/`)
   - **Domain Patterns**: DossierCard, IntakeForm, EntityRelationships, etc. (existing in `src/components/`)

### Project File Structure (Existing)
```
frontend/
├── src/
│   ├── components/
│   │   ├── ui/               # Kibo UI primitives (shadcn/ui - keep these)
│   │   ├── responsive/       # ⭐ RESPONSIVE WRAPPERS (CRITICAL)
│   │   │   ├── responsive-card.tsx
│   │   │   ├── responsive-wrapper.tsx
│   │   │   ├── responsive-nav.tsx
│   │   │   └── responsive-table.tsx
│   │   ├── kibo-ui/          # NEW: Additional Kibo UI blocks/patterns
│   │   ├── auth/             # Auth components
│   │   ├── dossiers/         # Dossier-specific components
│   │   ├── assignments/      # Assignment workflow
│   │   ├── kanban/           # Kanban board
│   │   ├── entity-links/     # Entity relationship components
│   │   ├── waiting-queue/    # Queue management
│   │   └── [domain folders]  # Other domain components
│   ├── hooks/
│   │   ├── use-responsive.ts      # ⭐ RESPONSIVE HOOK (USE THIS!)
│   │   ├── use-theme.ts           # Theme & direction hooks
│   │   └── ...
│   ├── pages/                # Page components (TanStack Router)
│   ├── routes/               # TanStack Router routes
│   ├── services/             # API clients (Supabase)
│   ├── lib/                  # Utilities (cn(), Supabase client)
│   ├── i18n/                 # i18next translations (en, ar)
│   ├── store/                # Zustand state management
│   └── types/                # TypeScript types
```

## Code Generation Standards

### Mobile-First Component Template (REQUIRED)

```typescript
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { ResponsiveCard } from '@/components/responsive/responsive-card'
import { useResponsive } from '@/hooks/use-responsive'
import { useDirection } from '@/hooks/use-theme'
import { useTranslation } from 'react-i18next'
import { cn } from '@/lib/utils'

interface MyComponentProps {
  title: string
  description?: string
  className?: string
}

export function MyComponent({ 
  title, 
  description, 
  className 
}: MyComponentProps) {
  // ALWAYS use these hooks for responsive design
  const { isMobile, isTablet, viewport } = useResponsive()
  const { isRTL } = useDirection()
  const { t } = useTranslation()
  
  // Mobile-first: Use ResponsiveCard when possible
  return (
    <ResponsiveCard
      title={title}
      description={description}
      collapsible={isMobile}  // Auto-collapse on mobile
      mobileLayout="stack"
      className={className}
    >
      <div className={cn(
        // Base (mobile) styles
        'flex flex-col gap-2 p-3',
        // Tablet enhancements
        'sm:flex-row sm:gap-4 sm:p-4',
        // Desktop enhancements
        'md:gap-6 md:p-6'
      )}>
        {/* Content adapts to viewport */}
        {isMobile ? (
          <MobileView />
        ) : (
          <DesktopView />
        )}
      </div>
    </ResponsiveCard>
  )
}
```

### Progressive Disclosure Pattern

```typescript
// Show less on mobile, more on larger screens
function DataCard({ data }: { data: DossierData }) {
  const { isMobile, isTablet } = useResponsive()
  
  return (
    <Card>
      <CardHeader>
        <CardTitle>{data.title}</CardTitle>
        {/* Always show on tablet+ */}
        {!isMobile && <CardDescription>{data.description}</CardDescription>}
      </CardHeader>
      <CardContent>
        {/* Essential info on mobile */}
        <div className="space-y-2">
          <p>{data.summary}</p>
          
          {/* Progressive details */}
          {isTablet && (
            <div className="text-sm text-muted-foreground">
              {data.metadata}
            </div>
          )}
          
          {/* Full details on desktop */}
          {!isMobile && !isTablet && (
            <div className="mt-4 grid grid-cols-3 gap-4">
              {data.fullDetails}
            </div>
          )}
        </div>
      </CardContent>
    </Card>
  )
}
```

### Viewport-Specific Rendering

```typescript
function DossierDashboard() {
  const { viewport, alias, deviceType } = useResponsive()
  
  // Different layouts per viewport
  const layouts = {
    mobile: <MobileDashboard />,      // Single column, stacked
    tablet: <TabletDashboard />,      // Two columns
    desktop: <DesktopDashboard />,    // Grid layout
    wide: <WideDashboard />           // Full featured
  }
  
  return layouts[deviceType]
}
```

### TypeScript Requirements (Strict Mode Enabled)
- Always use `interface` for component props (not `type` unless necessary)
- All props must be explicitly typed
- Include responsive props when needed:
  ```typescript
  interface ComponentProps {
    // ... other props
    showOnMobile?: boolean
    mobileLayout?: 'stack' | 'inline'
    collapsible?: boolean
  }
  ```
- Enable strict null checks and no implicit any
- Use TypeScript generics for reusable components

### Styling Rules (Mobile-First)

1. **ALWAYS use mobile-first Tailwind utilities**
   ```tsx
   // ✅ CORRECT: Mobile base, then larger screens
   <div className="p-3 sm:p-4 md:p-6 lg:p-8">
   
   // ❌ WRONG: Desktop-first
   <div className="p-8 md:p-6 sm:p-4">
   ```

2. **Use logical properties for RTL support**
   ```tsx
   // ✅ CORRECT: Logical properties
   className="ms-4 pe-6"  // margin-start, padding-end
   
   // ❌ WRONG: Directional properties
   className="ml-4 pr-6"  // margin-left, padding-right
   ```

3. **Responsive text sizing**
   ```tsx
   // ✅ CORRECT: Progressive text sizing
   className="text-sm sm:text-base md:text-lg lg:text-xl"
   ```

4. **Use `cn()` for conditional classes** from `@/lib/utils`

5. **Theme tokens**: Use CSS variables from GASTAT theme

### Breakpoint System (Use Consistently)

Your project uses custom breakpoints via CSS variables:
```typescript
// Breakpoint aliases (from useResponsive)
type BreakpointAlias = 'xs' | 'sm' | 'md' | 'lg'

// Device types
type DeviceType = 'mobile' | 'tablet' | 'desktop' | 'wide'

// Default breakpoint values
xs: 320px   // Mobile portrait
sm: 768px   // Tablet / mobile landscape
md: 1024px  // Desktop
lg: 1440px  // Wide desktop
```

Use the `useResponsive()` hook to access:
```typescript
const {
  width,              // Current viewport width
  height,             // Current viewport height
  orientation,        // 'portrait' | 'landscape'
  alias,              // 'xs' | 'sm' | 'md' | 'lg'
  deviceType,         // 'mobile' | 'tablet' | 'desktop' | 'wide'
  isMobile,           // Boolean
  isTablet,           // Boolean
  isDesktop,          // Boolean
  isWide,             // Boolean
  up,                 // (alias) => boolean
  down,               // (alias) => boolean
  between,            // (min, max) => boolean
  containerQueries    // Boolean - recommend container queries
} = useResponsive()
```

### Container Queries (Modern Approach)

Your project supports CSS Container Queries:

```typescript
import { ResponsiveWrapper } from '@/components/responsive/responsive-wrapper'

// Enable container queries for intrinsic responsive design
<ResponsiveWrapper enableContainer={true}>
  {/* Components can respond to container size, not viewport */}
  <div className="@container">
    <div className="@sm:flex @md:grid @lg:grid-cols-3">
      {/* Uses container query breakpoints */}
    </div>
  </div>
</ResponsiveWrapper>
```

### GASTAT Theme Integration (Mobile Optimized)

Your project has two themes with mobile-optimized touch targets:
- **GASTAT Theme** (default): Green primary, larger touch targets on mobile
- **Blue Sky Theme**: Twitter-inspired, adaptive sizing

Always use theme CSS variables and ensure minimum 44px touch targets on mobile:

```tsx
// Mobile-friendly button sizing
<Button className={cn(
  'min-h-[44px]',        // WCAG AA touch target (mobile)
  'sm:min-h-[40px]',     // Smaller on desktop
  'text-sm sm:text-base'
)}>
  {label}
</Button>
```

### Accessibility Requirements (Mobile + Desktop)

1. **Touch targets**: Minimum 44x44px on mobile (WCAG AA)
2. **Keyboard navigation**: All interactive elements accessible via keyboard
3. **Semantic HTML**: Use `<button>`, `<nav>`, `<main>`, `<section>`
4. **ARIA labels**: Required for icon-only buttons
5. **Form labels**: Every input must have an associated label
6. **Color contrast**: Minimum 4.5:1 for text (tested in both themes)
7. **Screen readers**: Support VoiceOver (iOS), TalkBack (Android), NVDA, JAWS
8. **Focus indicators**: Visible focus states on all interactive elements

### Data Fetching Patterns (Mobile-Optimized)

```typescript
import { useQuery, useMutation } from '@tanstack/react-query'
import { supabase } from '@/lib/supabase'
import { useResponsive } from '@/hooks/use-responsive'

// Fetch less data on mobile for performance
function useDossiers() {
  const { isMobile } = useResponsive()
  
  return useQuery({
    queryKey: ['dossiers', isMobile ? 'mobile' : 'desktop'],
    queryFn: async () => {
      const query = supabase
        .from('dossiers')
        .select(isMobile 
          ? 'id, title, status'           // Minimal data on mobile
          : 'id, title, status, *, relationships(*)'  // Full data on desktop
        )
        .order('created_at', { ascending: false })
        
      // Limit results on mobile
      if (isMobile) {
        query.limit(20)
      }
      
      const { data, error } = await query
      if (error) throw error
      return data
    },
    // Cache longer on mobile to save battery
    staleTime: isMobile ? 5 * 60 * 1000 : 2 * 60 * 1000
  })
}
```

## When to Build Custom Components

### Build new Kibo-style components when:
1. No existing Kibo UI component matches the need
2. Domain-specific composition needed (e.g., DossierCard, AssignmentPanel)
3. Complex stateful blocks (e.g., KanbanBoard, TimelineView, EntityGraph)
4. Application-specific patterns (e.g., WaitingQueueActions, TriagePanel)

### Custom Component Checklist:
- [ ] **Mobile-first design** - Tested on 320px viewport
- [ ] Uses `useResponsive()` hook for adaptive behavior
- [ ] Follows Kibo UI design language (spacing, colors, typography)
- [ ] Uses existing Kibo primitives from `src/components/ui/`
- [ ] Uses `ResponsiveCard` or `ResponsiveWrapper` when appropriate
- [ ] Accepts `className` prop for extensibility
- [ ] Uses `cn()` for class merging
- [ ] **Supports RTL/LTR** via `useDirection()` hook
- [ ] Uses logical CSS properties (ms-, pe-, etc.)
- [ ] TypeScript interfaces exported
- [ ] **Progressive enhancement** - works on mobile, enhanced on desktop
- [ ] Touch-friendly (44px minimum touch targets on mobile)
- [ ] Accessible (WCAG AA)
- [ ] Documented with JSDoc comments
- [ ] Performance optimized (lazy loading, pagination on mobile)

## Component Discovery Process

### Before creating ANY UI:
1. ⭐ **Check `useResponsive()` hook** - Is this responsive enough?
2. ⭐ **Check `src/components/responsive/`** - Do responsive wrappers exist?
3. Check `src/components/ui/` for existing primitives (already has 28+ components)
4. Check `src/components/` for domain-specific blocks
5. Check if similar pattern exists in your codebase
6. Check Kibo UI documentation: https://kibo-ui.com
7. If unsure, ask: "Does our project already have a responsive component for [use case]?"

### Existing Responsive Components (USE THESE!)
Your project already has these responsive utilities:
- **ResponsiveCard** - Auto-collapsing cards with mobile layouts
- **ResponsiveWrapper** - Container query support
- **ResponsiveCardGrid** - Adaptive grid layouts
- **responsive-nav.tsx** - Mobile navigation patterns
- **responsive-table.tsx** - Mobile-friendly tables

### Existing UI Components (Keep & Use These)
Your project has these shadcn/ui components in `src/components/ui/`:
- accordion, alert-dialog, alert, avatar, badge, button
- calendar, card, checkbox, dialog, dropdown-menu
- form, input, kanban, label, navigation-menu
- popover, progress, radio-group, scroll-area
- select, separator, sheet, sidebar, skeleton
- switch, table, tabs, textarea, tooltip

**ALWAYS use these existing components with responsive wrappers!**

## Progressive Design Anti-Patterns (AVOID)

❌ Building for desktop first, then trying to "shrink" to mobile  
❌ Using fixed pixel widths instead of responsive units  
❌ Ignoring `useResponsive()` hook  
❌ Not testing on actual mobile devices  
❌ Using directional CSS properties (ml-, pr-) instead of logical (ms-, pe-)  
❌ Forgetting RTL support (always test in Arabic)  
❌ Touch targets smaller than 44px on mobile  
❌ Loading desktop-sized images on mobile  
❌ Not using ResponsiveCard/ResponsiveWrapper when available  
❌ Hardcoding breakpoint values instead of using `useResponsive()`  

## Progressive Design Success Patterns (FOLLOW THESE)

✅ **Always start with mobile (320px) design**  
✅ **Use `useResponsive()` hook in every layout component**  
✅ **Wrap cards with `ResponsiveCard` for auto-adaptation**  
✅ **Use `ResponsiveCardGrid` for responsive grids**  
✅ **Progressive disclosure** - show less on mobile, more on desktop  
✅ **Viewport-specific rendering** when layouts differ significantly  
✅ **Container queries** for intrinsic responsive components  
✅ **Logical CSS properties** for RTL support (ms-, pe-, etc.)  
✅ **Test in both English (LTR) and Arabic (RTL)**  
✅ **44px minimum touch targets** on mobile  
✅ **Optimize data fetching** per device type  
✅ **Mobile-first Tailwind classes** (base, then sm:, md:, lg:)  

## Commands to Remember
```bash
# Development
pnpm dev                    # Start dev server (frontend on :5173)
pnpm build                  # Production build
pnpm preview                # Preview production build

# Database
pnpm db:migrate             # Run Supabase migrations
pnpm db:seed                # Seed database
pnpm db:reset               # Reset database

# Code Quality
pnpm lint                   # Lint code
pnpm typecheck              # TypeScript type checking
pnpm test                   # Run tests
pnpm test:e2e               # Run Playwright E2E tests

# Add new shadcn/ui component
npx shadcn@latest add [component]

# Test responsive design
# Open Chrome DevTools → Toggle device toolbar → Test on multiple devices
```

---

**Project Specific Notes:**
- This is a **monorepo** with `backend/`, `frontend/`, `mobile/`, and `shared/` workspaces
- Frontend uses **Vite** (not Next.js)
- Routing via **TanStack Router** (not Next.js App Router)
- State management via **Zustand** (not Redux)
- ⭐ **Progressive design is a core requirement** - not optional
- ⭐ **Mobile-first is mandatory** - test mobile before desktop
- ⭐ **Custom `useResponsive` hook** must be used for all adaptive layouts
- ⭐ **ResponsiveCard/ResponsiveWrapper** should be default choice for layouts
- **RTL/LTR support required** with Tajawal (Arabic) and Inter (English) fonts
- **GASTAT branding** required (green primary, blue secondary)
- **Offline-first mobile app** exists separately (React Native + Expo)

**Last Updated**: 2025-01-22  
**Kibo UI Version**: Latest (shadcn/ui compatible) + Custom Responsive Extensions
